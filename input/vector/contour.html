<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Contour &#8212; MapServer 8.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx.css?v=6c7b17ac" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=dd298242" />
    <link rel="stylesheet" type="text/css" href="../../_static/ribbon.css?v=ea091bf4" />
    
    <script src="../../_static/documentation_options.js?v=521b6f53"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="icon" href="../../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="DGN" href="dgn.html" />
    <link rel="prev" title="ArcSDE" href="arcsde.html" /> 
  </head><body>


<!-- for main branch only, do not backport this -->

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../../index.html" title="Home"><img src="../../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../../index.html" title="Home">Home</a> |
      <a href="../../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter" target="_blank">Twitter</a> |
      <a href="../../download.html" title="Download Source or Binaries">Download </a> |
      <a class="badge" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=KRJ2X44N3HA6U&source=url" target="_blank">
        <img src="https://img.shields.io/badge/donate-%E2%9D%A4%C2%A0-ff69b4.svg?style=flat" alt="Donate to MapServer">
      </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../../ar/input/vector/contour.html"><img src="../../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../../de/input/vector/contour.html"><img src="../../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../../el/input/vector/contour.html"><img src="../../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../../es/input/vector/contour.html"><img src="../../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../../fr/input/vector/contour.html"><img src="../../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../../id/input/vector/contour.html"><img src="../../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../../it/input/vector/contour.html"><img src="../../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../../ja/input/vector/contour.html"><img src="../../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../../nl_NL/input/vector/contour.html"><img src="../../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../../pl/input/vector/contour.html"><img src="../../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../../ru/input/vector/contour.html"><img src="../../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../../sq/input/vector/contour.html"><img src="../../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../../tr/input/vector/contour.html"><img src="../../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="dgn.html" title="DGN"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="arcsde.html" title="ArcSDE"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../documentation.html" >MapServer 8.0.1 Documentation</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../index.html" >Data Input</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="index.html" accesskey="U">Vector Data</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Contour</a></li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="contour">
<span id="index-0"></span><span id="id1"></span><h1>Contour<a class="headerlink" href="#contour" title="Link to this heading">¶</a></h1>
<section id="overview">
<h2>1. Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p>MapServer (since version 6.4) can compute and render a contour layer on the
fly from a raster source.  The raster source is one band of raster data, which
represents a digital elevation model (DEM).  More info about DEMs at:
<a class="reference external" href="http://en.wikipedia.org/wiki/Digital_elevation_model">http://en.wikipedia.org/wiki/Digital_elevation_model</a></p>
</section>
<section id="how-it-works">
<h2>2. How it works<a class="headerlink" href="#how-it-works" title="Link to this heading">¶</a></h2>
<p id="index-1">CONNECTIONTYPE CONTOUR. The new (to MapServer 6.4) type is a hybrid layer, which
has a raster data source as input and vector features as output. Initially,
only the line representation of those vector features will be supported. More
detailed information about the original implementation can be found in <a class="reference internal" href="../../development/rfc/ms-rfc-85.html#rfc85"><span class="std std-ref">RFC 85</span></a>.</p>
<p>Since the internal layer is of type vector, queries will be supported and
operate on the vectors (not on the raw raster source). In the future we might
see a need to add a query mode that queries the raster source, but this is not
included in this phase of work.</p>
<p>To render a contour layer, we need to define a layer in the mapfile with the
following options:</p>
<blockquote>
<div><ul class="simple">
<li><p>Set the layer TYPE to LINE.</p></li>
<li><p>Set CONNECTIONTYPE to CONTOUR.</p></li>
<li><p>Set the DATA to the raster file that contains the elevation band. Starting
with MapServer 7.0.1, a TILEINDEX can also be used, together with
<a class="reference internal" href="../../ogc/wms_time.html#wms-time"><span class="std std-ref">WMS Time</span></a> to specify which raster of the tileindex must be used.</p></li>
<li><p>Specify the band to use as elevation using PROCESSING “BANDS”, same as
regular raster.</p></li>
<li><p>Specify one or more classes and styles to render the line features.</p></li>
</ul>
</div></blockquote>
<p>PROCESSING settings:</p>
<blockquote>
<div><p>These options should be specified at layer level:</p>
<ul class="simple">
<li><p>CONTOUR_INTERVAL: elevation interval between contours</p></li>
<li><p>CONTOUR_LEVELS: comma-separated list of one or more ‘fixed levels’ to extract</p></li>
<li><p>CONTOUR_ITEM: provides a name for the item (attribute) in which to put the
elevation. (optional)</p></li>
</ul>
<blockquote>
<div><p>You can also provide explicit min/max scaledenom in the CONTOUR_iNTERVAL or
CONTOUR_LEVELS values if you wish to use scale-dependent contour spacing. This
is done by adding an optional “miscaledenom,maxscaledenom:” prefix to the
value or list of values. See the example below.</p>
</div></blockquote>
</div></blockquote>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you only set a single CONTOUR_INTERVAL for all scale ranges, MapServer
will likely crash at outer scale ranges (first example below).  More recent
GDAL versions (such as 3.2.0) will output an error message such as:
<em>“Input values and/or interval settings would lead to too many levels”</em>. To
avoid this, set multiple CONTOUR_INTERVAL lines to handle various scale ranges
(see the working Copernicus DEM example below, with output map images).</p>
</div>
<p>Example of a simple layer definition:</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">LAYER</span>
  <span class="k">NAME</span> <span class="s">&quot;my_contour_layer&quot;</span>
  <span class="k">TYPE</span> <span class="nb">LINE</span>
  <span class="k">STATUS</span> <span class="nb">DEFAULT</span>
  <span class="k">CONNECTIONTYPE</span> <span class="nb">CONTOUR</span>
  <span class="k">DATA</span> <span class="s">&quot;/mnt/data/raster/grib/dem.grib&quot;</span>
  <span class="k">PROCESSING</span> <span class="s">&quot;BANDS=1&quot;</span>
  <span class="k">PROCESSING</span> <span class="s">&quot;CONTOUR_ITEM=elevation&quot;</span>
  <span class="k">PROCESSING</span> <span class="s">&quot;CONTOUR_INTERVAL=10&quot;</span>
  <span class="k">CLASS</span>
    <span class="k">STYLE</span>
      <span class="k">WIDTH</span> <span class="mi">2</span>
      <span class="k">COLOR</span> <span class="mi">255</span> <span class="mi">0</span> <span class="mi">0</span>
    <span class="k">END</span>
  <span class="k">END</span>
<span class="k">END</span> <span class="c">#layer</span>
</pre></div>
</div>
<p>Example of a layer definition with scale-dependent contour ranges:</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">LAYER</span>
  <span class="k">NAME</span> <span class="s">&quot;my_contour_layer&quot;</span>
  <span class="k">TYPE</span> <span class="nb">LINE</span>
  <span class="k">STATUS</span> <span class="nb">DEFAULT</span>
  <span class="k">CONNECTIONTYPE</span> <span class="nb">CONTOUR</span>
  <span class="k">DATA</span> <span class="s">&quot;/mnt/data/raster/grib/dem.grib&quot;</span>
  <span class="k">PROCESSING</span> <span class="s">&quot;BANDS=1&quot;</span>
  <span class="k">PROCESSING</span> <span class="s">&quot;CONTOUR_ITEM=elevation&quot;</span>
  <span class="k">PROCESSING</span> <span class="s">&quot;CONTOUR_INTERVAL=0,25000:5&quot;</span> <span class="c"># interval of 5 for scales of 25000 or less</span>
  <span class="k">PROCESSING</span> <span class="s">&quot;CONTOUR_INTERVAL=25000,500000:10&quot;</span> <span class="c"># interval of 10 for scales in the 25000 to 500000 range</span>
  <span class="k">PROCESSING</span> <span class="s">&quot;CONTOUR_LEVELS=500000,0:10,25,50,100&quot;</span> <span class="c"># explicit list of levels for scales of 500000 and up</span>
  <span class="k">LABELITEM</span> <span class="s">&quot;elevation&quot;</span>
  <span class="k">CLASS</span>
    <span class="k">STYLE</span>
      <span class="k">WIDTH</span> <span class="mi">2</span>
      <span class="k">COLOR</span> <span class="mi">255</span> <span class="mi">0</span> <span class="mi">0</span>
    <span class="k">END</span>
    <span class="k">LABEL</span>
      <span class="p">...</span>
    <span class="k">END</span>
  <span class="k">END</span>
<span class="k">END</span> <span class="c">#layer</span>
</pre></div>
</div>
<p>Example of a layer definition with a tile index and WMS TIME support:</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">LAYER</span>
  <span class="k">NAME</span> <span class="s">&quot;my_contour_layer&quot;</span>
  <span class="k">TYPE</span> <span class="nb">LINE</span>
  <span class="k">STATUS</span> <span class="nb">OFF</span>
  <span class="k">CONNECTIONTYPE</span> <span class="nb">CONTOUR</span>
  <span class="k">TILEINDEX</span> <span class="s">&quot;data/contour_ti.shp&quot;</span>
  <span class="k">TILEITEM</span>  <span class="s">&quot;location&quot;</span>
  <span class="k">PROCESSING</span> <span class="s">&quot;BANDS=1&quot;</span>
  <span class="k">PROCESSING</span> <span class="s">&quot;CONTOUR_ITEM=elevation&quot;</span>
  <span class="k">PROCESSING</span> <span class="s">&quot;CONTOUR_INTERVAL=20&quot;</span>
  <span class="k">CLASS</span>
    <span class="k">STYLE</span>
      <span class="k">WIDTH</span> <span class="mi">1</span>
      <span class="k">COLOR</span> <span class="mi">255</span> <span class="mi">0</span> <span class="mi">0</span>
    <span class="k">END</span> <span class="c"># STYLE</span>
  <span class="k">END</span> <span class="c"># CLASS</span>

  <span class="k">METADATA</span>
    <span class="s">&quot;DESCRIPTION&quot;</span> <span class="s">&quot;contour&quot;</span>
    <span class="s">&quot;wms_title&quot;</span> <span class="s">&quot;contour&quot;</span>
    <span class="s">&quot;wms_timeitem&quot;</span>  <span class="s">&quot;TIME&quot;</span>
    <span class="s">&quot;wms_timeextent&quot;</span>  <span class="s">&quot;2004-01-01/2004-02-01&quot;</span>
  <span class="k">END</span> <span class="c"># METADATA</span>
<span class="k">END</span> <span class="c"># LAYER</span>
</pre></div>
</div>
<p>Example of a layer definition with scale-dependent contour ranges &amp; Copernicus EU DEM data:</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">LAYER</span>
  <span class="k">NAME</span> <span class="s">&quot;dem-contours&quot;</span>
  <span class="k">TYPE</span> <span class="nb">LINE</span>
  <span class="k">STATUS</span> <span class="nb">ON</span>
  <span class="k">CONNECTIONTYPE</span> <span class="nb">CONTOUR</span>
  <span class="k">DATA</span> <span class="s">&quot;eu_dem_v11_E40N20_clip.TIF&quot;</span>
  <span class="k">PROCESSING</span> <span class="s">&quot;BANDS=1&quot;</span>
  <span class="k">PROCESSING</span> <span class="s">&quot;CONTOUR_ITEM=Band_1&quot;</span>
  <span class="k">PROCESSING</span> <span class="s">&quot;CONTOUR_INTERVAL=0,25000:5&quot;</span> <span class="c"># interval of 5 for scales of 25000 or less</span>
  <span class="k">PROCESSING</span> <span class="s">&quot;CONTOUR_INTERVAL=25000,500000:10&quot;</span> <span class="c"># interval of 10 for scales in the 25000 to 500000 range</span>
  <span class="k">PROCESSING</span> <span class="s">&quot;CONTOUR_LEVELS=500000,0:10,25,50,100,200,300,400,500,600,700,800,900,1000&quot;</span> <span class="c"># explicit list of levels for scales of 500000 and up</span>
  <span class="k">CLASS</span>
    <span class="k">NAME</span> <span class="s">&quot;Contours&quot;</span>
    <span class="k">STYLE</span>
      <span class="k">WIDTH</span> <span class="mi">1</span>
      <span class="k">COLOR</span> <span class="mi">139</span> <span class="mi">69</span> <span class="mi">19</span>
    <span class="k">END</span>
  <span class="k">END</span>
<span class="k">END</span> <span class="c"># layer</span>
</pre></div>
</div>
<p><strong>Figure: contours zoomed-out to coastline (Corsica island) generated from Copernicus EU DEM</strong></p>
<img alt="../../_images/contour-coastline.png" class="no-scaled-link" src="../../_images/contour-coastline.png" style="width: 600px; height: 400px;" />
<p><strong>Figure: contours zoomed-in (Corsica island) generated from Copernicus EU DEM</strong></p>
<img alt="../../_images/contour.png" class="no-scaled-link" src="../../_images/contour.png" style="width: 600px; height: 400px;" />
</section>
<section id="data-cellsize">
<h2>2.1 Data cellsize<a class="headerlink" href="#data-cellsize" title="Link to this heading">¶</a></h2>
<p>The data produced by the gdal contour algorithm are generally in high
resolution. A lot of point are used to generated contours with precision. You
might want to generalize/simplify the line in some cases (ie. Shape
Smoothing). The <cite>[data_cellsize]</cite> attribute binding represents the cellsize of
the extend fetched from the raster file. This is different than the map
cellsize.</p>
<p>In the following example, I generalize my shape with a tolerance of 25% of the
data cellsize to produce smooth contours at all scales:</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">LAYER</span>
  <span class="k">NAME</span> <span class="s">&quot;MyContourLayer&quot;</span>
  <span class="k">STATUS</span> <span class="nb">DEFAULT</span>
  <span class="k">DATA</span> <span class="s">&quot;wind.tif&quot;</span>
  <span class="k">TYPE</span> <span class="nb">LINE</span>
  <span class="k">CONNECTIONTYPE</span> <span class="nb">CONTOUR</span>
  <span class="k">PROJECTION</span> <span class="nb">AUTO</span> <span class="k">END</span>
  <span class="k">PROCESSING</span> <span class="s">&quot;BANDS=1&quot;</span>
  <span class="k">PROCESSING</span> <span class="s">&quot;CONTOUR_ITEM=elevation&quot;</span>
  <span class="k">PROCESSING</span> <span class="s">&quot;CONTOUR_INTERVAL=0,0:1&quot;</span>
  <span class="k">GEOMTRANSFORM</span> <span class="p">(</span><span class="err">smoothsia</span><span class="p">(</span><span class="err">generalize</span><span class="p">([</span><span class="err">shape</span><span class="p">],</span> <span class="mf">0.25</span><span class="o">*</span><span class="nx">[data_cellsize]</span><span class="p">)))</span>
  <span class="k">CLASS</span>
    <span class="k">EXPRESSION</span> <span class="p">([</span><span class="err">elevati</span><span class="nb">on</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">STYLE</span>
      <span class="k">COLOR</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">255</span>
    <span class="k">END</span> <span class="c"># STYLE</span>
  <span class="k">END</span> <span class="c"># CLASS</span>
<span class="k">END</span> <span class="c"># LAYER</span>
</pre></div>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p>
<a href="../../about.html" title="About">About</a><br>
<a href="../../products.html" title="Products">Products</a><br>
<a href="../../community/index.html" title="Community">Community</a><br>
<a href="../../development/index.html" title="Development">Development</a><br>
<a href="../../download.html" title="Downloads">Downloads</a><br>
<a href="../../documentation.html" title="Documentation">Documentation</a><br>
<a href="../../faq.html" title="FAQ">FAQ</a><br>
<a href="../../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</h3>
  <ul>
<li><a class="reference internal" href="#">Contour</a><ul>
<li><a class="reference internal" href="#overview">1. Overview</a></li>
<li><a class="reference internal" href="#how-it-works">2. How it works</a></li>
<li><a class="reference internal" href="#data-cellsize">2.1 Data cellsize</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="dgn.html" title="DGN"
             >next</a> |</li>
        <li class="right" >
          <a href="arcsde.html" title="ArcSDE"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../documentation.html" >MapServer 8.0.1 Documentation</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../index.html" >Data Input</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="index.html" >Vector Data</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Contour</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; <a href="../../copyright.html">Copyright</a> 2023, Open Source Geospatial Foundation.
      Last updated on 2023-12-22.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.5.
    </div>
  </body>
</html>