<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>PostGIS/PostgreSQL &#8212; MapServer 8.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx.css?v=6c7b17ac" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=dd298242" />
    <link rel="stylesheet" type="text/css" href="../../_static/ribbon.css?v=ea091bf4" />
    
    <script src="../../_static/documentation_options.js?v=521b6f53"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="icon" href="../../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="SDTS" href="sdts.html" />
    <link rel="prev" title="Oracle Spatial" href="oracle.html" /> 
  </head><body>


<!-- for main branch only, do not backport this -->

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../../index.html" title="Home"><img src="../../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../../index.html" title="Home">Home</a> |
      <a href="../../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter" target="_blank">Twitter</a> |
      <a href="../../download.html" title="Download Source or Binaries">Download </a> |
      <a class="badge" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=KRJ2X44N3HA6U&source=url" target="_blank">
        <img src="https://img.shields.io/badge/donate-%E2%9D%A4%C2%A0-ff69b4.svg?style=flat" alt="Donate to MapServer">
      </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../../ar/input/vector/postgis.html"><img src="../../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../../de/input/vector/postgis.html"><img src="../../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../../el/input/vector/postgis.html"><img src="../../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../../es/input/vector/postgis.html"><img src="../../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../../fr/input/vector/postgis.html"><img src="../../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../../id/input/vector/postgis.html"><img src="../../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../../it/input/vector/postgis.html"><img src="../../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../../ja/input/vector/postgis.html"><img src="../../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../../nl_NL/input/vector/postgis.html"><img src="../../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../../pl/input/vector/postgis.html"><img src="../../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../../ru/input/vector/postgis.html"><img src="../../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../../sq/input/vector/postgis.html"><img src="../../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../../tr/input/vector/postgis.html"><img src="../../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="sdts.html" title="SDTS"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="oracle.html" title="Oracle Spatial"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../documentation.html" >MapServer 8.0.1 Documentation</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../index.html" >Data Input</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="index.html" accesskey="U">Vector Data</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">PostGIS/PostgreSQL</a></li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="postgis-postgresql">
<span id="input-postgis"></span><h1><a class="toc-backref" href="#table-of-contents" role="doc-backlink">PostGIS/PostgreSQL</a><a class="headerlink" href="#postgis-postgresql" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Author<span class="colon">:</span></dt>
<dd class="field-odd"><p>Jeff McKenna</p>
</dd>
<dt class="field-even">Contact<span class="colon">:</span></dt>
<dd class="field-even"><p>jmckenna at gatewaygeomatics.com</p>
</dd>
<dt class="field-odd">Last Updated<span class="colon">:</span></dt>
<dd class="field-odd"><p>2022-04-25</p>
</dd>
</dl>
<nav class="contents" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#postgis-postgresql" id="id2">PostGIS/PostgreSQL</a></p>
<ul>
<li><p><a class="reference internal" href="#id1" id="id3">PostGIS/PostgreSQL</a></p></li>
<li><p><a class="reference internal" href="#data-access-connection-method" id="id4">Data Access /Connection Method</a></p></li>
<li><p><a class="reference internal" href="#ogrinfo-examples" id="id5">OGRINFO Examples</a></p></li>
<li><p><a class="reference internal" href="#mapfile-example" id="id6">Mapfile Example</a></p></li>
<li><p><a class="reference internal" href="#postgis-raster-pgraster" id="id7">PostGIS Raster (PGRaster)</a></p>
<ul>
<li><p><a class="reference internal" href="#load-raster-data" id="id8">Load Raster DATA</a></p></li>
<li><p><a class="reference internal" href="#connect-with-gdalinfo" id="id9">Connect with GDALINFO</a></p></li>
<li><p><a class="reference internal" href="#mapfile-layer" id="id10">Mapfile Layer</a></p></li>
<li><p><a class="reference internal" href="#test-with-map2img" id="id11">Test with map2img</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#support-for-2-5d-geometries" id="id12">Support for 2.5D geometries</a></p></li>
<li><p><a class="reference internal" href="#support-for-sql-mm-curves" id="id13">Support for SQL/MM Curves</a></p>
<ul>
<li><p><a class="reference internal" href="#example-1-circularstring-in-mapserver" id="id14">Example#1: CircularString in MapServer</a></p></li>
<li><p><a class="reference internal" href="#example-2-compoundcurve-in-mapserver" id="id15">Example#2: CompoundCurve in MapServer</a></p></li>
<li><p><a class="reference internal" href="#example-3-curvepolygon-in-mapserver" id="id16">Example#3: CurvePolygon in MapServer</a></p></li>
<li><p><a class="reference internal" href="#example-4-multicurve-in-mapserver" id="id17">Example#4: MultiCurve in MapServer</a></p></li>
<li><p><a class="reference internal" href="#example-5-multisurface-in-mapserver" id="id18">Example#5: MultiSurface in MapServer</a></p></li>
<li><p><a class="reference internal" href="#using-mapserver-6-0" id="id19">Using MapServer &lt; 6.0</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
<section id="id1">
<h2><a class="toc-backref" href="#table-of-contents" role="doc-backlink">PostGIS/PostgreSQL</a><a class="headerlink" href="#id1" title="Link to this heading">¶</a></h2>
<p><a class="reference external" href="https://postgis.net/">PostGIS</a> spatially enables the
Open Source <a class="reference external" href="https://www.postgresql.org/">PostgreSQL</a> database.</p>
<p>The <a class="reference external" href="https://github.com/MapServer/MapServer/wiki/PostGIS">PostGIS wiki page</a>
may include additional information.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Be sure that you have loaded the extension into your database:
<em>CREATE EXTENSION postgis;</em></p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If you have upgraded PostGIS, be sure to execute the following
on your database: <em>SELECT postgis_extensions_upgrade();</em></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../../optimization/vector.html#vector-optimization"><span class="std std-ref">Vector Data Management &amp; Optimization</span></a></p>
</div>
</section>
<section id="data-access-connection-method">
<h2><a class="toc-backref" href="#table-of-contents" role="doc-backlink">Data Access /Connection Method</a><a class="headerlink" href="#data-access-connection-method" title="Link to this heading">¶</a></h2>
<p>PostGIS is supported directly by MapServer and must be compiled into
MapServer to work.</p>
<p>The PostgreSQL client libraries (<em>libpq.so</em> or <em>libpq.dll</em>) must be
present in the system’s path environment for functionality to be
present.</p>
<p>The <a class="reference internal" href="../../mapfile/layer.html#mapfile-layer-connectiontype"><span class="std std-ref">CONNECTIONTYPE</span></a> parameter must be set to POSTGIS.</p>
<p>The <a class="reference internal" href="../../mapfile/layer.html#mapfile-layer-connection"><span class="std std-ref">CONNECTION</span></a> parameter is used to specify the parameters to connect
to the database. CONNECTION parameters can be in any order.  Most are
optional.  <em>dbname</em> is required.  <em>user</em> is required.  <em>host</em> defaults to
localhost, <em>port</em> defaults to 5432 (the standard port for PostgreSQL).</p>
<p>The DATA parameter is used to specify the data used to draw the map.
The form of DATA is “[geometry_column] from [table_name|sql_subquery]
using unique [unique_key] using srid=[spatial_reference_id]”.  The
“using unique” and “using srid=” clauses are optional when drawing
features, but using them improves performance. If you want to make
MapServer query calls to a PostGIS layer, your DATA parameter must
include “using unique”. Omitting it will cause the query to fail.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If you are trying to execute a query and receive the message
<cite>“ERROR:  column oid does not exist at character…”</cite> it is likely
that you are missing the <cite>using unique</cite> part in your DATA parameter.
If you don’t specify a unique ID column, then MapServer will try to
look for one (at the cost of executing a few more queries).  It is
therefore best to <strong>always</strong> specify a unique ID column
in your DATA statement.  If your table does not have a unique ID column,
you can add one such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ALTER</span> <span class="n">TABLE</span> <span class="n">mytable</span> <span class="n">ADD</span> <span class="n">COLUMN</span> <span class="n">unique_id</span> <span class="n">SERIAL</span> <span class="n">PRIMARY</span> <span class="n">KEY</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>OIDs were removed from PostgreSQL as of the PostgreSQL 12.0 release.
It is recommended to specify a different unique ID column instead,
in your layer’s DATA statement, of your mapfile.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Variable binding is supported by using <a class="reference internal" href="../../mapfile/layer.html#mapfile-layer-bindvals"><span class="std std-ref">BINDVALS</span></a>
and name value pairs.</p>
</div>
<p>Here is a simple generic example:</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">CONNECTIONTYPE</span> <span class="nb">POSTGIS</span>
<span class="k">CONNECTION</span> <span class="s">&quot;host=yourhostname dbname=yourdatabasename user=yourdbusername</span>
            <span class="err">password</span><span class="o">=</span><span class="err">yourdbpassword</span> <span class="err">port</span><span class="o">=</span><span class="err">yourpgport</span><span class="s">&quot;</span>
<span class="k">DATA</span> <span class="s">&quot;geometrycolumn from yourtablename&quot;</span>
</pre></div>
</div>
<p>This example shows specifying the unique key and srid in the DATA line:</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">CONNECTIONTYPE</span> <span class="nb">POSTGIS</span>
<span class="k">CONNECTION</span> <span class="s">&quot;dbname=yourdatabasename user=yourdbusername&quot;</span>
<span class="k">DATA</span> <span class="s">&quot;the_geom from the_database using unique gid using srid=4326&quot;</span>
</pre></div>
</div>
<p>This example shows using a SQL subquery to perform a join inside the
database and map the result in MapServer. Note the “as subquery”
string in the statement – everything between “from” and “using” is
sent to the database for evaluation:</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">CONNECTIONTYPE</span> <span class="nb">POSTGIS</span>
<span class="k">CONNECTION</span> <span class="s">&quot;dbname=yourdatabasename user=yourdbusername&quot;</span>
<span class="k">DATA</span> <span class="s">&quot;the_geom from (select g.gid, g.the_geom, a.attr1, a.attr2 from</span>
      <span class="err">geo</span><span class="k">table</span> <span class="err">g</span> <span class="k">join</span> <span class="err">attr</span><span class="k">table</span> <span class="err">a</span> <span class="nb">on</span> <span class="err">g</span><span class="p">.</span><span class="err">gid</span> <span class="o">=</span> <span class="err">a</span><span class="p">.</span><span class="err">aid</span><span class="p">)</span> <span class="err">as</span> <span class="err">sub</span><span class="nb">query</span>
      <span class="err">using</span> <span class="err">unique</span> <span class="err">gid</span> <span class="err">using</span> <span class="err">srid</span><span class="o">=</span><span class="mi">4326</span><span class="s">&quot;</span>
</pre></div>
</div>
<p>This example shows using a geometry function and database sort to
limit the number of features and vertices returned to MapServer:</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">CONNECTIONTYPE</span> <span class="nb">POSTGIS</span>
<span class="k">CONNECTION</span> <span class="s">&quot;dbname=yourdatabasename user=yourdbusername&quot;</span>
<span class="k">DATA</span> <span class="s">&quot;the_geom from (select g.gid, ST_Simplify(g.the_geom, 10.0) as</span>
      <span class="err">the_geom</span> <span class="k">from</span> <span class="err">geo</span><span class="k">table</span> <span class="err">g</span> <span class="err">order</span> <span class="err">by</span> <span class="err">ST_Area</span><span class="p">(</span><span class="err">g</span><span class="p">.</span><span class="err">the_geom</span><span class="p">)</span> <span class="err">desc</span>
      <span class="err">limit</span> <span class="mi">10</span><span class="p">)</span> <span class="err">as</span> <span class="err">sub</span><span class="nb">query</span> <span class="err">using</span> <span class="err">unique</span> <span class="err">gid</span> <span class="err">using</span> <span class="err">srid</span><span class="o">=</span><span class="mi">4326</span><span class="s">&quot;</span>
</pre></div>
</div>
<p>This example shows the use of the !BOX! substitution string to
over-ride the default inclusion of the map bounding box in the SQL. By
default the spatial box clause is appended to the SQL in the DATA
clause, but you can use !BOX! to insert it anywhere you like in the
statement. In general, you won’t need to use !BOX!, because the
PostgreSQL planner will generate the optimal plan from the generated
SQL, but in some cases (complex sub-queries) a better plan can be
generated by placing the !BOX! closer to the middle of the query:</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">CONNECTIONTYPE</span> <span class="nb">POSTGIS</span>
<span class="k">CONNECTION</span> <span class="s">&quot;dbname=yourdatabasename user=yourdbusername&quot;</span>
<span class="k">DATA</span> <span class="s">&quot;the_geom from (select g.gid, ST_Union(g.the_geom, 10.0) as</span>
      <span class="err">the_geom</span> <span class="k">from</span> <span class="err">geo</span><span class="k">table</span> <span class="err">g</span> <span class="err">where</span> <span class="err">ST_Intersects</span><span class="p">(</span><span class="err">g</span><span class="p">.</span><span class="err">geom</span><span class="p">,</span><span class="err">!BOX!</span><span class="p">))</span> <span class="err">as</span>
      <span class="err">sub</span><span class="nb">query</span> <span class="err">using</span> <span class="err">unique</span> <span class="err">gid</span> <span class="err">using</span> <span class="err">srid</span><span class="o">=</span><span class="mi">4326</span><span class="s">&quot;</span>
</pre></div>
</div>
</section>
<section id="ogrinfo-examples">
<h2><a class="toc-backref" href="#table-of-contents" role="doc-backlink">OGRINFO Examples</a><a class="headerlink" href="#ogrinfo-examples" title="Link to this heading">¶</a></h2>
<p>OGRINFO can be used to read out metadata about PostGIS tables directly
from the database.</p>
<p>First you should make sure that your GDAL/OGR build contains the
PostgreSQL driver, by using the ‘–formats’ command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">ogrinfo</span> <span class="o">--</span><span class="n">formats</span>

  <span class="n">Supported</span> <span class="n">formats</span><span class="p">:</span>
  <span class="o">...</span>
    <span class="n">PGeo</span> <span class="o">-</span><span class="n">vector</span><span class="o">-</span> <span class="p">(</span><span class="n">ro</span><span class="p">):</span> <span class="n">ESRI</span> <span class="n">Personal</span> <span class="n">GeoDatabase</span>
    <span class="n">MSSQLSpatial</span> <span class="o">-</span><span class="n">vector</span><span class="o">-</span> <span class="p">(</span><span class="n">rw</span><span class="o">+</span><span class="p">):</span> <span class="n">Microsoft</span> <span class="n">SQL</span> <span class="n">Server</span> <span class="n">Spatial</span> <span class="n">Database</span>
    <span class="n">PostgreSQL</span> <span class="o">-</span><span class="n">vector</span><span class="o">-</span> <span class="p">(</span><span class="n">rw</span><span class="o">+</span><span class="p">):</span> <span class="n">PostgreSQL</span><span class="o">/</span><span class="n">PostGIS</span>
    <span class="n">MySQL</span> <span class="o">-</span><span class="n">vector</span><span class="o">-</span> <span class="p">(</span><span class="n">rw</span><span class="o">+</span><span class="p">):</span> <span class="n">MySQL</span>
  <span class="o">...</span>
</pre></div>
</div>
<p>If you don’t have the driver, you might want to try the <a class="reference external" href="http://fwtools.maptools.org">FWTools</a> or
<a class="reference external" href="https://ms4w.com">MS4W</a> packages, which include the driver.</p>
<p>Once you have the driver you are ready to try an ogrinfo command on
your database to get a list of spatial tables:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&gt;ogrinfo PG:&quot;host=127.0.0.1 user=postgres password=postgres dbname=canada port=5432&quot;
      using driver `PostgreSQL&#39; successful.
      1: province (Polygon)
</pre></div>
</div>
<p>Now use ogrinfo to get information on the structure of the spatial table:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&gt;ogrinfo PG:&quot;host=127.0.0.1 user=postgres password=postgres dbname=canada port=5432&quot; province -summary

 INFO: Open of `PG:host=127.0.0.1 user=postgres password=postgres dbname=canada&#39;
    using driver `PostgreSQL&#39; successful.

  Layer name: province
  Geometry: Polygon
  Feature Count: 1068
  Extent: (-2340603.750000, -719746.062500) - (3009430.500000, 3836605.250000)
  Layer SRS WKT:
  PROJCS[&quot;NAD83 / Canada Atlas Lambert&quot;,
      GEOGCS[&quot;NAD83&quot;,
          DATUM[&quot;North_American_Datum_1983&quot;,
              SPHEROID[&quot;GRS 1980&quot;,6378137,298.257222101,
                  AUTHORITY[&quot;EPSG&quot;,&quot;7019&quot;]],
              TOWGS84[0,0,0,0,0,0,0],
              AUTHORITY[&quot;EPSG&quot;,&quot;6269&quot;]],
          PRIMEM[&quot;Greenwich&quot;,0,
              AUTHORITY[&quot;EPSG&quot;,&quot;8901&quot;]],
          UNIT[&quot;degree&quot;,0.0174532925199433,
              AUTHORITY[&quot;EPSG&quot;,&quot;9122&quot;]],
          AUTHORITY[&quot;EPSG&quot;,&quot;4269&quot;]],
      PROJECTION[&quot;Lambert_Conformal_Conic_2SP&quot;],
      PARAMETER[&quot;standard_parallel_1&quot;,49],
      PARAMETER[&quot;standard_parallel_2&quot;,77],
      PARAMETER[&quot;latitude_of_origin&quot;,49],
      PARAMETER[&quot;central_meridian&quot;,-95],
      PARAMETER[&quot;false_easting&quot;,0],
      PARAMETER[&quot;false_northing&quot;,0],
      UNIT[&quot;metre&quot;,1,
          AUTHORITY[&quot;EPSG&quot;,&quot;9001&quot;]],
      AXIS[&quot;Easting&quot;,EAST],
      AXIS[&quot;Northing&quot;,NORTH],
      AUTHORITY[&quot;EPSG&quot;,&quot;3978&quot;]]
  FID Column = ogc_fid
  Geometry Column = wkb_geometry
  ...
</pre></div>
</div>
</section>
<section id="mapfile-example">
<h2><a class="toc-backref" href="#table-of-contents" role="doc-backlink">Mapfile Example</a><a class="headerlink" href="#mapfile-example" title="Link to this heading">¶</a></h2>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">LAYER</span>
  <span class="k">NAME</span> <span class="s">&quot;province&quot;</span>
  <span class="k">STATUS</span> <span class="nb">ON</span>
  <span class="k">TYPE</span> <span class="nb">POLYGON</span>
  <span class="k">CONNECTIONTYPE</span> <span class="nb">POSTGIS</span>
  <span class="k">CONNECTION</span> <span class="s">&quot;host=127.0.0.1 user=postgres password=postgres port=5432 dbname=canada&quot;</span>
  <span class="k">DATA</span> <span class="s">&quot;wkb_geometry FROM province USING UNIQUE ogc_fid USING srid=3978&quot;</span>
  <span class="k">EXTENT</span> <span class="p">-</span><span class="mf">2340603.750000</span> <span class="p">-</span><span class="mf">719746.062500</span> <span class="mf">3009430.500000</span> <span class="mf">3836605.250000</span> <span class="c"># for maximum performance</span>
  <span class="k">PROCESSING</span> <span class="s">&quot;CLOSE_CONNECTION=DEFER&quot;</span> <span class="c"># for maximum performance</span>
  <span class="k">CLASS</span>
    <span class="k">NAME</span> <span class="s">&quot;Provincial Land&quot;</span>
    <span class="k">STYLE</span>
      <span class="k">COLOR</span> <span class="mi">240</span> <span class="mi">240</span> <span class="mi">240</span>
      <span class="k">OUTLINECOLOR</span> <span class="mi">199</span> <span class="mi">199</span> <span class="mi">199</span>
    <span class="k">END</span>
  <span class="k">END</span>
  <span class="k">PROJECTION</span> <span class="c">#source</span>
    <span class="s">&quot;init=epsg:3978&quot;</span>
  <span class="k">END</span>
<span class="k">END</span>
</pre></div>
</div>
<p>For more info about PostGIS and MapServer see the PostGIS docs:
<a class="reference external" href="https://postgis.net/documentation/">https://postgis.net/documentation/</a></p>
</section>
<section id="postgis-raster-pgraster">
<h2><a class="toc-backref" href="#table-of-contents" role="doc-backlink">PostGIS Raster (PGRaster)</a><a class="headerlink" href="#postgis-raster-pgraster" title="Link to this heading">¶</a></h2>
<p>Since the PostGIS 2.0 release, PostGIS includes support for raster data,
which can be accessed by MapServer (through GDAL).</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Be sure that you have loaded the extension into your database:
<em>CREATE EXTENSION postgis_raster;</em></p>
</div>
<section id="load-raster-data">
<h3><a class="toc-backref" href="#table-of-contents" role="doc-backlink">Load Raster DATA</a><a class="headerlink" href="#load-raster-data" title="Link to this heading">¶</a></h3>
<p>You must use <em>raster2pgsql</em> to load your raster data into PostGIS
(see <a class="reference external" href="https://postgis.net/docs/using_raster_dataman.html">postgis.net</a> for usage), such
as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">raster2pgsql</span> <span class="o">-</span><span class="n">s</span> <span class="mi">2961</span> <span class="o">-</span><span class="n">I</span> <span class="o">-</span><span class="n">C</span> <span class="o">-</span><span class="n">M</span> <span class="o">-</span><span class="n">F</span> <span class="o">-</span><span class="n">t</span> <span class="n">auto</span> <span class="o">-</span><span class="n">l</span> <span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">8</span> <span class="n">colorhillshade_dtm_1m_utm20_w_10_91</span><span class="o">.</span><span class="n">tif</span> <span class="n">lunenburg_colorhillshade</span> <span class="o">&gt;</span> <span class="n">raster</span><span class="o">.</span><span class="n">sql</span>
<span class="n">psql</span> <span class="o">-</span><span class="n">U</span> <span class="n">postgres</span> <span class="o">-</span><span class="n">p</span> <span class="mi">5432</span> <span class="o">-</span><span class="n">d</span> <span class="n">mydb</span> <span class="o">-</span><span class="n">f</span> <span class="n">raster</span><span class="o">.</span><span class="n">sql</span>
</pre></div>
</div>
<p>The above will create a new <em>lunenburg_colorhillshade</em> table from a GeoTIFF
file.</p>
<dl class="simple">
<dt>Important points for display in MapServer:</dt><dd><ul class="simple">
<li><p>be sure to set the <em>-t</em> switch to tile the raster</p></li>
<li><p>be sure to set the <em>-I</em> switch to create a GiST index on the raster</p></li>
<li><p>be sure to set the <em>-C</em> switch to apply raster constraints</p></li>
<li><p>be sure to set the <em>-F</em> switch to add a column with the name of the raster file</p></li>
</ul>
</dd>
</dl>
</section>
<section id="connect-with-gdalinfo">
<h3><a class="toc-backref" href="#table-of-contents" role="doc-backlink">Connect with GDALINFO</a><a class="headerlink" href="#connect-with-gdalinfo" title="Link to this heading">¶</a></h3>
<p>Use the <em>gdalinfo</em> utility to list the available raster tables in your
database, such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gdalinfo</span> <span class="n">PG</span><span class="p">:</span><span class="s2">&quot;host=127.0.0.1 port=5432 user=postgres password=postgres dbname=mydb&quot;</span>
</pre></div>
</div>
<p>which returns something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Driver</span><span class="p">:</span> <span class="n">PostGISRaster</span><span class="o">/</span><span class="n">PostGIS</span> <span class="n">Raster</span> <span class="n">driver</span>

<span class="n">Subdatasets</span><span class="p">:</span>
  <span class="o">...</span>
    <span class="n">SUBDATASET_3_NAME</span><span class="o">=</span><span class="n">PG</span><span class="p">:</span><span class="n">host</span><span class="o">=</span><span class="mf">127.0.0.1</span> <span class="n">port</span><span class="o">=</span><span class="mi">5432</span> <span class="n">user</span><span class="o">=</span><span class="n">postgres</span> <span class="n">password</span><span class="o">=</span><span class="n">postgres</span> <span class="n">dbname</span><span class="o">=</span><span class="n">mydb</span>  <span class="n">schema</span><span class="o">=</span><span class="s1">&#39;public&#39;</span> <span class="n">table</span><span class="o">=</span><span class="s1">&#39;lunenburg_colorhillshade&#39;</span> <span class="n">column</span><span class="o">=</span><span class="s1">&#39;rast&#39;</span>
    <span class="n">SUBDATASET_3_DESC</span><span class="o">=</span><span class="n">PostGIS</span> <span class="n">Raster</span> <span class="n">table</span> <span class="n">at</span> <span class="n">public</span><span class="o">.</span><span class="n">lunenburg_colorhillshade</span> <span class="p">(</span><span class="n">rast</span><span class="p">)</span>
  <span class="o">...</span>
</pre></div>
</div>
<p>Next specify the <em>table</em> and <em>column</em>, with the <em>-nomd</em> switch, such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gdalinfo</span> <span class="n">PG</span><span class="p">:</span><span class="s2">&quot;host=127.0.0.1 port=5432 user=postgres password=postgres dbname=mydb table=lunenburg_colorhillshade column=rast&quot;</span> <span class="o">-</span><span class="n">nomd</span>
</pre></div>
</div>
<p>which returns a summary of the raster, including its projection
(<a class="reference external" href="https://epsg.io/2961">EPSG:2961</a>) :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Driver</span><span class="p">:</span> <span class="n">PostGISRaster</span><span class="o">/</span><span class="n">PostGIS</span> <span class="n">Raster</span> <span class="n">driver</span>
<span class="n">Coordinate</span> <span class="n">System</span> <span class="ow">is</span><span class="p">:</span>
<span class="n">PROJCS</span><span class="p">[</span><span class="s2">&quot;NAD83(CSRS) / UTM zone 20N&quot;</span><span class="p">,</span>
    <span class="n">GEOGCS</span><span class="p">[</span><span class="s2">&quot;NAD83(CSRS)&quot;</span><span class="p">,</span>
        <span class="n">DATUM</span><span class="p">[</span><span class="s2">&quot;NAD83_Canadian_Spatial_Reference_System&quot;</span><span class="p">,</span>
            <span class="n">SPHEROID</span><span class="p">[</span><span class="s2">&quot;GRS 1980&quot;</span><span class="p">,</span><span class="mi">6378137</span><span class="p">,</span><span class="mf">298.257222101</span><span class="p">,</span>
                <span class="n">AUTHORITY</span><span class="p">[</span><span class="s2">&quot;EPSG&quot;</span><span class="p">,</span><span class="s2">&quot;7019&quot;</span><span class="p">]],</span>
            <span class="n">TOWGS84</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">AUTHORITY</span><span class="p">[</span><span class="s2">&quot;EPSG&quot;</span><span class="p">,</span><span class="s2">&quot;6140&quot;</span><span class="p">]],</span>
        <span class="n">PRIMEM</span><span class="p">[</span><span class="s2">&quot;Greenwich&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">AUTHORITY</span><span class="p">[</span><span class="s2">&quot;EPSG&quot;</span><span class="p">,</span><span class="s2">&quot;8901&quot;</span><span class="p">]],</span>
        <span class="n">UNIT</span><span class="p">[</span><span class="s2">&quot;degree&quot;</span><span class="p">,</span><span class="mf">0.0174532925199433</span><span class="p">,</span>
            <span class="n">AUTHORITY</span><span class="p">[</span><span class="s2">&quot;EPSG&quot;</span><span class="p">,</span><span class="s2">&quot;9122&quot;</span><span class="p">]],</span>
        <span class="n">AUTHORITY</span><span class="p">[</span><span class="s2">&quot;EPSG&quot;</span><span class="p">,</span><span class="s2">&quot;4617&quot;</span><span class="p">]],</span>
    <span class="n">PROJECTION</span><span class="p">[</span><span class="s2">&quot;Transverse_Mercator&quot;</span><span class="p">],</span>
    <span class="n">PARAMETER</span><span class="p">[</span><span class="s2">&quot;latitude_of_origin&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
    <span class="n">PARAMETER</span><span class="p">[</span><span class="s2">&quot;central_meridian&quot;</span><span class="p">,</span><span class="o">-</span><span class="mi">63</span><span class="p">],</span>
    <span class="n">PARAMETER</span><span class="p">[</span><span class="s2">&quot;scale_factor&quot;</span><span class="p">,</span><span class="mf">0.9996</span><span class="p">],</span>
    <span class="n">PARAMETER</span><span class="p">[</span><span class="s2">&quot;false_easting&quot;</span><span class="p">,</span><span class="mi">500000</span><span class="p">],</span>
    <span class="n">PARAMETER</span><span class="p">[</span><span class="s2">&quot;false_northing&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
    <span class="n">UNIT</span><span class="p">[</span><span class="s2">&quot;metre&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">AUTHORITY</span><span class="p">[</span><span class="s2">&quot;EPSG&quot;</span><span class="p">,</span><span class="s2">&quot;9001&quot;</span><span class="p">]],</span>
    <span class="n">AXIS</span><span class="p">[</span><span class="s2">&quot;Easting&quot;</span><span class="p">,</span><span class="n">EAST</span><span class="p">],</span>
    <span class="n">AXIS</span><span class="p">[</span><span class="s2">&quot;Northing&quot;</span><span class="p">,</span><span class="n">NORTH</span><span class="p">],</span>
    <span class="n">AUTHORITY</span><span class="p">[</span><span class="s2">&quot;EPSG&quot;</span><span class="p">,</span><span class="s2">&quot;2961&quot;</span><span class="p">]]</span>
</pre></div>
</div>
</section>
<section id="mapfile-layer">
<h3><a class="toc-backref" href="#table-of-contents" role="doc-backlink">Mapfile Layer</a><a class="headerlink" href="#mapfile-layer" title="Link to this heading">¶</a></h3>
<p>The mapfile layer is similar to other raster layers, but the PostGIS
connection parameters are specified in the <em>DATA</em> parameter, such
as:</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">LAYER</span>
  <span class="k">NAME</span> <span class="s">&quot;lunenburg_raster&quot;</span>
  <span class="k">TYPE</span> <span class="nb">RASTER</span>
  <span class="k">STATUS</span> <span class="nb">ON</span>
  <span class="k">DATA</span> <span class="s">&quot;PG:host=127.0.0.1 port=5432 sslmode=disable user=postgres password=postgres dbname=mydb schema=public table=lunenburg_colorhillshade column=rast mode=2&quot;</span>
  <span class="k">PROJECTION</span>
    <span class="s">&quot;init=epsg:2961&quot;</span>
  <span class="k">END</span>
  <span class="k">CLASS</span>
    <span class="k">NAME</span> <span class="s">&quot;Lunenburg&quot;</span>
  <span class="k">END</span>
  <span class="k">PROCESSING</span> <span class="s">&quot;CLOSE_CONNECTION=DEFER&quot;</span>
<span class="k">END</span> <span class="c"># layer</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The parameter <em>mode=2</em> must be specified in the DATA connection string,
for MapServer to load this properly, as the raster is tiled.  See
the <a class="reference external" href="https://gdal.org/drivers/raster/postgisraster.html">PostGIS Raster Driver</a>
page for more info.</p>
</div>
</section>
<section id="test-with-map2img">
<h3><a class="toc-backref" href="#table-of-contents" role="doc-backlink">Test with map2img</a><a class="headerlink" href="#test-with-map2img" title="Link to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">map2img</span> <span class="o">-</span><span class="n">m</span> <span class="n">postgis</span><span class="o">.</span><span class="n">map</span> <span class="o">-</span><span class="n">o</span> <span class="n">ttt</span><span class="o">.</span><span class="n">png</span> <span class="o">-</span><span class="n">map_debug</span> <span class="mi">3</span>

  <span class="n">msDrawMap</span><span class="p">():</span> <span class="n">rendering</span> <span class="n">using</span> <span class="n">outputformat</span> <span class="n">named</span> <span class="n">png</span> <span class="p">(</span><span class="n">AGG</span><span class="o">/</span><span class="n">PNG</span><span class="p">)</span><span class="o">.</span>
  <span class="n">msDrawMap</span><span class="p">():</span> <span class="n">WMS</span><span class="o">/</span><span class="n">WFS</span> <span class="nb">set</span><span class="o">-</span><span class="n">up</span> <span class="ow">and</span> <span class="n">query</span><span class="p">,</span> <span class="mf">0.000</span><span class="n">s</span>
  <span class="n">msDrawRasterLayerLow</span><span class="p">(</span><span class="n">lunenburg_raster</span><span class="p">):</span> <span class="n">entering</span><span class="o">.</span>
  <span class="n">msDrawMap</span><span class="p">():</span> <span class="n">Layer</span> <span class="mi">1</span> <span class="p">(</span><span class="n">lunenburg_raster</span><span class="p">),</span> <span class="mf">0.355</span><span class="n">s</span>
  <span class="n">msDrawMap</span><span class="p">():</span> <span class="n">Drawing</span> <span class="n">Label</span> <span class="n">Cache</span><span class="p">,</span> <span class="mf">0.000</span><span class="n">s</span>
  <span class="n">msDrawMap</span><span class="p">()</span> <span class="n">total</span> <span class="n">time</span><span class="p">:</span> <span class="mf">0.356</span><span class="n">s</span>
  <span class="n">msSaveImage</span><span class="p">(</span><span class="n">ttt</span><span class="o">.</span><span class="n">png</span><span class="p">)</span> <span class="n">total</span> <span class="n">time</span><span class="p">:</span> <span class="mf">0.004</span><span class="n">s</span>
</pre></div>
</div>
<img alt="../../_images/pgraster.png" class="no-scaled-link" src="../../_images/pgraster.png" style="width: 400px; height: 300px;" />
</section>
</section>
<section id="support-for-2-5d-geometries">
<h2><a class="toc-backref" href="#table-of-contents" role="doc-backlink">Support for 2.5D geometries</a><a class="headerlink" href="#support-for-2-5d-geometries" title="Link to this heading">¶</a></h2>
<p>In addition to horizontal coordinates (X,Y or longitude,latitude), PostGIS can
support geometries with a vertical component, often called 2.5D geometries.</p>
<p>As of MapServer 7.0, such 2.5D geometries will be taken into account if MapServer
is built with -DWITH_POINT_Z_M=ON.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Output of 2.5D geometries in WFS requires explicit metadata item to be
specified at the layer level. See <a class="reference internal" href="../../ogc/wfs_server.html#wfs-server"><span class="std std-ref">WFS server</span></a> documentation.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is still possible to force 2D only geometries to be retrieved from PostGIS by
setting the following PROCESSING option</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">PROCESSING</span> <span class="s">&quot;FORCE2D=YES&quot;</span>
</pre></div>
</div>
</div>
</section>
<section id="support-for-sql-mm-curves">
<h2><a class="toc-backref" href="#table-of-contents" role="doc-backlink">Support for SQL/MM Curves</a><a class="headerlink" href="#support-for-sql-mm-curves" title="Link to this heading">¶</a></h2>
<p>PostGIS is able to store circular interpolated curves, as part of the
SQL Multimedia Applications Spatial specification (read about the
<a class="reference external" href="http://subs.emis.de/LNI/Proceedings/Proceedings26/GI-Proceedings.26-17.pdf">SQL/MM specification</a>).</p>
<p>For more information about PostGIS’ support, see the <em>SQL-MM Part 3</em>
section in the PostGIS documentation, such as <a class="reference external" href="https://www.postgis.net/docs/manual-1.5/ch04.html#SQL_MM_Part3">here</a>.</p>
<p>As of MapServer 6.0, the PostGIS features CircularString,
CompoundCurve, CurvePolygon, MultiCurve, and MultiSurface can be drawn
through MapServer directly.</p>
<section id="example-1-circularstring-in-mapserver">
<h3><a class="toc-backref" href="#table-of-contents" role="doc-backlink">Example#1: CircularString in MapServer</a><a class="headerlink" href="#example-1-circularstring-in-mapserver" title="Link to this heading">¶</a></h3>
<p>The following is the Well Known Text of the feature loading into PostGIS:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">test</span> <span class="p">(</span> <span class="n">g</span><span class="p">,</span> <span class="nb">id</span> <span class="p">)</span> <span class="n">VALUES</span> <span class="p">(</span> <span class="n">ST_GeomFromText</span><span class="p">(</span><span class="s1">&#39;CIRCULARSTRING(0 0,</span>
                                    <span class="mi">4</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">)</span><span class="s1">&#39;, -1), 2);</span>
</pre></div>
</div>
<p>An example MapServer layer might look like:</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">LAYER</span>
  <span class="k">NAME</span> <span class="s">&quot;curves_poly&quot;</span>
  <span class="k">STATUS</span> <span class="nb">DEFAULT</span>
  <span class="k">TYPE</span> <span class="nb">POLYGON</span>
  <span class="k">CONNECTIONTYPE</span> <span class="nb">postgis</span>
  <span class="k">CONNECTION</span> <span class="s">&quot;user=postgres password=postgres dbname=curves host=localhost port=5432&quot;</span>
  <span class="k">DATA</span> <span class="s">&quot;g from test using SRID=-1 using unique id&quot;</span>
  <span class="k">CLASS</span>
    <span class="k">STYLE</span>
      <span class="k">COLOR</span> <span class="mi">128</span> <span class="mi">128</span> <span class="mi">128</span>
      <span class="k">ANTIALIAS</span> <span class="nb">true</span>
    <span class="k">END</span>
  <span class="k">END</span>
<span class="k">END</span>
</pre></div>
</div>
<p>And testing with <a class="reference internal" href="../../utilities/map2img.html#map2img"><span class="std std-ref">map2img</span></a> should produce a map image of:</p>
<img alt="../../_images/circularstring.png" src="../../_images/circularstring.png" />
</section>
<section id="example-2-compoundcurve-in-mapserver">
<h3><a class="toc-backref" href="#table-of-contents" role="doc-backlink">Example#2: CompoundCurve in MapServer</a><a class="headerlink" href="#example-2-compoundcurve-in-mapserver" title="Link to this heading">¶</a></h3>
<p>The following is the Well Known Text of the feature loading into PostGIS:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">test</span> <span class="p">(</span> <span class="n">g</span><span class="p">,</span> <span class="nb">id</span> <span class="p">)</span> <span class="n">VALUES</span> <span class="p">(</span> <span class="n">ST_GeomFromText</span><span class="p">(</span><span class="s1">&#39;COMPOUNDCURVE(</span>
                  <span class="n">CIRCULARSTRING</span><span class="p">(</span><span class="mi">0</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="mi">0</span><span class="p">),(</span><span class="mi">1</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">))</span><span class="s1">&#39;, -1), 3);</span>
</pre></div>
</div>
<p>An example MapServer layer might look like:</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">LAYER</span>
  <span class="k">NAME</span> <span class="s">&quot;curves_poly&quot;</span>
  <span class="k">STATUS</span> <span class="nb">DEFAULT</span>
  <span class="k">TYPE</span> <span class="nb">POLYGON</span>
  <span class="k">CONNECTIONTYPE</span> <span class="nb">postgis</span>
  <span class="k">CONNECTION</span> <span class="s">&quot;user=postgres password=postgres dbname=curves host=localhost port=5432&quot;</span>
  <span class="k">DATA</span> <span class="s">&quot;g from test using SRID=-1 using unique id&quot;</span>
  <span class="k">CLASS</span>
    <span class="k">STYLE</span>
      <span class="k">COLOR</span> <span class="mi">128</span> <span class="mi">128</span> <span class="mi">128</span>
      <span class="k">ANTIALIAS</span> <span class="nb">true</span>
    <span class="k">END</span>
  <span class="k">END</span>
<span class="k">END</span>
</pre></div>
</div>
<p>And testing with <a class="reference internal" href="../../utilities/map2img.html#map2img"><span class="std std-ref">map2img</span></a> should produce a map image of:</p>
<img alt="../../_images/compoundcurve.png" src="../../_images/compoundcurve.png" />
</section>
<section id="example-3-curvepolygon-in-mapserver">
<h3><a class="toc-backref" href="#table-of-contents" role="doc-backlink">Example#3: CurvePolygon in MapServer</a><a class="headerlink" href="#example-3-curvepolygon-in-mapserver" title="Link to this heading">¶</a></h3>
<p>The following is the Well Known Text of the feature loading into PostGIS:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">test</span> <span class="p">(</span> <span class="n">g</span><span class="p">,</span> <span class="nb">id</span> <span class="p">)</span> <span class="n">VALUES</span> <span class="p">(</span> <span class="n">ST_GeomFromText</span><span class="p">(</span><span class="s1">&#39;CURVEPOLYGON(</span>
                  <span class="n">CIRCULARSTRING</span><span class="p">(</span><span class="mi">0</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">),(</span><span class="mi">1</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="mi">3</span><span class="p">,</span>
                  <span class="mi">3</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="mi">1</span><span class="p">))</span><span class="s1">&#39;, -1), 4);</span>
</pre></div>
</div>
<p>An example MapServer layer might look like:</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">LAYER</span>
  <span class="k">NAME</span> <span class="s">&quot;curves_poly&quot;</span>
  <span class="k">STATUS</span> <span class="nb">DEFAULT</span>
  <span class="k">TYPE</span> <span class="nb">POLYGON</span>
  <span class="k">CONNECTIONTYPE</span> <span class="nb">postgis</span>
  <span class="k">CONNECTION</span> <span class="s">&quot;user=postgres password=postgres dbname=curves host=localhost port=5432&quot;</span>
  <span class="k">DATA</span> <span class="s">&quot;g from test using SRID=-1 using unique id&quot;</span>
  <span class="k">CLASS</span>
    <span class="k">STYLE</span>
      <span class="k">COLOR</span> <span class="mi">128</span> <span class="mi">128</span> <span class="mi">128</span>
      <span class="k">ANTIALIAS</span> <span class="nb">true</span>
    <span class="k">END</span>
  <span class="k">END</span>
<span class="k">END</span>
</pre></div>
</div>
<p>And testing with <a class="reference internal" href="../../utilities/map2img.html#map2img"><span class="std std-ref">map2img</span></a> should produce a map image of:</p>
<img alt="../../_images/curvepolygon.png" src="../../_images/curvepolygon.png" />
</section>
<section id="example-4-multicurve-in-mapserver">
<h3><a class="toc-backref" href="#table-of-contents" role="doc-backlink">Example#4: MultiCurve in MapServer</a><a class="headerlink" href="#example-4-multicurve-in-mapserver" title="Link to this heading">¶</a></h3>
<p>The following is the Well Known Text of the feature loading into PostGIS:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">test</span> <span class="p">(</span> <span class="n">g</span><span class="p">,</span> <span class="nb">id</span> <span class="p">)</span> <span class="n">VALUES</span> <span class="p">(</span> <span class="n">ST_GeomFromText</span><span class="p">(</span><span class="s1">&#39;MULTICURVE((0 0,</span>
                  <span class="mi">5</span> <span class="mi">5</span><span class="p">),</span><span class="n">CIRCULARSTRING</span><span class="p">(</span><span class="mi">4</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span> <span class="mi">4</span><span class="p">))</span><span class="s1">&#39;, -1), 6);</span>
</pre></div>
</div>
<p>An example MapServer layer might look like:</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">LAYER</span>
  <span class="k">NAME</span> <span class="s">&quot;curves_poly&quot;</span>
  <span class="k">STATUS</span> <span class="nb">DEFAULT</span>
  <span class="k">TYPE</span> <span class="nb">POLYGON</span>
  <span class="k">CONNECTIONTYPE</span> <span class="nb">postgis</span>
  <span class="k">CONNECTION</span> <span class="s">&quot;user=postgres password=postgres dbname=curves host=localhost port=5432&quot;</span>
  <span class="k">DATA</span> <span class="s">&quot;g from test using SRID=-1 using unique id&quot;</span>
  <span class="k">CLASS</span>
    <span class="k">STYLE</span>
      <span class="k">COLOR</span> <span class="mi">128</span> <span class="mi">128</span> <span class="mi">128</span>
      <span class="k">ANTIALIAS</span> <span class="nb">true</span>
    <span class="k">END</span>
  <span class="k">END</span>
<span class="k">END</span>
</pre></div>
</div>
<p>And testing with <a class="reference internal" href="../../utilities/map2img.html#map2img"><span class="std std-ref">map2img</span></a> should produce a map image of:</p>
<img alt="../../_images/multicurve.png" src="../../_images/multicurve.png" />
</section>
<section id="example-5-multisurface-in-mapserver">
<h3><a class="toc-backref" href="#table-of-contents" role="doc-backlink">Example#5: MultiSurface in MapServer</a><a class="headerlink" href="#example-5-multisurface-in-mapserver" title="Link to this heading">¶</a></h3>
<p>The following is the Well Known Text of the feature loading into PostGIS:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">test</span> <span class="p">(</span> <span class="n">g</span><span class="p">,</span> <span class="nb">id</span> <span class="p">)</span> <span class="n">VALUES</span> <span class="p">(</span> <span class="n">ST_GeomFromText</span><span class="p">(</span><span class="s1">&#39;MULTISURFACE(</span>
                  <span class="n">CURVEPOLYGON</span><span class="p">(</span><span class="n">CIRCULARSTRING</span><span class="p">(</span><span class="mi">0</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span> <span class="mi">4</span><span class="p">,</span>
                  <span class="mi">0</span> <span class="mi">0</span><span class="p">),(</span><span class="mi">1</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="mi">1</span><span class="p">)),((</span><span class="mi">10</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">14</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">11</span> <span class="mi">10</span><span class="p">,</span>
                  <span class="mi">10</span> <span class="mi">10</span><span class="p">),(</span><span class="mi">11</span> <span class="mi">11</span><span class="p">,</span> <span class="mf">11.5</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">11</span> <span class="mf">11.5</span><span class="p">,</span> <span class="mi">11</span> <span class="mi">11</span><span class="p">)))</span><span class="s1">&#39;, -1), 7);</span>
</pre></div>
</div>
<p>An example MapServer layer might look like:</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">LAYER</span>
  <span class="k">NAME</span> <span class="s">&quot;curves_poly&quot;</span>
  <span class="k">STATUS</span> <span class="nb">DEFAULT</span>
  <span class="k">TYPE</span> <span class="nb">POLYGON</span>
  <span class="k">CONNECTIONTYPE</span> <span class="nb">postgis</span>
  <span class="k">CONNECTION</span> <span class="s">&quot;user=postgres password=postgres dbname=curves host=localhost port=5432&quot;</span>
  <span class="k">DATA</span> <span class="s">&quot;g from test using SRID=-1 using unique id&quot;</span>
  <span class="k">CLASS</span>
    <span class="k">STYLE</span>
      <span class="k">COLOR</span> <span class="mi">128</span> <span class="mi">128</span> <span class="mi">128</span>
      <span class="k">ANTIALIAS</span> <span class="nb">true</span>
    <span class="k">END</span>
  <span class="k">END</span>
<span class="k">END</span>
</pre></div>
</div>
<p>And testing with <a class="reference internal" href="../../utilities/map2img.html#map2img"><span class="std std-ref">map2img</span></a> should produce a map image of:</p>
<img alt="../../_images/multisurface.png" src="../../_images/multisurface.png" />
</section>
<section id="using-mapserver-6-0">
<h3><a class="toc-backref" href="#table-of-contents" role="doc-backlink">Using MapServer &lt; 6.0</a><a class="headerlink" href="#using-mapserver-6-0" title="Link to this heading">¶</a></h3>
<p>If you cannot upgrade to MapServer 6.0, then you can use the PostGIS function <em>ST_CurveToLine()</em> in your
MapServer LAYER to draw the curves (note that this is much slower however):</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">LAYER</span>
  <span class="k">NAME</span> <span class="s">&quot;curves_poly&quot;</span>
  <span class="k">STATUS</span> <span class="nb">DEFAULT</span>
  <span class="k">TYPE</span> <span class="nb">POLYGON</span>
  <span class="k">CONNECTIONTYPE</span> <span class="nb">postgis</span>
  <span class="k">CONNECTION</span> <span class="s">&quot;user=postgres password=postgres dbname=curves host=localhost port=5432&quot;</span>
  <span class="k">DATA</span> <span class="s">&quot;wkb_geometry from (select c.id, ST_CurveToLine(c.g) as</span>
                           <span class="err">wkb_geometry</span> <span class="k">from</span> <span class="err">c</span><span class="p">)</span> <span class="err">as</span> <span class="err">sub</span><span class="nb">query</span> <span class="err">using</span>
                           <span class="err">unique</span> <span class="err">id</span> <span class="err">using</span> <span class="err">SRID</span><span class="o">=</span><span class="p">-</span><span class="mi">1</span><span class="s">&quot;</span>
  <span class="k">CLASS</span>
    <span class="k">STYLE</span>
      <span class="k">COLOR</span> <span class="mi">128</span> <span class="mi">128</span> <span class="mi">128</span>
      <span class="k">ANTIALIAS</span> <span class="nb">true</span>
    <span class="k">END</span>
  <span class="k">END</span>
<span class="k">END</span>
</pre></div>
</div>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p>
<a href="../../about.html" title="About">About</a><br>
<a href="../../products.html" title="Products">Products</a><br>
<a href="../../community/index.html" title="Community">Community</a><br>
<a href="../../development/index.html" title="Development">Development</a><br>
<a href="../../download.html" title="Downloads">Downloads</a><br>
<a href="../../documentation.html" title="Documentation">Documentation</a><br>
<a href="../../faq.html" title="FAQ">FAQ</a><br>
<a href="../../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</h3>
  <ul>
<li><a class="reference internal" href="#">PostGIS/PostgreSQL</a><ul>
<li><a class="reference internal" href="#id1">PostGIS/PostgreSQL</a></li>
<li><a class="reference internal" href="#data-access-connection-method">Data Access /Connection Method</a></li>
<li><a class="reference internal" href="#ogrinfo-examples">OGRINFO Examples</a></li>
<li><a class="reference internal" href="#mapfile-example">Mapfile Example</a></li>
<li><a class="reference internal" href="#postgis-raster-pgraster">PostGIS Raster (PGRaster)</a><ul>
<li><a class="reference internal" href="#load-raster-data">Load Raster DATA</a></li>
<li><a class="reference internal" href="#connect-with-gdalinfo">Connect with GDALINFO</a></li>
<li><a class="reference internal" href="#mapfile-layer">Mapfile Layer</a></li>
<li><a class="reference internal" href="#test-with-map2img">Test with map2img</a></li>
</ul>
</li>
<li><a class="reference internal" href="#support-for-2-5d-geometries">Support for 2.5D geometries</a></li>
<li><a class="reference internal" href="#support-for-sql-mm-curves">Support for SQL/MM Curves</a><ul>
<li><a class="reference internal" href="#example-1-circularstring-in-mapserver">Example#1: CircularString in MapServer</a></li>
<li><a class="reference internal" href="#example-2-compoundcurve-in-mapserver">Example#2: CompoundCurve in MapServer</a></li>
<li><a class="reference internal" href="#example-3-curvepolygon-in-mapserver">Example#3: CurvePolygon in MapServer</a></li>
<li><a class="reference internal" href="#example-4-multicurve-in-mapserver">Example#4: MultiCurve in MapServer</a></li>
<li><a class="reference internal" href="#example-5-multisurface-in-mapserver">Example#5: MultiSurface in MapServer</a></li>
<li><a class="reference internal" href="#using-mapserver-6-0">Using MapServer &lt; 6.0</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="sdts.html" title="SDTS"
             >next</a> |</li>
        <li class="right" >
          <a href="oracle.html" title="Oracle Spatial"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../documentation.html" >MapServer 8.0.1 Documentation</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../index.html" >Data Input</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="index.html" >Vector Data</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">PostGIS/PostgreSQL</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; <a href="../../copyright.html">Copyright</a> 2023, Open Source Geospatial Foundation.
      Last updated on 2023-12-22.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.5.
    </div>
  </body>
</html>