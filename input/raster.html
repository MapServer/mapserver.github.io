<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Raster Data &#8212; MapServer 7.0.3 documentation</title>
    
    <link rel="stylesheet" href="../_static/sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '7.0.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="next" title="Virtual File System" href="virtual-file.html" />
    <link rel="prev" title="WFS" href="vector/wfs.html" /> 
  </head>
  <body role="document">

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../index.html" title="Home"><img src="../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../index.html" title="Home">Home</a> |
      <a href="../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="../download.html" title="Download Source or Binaries">Download </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../ar/input/raster.html"><img src="../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../de/input/raster.html"><img src="../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../el/input/raster.html"><img src="../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../es/input/raster.html"><img src="../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../fr/input/raster.html"><img src="../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../id/input/raster.html"><img src="../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../it/input/raster.html"><img src="../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../ja/input/raster.html"><img src="../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../nl_NL/input/raster.html"><img src="../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../pl/input/raster.html"><img src="../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../ru/input/raster.html"><img src="../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../sq/input/raster.html"><img src="../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../tr/input/raster.html"><img src="../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="virtual-file.html" title="Virtual File System"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="vector/wfs.html" title="WFS"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../documentation.html" >MapServer 7.0.3 Documentation</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Data Input</a> &#187;</li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="raster-data">
<span id="raster"></span><span id="index-0"></span><h1><a class="toc-backref" href="#table-of-contents">Raster Data</a><a class="headerlink" href="#raster-data" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Author:</th><td class="field-body">Frank Warmerdam</td>
</tr>
<tr class="field-even field"><th class="field-name">Contact:</th><td class="field-body">warmerdam at pobox.com</td>
</tr>
<tr class="field-odd field"><th class="field-name">Last Updated:</th><td class="field-body">2013/07/04</td>
</tr>
</tbody>
</table>
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#raster-data" id="id1">Raster Data</a><ul>
<li><a class="reference internal" href="#introduction" id="id2">Introduction</a></li>
<li><a class="reference internal" href="#how-are-rasters-added-to-a-map-file" id="id3">How are rasters added to a Map file?</a></li>
<li><a class="reference internal" href="#supported-formats" id="id4">Supported Formats</a></li>
<li><a class="reference internal" href="#rasters-and-tile-indexing" id="id5">Rasters and Tile Indexing</a></li>
<li><a class="reference internal" href="#raster-warping" id="id6">Raster Warping</a></li>
<li><a class="reference internal" href="#bit-rgb-rendering" id="id7">24bit RGB Rendering</a></li>
<li><a class="reference internal" href="#special-processing-directives" id="id8">Special Processing Directives</a></li>
<li><a class="reference internal" href="#raster-query" id="id9">Raster Query</a></li>
<li><a class="reference internal" href="#raster-display-performance-tips" id="id10">Raster Display Performance Tips</a></li>
<li><a class="reference internal" href="#preprocessing-rasters" id="id11">Preprocessing Rasters</a></li>
<li><a class="reference internal" href="#georeference-with-world-files" id="id12">Georeference with World Files</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#table-of-contents">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>MapServer supports rendering a variety of raster file formats in maps. The
following describes some of the supported formats, and what capabilities are
supported with what formats.</p>
<p>This document assumes that you are already familiar with setting up MapServer
<a class="reference internal" href="../mapfile/index.html#mapfile"><span class="std std-ref">Mapfile</span></a>, but does explain the raster specific aspects of mapfiles.</p>
</div>
<div class="section" id="how-are-rasters-added-to-a-map-file">
<h2><a class="toc-backref" href="#table-of-contents">How are rasters added to a Map file?</a><a class="headerlink" href="#how-are-rasters-added-to-a-map-file" title="Permalink to this headline">¶</a></h2>
<p>A simple raster layer declaration looks like this. The <cite>DATA</cite> file is
interpreted relative to the <cite>SHAPEPATH</cite>, much like shapefiles.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">LAYER</span>
  <span class="n">NAME</span> <span class="s2">&quot;JacksonvilleNC_CIB&quot;</span>
  <span class="n">DATA</span> <span class="s2">&quot;Jacksonville.tif&quot;</span>
  <span class="n">TYPE</span> <span class="n">RASTER</span>
  <span class="n">STATUS</span> <span class="n">ON</span>
<span class="n">END</span>
</pre></div>
</div>
<p>Though not shown rasters can have <cite>PROJECTION</cite>, <cite>METADATA</cite>,
<cite>PROCESSING</cite>, <cite>MINSCALE</cite>, and <cite>MAXSCALE</cite> information. It cannot have
labels, <cite>CONNECTION</cite>, <cite>CONNECTIONTYPE</cite>, or <cite>FEATURE</cite> information.</p>
<div class="section" id="classifying-rasters">
<span id="index-1"></span><h3>Classifying Rasters<a class="headerlink" href="#classifying-rasters" title="Permalink to this headline">¶</a></h3>
<p>Rasters can be classified in a manner similar to vectors, with a few
exceptions.</p>
<span class="target" id="index-2"></span><span class="target" id="index-3"></span><span class="target" id="index-4"></span><p id="index-5">There is no need to specify a <cite>CLASSITEM</cite>. The raw pixel value itself
(&#8220;[pixel]&#8221;) and, for paletted images, the red, green and blue color associated
with that pixel value (&#8220;[red]&#8221;, &#8220;[green]&#8221; and &#8220;[blue]&#8221;) are available for use
in classifications. When used in an evaluated expression the pixel, red, green
and blue keywords must be in lower case.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">LAYER</span>
  <span class="n">NAME</span> <span class="s2">&quot;JacksonvilleNC_CIB&quot;</span>
  <span class="n">DATA</span> <span class="s2">&quot;Jacksonville.tif&quot;</span>
  <span class="n">TYPE</span> <span class="n">RASTER</span>
  <span class="n">STATUS</span> <span class="n">ON</span>
  <span class="n">CLASSITEM</span> <span class="s2">&quot;[pixel]&quot;</span>
  <span class="c1"># class using simple string comparison, equivalent to ([pixel] = 0)</span>
  <span class="n">CLASS</span>
    <span class="n">EXPRESSION</span> <span class="s2">&quot;0&quot;</span>
    <span class="n">STYLE</span>
      <span class="n">COLOR</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span>
    <span class="n">END</span>
  <span class="n">END</span>
  <span class="c1"># class using an EXPRESSION using only [pixel].</span>
  <span class="n">CLASS</span>
    <span class="n">EXPRESSION</span> <span class="p">([</span><span class="n">pixel</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">64</span> <span class="n">AND</span> <span class="p">[</span><span class="n">pixel</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">128</span><span class="p">)</span>
    <span class="n">STYLE</span>
      <span class="n">COLOR</span> <span class="mi">255</span> <span class="mi">0</span> <span class="mi">0</span>
    <span class="n">END</span>
  <span class="n">END</span>
  <span class="c1"># class using the red/green/blue values from the palette</span>
  <span class="n">CLASS</span>
    <span class="n">NAME</span> <span class="s2">&quot;near white&quot;</span>
    <span class="n">EXPRESSION</span> <span class="p">([</span><span class="n">red</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">200</span> <span class="n">AND</span> <span class="p">[</span><span class="n">green</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">200</span> <span class="n">AND</span> <span class="p">[</span><span class="n">blue</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">200</span><span class="p">)</span>
    <span class="n">STYLE</span>
      <span class="n">COLOR</span> <span class="mi">0</span> <span class="mi">255</span> <span class="mi">0</span>
    <span class="n">END</span>
  <span class="n">END</span>
  <span class="c1"># Class using a regular expression to capture only pixel values ending in 1</span>
  <span class="n">CLASS</span>
    <span class="n">EXPRESSION</span> <span class="o">/*</span><span class="mi">1</span><span class="o">/</span>
    <span class="n">STYLE</span>
      <span class="n">COLOR</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">255</span>
    <span class="n">END</span>
  <span class="n">END</span>
<span class="n">END</span>
</pre></div>
</div>
<p>As usual, <cite>CLASS</cite> definitions are evaluated in order from first to
last, and the first to match is used. If a <cite>CLASS</cite> has a <cite>NAME</cite>
attribute it may appear in a <cite>LEGEND</cite>. Only the <cite>COLOR</cite>, <cite>EXPRESSION</cite>
and <cite>NAME</cite> parameters within a <cite>CLASS</cite> definition are utilized for
raster classifications. The other styling or control information is
ignored.</p>
<p>Raster classifications always take place on only one raster band. It defaults
to the first band in the referenced file, but this can be altered with the
<cite>BANDS</cite> <cite>PROCESSING</cite> directive. In particular this means that including even a
single CLASS declaration in a raster layer will result in the raster layer
being rendered using the one band classification rules instead of other rules
that might have applied (such as 3 band RGB rendering).</p>
<div class="section" id="classifying-non-8bit-rasters">
<h4>Classifying Non-8bit Rasters<a class="headerlink" href="#classifying-non-8bit-rasters" title="Permalink to this headline">¶</a></h4>
<p>As of MapServer 4.4 support has been added for classifying non-8bit raster
inputs. That is input rasters with values outside the range 0-255. Mostly this
works transparently but there are a few caveats and options to provide
explicit control.</p>
<p>Classifying raster data in MapServer is accomplished by pre-classifying all
expected input values and using that table of classification results to lookup
each pixel as it is rendered. This is done because evaluating a pixel value
against a series of CLASS definitions is relatively expensive to do for the
hundreds of thousands of pixels in a typical rendered image.</p>
<p>For simple 8bit inputs, only 256 input values need to be pre-classified. But
for non-8bit inputs more values need to be classified. For 16bit integer
inputs all 65536 possible input values are pre-classified. For floating point
and other input data types, up to 65536 values are pre-classified based on the
maximum expected range of input values.</p>
<p>The <cite>PROCESSING</cite> directive can be used to override the range of values to be
pre-classified, or the number of values (aka Buckets) in that range to
classify. The <cite>SCALE=min,max</cite> <cite>PROCESSING</cite> directive controls the range. The
<cite>SCALE_BUCKETS PROCESSING</cite> directive controls the number of buckets. In some
cases rendering can be accelerated considerable by selecting a restricted
range of input values and a reduced number of scaling values (buckets).</p>
<p>The following example classifies a floating raster, but only 4 values over the
range -10 to 10 are classified. In particular, the values classified would be
-7.5, -2.5, 2.5, and 7.5 (the middle of each &#8220;quarter&#8221; of the range). So those
four value are classified, and one of the classification results is selected
based on which value is closest to the pixel value being classified.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">LAYER</span>
  <span class="n">NAME</span> <span class="n">grid1</span>
  <span class="n">TYPE</span> <span class="n">raster</span>
  <span class="n">STATUS</span> <span class="n">default</span>
  <span class="n">DATA</span> <span class="n">data</span><span class="o">/</span><span class="nb">float</span><span class="o">.</span><span class="n">tif</span>
  <span class="n">PROCESSING</span> <span class="s2">&quot;SCALE=-10,10&quot;</span>
  <span class="n">PROCESSING</span> <span class="s2">&quot;SCALE_BUCKETS=4&quot;</span>
  <span class="n">CLASS</span>
    <span class="n">NAME</span> <span class="s2">&quot;red&quot;</span>
    <span class="n">EXPRESSION</span> <span class="p">([</span><span class="n">pixel</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">STYLE</span>
      <span class="n">COLOR</span> <span class="mi">255</span> <span class="mi">0</span> <span class="mi">0</span>
    <span class="n">END</span>
  <span class="n">END</span>
  <span class="n">CLASS</span>
    <span class="n">NAME</span> <span class="s2">&quot;green&quot;</span>
    <span class="n">EXPRESSION</span> <span class="p">([</span><span class="n">pixel</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mi">3</span> <span class="ow">and</span> <span class="p">[</span><span class="n">pixel</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">STYLE</span>
      <span class="n">COLOR</span> <span class="mi">0</span> <span class="mi">255</span> <span class="mi">0</span>
    <span class="n">END</span>
  <span class="n">END</span>
  <span class="n">CLASS</span>
    <span class="n">NAME</span> <span class="s2">&quot;blue&quot;</span>
    <span class="n">EXPRESSION</span> <span class="p">([</span><span class="n">pixel</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">STYLE</span>
      <span class="n">COLOR</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">255</span>
    <span class="n">END</span>
  <span class="n">END</span>
<span class="n">END</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="supported-formats">
<span id="index-6"></span><h2><a class="toc-backref" href="#table-of-contents">Supported Formats</a><a class="headerlink" href="#supported-formats" title="Permalink to this headline">¶</a></h2>
<p>Since version 6.2, MapServer raster input support is through the GDAL
raster library only.</p>
<p>More information on GDAL can be found at <a class="reference external" href="http://www.gdal.org">http://www.gdal.org</a>, including the
<a class="reference external" href="http://www.gdal.org/formats_list.html">supported formats list</a>. Some of the advanced MapServer raster features,
such as resampling, RGB color cube generation and automatic projection capture
only work with raster formats used through GDAL. GDAL is normally built and
installed separately from MapServer, and then enabled during the build of
MapServer using the <em>&#8211;with-gdal</em> configuration switch.</p>
<p>To find out if GDAL support is built into a particular MapServer
executable, use the -v flag to discover what build options are
enabled.  To find out what GDAL formats are available, the &#8220;gdalinfo
&#8211;formats&#8221; command may be used. For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">warmerda</span><span class="nd">@gdal2200</span><span class="p">[</span><span class="mi">124</span><span class="p">]</span><span class="o">%</span> <span class="n">mapserv</span> <span class="o">-</span><span class="n">v</span>
<span class="n">MapServer</span> <span class="n">version</span> <span class="mf">6.2</span><span class="o">.</span><span class="mi">0</span> <span class="n">OUTPUT</span><span class="o">=</span><span class="n">GIF</span> <span class="n">OUTPUT</span><span class="o">=</span><span class="n">PNG</span> <span class="n">OUTPUT</span><span class="o">=</span><span class="n">JPEG</span>
<span class="n">SUPPORTS</span><span class="o">=</span><span class="n">PROJ</span> <span class="n">SUPPORTS</span><span class="o">=</span><span class="n">GD</span> <span class="n">SUPPORTS</span><span class="o">=</span><span class="n">AGG</span> <span class="n">SUPPORTS</span><span class="o">=</span><span class="n">FREETYPE</span>
<span class="n">SUPPORTS</span><span class="o">=</span><span class="n">CAIRO</span> <span class="n">SUPPORTS</span><span class="o">=</span><span class="n">OPENGL</span> <span class="n">SUPPORTS</span><span class="o">=</span><span class="n">ICONV</span> <span class="n">SUPPORTS</span><span class="o">=</span><span class="n">WMS_SERVER</span>
<span class="n">SUPPORTS</span><span class="o">=</span><span class="n">WMS_CLIENT</span> <span class="n">SUPPORTS</span><span class="o">=</span><span class="n">WFS_SERVER</span> <span class="n">SUPPORTS</span><span class="o">=</span><span class="n">WFS_CLIENT</span>
<span class="n">SUPPORTS</span><span class="o">=</span><span class="n">WCS_SERVER</span> <span class="n">SUPPORTS</span><span class="o">=</span><span class="n">SOS_SERVER</span> <span class="n">SUPPORTS</span><span class="o">=</span><span class="n">FASTCGI</span>
<span class="n">SUPPORTS</span><span class="o">=</span><span class="n">THREADS</span> <span class="n">SUPPORTS</span><span class="o">=</span><span class="n">GEOS</span> <span class="n">INPUT</span><span class="o">=</span><span class="n">JPEG</span> <span class="n">INPUT</span><span class="o">=</span><span class="n">POSTGIS</span> <span class="n">INPUT</span><span class="o">=</span><span class="n">OGR</span>
<span class="n">INPUT</span><span class="o">=</span><span class="n">GDAL</span> <span class="n">INPUT</span><span class="o">=</span><span class="n">SHAPEFILE</span>


<span class="n">warmerda</span><span class="nd">@gdal2200</span><span class="p">[</span><span class="mi">18</span><span class="p">]</span><span class="o">%</span> <span class="n">gdalinfo</span> <span class="o">--</span><span class="n">formats</span>
<span class="n">Supported</span> <span class="n">Formats</span><span class="p">:</span>
  <span class="n">VRT</span> <span class="p">(</span><span class="n">rw</span><span class="o">+</span><span class="n">v</span><span class="p">):</span> <span class="n">Virtual</span> <span class="n">Raster</span>
  <span class="n">GTiff</span> <span class="p">(</span><span class="n">rw</span><span class="o">+</span><span class="n">vs</span><span class="p">):</span> <span class="n">GeoTIFF</span>
  <span class="n">NITF</span> <span class="p">(</span><span class="n">rw</span><span class="o">+</span><span class="n">vs</span><span class="p">):</span> <span class="n">National</span> <span class="n">Imagery</span> <span class="n">Transmission</span> <span class="n">Format</span>
  <span class="n">RPFTOC</span> <span class="p">(</span><span class="n">rovs</span><span class="p">):</span> <span class="n">Raster</span> <span class="n">Product</span> <span class="n">Format</span> <span class="n">TOC</span> <span class="nb">format</span>
  <span class="n">ECRGTOC</span> <span class="p">(</span><span class="n">rovs</span><span class="p">):</span> <span class="n">ECRG</span> <span class="n">TOC</span> <span class="nb">format</span>
  <span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="rasters-and-tile-indexing">
<span id="index-7"></span><h2><a class="toc-backref" href="#table-of-contents">Rasters and Tile Indexing</a><a class="headerlink" href="#rasters-and-tile-indexing" title="Permalink to this headline">¶</a></h2>
<p>When handling very large raster layers it is often convenient, and higher
performance to split the raster image into a number of smaller images. Each
file is a tile of the larger raster mosaic available for display. The list of
files forming a layer can be stored in a shapefile with polygons representing
the footprint of each file, and the name of the files. This is called a
&#8216;TILEINDEX&#8217; and works similarly to the same feature in vector layers. The result
can be represented in the Mapfile as one layer, but MapServer will first scan
the tile index, and ensure that only raster files overlapping the current
display request will be opened.</p>
<p>The following example shows a simple example. No <cite>DATA</cite> statement is required
because MapServer will fetch the filename of the raster files from the
Location attribute column in the hp2.dbf file for records associated with
polygons in hp2.shp that intersect the current display region. The polygons in
hp2.shp should be rectangles representing the footprint of the corresponding
file. Note that the files do not have to be all the same size, the formats can
vary and they can even overlap (later files will be drawn over earlier ones).</p>
<p>Starting with MapServer 6.4, the files can have different coordinate
system (projection). This requires specifying the <a class="reference internal" href="../mapfile/layer.html#tilesrs"><span class="std std-ref">TILESRS</span></a> keyword and generating the tileindex with a few additional
options. See <a class="reference internal" href="../optimization/tileindex.html#tileindex-mixed-srs"><span class="std std-ref">Tileindexes with tiles in different projections</span></a>.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">LAYER</span>
  <span class="n">NAME</span> <span class="s2">&quot;hpool&quot;</span>
  <span class="n">STATUS</span> <span class="n">ON</span>
  <span class="n">TILEINDEX</span> <span class="s2">&quot;hp2.shp&quot;</span>
  <span class="n">TILEITEM</span> <span class="s2">&quot;Location&quot;</span>
  <span class="n">TYPE</span> <span class="n">RASTER</span>
<span class="n">END</span>
</pre></div>
</div>
<p>The filenames in the tileindex are searched for relative to the <cite>SHAPEPATH</cite> or
map file, not relative to the tileindex. Great care should be taken when
establishing the paths put into the tileindex to ensure they will evaluate
properly in use. Often it is easiest to place the tileindex in the <cite>SHAPEPATH</cite>
directory, and to create the tileindex with a path relative to the <cite>SHAPEPATH</cite>
directory. When all else fails, absolute paths can be used in tileindex, but
then they cannot be so easily moved from system to system.</p>
<p>While there are many ways to produce <cite>TILEINDEX</cite> shapefiles for use with this
command, one option is the <a class="reference external" href="http://www.gdal.org/gdal_utilities.html">gdaltindex</a> program, part of the GDAL utility
suite. The gdaltindex program will automatically generate a tile index
shapefile from a list of GDAL supported raster files passed on the command
line.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Usage</span><span class="p">:</span> <span class="n">gdaltindex</span> <span class="p">[</span><span class="o">-</span><span class="n">tileindex</span> <span class="n">field_name</span><span class="p">]</span> <span class="n">index_file</span> <span class="p">[</span><span class="n">gdal_file</span><span class="p">]</span><span class="o">*</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">gdaltindex</span> <span class="n">doq_index</span><span class="o">.</span><span class="n">shp</span> <span class="n">doq</span><span class="o">/*.</span><span class="n">tif</span>
</pre></div>
</div>
<div class="section" id="tile-index-notes">
<h3>Tile Index Notes<a class="headerlink" href="#tile-index-notes" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>The shapefile (index_file) will be created if it doesn&#8217;t already exist.</li>
<li>The default tile index field is &#8216;location&#8217;.</li>
<li>Simple rectangular polygons must be generated in the same
coordinate system as the raster layer. If the files in the tileindex are
not in the same projection as the raster layer, or are in heterogeneous
projections, the TILESRS keyword must be specified in the LAYER definition.
See <a class="reference internal" href="../optimization/tileindex.html#tileindex-mixed-srs"><span class="std std-ref">Tileindexes with tiles in different projections</span></a></li>
<li>Raster filenames will be put in the file exactly as they are specified
on the commandline.</li>
<li>Many problems with tile indexes relate to how relative paths in the tile
index are evaluated.  They should be evaluated relative to the <cite>SHAPEPATH</cite>
if one is set, otherwise relative to the tileindex file.  When in doubt
absolute paths may avoid path construction problems.</li>
</ul>
<p>The gdaltindex program is built as part of GDAL. Prebuilt binaries for GDAL
including the gdaltindex program can be downloaded as part of the <a class="reference external" href="http://trac.osgeo.org/osgeo4w/">OSGeo4W</a>,
<a class="reference external" href="http://fwtools.maptools.org/">FWTools</a> and <a class="reference external" href="http://www.ms4w.com">MS4W</a> distributions.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="../optimization/tileindex.html#tileindex"><span class="std std-ref">Tile Indexes</span></a></p>
</div>
</div>
</div>
<div class="section" id="raster-warping">
<span id="index-8"></span><h2><a class="toc-backref" href="#table-of-contents">Raster Warping</a><a class="headerlink" href="#raster-warping" title="Permalink to this headline">¶</a></h2>
<p>MapServer is able to resample GDAL rasters on the fly into new projections.
Non-GDAL rasters may only be up or down sampled without any rotation or
warping.</p>
<p>Raster warping kicks in if the projection appears to be different for a raster
layer than for the map being generated. Warped raster layers are significantly
more expensive to render than normal raster layers with rendering time being
perhaps 2-4 times long than a normal layer. The projection and datum shifting
transformation is computed only at selected points, and generally linearly
interpolated along the scanlines (as long as the error appears to be less than
0.333 pixels.</p>
<p>In addition to reprojecting rasters, the raster warping ability can also apply
rotation to GDAL rasters with rotational coefficients in their georeferencing
information. Currently rotational coefficients won&#8217;t trigger raster warping
unless the map and layer have valid (though matching is fine) projection
definitions.</p>
</div>
<div class="section" id="bit-rgb-rendering">
<span id="index-9"></span><h2><a class="toc-backref" href="#table-of-contents">24bit RGB Rendering</a><a class="headerlink" href="#bit-rgb-rendering" title="Permalink to this headline">¶</a></h2>
<p>Traditionally MapServer has been used to produce 8 bit pseudo-colored map
displays generated from 8bit greyscale or pseudocolored raster data. However,
if the raster file to be rendered is actually 24bit (a red, green and blue
band) then additional considerations come into play. Rendering of
24bit imagery is supported via the GDAL renderer.</p>
<p>If the output is still 8bit pseudo-colored (the <cite>IMAGEMODE</cite> is PC256 in the
associated <cite>OUTPUTFORMAT</cite> declaration) then the full 24bit RGB colors for input
pixels will be converted to a color in the colormap of the output image. By
default a color cube is used. That is a fixed set of 175 colors providing 5
levels of red, 7 levels of green and 5 levels of blue is used, plus an
additional 32 greyscale color entries. Colors in the input raster are mapped
to the closest color in this color cube on the fly. This substantial degrades
color quality, especially for smoothly changing images. It also fills up the
colors table, limited to 256 colors, quite quickly.</p>
<p>A variation on this approach is to dither the image during rendering.
Dithering selects a color for a pixel in a manner that &#8220;diffuses error&#8221; over
pixels. In an area all one color in the source image, a variety of output
pixel colors would be selected such that the average of the pixels would more
closely approximate the desired color. Dithering also takes advantage of all
currently allocated colors, not just those in the color cube. Dithering
requires GDAL 1.1.9 or later, and is enabled by providing the <cite>PROCESSING</cite>
&#8220;DITHER=YES&#8221; option in the mapfile. Dithering is more CPU intensive than using
a simple color cube, and should be avoided if possible in performance
sensitive situations.</p>
<p>The other new possibility for handling 24bit input imagery in MapServer 4.0 or
later, is to produce 24bit output images. The default &#8220;IMAGETYPE png24&#8221; or
&#8220;IMAGETYPE jpeg&#8221; declaration may be used to produce a 24bit PNG output file,
instead of the more common 8bit pseudo-colored PNG file. The <cite>OUTPUTFORMAT</cite>
declaration provides for detailed control of the output format. The <cite>IMAGEMODE</cite>
RGB and <cite>IMAGEMODE</cite> RGBA options produce 24bit and 32bit (24bit plus 8bit
alpha/transparency) for supported formats.</p>
</div>
<div class="section" id="special-processing-directives">
<span id="index-10"></span><h2><a class="toc-backref" href="#table-of-contents">Special Processing Directives</a><a class="headerlink" href="#special-processing-directives" title="Permalink to this headline">¶</a></h2>
<p>As of MapServer 4.0, the PROCESSING parameter was added to the <a class="reference internal" href="../mapfile/layer.html#layer"><span class="std std-ref">LAYER</span></a> of
the <a class="reference internal" href="../mapfile/index.html#mapfile"><span class="std std-ref">Mapfile</span></a>. It is primarily used to pass specialized raster processing
options to the GDAL based raster renderer. The following processing options
are supported in MapServer 4.0 and newer.</p>
<dl class="docutils" id="index-11">
<dt><strong>BANDS=red_or_grey[,green,blue[,alpha]]</strong></dt>
<dd><p class="first">This directive allows a specific band or bands to be selected from a
raster file. If one band is selected, it is treated as greyscale. If 3 are
selected, they are treated as red, green and blue. If 4 are selected they
are treated as red, green, blue and alpha (opacity).</p>
<p>Example:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="n">PROCESSING</span> <span class="s2">&quot;BANDS=4,2,1&quot;</span>
</pre></div>
</div>
</dd>
</dl>
<dl class="docutils" id="index-12">
<dt><strong>COLOR_MATCH_THRESHOLD=n</strong></dt>
<dd><p class="first">Alter the precision with which colors need to match an entry in the color
table to use it when producing 8bit colormapped output (IMAGEMODE PC256).
Normally colors from a raster colormap (or greyscale values) need to match
exactly. This relaxes the requirement to being within the specified color
distance. So a COLOR_MATCH_THRESHOLD of 3 would mean that an existing
color entry within 3 (sum of difference in red, green and blue) would be
used instead of creating a new colormap entry. Especially with greyscale
raster layers, which would normally use all 256 color entries if
available, this can be a good way to avoid &#8220;stealing&#8221; your whole colormap
for a raster layer. Normally values in the range 2-6 will give good
results.</p>
<p>Example:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="n">PROCESSING</span> <span class="s2">&quot;COLOR_MATCH_THRESHOLD=3&quot;</span>
</pre></div>
</div>
</dd>
</dl>
<dl class="docutils" id="index-13">
<dt><strong>DITHER=YES</strong></dt>
<dd><p class="first">This turns on error diffusion mode, used to convert 24bit images to 8bit
with error diffusion to get better color results.</p>
<p>Example:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="n">PROCESSING</span> <span class="s2">&quot;DITHER=YES&quot;</span>
</pre></div>
</div>
</dd>
</dl>
<dl class="docutils" id="index-14">
<dt><strong>EXTENT_PRIORITY=WORLD</strong></dt>
<dd><p class="first">Override GDAL with a world file.</p>
<p>Example:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="n">PROCESSING</span> <span class="s2">&quot;EXTENT_PRIORITY=WORLD&quot;</span>
</pre></div>
</div>
</dd>
</dl>
<dl class="docutils" id="index-15">
<dt><strong>LOAD_FULL_RES_IMAGE=YES/NO</strong></dt>
<dd>This option affects how image data is loaded for the resampler when
reprojecting or otherwise going through complex resampling (as opposed
to the fast default image decimation code path).  This forces the source
image to be loaded at full resolution if turned on (default is NO).  This
helps work around problems with default image resolution selection in
when radical warping is being done.  It can result in very slow processing
if the source image is large.</dd>
</dl>
<dl class="docutils" id="index-16">
<dt><strong>LOAD_WHOLE_IMAGE=YES/NO</strong></dt>
<dd>This option affects how image data is loaded for the resampler (as above).
This option, if turned on, will cause the whole source image to be loaded
and helps make up for problem identifying the area required, usually due
to radical image reprojection near a dateline or projection &#8220;horizon&#8221;.
The default is NO.  Turning this on can dramatically affect rendering
performance and memory requirements.</dd>
</dl>
<dl class="docutils" id="index-17">
<dt><strong>LUT[_n]=&lt;lut_spec&gt;</strong></dt>
<dd><p class="first">This directive (MapServer 4.9+) instructs the GDAL reader to apply a
custom LUT (lookup table) to one or all color bands as a form of on the
fly color correction. If LUT is used, the LUT is applied to all color
bands. If LUT_n is used it is applied to one color band (n is 1 for red, 2
for green, 3 for blue, 4 for alpha).</p>
<p>The LUT can be specified inline in the form:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">lut_spec</span><span class="o">&gt;</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">in_value</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">out_value</span><span class="o">&gt;</span><span class="p">[,</span><span class="o">&lt;</span><span class="n">in_value</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">out_value</span><span class="o">&gt;</span><span class="p">]</span><span class="o">*</span>
</pre></div>
</div>
<p>This essentially establish particular input values which are mapped to
particular output values.  The list implicitly begins with 0:0, and
255:255.  An actual 256 entry lookup table is created from this
specification, linearly interpolating between the values.  The in values
must be in increasing order.   The LUT specification may also be in a
text file with the &lt;lut_spec&gt; being the filename.  The file contents should
be in the same syntax, and the file is searched relative to the mapfile.</p>
<p>Example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">PROCESSING</span> <span class="s2">&quot;LUT_1=red.lut&quot;</span>
<span class="n">PROCESSING</span> <span class="s2">&quot;LUT_2=green.lut&quot;</span>
<span class="n">PROCESSING</span> <span class="s2">&quot;LUT_3=blue.lut&quot;</span>
  <span class="ow">or</span>
<span class="n">PROCESSING</span> <span class="s2">&quot;LUT=100:30,160:128,210:200&quot;</span>
</pre></div>
</div>
<p>As a special case there is also support for GIMP format curve files.  That
is the text files written out by the Tools-&gt;Color-&gt;Curves tool.  If this
is specified as the filename then it will be internally converted into
linear segments based on the curve control points.  Note that this will
not produce exactly the same results as the GIMP because linear
interpolation is used between control points instead of curves as used in
the GIMP.  For a reasonable number of control points the results should
be similar.  Also note that GIMP color curve files include an overall
&#8220;value&#8221; curve, and curves for red, green, blue and alpha.  The value curve
and the appropriate color curve will be composed internally to produce
the final LUT.</p>
<p>Example:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="n">PROCESSING</span> <span class="s2">&quot;LUT=munich.crv&quot;</span>
</pre></div>
</div>
</dd>
</dl>
<dl class="docutils" id="index-18">
<dt><strong>OVERSAMPLE_RATIO=double</strong></dt>
<dd><p class="first">Default is 2.5.  Rendering time will increase with increasing
OVERSAMPLE_RATIO.</p>
<p>Example:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="n">PROCESSING</span> <span class="s2">&quot;OVERSAMPLE_RATIO=1.0&quot;</span>
</pre></div>
</div>
</dd>
</dl>
<dl class="docutils" id="index-19">
<dt><strong>RESAMPLE=NEAREST/AVERAGE/BILINEAR</strong></dt>
<dd><p class="first">This option can be used to control the resampling kernel used sampling
raster images. The default (and fastest) is NEAREST. AVERAGE will perform
compute the average pixel value of all pixels in the region of the disk
file being mapped to the output pixel (or possibly just a sampling of
them). BILINEAR will compute a linear interpolation of the four pixels
around the target location. This topic is discussed in more detail in
<a class="reference internal" href="../development/rfc/ms-rfc-4.html#rfc4"><span class="std std-ref">MS RFC 4: MapServer Raster Resampling</span></a>.</p>
<p>Resampling options other than NEAREST result in use of the generalized
warper and can dramatically slow down raster processing. Generally AVERAGE
can be desirable for reducing noise in dramatically downsampled data, and
can give something approximating antialiasing for black and white
linework. BILINEAR can be helpful when oversampling data to give a smooth
appearance.</p>
<p>Example (chose one):</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="n">PROCESSING</span> <span class="s2">&quot;RESAMPLE=NEAREST&quot;</span>
<span class="n">PROCESSING</span> <span class="s2">&quot;RESAMPLE=AVERAGE&quot;</span>
<span class="n">PROCESSING</span> <span class="s2">&quot;RESAMPLE=BILINEAR&quot;</span>
</pre></div>
</div>
</dd>
</dl>
<dl class="docutils" id="index-20">
<dt><strong>SCALE[_n]=AUTO or min,max</strong></dt>
<dd><p class="first">This directive instructs the GDAL reader to pre-scale the incoming raster
data. It is primarily used to scale 16bit or floating point data to the
range 0-255, but can also be used to constrast stretch 8bit data. If an
explicit min/max are provided then the input data is stretch (or squished)
such that the minimum value maps to zero, and the maximum to 255. If AUTO
is used instead, a min/max is automatically computed. To control the
scaling of individual input bands, use the SCALE_1, SCALE_2 and SCALE_3
keywords (for red, green and blue) instead of SCALE which applies to all
bands.</p>
<p>Example:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="n">PROCESSING</span> <span class="s2">&quot;SCALE=AUTO&quot;</span>
 <span class="ow">or</span>
<span class="n">PROCESSING</span> <span class="s2">&quot;SCALE_1=409,1203&quot;</span>
<span class="n">PROCESSING</span> <span class="s2">&quot;SCALE_2=203,296&quot;</span>
<span class="n">PROCESSING</span> <span class="s2">&quot;SCALE_3=339,1004&quot;</span>
</pre></div>
</div>
</dd>
</dl>
<dl class="docutils" id="index-21">
<dt><strong>WORLDFILE=&lt;file&gt;</strong></dt>
<dd><p class="first">Specifies an alternative world file (for georeferencing).  If a
path only is specified, the base name of the dataset will be
appended.  The suffix (<cite>.wld</cite> / <cite>.tfw</cite> / ...) can be omitted.</p>
<p>Example:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="n">PROCESSING</span> <span class="s2">&quot;WORLDFILE=/path/&quot;</span>
 <span class="ow">or</span>
<span class="n">PROCESSING</span> <span class="s2">&quot;WORLDFILE=/path/file.wld&quot;</span>
 <span class="ow">or</span>
<span class="n">PROCESSING</span> <span class="s2">&quot;WORLDFILE=/path/file&quot;</span>
</pre></div>
</div>
</dd>
</dl>
</div>
<div class="section" id="raster-query">
<span id="index-22"></span><h2><a class="toc-backref" href="#table-of-contents">Raster Query</a><a class="headerlink" href="#raster-query" title="Permalink to this headline">¶</a></h2>
<p>A new feature added in MapServer 4.4 is the ability to perform queries on
rasters in a manner similar to queries against vector layers. Raster queries
on raster layers return one point feature for each pixel matching the query.
The point features will have attributes indicating the value of different
bands at that pixel, the final rendering color and the class name. The
resulting feature can be directly access in MapScript, or processed through
templates much like normal vector query results. Only raster layers with a
query TEMPLATE associated can be queried, even for the query methods that
don&#8217;t actually use the query template (much like vector data).</p>
<p>Raster query supports QueryByPoint, QueryByRect, and QueryByShape.
QueryByPoint supports single and multiple result queries. Other query
operations such as QueryByIndex, QueryByIndexAdd, QueryByAttributes and
QueryByFeature are not supported for raster layers.</p>
<p>Raster layers do <strong>not</strong> support saving queries to disk, nor <strong>query maps</strong>.</p>
<p>Raster queries return point features with some or all of the following
attributes:</p>
<table class="docutils field-list" frame="void" id="index-23" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">x:</th><td class="field-body">georeferenced X location of pixel.</td>
</tr>
</tbody>
</table>
<table class="docutils field-list" frame="void" id="index-24" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">y:</th><td class="field-body">georeferenced Y location of pixel.</td>
</tr>
</tbody>
</table>
<table class="docutils field-list" frame="void" id="index-25" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">value_list:</th><td class="field-body">a comma separated list of the values of all selected bands at the
target pixel.</td>
</tr>
</tbody>
</table>
<table class="docutils field-list" frame="void" id="index-26" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">value_n:</th><td class="field-body">the value for the n&#8217;th band in the selected list at this pixel
(zero based). There is one value_n entry for each selected band.</td>
</tr>
</tbody>
</table>
<table class="docutils field-list" frame="void" id="index-27" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">class:</th><td class="field-body">Name of the class this pixel is a member of (classified layers only).</td>
</tr>
</tbody>
</table>
<table class="docutils field-list" frame="void" id="index-28" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">red:</th><td class="field-body">red component of the display color for this pixel.</td>
</tr>
</tbody>
</table>
<table class="docutils field-list" frame="void" id="index-29" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">green:</th><td class="field-body">green component of the display color for this pixel.</td>
</tr>
</tbody>
</table>
<table class="docutils field-list" frame="void" id="index-30" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">blue:</th><td class="field-body">blue component of the display color for this pixel.</td>
</tr>
</tbody>
</table>
<p>The red, green and blue attribute are intended to be the final color the pixel
would be rendered with, but in some subtle cases it can be wrong (ie.
classified floating point results). The selected bands are normally the band
that would be used to render the layer. For a pure query-only layer BANDS
<cite>PROCESSING</cite> directive can be used to select more bands than could normally be
used in a render operation. For instance for a 7 band landsat scene a
<cite>PROCESSING</cite> &#8220;BANDS=1,2,3,4,5,6,7&#8221; directive could be used to get query results
for all seven bands in results to a query operation.</p>
<p>Care should be taken to avoid providing a large query area (selecting a lot of
pixels) as each selected pixel requires over 100 bytes of memory for temporary
caching. The RASTER_QUERY_MAX_RESULT <cite>PROCESSING</cite> item can be used to restrict
the maximum number of query results that will be returned. The default is one
million which would take on the order of 100MB of RAM.</p>
<p>Query results can be returned as HTML via the normal substitution into query
template HTML. Query results are also accessible via WMS GetFeatureInfo calls,
and from MapScript. The following example shows executing a feature query from
Python MapScript and fetching back the results:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="nb">map</span> <span class="o">=</span> <span class="n">mapscript</span><span class="o">.</span><span class="n">Map</span><span class="p">(</span><span class="s1">&#39;rquery.map&#39;</span><span class="p">)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="nb">map</span><span class="o">.</span><span class="n">getLayer</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">pnt</span> <span class="o">=</span> <span class="n">mapscript</span><span class="o">.</span><span class="n">Point</span><span class="p">()</span>
<span class="n">pnt</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">440780</span>
<span class="n">pnt</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">3751260</span>

<span class="n">layer</span><span class="o">.</span><span class="n">queryByPoint</span><span class="p">(</span> <span class="nb">map</span><span class="p">,</span> <span class="n">pnt</span><span class="p">,</span> <span class="n">mapscript</span><span class="o">.</span><span class="n">MS_MULTIPLE</span><span class="p">,</span> <span class="mf">180.0</span> <span class="p">)</span>

<span class="n">layer</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
  <span class="n">result</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">getResult</span><span class="p">(</span> <span class="n">i</span> <span class="p">)</span>
  <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
    <span class="k">break</span>

  <span class="n">s</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">getShape</span><span class="p">(</span> <span class="n">result</span> <span class="p">)</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">numitems</span><span class="p">):</span>
    <span class="k">print</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">s</span><span class="o">.</span><span class="n">getValue</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

<span class="n">layer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>This following is a simple example query <a class="reference internal" href="../mapfile/template.html#template"><span class="std std-ref">TEMPLATE</span></a>
file. The raster pixel attributes will be substituted in before the
query result is returned to the user as HTML.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Pixel</span><span class="p">:</span><span class="o">&lt;</span><span class="n">br</span><span class="o">&gt;</span>
  <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="n">value_list</span><span class="p">]</span><span class="o">&lt;</span><span class="n">br</span><span class="o">&gt;</span>

  <span class="n">value_0</span><span class="o">=</span><span class="p">[</span><span class="n">value_0</span><span class="p">]</span><span class="o">&lt;</span><span class="n">br</span><span class="o">&gt;</span>
  <span class="n">value_1</span><span class="o">=</span><span class="p">[</span><span class="n">value_1</span><span class="p">]</span><span class="o">&lt;</span><span class="n">br</span><span class="o">&gt;</span>
  <span class="n">value_2</span><span class="o">=</span><span class="p">[</span><span class="n">value_2</span><span class="p">]</span><span class="o">&lt;</span><span class="n">br</span><span class="o">&gt;</span>
  <span class="n">RGB</span> <span class="o">=</span> <span class="p">[</span><span class="n">red</span><span class="p">],[</span><span class="n">green</span><span class="p">],[</span><span class="n">blue</span><span class="p">]</span><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>
  <span class="n">Class</span> <span class="o">=</span> <span class="p">[</span><span class="n">class</span><span class="p">]</span><span class="o">&lt;</span><span class="n">br</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Internally raster query results are essentially treated as a set of
temporary features cached in RAM. Issuing a new query operation clears
the existing query cache on the layer. The transitory in-memory
representation of raster query results is also responsible for the
inability to save raster query results since saved query results
normally only contain the feature ids, not the entire features. Some
addition information is available in the <a class="reference external" href="https://github.com/mapserver/mapserver/wiki/RasterQuery">RasterQuery</a> Wiki topic.</p>
</div>
<div class="section" id="raster-display-performance-tips">
<span id="index-31"></span><h2><a class="toc-backref" href="#table-of-contents">Raster Display Performance Tips</a><a class="headerlink" href="#raster-display-performance-tips" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Build overview levels for large rasters to ensure only a reasonable
amount of data needs to be touched to display an overview of a large
layer. Overviews can be implemented as a group of raster layers at
different resolutions, using <cite>MINSCALEDENOM</cite>, and <cite>MAXSCALEDENOM</cite> to
control which layers are displayed at different
resolutions. Another, perhaps easier way, is to build overviews for
GDAL supported formats using the <a class="reference external" href="http://www.gdal.org/gdal_utilities.html">gdaladdo</a> utility.</li>
<li>When using tileindexes to manage many raster files as a single file,
it is especially important to have an overview layer that kicks in
at high scales to avoid having to open a large number of raster
files to fulfill the map request.</li>
<li>Preprocess RGB images to eightbit with a colormap to reduce the
amount of data that has to be read, and the amount of computation to
do on the fly.</li>
<li>For large images use tiling to reduce the overhead for loading a
view of a small area. This can be accomplished using the <cite>TILEINDEX</cite>
mechanism of the mapfile, or by creating a tiled format file
(ie. TIFF with GDAL).</li>
<li>Ensure that the image is kept on disk in the most commonly requested
projection to avoid on-the-fly image warping which is fairly
expensive.</li>
<li>If you are getting debug output from MapServer in your web server
log file, check to see if the message msResampleGDALToMap in effect
appears. If so, the raster layer is being resampled. If you don&#8217;t
think it should be resampled carefully review your map file to
ensure that the layer projection exactly matches the map projection
or that the layer has no projection definition.</li>
</ul>
</div>
<div class="section" id="preprocessing-rasters">
<span id="index-32"></span><h2><a class="toc-backref" href="#table-of-contents">Preprocessing Rasters</a><a class="headerlink" href="#preprocessing-rasters" title="Permalink to this headline">¶</a></h2>
<p>The following operations use GDAL commandline utilities, some of which are
python scripts.  They are generally available on any GDAL installation with
python support.</p>
<div class="section" id="producing-tiled-datasets">
<span id="index-33"></span><h3>Producing Tiled Datasets<a class="headerlink" href="#producing-tiled-datasets" title="Permalink to this headline">¶</a></h3>
<p>The TIFF and Erdas Imagine formats support internal tiling within
files, and will generally give better display speed for local map
requests from large images.  To produce a GeoTIFF file in internally
tiled format using the TILED=YES creation option with the
<a class="reference external" href="http://www.gdal.org/gdal_utilities.html">gdal_translate</a> utility:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">gdal_translate</span> <span class="o">-</span><span class="n">co</span> <span class="n">TILED</span><span class="o">=</span><span class="n">YES</span> <span class="n">original</span><span class="o">.</span><span class="n">tif</span> <span class="n">tiled</span><span class="o">.</span><span class="n">tif</span>
</pre></div>
</div>
<p>Erdas Imagine (HFA) files are always tiled, and can be larger than 4GB
(the GeoTIFF limit).  Use a command like the following to translate a
raster to Imagine format:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">gdal_translate</span> <span class="o">-</span><span class="n">of</span> <span class="n">HFA</span> <span class="n">original</span><span class="o">.</span><span class="n">tif</span> <span class="n">tiled</span><span class="o">.</span><span class="n">img</span>
</pre></div>
</div>
</div>
<div class="section" id="reducing-rgb-to-8bit">
<span id="index-34"></span><h3>Reducing RGB to 8bit<a class="headerlink" href="#reducing-rgb-to-8bit" title="Permalink to this headline">¶</a></h3>
<p>Rendering and returning 24bit images (especially as PNG) can be quite
expensive in render/compress time and bandwidth.  Pre-reducing raster
data to 8bit can save disk space, processing time, and bandwidth.
However, such a color reduction also implicitly reduces the quality of
the resulting map.  The color reduction can be done on the fly by
MapServer but this requires even more processing.  A faster approach
is to pre-reduce the colors of 24bit imagery to 8bit.  This can be
accomplished with the GDAL rgb2pct.py script like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">rgb2pct</span><span class="o">.</span><span class="n">py</span> <span class="n">original</span><span class="o">.</span><span class="n">tif</span> <span class="mi">8</span><span class="n">bit</span><span class="o">.</span><span class="n">tif</span>
</pre></div>
</div>
<p>By default images will be reduced to 256 colors but this can mean
there are not enough colors to render other colors in the map.  So it
may be desired to reduce to even less colors:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">rgb2pct</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">n</span> <span class="mi">200</span> <span class="n">original</span><span class="o">.</span><span class="n">tif</span> <span class="mi">8</span><span class="n">bit</span><span class="o">.</span><span class="n">tif</span>
</pre></div>
</div>
<p>Downsampling to 8bit should be done before internal tiling and
overview building.  The rgb2pct.py script tries to compute an optimal
color table for a given image, and then uses error diffusion during
the 24bit to 8bit reduction.  Other packages (such as ImageMagick or
Photoshop) may have alternative color reduction algorithms that are
more appropriate for some uses.</p>
</div>
<div class="section" id="building-internal-overviews">
<span id="index-35"></span><h3>Building Internal Overviews<a class="headerlink" href="#building-internal-overviews" title="Permalink to this headline">¶</a></h3>
<p>Most GDAL supported raster formats can have overviews pre-built using
the <a class="reference external" href="http://www.gdal.org/gdal_utilities.html">gdaladdo</a> utility.  However, a few formats, such as JPEG2000,
MrSID, and ECW already contain implicit overviews in the format
themselves and will not generally benefit from external overviews.
For other formats (such as GeoTIFF, and Erdas Imagine format) use a
command like the following to build overviews:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">gdaladdo</span> <span class="n">tile</span><span class="o">.</span><span class="n">tif</span> <span class="mi">2</span> <span class="mi">4</span> <span class="mi">8</span> <span class="mi">16</span> <span class="mi">32</span> <span class="mi">64</span> <span class="mi">128</span>
</pre></div>
</div>
<p>The above would build overviews at x2 through x128 decimation levels.
By default it uses &#8220;nearest neighbour&#8221; downsampling.  That is one of
the pixels in the input downsampled area is selected for each output
pixel.  For some kinds of data averaging can give much smoother
overview results, as might be generated with this command:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">gdaladdo</span> <span class="o">-</span><span class="n">r</span> <span class="n">average</span> <span class="n">tiled</span><span class="o">.</span><span class="n">tif</span> <span class="mi">2</span> <span class="mi">4</span> <span class="mi">8</span> <span class="mi">16</span> <span class="mi">32</span> <span class="mi">64</span> <span class="mi">128</span>
</pre></div>
</div>
<p>Note that overview building should be done after translating to a
final format.  Overviews are lost in format conversions using
gdal_translate.  Also, nothing special needs to be done to make
MapServer use GDAL generated overviews.  They are automatically picked
up by GDAL when mapserver requests a reduced resolution map.</p>
</div>
<div class="section" id="building-external-overviews">
<span id="index-36"></span><h3>Building External Overviews<a class="headerlink" href="#building-external-overviews" title="Permalink to this headline">¶</a></h3>
<p>When working with large collections of raster files using a MapServer
tileindex, it is desirable to build reduced resolution overview layers
that kick in at high scales (using <cite>MINSCALEDENOM</cite> / <cite>MAXSCALEDENOM</cite>
to control which layer activates).  Preparing the overviews can be a
somewhat complex process.  One approach is to use the gdal_merge.py
script to downsample and mosaic all the images.  For instance if we
want to produce an overview of many 1meter ortho photos with 250 meter
pixels we might do something like:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">gdal_merge</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">o</span> <span class="n">overview</span><span class="o">.</span><span class="n">tif</span> <span class="o">-</span><span class="n">ps</span> <span class="mi">250</span> <span class="mi">250</span> <span class="n">ortho_</span><span class="o">*.</span><span class="n">tif</span>
</pre></div>
</div>
<p>The gdal_merge.py utility suffers from a variety of issues, including
no support for different resampling kernels.  With GDAL 1.3.2 or later
it should be able to accomplish something similar with the more
flexible gdalwarp utility:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">gdalwarp</span> <span class="o">-</span><span class="n">rc</span> <span class="o">-</span><span class="n">tr</span> <span class="mi">250</span> <span class="mi">250</span> <span class="n">ortho_</span><span class="o">*.</span><span class="n">tif</span> <span class="n">overview</span><span class="o">.</span><span class="n">tif</span>
</pre></div>
</div>
<p>In some cases the easiest way of generating an overview is to let
MapServer do it using the shp2img utility.  For instance if the
tileindex layer is called &#8216;&#8217;orthos&#8217;&#8217; we could do something like:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">shp2img</span> <span class="o">-</span><span class="n">m</span> <span class="n">ortho</span><span class="o">.</span><span class="n">map</span> <span class="o">-</span><span class="n">l</span> <span class="n">orthos</span> <span class="o">-</span><span class="n">o</span> <span class="n">overview</span><span class="o">.</span><span class="n">png</span>
</pre></div>
</div>
<p>Note that the overview will be generated with the extents and size in
the .map file, so it may be necessary to temporarily adjust the map
extents and size values to match the raster extents and the desired
output size.  Also, if using this method, don&#8217;t leave large files in
PNG (or GIF or JPEG) format as they are slow formats to extract
subareas from.</p>
<span class="target" id="index-37"></span></div>
</div>
<div class="section" id="georeference-with-world-files">
<span id="index-38"></span><h2><a class="toc-backref" href="#table-of-contents">Georeference with World Files</a><a class="headerlink" href="#georeference-with-world-files" title="Permalink to this headline">¶</a></h2>
<p>World files are a simple mechanism for associating georeferencing
(world coordinates) information with raster files. ESRI was the first
company to propagate the use of world files, and they are often used with
TIFF instead of embedding georeferencing information in the file
itself.</p>
<p>The world file contents look like the following. The first coefficient
is the X pixel size. The second and third are rotational/shear
coefficients (and should normally be 0.0). The fourth is the Y pixel
size, normally negative indicating that Y decreases as you move down
from the top left origin. The final two values are the X and Y
location of the center of the top left pixel. This example is for an
image with a 2m x 2m pixel size, and a top left origin at (356800E,
5767999N):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="mi">2</span>
<span class="mf">0.0000000000</span>
<span class="mf">0.0000000000</span>
<span class="o">-</span><span class="mi">2</span>
<span class="mf">356800.00</span>
<span class="mf">5767999.00</span>
</pre></div>
</div>
<p>The name of the world file is based on the file it relates to. For
instance, the world file for aerial.tif might be
aerial.tfw. Conventions vary for appropriate endings, but with
MapServer the extension .wld is always OK for world files.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><h3>Navigation</h3>
<p>
<a href="../about.html" title="About">About</a><br>
<a href="../products.html" title="Products">Products</a><br>
<a href="../community/index.html" title="Community">Community</a><br>
<a href="../development/index.html" title="Development">Development</a><br>
<a href="../download.html" title="Downloads">Downloads</a><br>
<a href="../documentation.html" title="Documentation">Documentation</a><br>
<a href="../faq.html" title="FAQ">FAQ</a><br>
<a href="../psc.html" title="PSC">PSC</a>
</p>
  <h3>Current Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Raster Data</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#how-are-rasters-added-to-a-map-file">How are rasters added to a Map file?</a><ul>
<li><a class="reference internal" href="#classifying-rasters">Classifying Rasters</a><ul>
<li><a class="reference internal" href="#classifying-non-8bit-rasters">Classifying Non-8bit Rasters</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#supported-formats">Supported Formats</a></li>
<li><a class="reference internal" href="#rasters-and-tile-indexing">Rasters and Tile Indexing</a><ul>
<li><a class="reference internal" href="#tile-index-notes">Tile Index Notes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#raster-warping">Raster Warping</a></li>
<li><a class="reference internal" href="#bit-rgb-rendering">24bit RGB Rendering</a></li>
<li><a class="reference internal" href="#special-processing-directives">Special Processing Directives</a></li>
<li><a class="reference internal" href="#raster-query">Raster Query</a></li>
<li><a class="reference internal" href="#raster-display-performance-tips">Raster Display Performance Tips</a></li>
<li><a class="reference internal" href="#preprocessing-rasters">Preprocessing Rasters</a><ul>
<li><a class="reference internal" href="#producing-tiled-datasets">Producing Tiled Datasets</a></li>
<li><a class="reference internal" href="#reducing-rgb-to-8bit">Reducing RGB to 8bit</a></li>
<li><a class="reference internal" href="#building-internal-overviews">Building Internal Overviews</a></li>
<li><a class="reference internal" href="#building-external-overviews">Building External Overviews</a></li>
</ul>
</li>
<li><a class="reference internal" href="#georeference-with-world-files">Georeference with World Files</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="virtual-file.html" title="Virtual File System"
             >next</a> |</li>
        <li class="right" >
          <a href="vector/wfs.html" title="WFS"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../documentation.html" >MapServer 7.0.3 Documentation</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Data Input</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; <a href="../copyright.html">Copyright</a> 2016, Open Source Geospatial Foundation.
      Last updated on 2016-12-15.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.1.
    </div>
  </body>
</html>