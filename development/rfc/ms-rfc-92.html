<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>MS RFC 92: Migrating from Autotools to CMake &#8212; MapServer 8.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx.css?v=6c7b17ac" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=dd298242" />
    <link rel="stylesheet" type="text/css" href="../../_static/ribbon.css?v=ea091bf4" />
    
    <script src="../../_static/documentation_options.js?v=521b6f53"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="icon" href="../../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="MS RFC 93: UTF Grid Support" href="ms-rfc-93.html" />
    <link rel="prev" title="MS RFC 91: Layer Filter Normalization" href="ms-rfc-91.html" /> 
  </head><body>


<!-- for main branch only, do not backport this -->

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../../index.html" title="Home"><img src="../../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../../index.html" title="Home">Home</a> |
      <a href="../../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter" target="_blank">Twitter</a> |
      <a href="../../download.html" title="Download Source or Binaries">Download </a> |
      <a class="badge" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=KRJ2X44N3HA6U&source=url" target="_blank">
        <img src="https://img.shields.io/badge/donate-%E2%9D%A4%C2%A0-ff69b4.svg?style=flat" alt="Donate to MapServer">
      </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../../ar/development/rfc/ms-rfc-92.html"><img src="../../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../../de/development/rfc/ms-rfc-92.html"><img src="../../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../../el/development/rfc/ms-rfc-92.html"><img src="../../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../../es/development/rfc/ms-rfc-92.html"><img src="../../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../../fr/development/rfc/ms-rfc-92.html"><img src="../../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../../id/development/rfc/ms-rfc-92.html"><img src="../../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../../it/development/rfc/ms-rfc-92.html"><img src="../../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../../ja/development/rfc/ms-rfc-92.html"><img src="../../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../../nl_NL/development/rfc/ms-rfc-92.html"><img src="../../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../../pl/development/rfc/ms-rfc-92.html"><img src="../../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../../ru/development/rfc/ms-rfc-92.html"><img src="../../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../../sq/development/rfc/ms-rfc-92.html"><img src="../../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../../tr/development/rfc/ms-rfc-92.html"><img src="../../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ms-rfc-93.html" title="MS RFC 93: UTF Grid Support"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-91.html" title="MS RFC 91: Layer Filter Normalization"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 92: Migrating from Autotools to CMake</a></li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="ms-rfc-92-migrating-from-autotools-to-cmake">
<span id="rfc92"></span><h1>MS RFC 92: Migrating from Autotools to CMake<a class="headerlink" href="#ms-rfc-92-migrating-from-autotools-to-cmake" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Date<span class="colon">:</span></dt>
<dd class="field-odd"><p>2013/03/26</p>
</dd>
<dt class="field-even">Author<span class="colon">:</span></dt>
<dd class="field-even"><p>Thomas Bonfort</p>
</dd>
<dt class="field-odd">Contact<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="mailto:thomas&#46;bonfort&#37;&#52;&#48;gmail&#46;com">thomas<span>&#46;</span>bonfort<span>&#64;</span>gmail<span>&#46;</span>com</a></p>
</dd>
<dt class="field-even">Status<span class="colon">:</span></dt>
<dd class="field-even"><p>Adopted</p>
</dd>
<dt class="field-odd">Version<span class="colon">:</span></dt>
<dd class="field-odd"><p>MapServer 6.4</p>
</dd>
</dl>
<section id="overview">
<h2>1. Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p>Our current autoconf + Makefile setup has several limitations:</p>
<ul class="simple">
<li><p>searching for external dependencies is inconsistent between searched libraries</p></li>
<li><p>some external dependencies are not found in their default locations, forcing
the inclusion of default locations in the compiler/linker flags, and thus
preventing the usage of other dependencies installed in non-standard locations
(e.g. if -L/usr/lib is added to the linker flags, then /usr/lib/libgdal.so will
be used even if the user asked to use gdal from /opt/local/)</p></li>
<li><p>the number of iterations that happened in configure.in are starting to show…
maintaining this file is now a fairly evolved task</p></li>
<li><p>Build files for platforms that do not support autotools are hand maintained
alongside the standard Makefiles</p></li>
<li><p>Mapscript builds are not streamlined with the principal build, and require
custom instructions for each language</p></li>
<li><p>Supported features and available system functions are declared as defines on
the compiler command line, preventing the safe usage of our headers without the
need to know exactly what defines should be added (thus the need for the
mapserver-config and mapservervars hacks to be able to build mapscripts)</p></li>
</ul>
</section>
<section id="proposed-solution">
<h2>2. Proposed solution<a class="headerlink" href="#proposed-solution" title="Link to this heading">¶</a></h2>
<p>Switch to cmake (<a class="reference external" href="http://www.cmake.org">http://www.cmake.org</a>) to replace our autoconf + Makefile.in
setup. Cmake is aimed at building and installing c/c++ projects in a
cross-platform way.</p>
</section>
<section id="implementation-details">
<h2>3. Implementation Details<a class="headerlink" href="#implementation-details" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>remove the current autotools/Makefile related files</p></li>
<li><p>implement CMakefiles replicating our search for dependencies and build</p></li>
<li><p>use a generated mapserver-config.h included by mapserver.h that contains
the defines that we are now passing on the command line (-DUSE_OGR or -DNEED_STRSTR)</p></li>
<li><p>store MapServer release information in the CMakefiles, and include that information
in a generated mapserver-version.h</p></li>
</ul>
</section>
<section id="files-affected">
<h2>3.2 Files affected<a class="headerlink" href="#files-affected" title="Link to this heading">¶</a></h2>
<dl class="simple">
<dt>Files removed:</dt><dd><ul class="simple">
<li><p>*/Makefile */Makefile.in</p></li>
<li><p>configure.in configure</p></li>
<li><p>aclocal.m4</p></li>
<li><p>README.Configure</p></li>
</ul>
</dd>
<dt>Files added:</dt><dd><ul class="simple">
<li><p>*/CMakeLists.txt</p></li>
<li><p>mapserver-config.h.in</p></li>
<li><p>mapserver-version.h.in</p></li>
</ul>
</dd>
</dl>
</section>
<section id="mapscript">
<h2>3.3 MapScript<a class="headerlink" href="#mapscript" title="Link to this heading">¶</a></h2>
<p>Mapscript building will be streamlined with the main build process, and usually
requires the presence of SWIG.</p>
</section>
<section id="backwards-compatibility-issues">
<h2>3.4 Backwards Compatibility Issues<a class="headerlink" href="#backwards-compatibility-issues" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Current ./configure handling will not be supported.</p></li>
<li><p>Linking against dependencies available as a static library only is not supported
directly. Workarounds should be possible and will be documented if that need
arises</p></li>
<li><p>Installed binaries will not have their rpath to libmapserver set. If libmapserver
is installed to a non-standard location, then LD_LIBRARY_PATH will have to be set
pointing to that location.</p></li>
<li><p>Current win32 buildfiles would need to be updated as the NEED_STRXXX defines have
been renamed in mapserver.h to HAVE_STRXXX</p></li>
</ul>
</section>
<section id="tips-when-migrating-from-autotools-habits">
<h2>4. Tips when migrating from autotools habits<a class="headerlink" href="#tips-when-migrating-from-autotools-habits" title="Link to this heading">¶</a></h2>
<ul>
<li><p>Cmake builds should preferably be run “out-of-source”, i.e. in a separate
directory from the source files:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd mapserver
$ mkdir build
$ cd build
$ cmake ..
# fix dependency problems
$ make
</pre></div>
</div>
</li>
<li><p>Many new features are enabled/looked for by default instead of being silently
ignored.</p></li>
<li><p>Missing dependencies are reported with an error message indicating the resolution.
An unwanted dependency can be disabled by adding -DWITH_XXX=0 to the cmake
invocation (e.g. -DWITH_FRIBIDI=0 -DWITH_WFS=0)</p></li>
<li><p>Mapscripts are not built by default and are enabled by adding -DWITH_PHP=1
-DWITH_PYTHON=1, etc…</p></li>
<li><p>Dependencies that are installed outside of default locations can be referenced by
adding -DCMAKE_PREFIX_PATH=/path/to/gdal-prefix;/path/to/libxml2-prefix</p></li>
</ul>
</section>
<section id="performance-implications">
<h2>5. Performance implications<a class="headerlink" href="#performance-implications" title="Link to this heading">¶</a></h2>
<p>None</p>
</section>
<section id="bug-id">
<h2>6. Bug ID<a class="headerlink" href="#bug-id" title="Link to this heading">¶</a></h2>
<p><a class="reference external" href="https://github.com/MapServer/MapServer/issues/4617">https://github.com/MapServer/MapServer/issues/4617</a></p>
</section>
<section id="voting-history">
<h2>7. Voting history<a class="headerlink" href="#voting-history" title="Link to this heading">¶</a></h2>
<p>+1 from ThomasB, MikeS, TomK, JeffM, DanielM, OlivierC,
SteveL, SteveW and PerryN</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p>
<a href="../../about.html" title="About">About</a><br>
<a href="../../products.html" title="Products">Products</a><br>
<a href="../../community/index.html" title="Community">Community</a><br>
<a href="../index.html" title="Development">Development</a><br>
<a href="../../download.html" title="Downloads">Downloads</a><br>
<a href="../../documentation.html" title="Documentation">Documentation</a><br>
<a href="../../faq.html" title="FAQ">FAQ</a><br>
<a href="../../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</h3>
  <ul>
<li><a class="reference internal" href="#">MS RFC 92: Migrating from Autotools to CMake</a><ul>
<li><a class="reference internal" href="#overview">1. Overview</a></li>
<li><a class="reference internal" href="#proposed-solution">2. Proposed solution</a></li>
<li><a class="reference internal" href="#implementation-details">3. Implementation Details</a></li>
<li><a class="reference internal" href="#files-affected">3.2 Files affected</a></li>
<li><a class="reference internal" href="#mapscript">3.3 MapScript</a></li>
<li><a class="reference internal" href="#backwards-compatibility-issues">3.4 Backwards Compatibility Issues</a></li>
<li><a class="reference internal" href="#tips-when-migrating-from-autotools-habits">4. Tips when migrating from autotools habits</a></li>
<li><a class="reference internal" href="#performance-implications">5. Performance implications</a></li>
<li><a class="reference internal" href="#bug-id">6. Bug ID</a></li>
<li><a class="reference internal" href="#voting-history">7. Voting history</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ms-rfc-93.html" title="MS RFC 93: UTF Grid Support"
             >next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-91.html" title="MS RFC 91: Layer Filter Normalization"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 92: Migrating from Autotools to CMake</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; <a href="../../copyright.html">Copyright</a> 2023, Open Source Geospatial Foundation.
      Last updated on 2023-12-22.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.5.
    </div>
  </body>
</html>