<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>MS RFC 92: Migrating from Autotools to CMake &mdash; MapServer 7.0.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '7.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="top" title="MapServer 7.0.0 documentation" href="../../index.html" />
    <link rel="up" title="Request for Comments" href="index.html" />
    <link rel="next" title="MS RFC 93: UTF Grid Support" href="ms-rfc-93.html" />
    <link rel="prev" title="MS RFC 91: Layer Filter Normalization" href="ms-rfc-91.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../../index.html" title="Home"><img src="../../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../../index.html" title="Home">Home</a> |
      <a href="../../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../../faq.html" title="FAQ">FAQ</a> |
      <a href="../../download.html" title="Download">Download </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../../ar/development/rfc/ms-rfc-92.html"><img src="../../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../../de/development/rfc/ms-rfc-92.html"><img src="../../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../../el/development/rfc/ms-rfc-92.html"><img src="../../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../../es/development/rfc/ms-rfc-92.html"><img src="../../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../../fr/development/rfc/ms-rfc-92.html"><img src="../../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../../id/development/rfc/ms-rfc-92.html"><img src="../../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../../it/development/rfc/ms-rfc-92.html"><img src="../../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../../ja/development/rfc/ms-rfc-92.html"><img src="../../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../../nl_NL/development/rfc/ms-rfc-92.html"><img src="../../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../../pl/development/rfc/ms-rfc-92.html"><img src="../../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../../ru/development/rfc/ms-rfc-92.html"><img src="../../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../../sq/development/rfc/ms-rfc-92.html"><img src="../../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../../tr/development/rfc/ms-rfc-92.html"><img src="../../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        
        
          <a href="../../uk/development/rfc/ms-rfc-92.html"><img src="../../_static/flagicons/uk.png" alt="uk" title="uk" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ms-rfc-93.html" title="MS RFC 93: UTF Grid Support"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-91.html" title="MS RFC 91: Layer Filter Normalization"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Request for Comments</a> &raquo;</li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="ms-rfc-92-migrating-from-autotools-to-cmake">
<span id="rfc92"></span><h1>MS RFC 92: Migrating from Autotools to CMake<a class="headerlink" href="#ms-rfc-92-migrating-from-autotools-to-cmake" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Date:</th><td class="field-body">2013/03/26</td>
</tr>
<tr class="field-even field"><th class="field-name">Author:</th><td class="field-body">Thomas Bonfort</td>
</tr>
<tr class="field-odd field"><th class="field-name">Contact:</th><td class="field-body"><a class="reference external" href="mailto:thomas&#46;bonfort&#37;&#52;&#48;gmail&#46;com">thomas<span>&#46;</span>bonfort<span>&#64;</span>gmail<span>&#46;</span>com</a></td>
</tr>
<tr class="field-even field"><th class="field-name">Status:</th><td class="field-body">Adopted</td>
</tr>
<tr class="field-odd field"><th class="field-name">Version:</th><td class="field-body">MapServer 6.4</td>
</tr>
</tbody>
</table>
<div class="section" id="overview">
<h2>1. Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Our current autoconf + Makefile setup has several limitations:</p>
<ul class="simple">
<li>searching for external dependencies is inconsistent between searched libraries</li>
<li>some external dependencies are not found in their default locations, forcing
the inclusion of default locations in the compiler/linker flags, and thus
preventing the usage of other dependencies installed in non-standard locations
(e.g. if -L/usr/lib is added to the linker flags, then /usr/lib/libgdal.so will
be used even if the user asked to use gdal from /opt/local/)</li>
<li>the number of iterations that happened in configure.in are starting to show...
maintaining this file is now a fairly evolved task</li>
<li>Build files for platforms that do not support autotools are hand maintained
alongside the standard Makefiles</li>
<li>Mapscript builds are not streamlined with the principal build, and require
custom instructions for each language</li>
<li>Supported features and available system functions are declared as defines on
the compiler command line, preventing the safe usage of our headers without the
need to know exactly what defines should be added (thus the need for the
mapserver-config and mapservervars hacks to be able to build mapscripts)</li>
</ul>
</div>
<div class="section" id="proposed-solution">
<h2>2. Proposed solution<a class="headerlink" href="#proposed-solution" title="Permalink to this headline">¶</a></h2>
<p>Switch to cmake (<a class="reference external" href="http://www.cmake.org">http://www.cmake.org</a>) to replace our autoconf + Makefile.in
setup. Cmake is aimed at building and installing c/c++ projects in a
cross-platform way.</p>
</div>
<div class="section" id="implementation-details">
<h2>3. Implementation Details<a class="headerlink" href="#implementation-details" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>remove the current autotools/Makefile related files</li>
<li>implement CMakefiles replicating our search for dependencies and build</li>
<li>use a generated mapserver-config.h included by mapserver.h that contains
the defines that we are now passing on the command line (-DUSE_OGR or -DNEED_STRSTR)</li>
<li>store Mapserver release information in the CMakefiles, and include that information
in a generated mapserver-version.h</li>
</ul>
</div>
<div class="section" id="files-affected">
<h2>3.2 Files affected<a class="headerlink" href="#files-affected" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>Files removed:</dt>
<dd><ul class="first last simple">
<li>*/Makefile */Makefile.in</li>
<li>configure.in configure</li>
<li>aclocal.m4</li>
<li>README.Configure</li>
</ul>
</dd>
<dt>Files added:</dt>
<dd><ul class="first last simple">
<li>*/CMakeLists.txt</li>
<li>mapserver-config.h.in</li>
<li>mapserver-version.h.in</li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="mapscript">
<h2>3.3 MapScript<a class="headerlink" href="#mapscript" title="Permalink to this headline">¶</a></h2>
<p>Mapscript building will be streamlined with the main build process, and usually
requires the presence of SWIG.</p>
</div>
<div class="section" id="backwards-compatibility-issues">
<h2>3.4 Backwards Compatibility Issues<a class="headerlink" href="#backwards-compatibility-issues" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Current ./configure handling will not be supported.</li>
<li>Linking against dependencies available as a static library only is not supported
directly. Workarounds should be possible and will be documented if that need
arises</li>
<li>Installed binaries will not have their rpath to libmapserver set. If libmapserver
is installed to a non-standard location, then LD_LIBRARY_PATH will have to be set
pointing to that location.</li>
<li>Current win32 buildfiles would need to be updated as the NEED_STRXXX defines have
been renamed in mapserver.h to HAVE_STRXXX</li>
</ul>
</div>
<div class="section" id="tips-when-migrating-from-autotools-habits">
<h2>4. Tips when migrating from autotools habits<a class="headerlink" href="#tips-when-migrating-from-autotools-habits" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">Cmake builds should preferably be run &#8220;out-of-source&#8221;, i.e. in a separate
directory from the source files:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ cd mapserver
$ mkdir build
$ cd build
$ cmake ..
# fix dependency problems
$ make
</pre></div>
</div>
</li>
<li><p class="first">Many new features are enabled/looked for by default instead of being silently
ignored.</p>
</li>
<li><p class="first">Missing dependencies are reported with an error message indicating the resolution.
An unwanted dependency can be disabled by adding -DWITH_XXX=0 to the cmake
invocation (e.g. -DWITH_FRIBIDI=0 -DWITH_WFS=0)</p>
</li>
<li><p class="first">Mapscripts are not built by default and are enabled by adding -DWITH_PHP=1
-DWITH_PYTHON=1, etc...</p>
</li>
<li><p class="first">Dependencies that are installed outside of default locations can be referenced by
adding -DCMAKE_PREFIX_PATH=/path/to/gdal-prefix;/path/to/libxml2-prefix</p>
</li>
</ul>
</div>
<div class="section" id="performance-implications">
<h2>5. Performance implications<a class="headerlink" href="#performance-implications" title="Permalink to this headline">¶</a></h2>
<p>None</p>
</div>
<div class="section" id="bug-id">
<h2>6. Bug ID<a class="headerlink" href="#bug-id" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/mapserver/mapserver/issues/4617">https://github.com/mapserver/mapserver/issues/4617</a></p>
</div>
<div class="section" id="voting-history">
<h2>7. Voting history<a class="headerlink" href="#voting-history" title="Permalink to this headline">¶</a></h2>
<p>+1 from ThomasB, MikeS, TomK, JeffM, DanielM, OlivierC,
SteveL, SteveW and PerryN</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Navigation</h3>
<p>
<a href="../../about.html" title="About">About</a><br>
<a href="../../products.html" title="Products">Products</a><br>
<a href="../../community/index.html" title="Community">Community</a><br>
<a href="../index.html" title="Development">Development</a><br>
<a href="../../download.html" title="Downloads">Downloads</a><br>
<a href="../../documentation.html" title="Documentation">Documentation</a><br>
<a href="../../faq.html" title="FAQ">FAQ</a>
</p>
  <h3>Current Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">MS RFC 92: Migrating from Autotools to CMake</a><ul>
<li><a class="reference internal" href="#overview">1. Overview</a></li>
<li><a class="reference internal" href="#proposed-solution">2. Proposed solution</a></li>
<li><a class="reference internal" href="#implementation-details">3. Implementation Details</a></li>
<li><a class="reference internal" href="#files-affected">3.2 Files affected</a></li>
<li><a class="reference internal" href="#mapscript">3.3 MapScript</a></li>
<li><a class="reference internal" href="#backwards-compatibility-issues">3.4 Backwards Compatibility Issues</a></li>
<li><a class="reference internal" href="#tips-when-migrating-from-autotools-habits">4. Tips when migrating from autotools habits</a></li>
<li><a class="reference internal" href="#performance-implications">5. Performance implications</a></li>
<li><a class="reference internal" href="#bug-id">6. Bug ID</a></li>
<li><a class="reference internal" href="#voting-history">7. Voting history</a></li>
</ul>
</li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Open Source Geospatial Foundation.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.4</a>
      
    </div>

    

    
  </body>
</html>