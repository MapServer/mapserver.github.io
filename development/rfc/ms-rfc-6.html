<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>MS RFC 6: Color Range Mapping of Continuous Feature Values &#8212; MapServer 8.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx.css?v=6c7b17ac" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=dd298242" />
    <link rel="stylesheet" type="text/css" href="../../_static/ribbon.css?v=ea091bf4" />
    
    <script src="../../_static/documentation_options.js?v=521b6f53"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="icon" href="../../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="MS RFC 7: MapServer CVS Commit Management" href="ms-rfc-7.html" />
    <link rel="prev" title="MS RFC 5: MapServer Horizon Reprojection Improvements" href="ms-rfc-5.html" /> 
  </head><body>


<!-- for main branch only, do not backport this -->

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../../index.html" title="Home"><img src="../../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../../index.html" title="Home">Home</a> |
      <a href="../../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter" target="_blank">Twitter</a> |
      <a href="../../download.html" title="Download Source or Binaries">Download </a> |
      <a class="badge" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=KRJ2X44N3HA6U&source=url" target="_blank">
        <img src="https://img.shields.io/badge/donate-%E2%9D%A4%C2%A0-ff69b4.svg?style=flat" alt="Donate to MapServer">
      </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../../ar/development/rfc/ms-rfc-6.html"><img src="../../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../../de/development/rfc/ms-rfc-6.html"><img src="../../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../../el/development/rfc/ms-rfc-6.html"><img src="../../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../../es/development/rfc/ms-rfc-6.html"><img src="../../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../../fr/development/rfc/ms-rfc-6.html"><img src="../../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../../id/development/rfc/ms-rfc-6.html"><img src="../../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../../it/development/rfc/ms-rfc-6.html"><img src="../../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../../ja/development/rfc/ms-rfc-6.html"><img src="../../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../../nl_NL/development/rfc/ms-rfc-6.html"><img src="../../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../../pl/development/rfc/ms-rfc-6.html"><img src="../../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../../ru/development/rfc/ms-rfc-6.html"><img src="../../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../../sq/development/rfc/ms-rfc-6.html"><img src="../../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../../tr/development/rfc/ms-rfc-6.html"><img src="../../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ms-rfc-7.html" title="MS RFC 7: MapServer CVS Commit Management"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-5.html" title="MS RFC 5: MapServer Horizon Reprojection Improvements"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 6: Color Range Mapping of Continuous Feature Values</a></li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="ms-rfc-6-color-range-mapping-of-continuous-feature-values">
<span id="rfc6"></span><h1>MS RFC 6: Color Range Mapping of Continuous Feature Values<a class="headerlink" href="#ms-rfc-6-color-range-mapping-of-continuous-feature-values" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Date<span class="colon">:</span></dt>
<dd class="field-odd"><p>2005/09/27</p>
</dd>
<dt class="field-even">Author<span class="colon">:</span></dt>
<dd class="field-even"><p>Bill Binko</p>
</dd>
<dt class="field-odd">Contact<span class="colon">:</span></dt>
<dd class="field-odd"><p>bill at binko.net</p>
</dd>
<dt class="field-even">Status<span class="colon">:</span></dt>
<dd class="field-even"><p>Proposed</p>
</dd>
</dl>
<p>Description: This proposal addresses the need to be able to easily
map continuous feature values to a continuous range of colors.  This RFC is
the result of (and my interpretation of) the discussion that
surrounded Bug #1305.</p>
<p>A preliminary patch has already been applied to MapServer  4.6+ (before
the RFC process was in place), however, there is little consensus on the
format being used and there is no support for proper display of
legends for classes using ColorRanges.</p>
<section id="background">
<h2>Background<a class="headerlink" href="#background" title="Link to this heading">¶</a></h2>
<p>This work started as a patch that I created to be able to quickly
visualize data with a large range of values.  In particular, I was
wishing to map property values, and various ratios that could take on
a large range of values.  To me, the natural way to do this was to set
a max value, a min value and what colors those mapped to.  The patch I
wrote had MapServer  do a linear interpolation of the value for each
feature on to that color range.</p>
<p>The initial syntax for this feature simply added 5 new keywords to the
STYLE block and looked as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">STYLE</span>
  <span class="n">COLOR</span> <span class="mi">60</span> <span class="mi">60</span> <span class="mi">60</span>
  <span class="n">MINCOLOR</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span>
  <span class="n">MAXCOLOR</span> <span class="mi">255</span> <span class="mi">255</span> <span class="mi">0</span>
  <span class="n">MINVALUE</span> <span class="mf">0.0</span>
  <span class="n">MAXVALUE</span> <span class="mf">300000.0</span>
  <span class="n">GRADIENTITEM</span> <span class="s2">&quot;sale_price&quot;</span>
<span class="n">END</span>
</pre></div>
</div>
<p>After some discussion, the term Gradient was shown to be problematic.
Also, the number of new keywords seemed high.  After some discussion,
the syntax was changed to this format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">STYLE</span>
  <span class="n">COLORRANGE</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span>  <span class="mi">255</span> <span class="mi">255</span> <span class="mi">0</span> <span class="c1"># black to yellow</span>
  <span class="n">DATARANGE</span> <span class="mf">0.0</span> <span class="mf">100.0</span>
  <span class="n">RANGEITEM</span> <span class="s2">&quot;foobar&quot;</span>
<span class="n">END</span>
</pre></div>
</div>
<p>While this is still just a set of keywords under a Style, it seemed
simpler and is now working in the MapServer  4.6 branch.</p>
</section>
<section id="current-syntax-problems">
<h2>Current Syntax Problems<a class="headerlink" href="#current-syntax-problems" title="Link to this heading">¶</a></h2>
<p>Several people pointed out that the current syntax could be improved
by:</p>
<ol class="arabic simple">
<li><p>Moving the new keywords into a block</p></li>
<li><p>Adding a METHOD keyword with the type of interpolation used
(‘linear’ being the first defined type, ‘logarithmic’ being a
potential second type, etc.</p></li>
<li><p>Adding an INTERVALS keyword that would limit the number of colors
actually used by rounding values before interopolation.</p></li>
<li><p>Moving all of the keywords out of the Style block.</p></li>
<li><p>Allowing the ColorRange to be defined separately so that it can be reused</p></li>
</ol>
</section>
<section id="proposed-new-syntax">
<h2>Proposed New Syntax<a class="headerlink" href="#proposed-new-syntax" title="Link to this heading">¶</a></h2>
<p>To meet the above needs, I propose the following new Block Syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">COLORRANGE</span>
  <span class="n">RANGEITEM</span> <span class="s1">&#39;itemname&#39;</span> <span class="c1">#required</span>
  <span class="n">MINCOLOR</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="c1">#optional - default = Black</span>
  <span class="n">MAXCOLOR</span> <span class="mi">255</span> <span class="mi">255</span> <span class="mi">0</span> <span class="c1">#optional -default = White</span>
  <span class="n">MINVALUE</span> <span class="mf">0.0</span> <span class="c1">#optional - default = 0</span>
  <span class="n">MAXVALUE</span> <span class="mf">100.0</span> <span class="c1">#optional - default = 1</span>
  <span class="n">INTERVALS</span> <span class="mi">10</span> <span class="c1">#optional - default = 0 (unlimited)</span>
  <span class="n">METHOD</span> <span class="n">LINEAR</span> <span class="c1">#optional - default = &#39;LINEAR&#39;</span>
<span class="n">END</span>
</pre></div>
</div>
<p>I propose that this block lives at the CLASS level.  My reasons for
putting it at the CLASS, rather than the LAYER (or above) level are as
follows:</p>
<ol class="arabic simple">
<li><p>CLASS is the lowest level that can define a Legend entry (by using
a named class)</p></li>
<li><p>Allows multiple COLORANGES to be applied to a single layer
(i.e. Red-&gt;Yellow and Yellow-&gt;Green to make a contiguous
Reg-&gt;Yellow-&gt;Green).</p></li>
<li><p>Allows “out of bounds” values to be highlighted separately (with a
different CLASS).</p></li>
</ol>
<p>(If we wish to provide this capability on the OUTLINECOLOR, then I
would suggest we create a OUTLINECOLORRANGE block with identical format.)</p>
<p>Note: I am (and have always been) flexible on all of the keyword names
and formats here.  However, given the discussion that’s gone on around
(and around) this, I thought I’d put a straw man up and start here.</p>
</section>
<section id="proposed-legend-format">
<h2>Proposed Legend Format<a class="headerlink" href="#proposed-legend-format" title="Link to this heading">¶</a></h2>
<p>I have posted a mockup of how I believe legends should look at</p>
<p><a class="reference external" href="https://github.com/MapServer/MapServer/issues/324">https://github.com/MapServer/MapServer/issues/324</a></p>
<p>The format only changes the height of the legend (which is already
dynamic) so it should not have major layout implications.
(Nit-picking about how tall the colorbar should be can be worked out
during implementation.)</p>
<p>I have not started the legend support, and would like some help in
this area.  However, I do believe it is straightforward, and I will do
it on my own if there are no volunteers.</p>
</section>
<section id="mapscript-issues">
<h2>MapScript Issues<a class="headerlink" href="#mapscript-issues" title="Link to this heading">¶</a></h2>
<p>As Sean Gillies mentioned in the discussion, this should be
encapsulated in MapScript as a class.  While I disagree with his
putting it on the LAYER (see above), the rest of his suggestions all
seem right in line.</p>
<p>I Propose a class named ColorRamp with the following read/write attributes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Color</span> <span class="n">minColor</span>
<span class="n">Color</span> <span class="n">maxColor</span>
<span class="n">double</span> <span class="n">minValue</span>
<span class="n">double</span> <span class="n">maxValue</span>
<span class="n">String</span> <span class="n">rangeItem</span>
<span class="n">String</span> <span class="n">method</span>
<span class="nb">int</span> <span class="n">intervals</span>
</pre></div>
</div>
<p>and two methods</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Color</span> <span class="n">findColor</span><span class="p">(</span><span class="n">double</span> <span class="n">value</span><span class="p">)</span>
<span class="n">double</span> <span class="n">findValue</span><span class="p">(</span><span class="n">Color</span> <span class="n">color</span><span class="p">)</span>
</pre></div>
</div>
<p>ColorRamps can be obtained through an appropriate constructor or
through a new (read/write) attribute on the ClassObj object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ColorRange</span> <span class="n">colorRange</span>
</pre></div>
</div>
<p>Note: I will need help in adding these to MapScript as I do not have
the SWIG experience to do it well.</p>
</section>
<section id="files-affected">
<h2>Files affected<a class="headerlink" href="#files-affected" title="Link to this heading">¶</a></h2>
<p>I will update this list as the RFC evolves, but right now, these are
what I see:</p>
<ul class="simple">
<li><p>mapfile.h =&gt; Change Keywords</p></li>
<li><p>maplexer.l =&gt; Change Keywords</p></li>
<li><p>mapfile.c =&gt; process new Keywords</p></li>
<li><p>mapscript/swiginc/*.i =&gt; various interface modifications to fit the
above requirements</p></li>
<li><p>maplegend.c =&gt; Add new Legend support</p></li>
<li><p>mapdraw.c =&gt; update existing ColorRange code to use new keywords &amp;
add intervals and LOGARITHMIC method</p></li>
</ul>
</section>
<section id="backwards-compatibility-issues">
<h2>Backwards compatibility issues<a class="headerlink" href="#backwards-compatibility-issues" title="Link to this heading">¶</a></h2>
<p>Right now, certain code _requires_ that there is a COLOR attribute set
on any layer that is going to be displayed.  Either this will need to
be changed, or we will have to decide what that means if both a COLOR
and a COLORRANGE are defined.  One option is to use the COLOR for any
values that are outside of the range.</p>
</section>
<section id="multiple-mapping-methods">
<h2>Multiple Mapping Methods<a class="headerlink" href="#multiple-mapping-methods" title="Link to this heading">¶</a></h2>
<p>The system will allow new color mapping methods to be added with as little
effort as possible.  If a new color mapping method uses only the keywords
defined by this RFC, it should be a simple as:</p>
<ol class="arabic simple">
<li><p>Implement a function with the signature</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">mappingFn</span><span class="p">(</span><span class="n">colorRangeObj</span>\<span class="o">*</span> <span class="nb">range</span><span class="p">,</span> <span class="n">shapeObj</span>\<span class="o">*</span> <span class="n">shape</span><span class="p">,</span> <span class="n">colorObj</span> \<span class="o">*</span><span class="n">color</span><span class="p">)</span>

<span class="n">This</span> <span class="n">function</span> <span class="n">should</span> <span class="n">use</span> <span class="n">the</span> <span class="n">shape</span> <span class="ow">and</span> <span class="nb">range</span> <span class="n">parameters</span> <span class="n">to</span> <span class="n">determine</span> <span class="n">the</span>
<span class="n">shapes</span> <span class="n">color</span><span class="p">,</span> <span class="ow">and</span> <span class="n">modify</span> <span class="n">the</span> <span class="n">color</span> <span class="n">parameter</span> <span class="n">accordingly</span><span class="o">.</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Choose a unique method name (‘linear’, ‘logarithmic’, ‘discrete’)
modify the method msMapColorRamp() to call its method when its method name
is found on a ColorRange definition.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Whether the msMapColorRamp() method uses if/then logic or dispatches
by function pointer can be determined later.  For now, I believe the
simplest approach would be to move all of the mapping logic + all current
methods into a mapColorRange.c file.</p>
</div>
</section>
<section id="bug-id">
<h2>Bug ID<a class="headerlink" href="#bug-id" title="Link to this heading">¶</a></h2>
<p>Currently this is being tracked by <a class="reference external" href="https://github.com/MapServer/MapServer/issues/1305">https://github.com/MapServer/MapServer/issues/1305</a></p>
</section>
<section id="voting-history">
<h2>Voting history<a class="headerlink" href="#voting-history" title="Link to this heading">¶</a></h2>
<p>None</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p>
<a href="../../about.html" title="About">About</a><br>
<a href="../../products.html" title="Products">Products</a><br>
<a href="../../community/index.html" title="Community">Community</a><br>
<a href="../index.html" title="Development">Development</a><br>
<a href="../../download.html" title="Downloads">Downloads</a><br>
<a href="../../documentation.html" title="Documentation">Documentation</a><br>
<a href="../../faq.html" title="FAQ">FAQ</a><br>
<a href="../../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</h3>
  <ul>
<li><a class="reference internal" href="#">MS RFC 6: Color Range Mapping of Continuous Feature Values</a><ul>
<li><a class="reference internal" href="#background">Background</a></li>
<li><a class="reference internal" href="#current-syntax-problems">Current Syntax Problems</a></li>
<li><a class="reference internal" href="#proposed-new-syntax">Proposed New Syntax</a></li>
<li><a class="reference internal" href="#proposed-legend-format">Proposed Legend Format</a></li>
<li><a class="reference internal" href="#mapscript-issues">MapScript Issues</a></li>
<li><a class="reference internal" href="#files-affected">Files affected</a></li>
<li><a class="reference internal" href="#backwards-compatibility-issues">Backwards compatibility issues</a></li>
<li><a class="reference internal" href="#multiple-mapping-methods">Multiple Mapping Methods</a></li>
<li><a class="reference internal" href="#bug-id">Bug ID</a></li>
<li><a class="reference internal" href="#voting-history">Voting history</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ms-rfc-7.html" title="MS RFC 7: MapServer CVS Commit Management"
             >next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-5.html" title="MS RFC 5: MapServer Horizon Reprojection Improvements"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 6: Color Range Mapping of Continuous Feature Values</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; <a href="../../copyright.html">Copyright</a> 2023, Open Source Geospatial Foundation.
      Last updated on 2023-12-22.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.5.
    </div>
  </body>
</html>