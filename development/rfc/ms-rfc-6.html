<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>MS RFC 6: Color Range Mapping of Continuous Feature Values &mdash; MapServer 7.0.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '7.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="top" title="MapServer 7.0.0 documentation" href="../../index.html" />
    <link rel="up" title="Request for Comments" href="index.html" />
    <link rel="next" title="MS RFC 7: MapServer CVS Commit Management" href="ms-rfc-7.html" />
    <link rel="prev" title="MS RFC 5: MapServer Horizon Reprojection Improvements" href="ms-rfc-5.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../../index.html" title="Home"><img src="../../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../../index.html" title="Home">Home</a> |
      <a href="../../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../../faq.html" title="FAQ">FAQ</a> |
      <a href="../../download.html" title="Download">Download </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../../ar/development/rfc/ms-rfc-6.html"><img src="../../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../../de/development/rfc/ms-rfc-6.html"><img src="../../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../../el/development/rfc/ms-rfc-6.html"><img src="../../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../../es/development/rfc/ms-rfc-6.html"><img src="../../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../../fr/development/rfc/ms-rfc-6.html"><img src="../../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../../id/development/rfc/ms-rfc-6.html"><img src="../../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../../it/development/rfc/ms-rfc-6.html"><img src="../../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../../ja/development/rfc/ms-rfc-6.html"><img src="../../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../../nl_NL/development/rfc/ms-rfc-6.html"><img src="../../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../../pl/development/rfc/ms-rfc-6.html"><img src="../../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../../ru/development/rfc/ms-rfc-6.html"><img src="../../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../../sq/development/rfc/ms-rfc-6.html"><img src="../../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../../tr/development/rfc/ms-rfc-6.html"><img src="../../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        
        
          <a href="../../uk/development/rfc/ms-rfc-6.html"><img src="../../_static/flagicons/uk.png" alt="uk" title="uk" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ms-rfc-7.html" title="MS RFC 7: MapServer CVS Commit Management"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-5.html" title="MS RFC 5: MapServer Horizon Reprojection Improvements"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Request for Comments</a> &raquo;</li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="ms-rfc-6-color-range-mapping-of-continuous-feature-values">
<span id="rfc6"></span><h1>MS RFC 6: Color Range Mapping of Continuous Feature Values<a class="headerlink" href="#ms-rfc-6-color-range-mapping-of-continuous-feature-values" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Date:</th><td class="field-body">2005/09/27</td>
</tr>
<tr class="field-even field"><th class="field-name">Author:</th><td class="field-body">Bill Binko</td>
</tr>
<tr class="field-odd field"><th class="field-name">Contact:</th><td class="field-body">bill at binko.net</td>
</tr>
<tr class="field-even field"><th class="field-name">Status:</th><td class="field-body">Proposed</td>
</tr>
</tbody>
</table>
<p>Description: This proposal addresses the need to be able to easily
map continuous feature values to a continuous range of colors.  This RFC is
the result of (and my interpretation of) the discussion that
surrounded Bug #1305.</p>
<p>A preliminary patch has already been applied to MapServer  4.6+ (before
the RFC process was in place), however, there is little consensus on the
format being used and there is no support for proper display of
legends for classes using ColorRanges.</p>
<div class="section" id="background">
<h2>Background<a class="headerlink" href="#background" title="Permalink to this headline">¶</a></h2>
<p>This work started as a patch that I created to be able to quickly
visualize data with a large range of values.  In particular, I was
wishing to map property values, and various ratios that could take on
a large range of values.  To me, the natural way to do this was to set
a max value, a min value and what colors those mapped to.  The patch I
wrote had MapServer  do a linear interpolation of the value for each
feature on to that color range.</p>
<p>The initial syntax for this feature simply added 5 new keywords to the
STYLE block and looked as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>STYLE
  COLOR 60 60 60
  MINCOLOR 0 0 0
  MAXCOLOR 255 255 0
  MINVALUE 0.0
  MAXVALUE 300000.0
  GRADIENTITEM &quot;sale_price&quot;
END
</pre></div>
</div>
<p>After some discussion, the term Gradient was shown to be problematic.
Also, the number of new keywords seemed high.  After some discussion,
the syntax was changed to this format:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>STYLE
  COLORRANGE 0 0 0  255 255 0 # black to yellow
  DATARANGE 0.0 100.0
  RANGEITEM &quot;foobar&quot;
END
</pre></div>
</div>
<p>While this is still just a set of keywords under a Style, it seemed
simpler and is now working in the MapServer  4.6 branch.</p>
</div>
<div class="section" id="current-syntax-problems">
<h2>Current Syntax Problems<a class="headerlink" href="#current-syntax-problems" title="Permalink to this headline">¶</a></h2>
<p>Several people pointed out that the current syntax could be improved
by:</p>
<ol class="arabic simple">
<li>Moving the new keywords into a block</li>
<li>Adding a METHOD keyword with the type of interpolation used
(&#8216;linear&#8217; being the first defined type, &#8216;logarithmic&#8217; being a
potential second type, etc.</li>
<li>Adding an INTERVALS keyword that would limit the number of colors
actually used by rounding values before interopolation.</li>
<li>Moving all of the keywords out of the Style block.</li>
<li>Allowing the ColorRange to be defined separately so that it can be reused</li>
</ol>
</div>
<div class="section" id="proposed-new-syntax">
<h2>Proposed New Syntax<a class="headerlink" href="#proposed-new-syntax" title="Permalink to this headline">¶</a></h2>
<p>To meet the above needs, I propose the following new Block Syntax:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>COLORRANGE
  RANGEITEM &#39;itemname&#39; #required
  MINCOLOR 0 0 0 #optional - default = Black
  MAXCOLOR 255 255 0 #optional -default = White
  MINVALUE 0.0 #optional - default = 0
  MAXVALUE 100.0 #optional - default = 1
  INTERVALS 10 #optional - default = 0 (unlimited)
  METHOD LINEAR #optional - default = &#39;LINEAR&#39;
END
</pre></div>
</div>
<p>I propose that this block lives at the CLASS level.  My reasons for
putting it at the CLASS, rather than the LAYER (or above) level are as
follows:</p>
<ol class="arabic simple">
<li>CLASS is the lowest level that can define a Legend entry (by using
a named class)</li>
<li>Allows multiple COLORANGES to be applied to a single layer
(i.e. Red-&gt;Yellow and Yellow-&gt;Green to make a contiguous
Reg-&gt;Yellow-&gt;Green).</li>
<li>Allows &#8220;out of bounds&#8221; values to be highlighted separately (with a
different CLASS).</li>
</ol>
<p>(If we wish to provide this capability on the OUTLINECOLOR, then I
would suggest we create a OUTLINECOLORRANGE block with identical format.)</p>
<p>Note: I am (and have always been) flexible on all of the keyword names
and formats here.  However, given the discussion that&#8217;s gone on around
(and around) this, I thought I&#8217;d put a straw man up and start here.</p>
</div>
<div class="section" id="proposed-legend-format">
<h2>Proposed Legend Format<a class="headerlink" href="#proposed-legend-format" title="Permalink to this headline">¶</a></h2>
<p>I have posted a mockup of how I believe legends should look at</p>
<p><a class="reference external" href="https://github.com/mapserver/mapserver/issues/324">https://github.com/mapserver/mapserver/issues/324</a></p>
<p>The format only changes the height of the legend (which is already
dynamic) so it should not have major layout implications.
(Nit-picking about how tall the colorbar should be can be worked out
during implementation.)</p>
<p>I have not started the legend support, and would like some help in
this area.  However, I do believe it is straightforward, and I will do
it on my own if there are no volunteers.</p>
</div>
<div class="section" id="mapscript-issues">
<h2>MapScript Issues<a class="headerlink" href="#mapscript-issues" title="Permalink to this headline">¶</a></h2>
<p>As Sean Gillies mentioned in the discussion, this should be
encapsulated in MapScript as a class.  While I disagree with his
putting it on the LAYER (see above), the rest of his suggestions all
seem right in line.</p>
<p>I Propose a class named ColorRamp with the following read/write attributes:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Color minColor
Color maxColor
double minValue
double maxValue
String rangeItem
String method
int intervals
</pre></div>
</div>
<p>and two methods</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Color findColor(double value)
double findValue(Color color)
</pre></div>
</div>
<p>ColorRamps can be obtained through an appropriate constructor or
through a new (read/write) attribute on the ClassObj object:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ColorRange colorRange
</pre></div>
</div>
<p>Note: I will need help in adding these to MapScript as I do not have
the SWIG experience to do it well.</p>
</div>
<div class="section" id="files-affected">
<h2>Files affected<a class="headerlink" href="#files-affected" title="Permalink to this headline">¶</a></h2>
<p>I will update this list as the RFC evolves, but right now, these are
what I see:</p>
<ul class="simple">
<li>mapfile.h =&gt; Change Keywords</li>
<li>maplexer.l =&gt; Change Keywords</li>
<li>mapfile.c =&gt; process new Keywords</li>
<li>mapscript/swiginc/*.i =&gt; various interface modifications to fit the
above requirements</li>
<li>maplegend.c =&gt; Add new Legend support</li>
<li>mapdraw.c =&gt; update existing ColorRange code to use new keywords &amp;
add intervals and LOGARITHMIC method</li>
</ul>
</div>
<div class="section" id="backwards-compatibility-issues">
<h2>Backwards compatibility issues<a class="headerlink" href="#backwards-compatibility-issues" title="Permalink to this headline">¶</a></h2>
<p>Right now, certain code _requires_ that there is a COLOR attribute set
on any layer that is going to be displayed.  Either this will need to
be changed, or we will have to decide what that means if both a COLOR
and a COLORRANGE are defined.  One option is to use the COLOR for any
values that are outside of the range.</p>
</div>
<div class="section" id="multiple-mapping-methods">
<h2>Multiple Mapping Methods<a class="headerlink" href="#multiple-mapping-methods" title="Permalink to this headline">¶</a></h2>
<p>The system will allow new color mapping methods to be added with as little
effort as possible.  If a new color mapping method uses only the keywords
defined by this RFC, it should be a simple as:</p>
<ol class="arabic simple">
<li>Implement a function with the signature</li>
</ol>
<div class="highlight-python"><div class="highlight"><pre><span></span>int mappingFn(colorRangeObj\* range, shapeObj\* shape, colorObj \*color)

This function should use the shape and range parameters to determine the
shapes color, and modify the color parameter accordingly.
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>Choose a unique method name (&#8216;linear&#8217;, &#8216;logarithmic&#8217;, &#8216;discrete&#8217;)
modify the method msMapColorRamp() to call its method when its method name
is found on a ColorRange definition.</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Whether the msMapColorRamp() method uses if/then logic or dispatches
by function pointer can be determined later.  For now, I believe the
simplest approach would be to move all of the mapping logic + all current
methods into a mapColorRange.c file.</p>
</div>
</div>
<div class="section" id="bug-id">
<h2>Bug ID<a class="headerlink" href="#bug-id" title="Permalink to this headline">¶</a></h2>
<p>Currently this is being tracked by <a class="reference external" href="https://github.com/mapserver/mapserver/issues/1305">https://github.com/mapserver/mapserver/issues/1305</a></p>
</div>
<div class="section" id="voting-history">
<h2>Voting history<a class="headerlink" href="#voting-history" title="Permalink to this headline">¶</a></h2>
<p>None</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Navigation</h3>
<p>
<a href="../../about.html" title="About">About</a><br>
<a href="../../products.html" title="Products">Products</a><br>
<a href="../../community/index.html" title="Community">Community</a><br>
<a href="../index.html" title="Development">Development</a><br>
<a href="../../download.html" title="Downloads">Downloads</a><br>
<a href="../../documentation.html" title="Documentation">Documentation</a><br>
<a href="../../faq.html" title="FAQ">FAQ</a>
</p>
  <h3>Current Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">MS RFC 6: Color Range Mapping of Continuous Feature Values</a><ul>
<li><a class="reference internal" href="#background">Background</a></li>
<li><a class="reference internal" href="#current-syntax-problems">Current Syntax Problems</a></li>
<li><a class="reference internal" href="#proposed-new-syntax">Proposed New Syntax</a></li>
<li><a class="reference internal" href="#proposed-legend-format">Proposed Legend Format</a></li>
<li><a class="reference internal" href="#mapscript-issues">MapScript Issues</a></li>
<li><a class="reference internal" href="#files-affected">Files affected</a></li>
<li><a class="reference internal" href="#backwards-compatibility-issues">Backwards compatibility issues</a></li>
<li><a class="reference internal" href="#multiple-mapping-methods">Multiple Mapping Methods</a></li>
<li><a class="reference internal" href="#bug-id">Bug ID</a></li>
<li><a class="reference internal" href="#voting-history">Voting history</a></li>
</ul>
</li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Open Source Geospatial Foundation.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.4</a>
      
    </div>

    

    
  </body>
</html>