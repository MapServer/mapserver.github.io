<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>MS RFC 87: Bitmap pattern support &#8212; MapServer 8.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx.css?v=6c7b17ac" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=dd298242" />
    <link rel="stylesheet" type="text/css" href="../../_static/ribbon.css?v=ea091bf4" />
    
    <script src="../../_static/documentation_options.js?v=521b6f53"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="icon" href="../../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="MS RFC 88: Saving MapServer Objects to Strings" href="ms-rfc-88.html" />
    <link rel="prev" title="MS RFC 86: Scale-dependant String Substitutions" href="ms-rfc-86.html" /> 
  </head><body>


<!-- for main branch only, do not backport this -->

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../../index.html" title="Home"><img src="../../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../../index.html" title="Home">Home</a> |
      <a href="../../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter" target="_blank">Twitter</a> |
      <a href="../../download.html" title="Download Source or Binaries">Download </a> |
      <a class="badge" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=KRJ2X44N3HA6U&source=url" target="_blank">
        <img src="https://img.shields.io/badge/donate-%E2%9D%A4%C2%A0-ff69b4.svg?style=flat" alt="Donate to MapServer">
      </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../../ar/development/rfc/ms-rfc-87.html"><img src="../../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../../de/development/rfc/ms-rfc-87.html"><img src="../../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../../el/development/rfc/ms-rfc-87.html"><img src="../../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../../es/development/rfc/ms-rfc-87.html"><img src="../../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../../fr/development/rfc/ms-rfc-87.html"><img src="../../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../../id/development/rfc/ms-rfc-87.html"><img src="../../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../../it/development/rfc/ms-rfc-87.html"><img src="../../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../../ja/development/rfc/ms-rfc-87.html"><img src="../../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../../nl_NL/development/rfc/ms-rfc-87.html"><img src="../../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../../pl/development/rfc/ms-rfc-87.html"><img src="../../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../../ru/development/rfc/ms-rfc-87.html"><img src="../../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../../sq/development/rfc/ms-rfc-87.html"><img src="../../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../../tr/development/rfc/ms-rfc-87.html"><img src="../../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ms-rfc-88.html" title="MS RFC 88: Saving MapServer Objects to Strings"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-86.html" title="MS RFC 86: Scale-dependant String Substitutions"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 87: Bitmap pattern support</a></li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="ms-rfc-87-bitmap-pattern-support">
<span id="rfc87"></span><h1>MS RFC 87: Bitmap pattern support<a class="headerlink" href="#ms-rfc-87-bitmap-pattern-support" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Date<span class="colon">:</span></dt>
<dd class="field-odd"><p>2013/01/14</p>
</dd>
<dt class="field-even">Author<span class="colon">:</span></dt>
<dd class="field-even"><p>Tamas Szekeres</p>
</dd>
<dt class="field-odd">Contact<span class="colon">:</span></dt>
<dd class="field-odd"><p>szekerest at gmail.com</p>
</dd>
<dt class="field-even">Status<span class="colon">:</span></dt>
<dd class="field-even"><p>Draft</p>
</dd>
<dt class="field-odd">Version<span class="colon">:</span></dt>
<dd class="field-odd"><p>TBD</p>
</dd>
</dl>
<section id="overview">
<h2>1. Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p>With this addition we could easily define brush patterns which are aware
of color and backgroundcolor settings and rendered equally well with the
various kind of renderers. Currently we have no such option to achieve the
same result, by using vector symbols we can not provide the same look for
most of the renderers (agg, cairo), due to the possible antialiasing
behaviour of the line drawings.</p>
<p>Bitmap patterns would be defined as symbols of type PATTERNMAP according to
the example below:</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">SYMBOL</span>
  <span class="k">NAME</span> <span class="s">&quot;mapinfo-brush-54&quot;</span>
  <span class="k">TYPE</span> <span class="err">PATTERN</span><span class="k">MAP</span>
  <span class="k">IMAGE</span> <span class="s">&quot;|10000010|01000100|00111001|01000100|10000010|00000001|00000001|00000001&quot;</span>
<span class="k">END</span>
</pre></div>
</div>
<p>This symbol will provide the following brush fill:</p>
<blockquote>
<div><img alt="../../_images/mapinfo-brush-54-fill.png" src="../../_images/mapinfo-brush-54-fill.png" />
</div></blockquote>
<p>Bitmap patterns can be defined with any size according to length of the rows
specified in the IMAGE section.</p>
<p>Bitmap patterns are non scalable, cannot be rotated, and the gap is always
set to zero. The patterns are aware of COLOR and BACKGROUNDCOLOR defined in
the STYLE section.</p>
</section>
<section id="proposed-solution">
<h2>2. Proposed Solution<a class="headerlink" href="#proposed-solution" title="Link to this heading">¶</a></h2>
<p>We will define a new symbol type PATTERNMAP, maplexer.l will be modified to be aware
of this new keyword. The new symbol type would be rendered in the same way a the
PIXMAP symbols. The mos significant difference is that the tile image is created on
the fly instead of loading the image from file.</p>
</section>
<section id="implementation-details">
<h2>3. Implementation Details<a class="headerlink" href="#implementation-details" title="Link to this heading">¶</a></h2>
<p>In mapsymbol.c msPreloadImageSymbol will be modified to initialize the raster
buffer with the proper size according to the bitmap specified in the IMAGE section.
In maprendering.c getTile will be modified to render the image:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">case</span> <span class="p">(</span><span class="n">MS_SYMBOL_PATTERNMAP</span><span class="p">):</span>
      <span class="k">if</span><span class="p">(</span><span class="n">msPreloadImageSymbol</span><span class="p">(</span><span class="n">renderer</span><span class="p">,</span><span class="n">symbol</span><span class="p">)</span> <span class="o">!=</span> <span class="n">MS_SUCCESS</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">NULL</span><span class="p">;</span> <span class="o">/*</span> <span class="n">failed</span> <span class="n">to</span> <span class="n">load</span> <span class="n">image</span><span class="p">,</span> <span class="n">renderer</span> <span class="n">should</span> <span class="n">have</span> <span class="nb">set</span> <span class="n">the</span> <span class="n">error</span> <span class="n">message</span> <span class="o">*/</span>
      <span class="p">}</span>
      <span class="n">msCreateBitmapSymbol</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>
      <span class="n">renderer</span><span class="o">-&gt;</span><span class="n">renderPixmapSymbol</span><span class="p">(</span><span class="n">tileimg</span><span class="p">,</span> <span class="n">p_x</span><span class="p">,</span> <span class="n">p_y</span><span class="p">,</span> <span class="n">symbol</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
</pre></div>
</div>
<p>The new function msCreateBitmapSymbol will process the IMAGE section in the
symbol definition and set the pixels according to the STYLE colors.</p>
<p>computeSymbolStyle (in maprendering.c) will be modified to set up colors
scale gap and rotation parameters before the rendering is taking place.</p>
</section>
<section id="files-affected">
<h2>4. Files Affected<a class="headerlink" href="#files-affected" title="Link to this heading">¶</a></h2>
<blockquote>
<div><ul class="simple">
<li><p>maplexer.l, maplexer.l: Add PATTERNMAP keyword</p></li>
<li><p>mapsymbol.h: Add MS_SYMBOL_PATTERNMAP enum value</p></li>
<li><p>mapsymbol.c: Modify the parser, writer and msPreloadImageSymbol</p></li>
<li><p>maprendering.c: Add msCreateBitmapSymbol, modify computeSymbolStyle, getTile etc.</p></li>
<li><p>mapdraw.c: Modify msDrawVectorLayer, msDrawShape to be aware of MS_SYMBOL_PATTERNMAP</p></li>
</ul>
</div></blockquote>
</section>
<section id="bug-id">
<h2>5. Bug ID<a class="headerlink" href="#bug-id" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/MapServer/MapServer/issues/4561">https://github.com/MapServer/MapServer/issues/4561</a></p></li>
</ul>
<p>Contains link for the sample implementation.</p>
</section>
<section id="backwards-compatibility-issues">
<h2>6. Backwards compatibility issues<a class="headerlink" href="#backwards-compatibility-issues" title="Link to this heading">¶</a></h2>
<p>None expected, new functionality.</p>
</section>
<section id="mapscript-changes">
<h2>7. MapScript changes<a class="headerlink" href="#mapscript-changes" title="Link to this heading">¶</a></h2>
<p>MS_SYMBOL_PATTERNMAP will be exposed as a new symbol type.</p>
</section>
<section id="voting-history">
<h2>8. Voting history<a class="headerlink" href="#voting-history" title="Link to this heading">¶</a></h2>
<p>TBD.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p>
<a href="../../about.html" title="About">About</a><br>
<a href="../../products.html" title="Products">Products</a><br>
<a href="../../community/index.html" title="Community">Community</a><br>
<a href="../index.html" title="Development">Development</a><br>
<a href="../../download.html" title="Downloads">Downloads</a><br>
<a href="../../documentation.html" title="Documentation">Documentation</a><br>
<a href="../../faq.html" title="FAQ">FAQ</a><br>
<a href="../../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</h3>
  <ul>
<li><a class="reference internal" href="#">MS RFC 87: Bitmap pattern support</a><ul>
<li><a class="reference internal" href="#overview">1. Overview</a></li>
<li><a class="reference internal" href="#proposed-solution">2. Proposed Solution</a></li>
<li><a class="reference internal" href="#implementation-details">3. Implementation Details</a></li>
<li><a class="reference internal" href="#files-affected">4. Files Affected</a></li>
<li><a class="reference internal" href="#bug-id">5. Bug ID</a></li>
<li><a class="reference internal" href="#backwards-compatibility-issues">6. Backwards compatibility issues</a></li>
<li><a class="reference internal" href="#mapscript-changes">7. MapScript changes</a></li>
<li><a class="reference internal" href="#voting-history">8. Voting history</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ms-rfc-88.html" title="MS RFC 88: Saving MapServer Objects to Strings"
             >next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-86.html" title="MS RFC 86: Scale-dependant String Substitutions"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 87: Bitmap pattern support</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; <a href="../../copyright.html">Copyright</a> 2023, Open Source Geospatial Foundation.
      Last updated on 2023-12-22.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.5.
    </div>
  </body>
</html>