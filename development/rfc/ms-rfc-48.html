<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>MS RFC 48: GEOTRANSFORM Geometry operations &#8212; MapServer 8.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx.css?v=6c7b17ac" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=dd298242" />
    <link rel="stylesheet" type="text/css" href="../../_static/ribbon.css?v=ea091bf4" />
    
    <script src="../../_static/documentation_options.js?v=521b6f53"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="icon" href="../../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="MS RFC 49: Symbology, Labeling, and Cartography Improvements" href="ms-rfc-49.html" />
    <link rel="prev" title="MS RFC 47: Move IGNORE_MISSING_DATA to run-time configuration" href="ms-rfc-47.html" /> 
  </head><body>


<!-- for main branch only, do not backport this -->

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../../index.html" title="Home"><img src="../../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../../index.html" title="Home">Home</a> |
      <a href="../../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter" target="_blank">Twitter</a> |
      <a href="../../download.html" title="Download Source or Binaries">Download </a> |
      <a class="badge" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=KRJ2X44N3HA6U&source=url" target="_blank">
        <img src="https://img.shields.io/badge/donate-%E2%9D%A4%C2%A0-ff69b4.svg?style=flat" alt="Donate to MapServer">
      </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../../ar/development/rfc/ms-rfc-48.html"><img src="../../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../../de/development/rfc/ms-rfc-48.html"><img src="../../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../../el/development/rfc/ms-rfc-48.html"><img src="../../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../../es/development/rfc/ms-rfc-48.html"><img src="../../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../../fr/development/rfc/ms-rfc-48.html"><img src="../../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../../id/development/rfc/ms-rfc-48.html"><img src="../../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../../it/development/rfc/ms-rfc-48.html"><img src="../../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../../ja/development/rfc/ms-rfc-48.html"><img src="../../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../../nl_NL/development/rfc/ms-rfc-48.html"><img src="../../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../../pl/development/rfc/ms-rfc-48.html"><img src="../../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../../ru/development/rfc/ms-rfc-48.html"><img src="../../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../../sq/development/rfc/ms-rfc-48.html"><img src="../../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../../tr/development/rfc/ms-rfc-48.html"><img src="../../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ms-rfc-49.html" title="MS RFC 49: Symbology, Labeling, and Cartography Improvements"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-47.html" title="MS RFC 47: Move IGNORE_MISSING_DATA to run-time configuration"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 48: GEOTRANSFORM Geometry operations</a></li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="ms-rfc-48-geotransform-geometry-operations">
<span id="rfc48"></span><h1>MS RFC 48: GEOTRANSFORM Geometry operations<a class="headerlink" href="#ms-rfc-48-geotransform-geometry-operations" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Date<span class="colon">:</span></dt>
<dd class="field-odd"><p>2008/11/01</p>
</dd>
<dt class="field-even">Authors<span class="colon">:</span></dt>
<dd class="field-even"><p>Thomas Bonfort, Stephen Lime,</p>
</dd>
<dt class="field-odd">Contact<span class="colon">:</span></dt>
<dd class="field-odd"><p>thomas.bonfort at camptocamp.com, Steve.Lime at DNR.State.MN.US</p>
</dd>
<dt class="field-even">Status<span class="colon">:</span></dt>
<dd class="field-even"><p>Implemented (2009/02)</p>
</dd>
<dt class="field-odd">Last Edited<span class="colon">:</span></dt>
<dd class="field-odd"><p>2009/02</p>
</dd>
<dt class="field-even">Version<span class="colon">:</span></dt>
<dd class="field-even"><p>MapServer 5.4</p>
</dd>
</dl>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Link to this heading">¶</a></h2>
<p>The purpose of this RFC is to add the ability to MapServer  to interpret the
geometries based on a user-defined GEOMETRYTRANSFORM keyword, and to render
the interpreted geometry with the selected styling</p>
<p>An example usage would be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">GEOMETRYTRANSFORM</span> <span class="s2">&quot;start([geom])&quot;</span>
</pre></div>
</div>
<p>to treat the underlying geometry as a point rendered on the first vertex
current feature.</p>
<p>The directive to activate this behavior is the GEOMETRYTRANSFORM keyword, that
initially belongs to the STYLE object. Further developments could be to enable
the keyword at the LAYER level.</p>
<p>Usages of this parameter include drawing bounding boxes of underlying
geometries, or adding arrowheads/tails to lines.</p>
<p>Further developments would allow complex expressions to be passed to the
keyword, allowing nested transformations to the underlying geometry, eg:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">GEOMETRYTRANSFORM</span> <span class="s2">&quot;difference([geom],buffer([geom],10))&quot;</span>
</pre></div>
</div>
<p>and binding to attributes, eg:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">GEOMETRYTRANSFORM</span> <span class="s2">&quot;buffer([geom],[distance])&quot;</span>
</pre></div>
</div>
</section>
<section id="detailed-functionality">
<h2>Detailed functionality<a class="headerlink" href="#detailed-functionality" title="Link to this heading">¶</a></h2>
<p>The GEOMETRYTRANSFORM keyword initially accepts a shortcut version of
these parameters :</p>
<ul class="simple">
<li><p><em>bbox</em> : render a shapeObj representing the bounding box of the
underlying geometry.</p></li>
<li><p><em>start/end</em> : render a point symbol at the first/last vertex of the
underlying geometry. By default, the symbol is oriented to match the
orientation of the corresponding geometry segment. This would be used
to add arrowheads/tails to linestrings.</p></li>
<li><p><em>vertices</em> : render a point symbol at each vertex of the geometry.
The default orientation matches the half angle of the corresponding segments.
The start and end vertices are not included in the transformation.</p></li>
</ul>
<p>These transforms are not initially implemented, but could be supported in the future:</p>
<ul class="simple">
<li><p><em>buffer([geom],distance)</em> : render a shapeObj representing the buffered geometry.
“distance” specifies the buffer distance, in layer units.</p></li>
<li><p><em>centroid([geom])</em> : render a pointObj at the location of the centroid of the
geometry</p></li>
<li><p><em>labelpoint([geom])</em> : render a pointObj at the location of the at the point
where the geometry will/would be labelled.</p></li>
<li><p><em>convexhull([geom])</em></p></li>
<li><p><em>simplify([geom])</em></p></li>
</ul>
</section>
<section id="implementation-details">
<h2>Implementation Details<a class="headerlink" href="#implementation-details" title="Link to this heading">¶</a></h2>
<p>Apart from the parsing and internal storage of which type should be used,
the modifications of this RFC only affect the high-level rendering functions
in mapdraw.c .</p>
<p>There are three main modifications:</p>
<ul class="simple">
<li><p>AUTO is added to the ANGLE parser for the STYLE block. styleObj has an autoangle
member added accordingly.</p></li>
<li><p>inside msDrawVectorLayer, a copy of the shape before being clipped by the
current extent must be kept, as the whole shape must be used for all but
the VERTICES type. Then, when looping through the different styles that
can be applied, we switch off to the type-specific function if a GEOMETRYTRANSFORM
keyword is set.</p></li>
<li><p>inside mapgeomtransform.c, the type-specific drawing function is added. Depending
on the current style type, it either computes a new shape from the
original shape (types bbox, convexhull or buffer) and passes it to the
msDrawShadeSymbol, or calls msDrawMarkerSymbol for points of the original
shape (types start, end, vertices, centroid) after having adjusted the
orientation accordingly.</p></li>
</ul>
</section>
<section id="affected-files">
<h2>Affected Files<a class="headerlink" href="#affected-files" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>mapdraw.c</p></li>
<li><p>maplexer.c/.l</p></li>
<li><p>mapfile.c</p></li>
<li><p>mapserver.h</p></li>
<li><p>mapgeometrytransform.c is added, for the parsing of the transform expression,
the transformation itself, and the calling of msDrawMarkerSymbol /
msDrawShadeSymbol functions</p></li>
</ul>
</section>
<section id="limitations">
<h2>Limitations<a class="headerlink" href="#limitations" title="Link to this heading">¶</a></h2>
<p>For line layers, the transformations do not fit in with the current cache
mechanism that draws the first style of each class in a first pass for all
shapes, and the remaining styles in a second pass.</p>
</section>
<section id="mapscript-implications">
<h2>MapScript implications<a class="headerlink" href="#mapscript-implications" title="Link to this heading">¶</a></h2>
<p>Getters and setters will have to be added to the different mapscripts.</p>
<p>A possible enhancement could also be to expose the transformation function to
MapScript.</p>
</section>
<section id="documentation">
<h2>Documentation<a class="headerlink" href="#documentation" title="Link to this heading">¶</a></h2>
<p>completed</p>
</section>
<section id="backwards-incompatibility-issues">
<h2>Backwards Incompatibility Issues<a class="headerlink" href="#backwards-incompatibility-issues" title="Link to this heading">¶</a></h2>
<p>none expected.</p>
</section>
<section id="bug-id">
<h2>Bug ID<a class="headerlink" href="#bug-id" title="Link to this heading">¶</a></h2>
<p><a class="reference external" href="https://github.com/MapServer/MapServer/issues/2825">https://github.com/MapServer/MapServer/issues/2825</a></p>
</section>
<section id="voting-history">
<h2>Voting History<a class="headerlink" href="#voting-history" title="Link to this heading">¶</a></h2>
<p>Vote completed on 2008/12/08:</p>
<ul class="simple">
<li><p>+1: Lime, Szekeres, Woodbridge, Nacionales, Morissette</p></li>
<li><p>+0: Nicoletti</p></li>
</ul>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p>
<a href="../../about.html" title="About">About</a><br>
<a href="../../products.html" title="Products">Products</a><br>
<a href="../../community/index.html" title="Community">Community</a><br>
<a href="../index.html" title="Development">Development</a><br>
<a href="../../download.html" title="Downloads">Downloads</a><br>
<a href="../../documentation.html" title="Documentation">Documentation</a><br>
<a href="../../faq.html" title="FAQ">FAQ</a><br>
<a href="../../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</h3>
  <ul>
<li><a class="reference internal" href="#">MS RFC 48: GEOTRANSFORM Geometry operations</a><ul>
<li><a class="reference internal" href="#summary">Summary</a></li>
<li><a class="reference internal" href="#detailed-functionality">Detailed functionality</a></li>
<li><a class="reference internal" href="#implementation-details">Implementation Details</a></li>
<li><a class="reference internal" href="#affected-files">Affected Files</a></li>
<li><a class="reference internal" href="#limitations">Limitations</a></li>
<li><a class="reference internal" href="#mapscript-implications">MapScript implications</a></li>
<li><a class="reference internal" href="#documentation">Documentation</a></li>
<li><a class="reference internal" href="#backwards-incompatibility-issues">Backwards Incompatibility Issues</a></li>
<li><a class="reference internal" href="#bug-id">Bug ID</a></li>
<li><a class="reference internal" href="#voting-history">Voting History</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ms-rfc-49.html" title="MS RFC 49: Symbology, Labeling, and Cartography Improvements"
             >next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-47.html" title="MS RFC 47: Move IGNORE_MISSING_DATA to run-time configuration"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 48: GEOTRANSFORM Geometry operations</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; <a href="../../copyright.html">Copyright</a> 2023, Open Source Geospatial Foundation.
      Last updated on 2023-12-22.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.5.
    </div>
  </body>
</html>