<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>MS RFC 105: Support for WFS 2.0 (server side) &#8212; MapServer 8.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx.css?v=6c7b17ac" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=dd298242" />
    <link rel="stylesheet" type="text/css" href="../../_static/ribbon.css?v=ea091bf4" />
    
    <script src="../../_static/documentation_options.js?v=521b6f53"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="icon" href="../../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="MS RFC 106: Support of Geomtransform JavaScript Plugin" href="ms-rfc-106.html" />
    <link rel="prev" title="MS RFC 104: Replace BITMAP labels with embedded Truetype font" href="ms-rfc-104.html" /> 
  </head><body>


<!-- for main branch only, do not backport this -->

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../../index.html" title="Home"><img src="../../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../../index.html" title="Home">Home</a> |
      <a href="../../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter" target="_blank">Twitter</a> |
      <a href="../../download.html" title="Download Source or Binaries">Download </a> |
      <a class="badge" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=KRJ2X44N3HA6U&source=url" target="_blank">
        <img src="https://img.shields.io/badge/donate-%E2%9D%A4%C2%A0-ff69b4.svg?style=flat" alt="Donate to MapServer">
      </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../../ar/development/rfc/ms-rfc-105.html"><img src="../../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../../de/development/rfc/ms-rfc-105.html"><img src="../../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../../el/development/rfc/ms-rfc-105.html"><img src="../../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../../es/development/rfc/ms-rfc-105.html"><img src="../../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../../fr/development/rfc/ms-rfc-105.html"><img src="../../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../../id/development/rfc/ms-rfc-105.html"><img src="../../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../../it/development/rfc/ms-rfc-105.html"><img src="../../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../../ja/development/rfc/ms-rfc-105.html"><img src="../../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../../nl_NL/development/rfc/ms-rfc-105.html"><img src="../../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../../pl/development/rfc/ms-rfc-105.html"><img src="../../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../../ru/development/rfc/ms-rfc-105.html"><img src="../../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../../sq/development/rfc/ms-rfc-105.html"><img src="../../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../../tr/development/rfc/ms-rfc-105.html"><img src="../../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ms-rfc-106.html" title="MS RFC 106: Support of Geomtransform JavaScript Plugin"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-104.html" title="MS RFC 104: Replace BITMAP labels with embedded Truetype font"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 105: Support for WFS 2.0 (server side)</a></li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="ms-rfc-105-support-for-wfs-2-0-server-side">
<span id="rfc105"></span><h1>MS RFC 105: Support for WFS 2.0 (server side)<a class="headerlink" href="#ms-rfc-105-support-for-wfs-2-0-server-side" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Date<span class="colon">:</span></dt>
<dd class="field-odd"><p>2013/11</p>
</dd>
<dt class="field-even">Author<span class="colon">:</span></dt>
<dd class="field-even"><p>Even Rouault</p>
</dd>
<dt class="field-odd">Contact<span class="colon">:</span></dt>
<dd class="field-odd"><p>even dot rouault at mines-paris dot org</p>
</dd>
<dt class="field-even">Status<span class="colon">:</span></dt>
<dd class="field-even"><p>Draft</p>
</dd>
<dt class="field-odd">Version<span class="colon">:</span></dt>
<dd class="field-odd"><p>MapServer 7.0</p>
</dd>
</dl>
<section id="overview">
<h2>1. Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p>MapServer currently supports the OGC WFS 1.0.0 and 1.1.0 protocols. The latest
published version of <a class="reference external" href="https://portal.ogc.org/files/?artifact_id=39967">WFS 2.0</a>, and it is desirable that MapServer implements
it. Particularly in the context of the European Inspire directive that
mandates WFS 2.0 as the base protocol for the INSPIRE Download Services.</p>
</section>
<section id="changes">
<h2>2. Changes<a class="headerlink" href="#changes" title="Link to this heading">¶</a></h2>
</section>
<section id="summary-of-changes-in-wfs-2-0">
<h2>Summary of changes in WFS 2.0<a class="headerlink" href="#summary-of-changes-in-wfs-2-0" title="Link to this heading">¶</a></h2>
<p>There’s apparently no official diff between WFS 1.1 and WFS 2.0, so here’s
a summary :</p>
<ul class="simple">
<li><p><a class="reference external" href="https://portal.ogc.org/files/?artifact_id=20509">GML 3.2.1</a></p></li>
<li><p><a class="reference external" href="https://portal.ogc.org/files/?artifact_id=39968">Filter Encoding 2.0</a></p></li>
<li><p>Paging support</p></li>
<li><p>GetCapabilities changes</p></li>
<li><p>GetFeature changes</p></li>
<li><p>new operations that we will implement :</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>GetPropertyValue</p></li>
<li><p>ListStoredQueries</p></li>
<li><p>DescribeStoredQueries</p></li>
<li><p>GetFeature with stored queries</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><p>new operations not covered by this work :</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>CreateStoredQuery</p></li>
<li><p>DropStoredQuery</p></li>
</ul>
</div></blockquote>
</section>
<section id="getcapabilities-changes">
<h2>GetCapabilities changes<a class="headerlink" href="#getcapabilities-changes" title="Link to this heading">¶</a></h2>
<p>There are a few changes and additions in the response document of a GetCapabilities
request w.r.t WFS 1.1 :</p>
<ul class="simple">
<li><p>the &lt;ows:OperationsMetadata&gt; element can have child elements that advertize
which conformance classes of the specification are supported by the implementation.
In the case of MapServer, we report as supported : ImplementsBasicWFS,
KVPEncoding, XMLEncoding, ImplementsResultPaging. We also publish the
server side limit on feature count in “CountDefault”.</p></li>
<li><p>the Filter_Capabilities respects the syntax of <a class="reference external" href="https://portal.ogc.org/files/?artifact_id=39968">Filter Encoding 2.0</a> capabilities.
It has a &lt;fes:Conformance&gt; element that advertizes which parts of FE 2.0
are supported by the implementation. In the case of MapServer, we report as
supported : ImplementsQuery, ImplementsAdHocQuery, ImplementsResourceId,
ImplementsMinStandardFilter, ImplementsStandardFilter, ImplementsMinSpatialFilter,
ImplementsMinTemporalFilter and ImplementsMinimumXPath</p></li>
</ul>
<p>We also now support the SECTIONS parameter of the GetCapabilities that enable
the user to request only parts of the GetCapabilities document. The value of
this parameter is a (comma separated) list of values among : All,ServiceIdentification,
ServiceProvider,OperationsMetadata,FeatureTypeList,Filter_Capabilities</p>
<p>Discovered during CITE testing, we now always add the namespace prefix in the
&lt;Name&gt; element of a feature type (could/should also probably be done for WFS 1.1.0).
If no user namespace is specified, the default “ms:” prefix is used.</p>
<p>An example of a GetCapabilities response can be found at
<a class="reference external" href="https://github.com/MapServer/msautotest/blob/wfs2/wxs/expected/wfs_200_caps.xml">https://github.com/MapServer/msautotest/blob/wfs2/wxs/expected/wfs_200_caps.xml</a></p>
</section>
<section id="gml-3-2-1">
<h2>GML 3.2.1<a class="headerlink" href="#gml-3-2-1" title="Link to this heading">¶</a></h2>
<p>GML 3.2.1 defines a mandatory gml:id attribute on each geometry element :
as Point, LineString, Polygon, MultiPoint, MultiLineString, MultiPolygon.
The id will be generated as “feature_gml_id.serial_number” where
feature_gml_id is the gml:id on the feature element of the geometry, and
serial_number a number starting from 1 and incremented from each subgeometry
(points in a multipoint, etc.)</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ms:a_layer</span><span class="w"> </span><span class="na">gml:id=</span><span class="s">&quot;a_layer.1&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;gml:boundedBy&gt;</span>
<span class="w">      </span><span class="nt">&lt;gml:Envelope</span><span class="w"> </span><span class="na">srsName=</span><span class="s">&quot;urn:ogc:def:crs:EPSG::4326&quot;</span><span class="nt">&gt;</span>
<span class="w">          </span><span class="nt">&lt;gml:lowerCorner&gt;</span>49.000000<span class="w"> </span>2.000000<span class="nt">&lt;/gml:lowerCorner&gt;</span>
<span class="w">          </span><span class="nt">&lt;gml:upperCorner&gt;</span>50.000000<span class="w"> </span>3.000000<span class="nt">&lt;/gml:upperCorner&gt;</span>
<span class="w">      </span><span class="nt">&lt;/gml:Envelope&gt;</span>
<span class="w">  </span><span class="nt">&lt;/gml:boundedBy&gt;</span>
<span class="w">  </span><span class="nt">&lt;ms:msGeometry&gt;</span>
<span class="w">    </span><span class="nt">&lt;gml:MultiPoint</span><span class="w"> </span><span class="na">gml:id=</span><span class="s">&quot;a_layer.1.1&quot;</span><span class="w"> </span><span class="na">srsName=</span><span class="s">&quot;urn:ogc:def:crs:EPSG::4326&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;gml:pointMembers&gt;</span>
<span class="w">        </span><span class="nt">&lt;gml:Point</span><span class="w"> </span><span class="na">gml:id=</span><span class="s">&quot;a_layer.1.2&quot;</span><span class="nt">&gt;</span>
<span class="w">          </span><span class="nt">&lt;gml:pos&gt;</span>49.000000<span class="w"> </span>2.000000<span class="nt">&lt;/gml:pos&gt;</span>
<span class="w">        </span><span class="nt">&lt;/gml:Point&gt;</span>
<span class="w">        </span><span class="nt">&lt;gml:Point</span><span class="w"> </span><span class="na">gml:id=</span><span class="s">&quot;a_layer.1.3&quot;</span><span class="nt">&gt;</span>
<span class="w">          </span><span class="nt">&lt;gml:pos&gt;</span>50.000000<span class="w"> </span>3.000000<span class="nt">&lt;/gml:pos&gt;</span>
<span class="w">        </span><span class="nt">&lt;/gml:Point&gt;</span>
<span class="w">      </span><span class="nt">&lt;/gml:pointMembers&gt;</span>
<span class="w">    </span><span class="nt">&lt;/gml:MultiPoint&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ms:msGeometry&gt;</span>
<span class="nt">&lt;/ms:a_layer&gt;</span>
</pre></div>
</div>
<p>Regarding SRS, for WFS 2.0, it will always be reported with the “<a class="reference external" href="urn:ogc:def:crs:EPSG">urn:ogc:def:crs:EPSG</a>::”
syntax. This should likely also be done for WFS 1.1.0. The “wfs_return_srs_as_urn” can
be set to “true” or “false” to enable or disable this behaviour. It defaults to “true”
for WFS 2.0 and to “false” for older versions.</p>
<p>Contrary to the previous versions of WFS, WFS 2.0 in its XML Schema definition
does not import any GML schema, so it is possible to generate valid GetFeature responses
with other GML output formats. In particular, GML 2.1.1 and GML 3.1.1 that are
already handled for WFS 1.0 and 1.1 can be used for output of DescribeFeatureType,
GetFeature and GetPropertyValue.</p>
</section>
<section id="filter-encoding-2-0">
<h2>Filter Encoding 2.0<a class="headerlink" href="#filter-encoding-2-0" title="Link to this heading">¶</a></h2>
<p>The “PropertyName” element is replaced by a “ValueReference” element, with
equivalent semantic. Likewise, the WFS 1.1 &lt;ogc:GmlObjectId gml:id=”XXXX”/&gt;
operator is replaced by &lt;fes:ResourceId rid=”XXXX”/&gt;.</p>
<p>For the sake of compliance testing, rather dummy implementations of
PropertyIsNull and PropertyIsNil operators have been introduced, as MapServer
cannot generate nullable or nillable fields.</p>
<p>FE 2.0 MinTemporalFilter conformance class is supported with &lt;fes:During&gt; as
operator and &lt;gml:TimePeriod&gt; as operand.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;fes:During&gt;</span>
<span class="w">    </span><span class="nt">&lt;fes:ValueReference&gt;</span>timeProperty<span class="nt">&lt;/fes:ValueReference&gt;</span>
<span class="w">    </span><span class="nt">&lt;gml:TimePeriod</span><span class="w"> </span><span class="na">gml:id=</span><span class="s">&quot;TP1&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;gml:beginPosition&gt;</span>2005-05-17T00:00:00Z<span class="nt">&lt;/gml:beginPosition&gt;</span>
<span class="w">        </span><span class="nt">&lt;gml:endPosition&gt;</span>2005-05-23T00:00:00Z<span class="nt">&lt;/gml:endPosition&gt;</span>
<span class="w">    </span><span class="nt">&lt;/gml:TimePeriod&gt;</span>
<span class="nt">&lt;/fes:During&gt;</span>
</pre></div>
</div>
<p>Related to temporal filter, in GML 3.2.1 output, fields of type Date will be
output as the following in the GML :</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ms:aFieldName</span><span class="w"> </span><span class="na">gml:id=</span><span class="s">&quot;layerName.fid.aFieldName&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;gml:timePosition&gt;</span>2004-01-01<span class="nt">&lt;/gml:timePosition&gt;</span>
<span class="nt">&lt;/ms:aFieldName&gt;</span>
</pre></div>
</div>
<p>And in the .xsd :</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;element</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;aFieldName&quot;</span><span class="w"> </span><span class="na">minOccurs=</span><span class="s">&quot;0&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;gml:TimeInstantType&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p>It is not really clear from the spec(s) if this is required, but it seems consistent
with the operand of &lt;fes:During&gt; (a TimePeriod must match a TimeInstant).</p>
</section>
<section id="response-paging-support">
<h2>Response paging support<a class="headerlink" href="#response-paging-support" title="Link to this heading">¶</a></h2>
<p>Response paging was already supported in MapServer for WFS 1.1.0 as an extension.
This is now a standard (optional) feature of WFS 2.0.
Paging is triggered by the use of STARTINDEX (beginning at 0 for first index)
and COUNT (COUNT is the equivalent of WFS 1.1 MAXFEATURES) parameters.</p>
</section>
<section id="getfeature-operation">
<h2>GetFeature operation<a class="headerlink" href="#getfeature-operation" title="Link to this heading">¶</a></h2>
<p>TYPENAME is replaced by TYPENAMES. FEATUREID is replaced by RESOURCEID.</p>
<p>The &lt;gml:featureMember&gt; element is replaced by &lt;wfs:member&gt;</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;wfs:FeatureCollection</span><span class="w"> </span><span class="na">numberReturned=</span><span class="s">&quot;X&quot;</span><span class="w"> </span><span class="na">numberMatched=</span><span class="s">&quot;Y&quot;</span><span class="w"> </span><span class="na">timeStamp=</span><span class="s">&quot;Z&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;wfs:member&gt;</span>
<span class="w">        </span><span class="nt">&lt;ms:myElement</span><span class="w"> </span><span class="na">gml_id=</span><span class="s">&quot;myElement.1&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;ms:firstProperty&gt;</span>foo<span class="nt">&lt;/ms:firstProperty&gt;</span>
<span class="w">            </span>...
<span class="w">        </span><span class="nt">&lt;/ms:myElement&gt;</span>
<span class="w">    </span><span class="nt">&lt;/wfs:member&gt;</span>
<span class="nt">&lt;/wfs:FeatureCollection&gt;</span>
</pre></div>
</div>
<p>The FeatureCollection element has the “numberReturned” and “numberMatched” mandatory
attributes.</p>
<ul class="simple">
<li><p>numberReturned contains the number of features returned in the document (0 is
always returned when RESULTTYPE=hits is specified).</p></li>
<li><p>numberMatched contains the number of features that matches the criterion of the
request.
If a “wfs_maxfeatures” metadata item is defined in the mapfile (or COUNT is specified
in the request), “unknown” will be returned if the number of matching features
reaches at least the server-side or client-side limit. This is to avoid performance
issues on the server. By defining “wfs_compute_number_matched” “true”, the
exact number of matching features will always be computed, but this can cause
performance issues.</p></li>
</ul>
<p>When relevant, MapServer will fill the “next” and “previous” optional attributes
that contain URL to navigate among the response pages.</p>
<p>The request SERVICE=WFS&amp;VERSION=2.0.0&amp;REQUEST=GetFeature&amp;TYPENAMES=province&amp;COUNT=1&amp;STARTINDEX=2
will generate the following response :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">wfs</span><span class="p">:</span><span class="n">FeatureCollection</span>
<span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="n">numberMatched</span><span class="o">=</span><span class="s2">&quot;unknown&quot;</span> <span class="n">numberReturned</span><span class="o">=</span><span class="s2">&quot;1&quot;</span>
<span class="n">previous</span><span class="o">=</span><span class="s2">&quot;http://localhost:8080/mapserv.cgi?SERVICE=WFS&amp;amp;VERSION=2.0.0&amp;amp;REQUEST=GetFeature&amp;amp;TYPENAMES=province&amp;amp;COUNT=1&amp;amp;STARTINDEX=1&quot;</span>
<span class="nb">next</span><span class="o">=</span><span class="s2">&quot;http://localhost:8080/mapserv.cgi?SERVICE=WFS&amp;amp;VERSION=2.0.0&amp;amp;REQUEST=GetFeature&amp;amp;TYPENAMES=province&amp;amp;COUNT=1&amp;amp;STARTINDEX=3&quot;</span><span class="o">&gt;</span>
<span class="p">[</span><span class="o">...</span><span class="p">]</span>
<span class="o">&lt;/</span><span class="n">wfs</span><span class="p">:</span><span class="n">FeatureCollection</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>In the case of a GetFeature request operating on several typenames,
the result for each query must be in its own FeatureCollection (§ 11.3.3.5).</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;wfs:FeatureCollection</span><span class="w"> </span><span class="na">numberReturned=</span><span class="s">&quot;X&quot;</span><span class="w"> </span><span class="na">numberMatched=</span><span class="s">&quot;Y&quot;</span><span class="w"> </span><span class="na">timeStamp=</span><span class="s">&quot;Z&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;wfs:member&gt;</span>
<span class="w">    </span><span class="nt">&lt;wfs:FeatureCollection</span><span class="w"> </span><span class="na">numberReturned=</span><span class="s">&quot;X1&quot;</span><span class="w"> </span><span class="na">numberMatched=</span><span class="s">&quot;Y1&quot;</span><span class="w"> </span><span class="na">timeStamp=</span><span class="s">&quot;Z&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;wfs:member&gt;</span>
<span class="w">        </span><span class="nt">&lt;ms:layer1</span><span class="w"> </span><span class="na">gml_id=</span><span class="s">&quot;layer1.1&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span>...
<span class="w">        </span><span class="nt">&lt;/ms:myElement&gt;</span>
<span class="w">        </span>...
<span class="w">    </span><span class="nt">&lt;wfs:member&gt;</span>
<span class="w">    </span><span class="nt">&lt;/wfs:FeatureCollection&gt;</span>
<span class="nt">&lt;/wfs:member&gt;</span>
<span class="nt">&lt;wfs:member&gt;</span>
<span class="w">    </span><span class="nt">&lt;wfs:FeatureCollection</span><span class="w"> </span><span class="na">numberReturned=</span><span class="s">&quot;X2&quot;</span><span class="w"> </span><span class="na">numberMatched=</span><span class="s">&quot;Y2&quot;</span><span class="w"> </span><span class="na">timeStamp=</span><span class="s">&quot;Z&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;wfs:member&gt;</span>
<span class="w">        </span><span class="nt">&lt;ms:layer2</span><span class="w"> </span><span class="na">gml_id=</span><span class="s">&quot;layer2.1&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span>...
<span class="w">        </span><span class="nt">&lt;/ms:myElement&gt;</span>
<span class="w">        </span>...
<span class="w">    </span><span class="nt">&lt;wfs:member&gt;</span>
<span class="w">    </span><span class="nt">&lt;/wfs:FeatureCollection&gt;</span>
<span class="nt">&lt;/wfs:member&gt;</span>
<span class="nt">&lt;/wfs:FeatureCollection&gt;</span>
</pre></div>
</div>
</section>
<section id="stored-queries">
<h2>Stored queries<a class="headerlink" href="#stored-queries" title="Link to this heading">¶</a></h2>
<p>Stored queries are queries (&lt;wfs:Query&gt;) stored on the server, potentially with parameters
whose value can be assigned by the client during a GetFeature request.</p>
<p>At WEB.METADATA level, a “wfs_storedqueries” metadata item can be specified with a
comma separated list of stored queries ids.</p>
<p>Then for each stored query id, “wfs_{storedqueryid}_inlinedef” must be specified
with a valid &lt;StoredQueryDescription&gt; as value. As it is not always convenient to
specify a inline XML content, it is also possible to specify
“wfs_{storedqueryid}_filedef” whose value is a filename that contains
the &lt;StoredQueryDescription&gt; XML content.</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="s">&quot;wfs_storedqueries&quot;</span>           <span class="s">&quot;bboxstoredquery&quot;</span>
<span class="s">&quot;wfs_bboxstoredquery_filedef&quot;</span> <span class="s">&quot;/data/bboxstoredquery.xml&quot;</span>
</pre></div>
</div>
<p>with /data/bboxstoredquery.xml containing for example :</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;StoredQueryDescription</span><span class="w"> </span><span class="na">xmlns:xs=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema&quot;</span>
<span class="w">                        </span><span class="na">xmlns:gml=</span><span class="s">&quot;http://www.opengis.net/gml/3.2&quot;</span>
<span class="w">                        </span><span class="na">id=</span><span class="s">&quot;bboxstoredquery&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;Title&gt;</span>query<span class="w"> </span>title<span class="nt">&lt;/Title&gt;</span>
<span class="w">    </span><span class="nt">&lt;Abstract&gt;</span>query<span class="w"> </span>abstract<span class="nt">&lt;/Abstract&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;longmin&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;xs:double&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;latmin&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;xs:double&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;longmax&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;xs:double&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;latmax&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;xs:double&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;QueryExpressionText</span><span class="w"> </span><span class="na">isPrivate=</span><span class="s">&quot;false&quot;</span>
<span class="w">                        </span><span class="na">language=</span><span class="s">&quot;urn:ogc:def:queryLanguage:OGC-WFS::WFS_QueryExpression&quot;</span>
<span class="w">                        </span><span class="na">xmlns:ms=</span><span class="s">&quot;http://mapserver.gis.umn.edu/mapserver&quot;</span>
<span class="w">                        </span><span class="na">returnFeatureTypes=</span><span class="s">&quot;ms:firstLayer ms:secondLayer&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;Query</span><span class="w"> </span><span class="na">xmlns:fes=</span><span class="s">&quot;http://www.opengis.net/fes/2.0&quot;</span><span class="w"> </span><span class="na">typeNames=</span><span class="s">&quot;ms:firstLayer&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;fes:Filter&gt;</span>
<span class="w">                </span><span class="nt">&lt;fes:BBOX&gt;</span>
<span class="w">                    </span><span class="nt">&lt;gml:Envelope</span><span class="w"> </span><span class="na">srsName=</span><span class="s">&quot;urn:ogc:def:crs:EPSG::4326&quot;</span><span class="nt">&gt;</span>
<span class="w">                        </span><span class="nt">&lt;gml:lowerCorner&gt;</span>${latmin}<span class="w"> </span>${longmin}<span class="nt">&lt;/gml:lowerCorner&gt;</span>
<span class="w">                        </span><span class="nt">&lt;gml:upperCorner&gt;</span>${latmax}<span class="w"> </span>${longmax}<span class="nt">&lt;/gml:upperCorner&gt;</span>
<span class="w">                    </span><span class="nt">&lt;/gml:Envelope&gt;</span>
<span class="w">                </span><span class="nt">&lt;/fes:BBOX&gt;</span>
<span class="w">            </span><span class="nt">&lt;/fes:Filter&gt;</span>
<span class="w">        </span><span class="nt">&lt;/Query&gt;</span>
<span class="w">        </span><span class="nt">&lt;Query</span><span class="w"> </span><span class="na">xmlns:fes=</span><span class="s">&quot;http://www.opengis.net/fes/2.0&quot;</span><span class="w"> </span><span class="na">typeNames=</span><span class="s">&quot;ms:secondLayer&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;fes:Filter&gt;</span>
<span class="w">                </span><span class="nt">&lt;fes:BBOX&gt;</span>
<span class="w">                    </span><span class="nt">&lt;gml:Envelope</span><span class="w"> </span><span class="na">srsName=</span><span class="s">&quot;urn:ogc:def:crs:EPSG::4326&quot;</span><span class="nt">&gt;</span>
<span class="w">                        </span><span class="nt">&lt;gml:lowerCorner&gt;</span>${latmin}<span class="w"> </span>${longmin}<span class="nt">&lt;/gml:lowerCorner&gt;</span>
<span class="w">                        </span><span class="nt">&lt;gml:upperCorner&gt;</span>${latmax}<span class="w"> </span>${longmax}<span class="nt">&lt;/gml:upperCorner&gt;</span>
<span class="w">                    </span><span class="nt">&lt;/gml:Envelope&gt;</span>
<span class="w">                </span><span class="nt">&lt;/fes:BBOX&gt;</span>
<span class="w">            </span><span class="nt">&lt;/fes:Filter&gt;</span>
<span class="w">        </span><span class="nt">&lt;/Query&gt;</span>
<span class="w">    </span><span class="nt">&lt;/QueryExpressionText&gt;</span>
<span class="nt">&lt;/StoredQueryDescription&gt;</span>
</pre></div>
</div>
<p>A corresponding valid GetFeature request can be :</p>
<p>REQUEST=GetFeature&amp;STOREDQUERY_ID=bboxstoredquery&amp;LONGMIN=2&amp;LATMIN=49&amp;LONGMAX=3&amp;LATMAX=50</p>
<section id="predefined-urn-ogc-def-query-ogc-wfs-getfeaturebyid-stored-query">
<h3>Predefined <a class="reference external" href="urn:ogc:def:query:OGC-WFS::GetFeatureById">urn:ogc:def:query:OGC-WFS::GetFeatureById</a> stored query<a class="headerlink" href="#predefined-urn-ogc-def-query-ogc-wfs-getfeaturebyid-stored-query" title="Link to this heading">¶</a></h3>
<p>WFS 2.0 defines a mandatory “<a class="reference external" href="urn:ogc:def:query:OGC-WFS::GetFeatureById">urn:ogc:def:query:OGC-WFS::GetFeatureById</a>” stored query.
This query accept a ID parameter whose value must be a feature id.</p>
<p>A valid request is :
REQUEST=GetFeature&amp;STOREDQUERY_ID=urn:ogc:def:query:OGC-WFS::GetFeatureById&amp;ID=mylayer.3</p>
<p>The definition hardcoded in MapServer is :</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;StoredQueryDescription</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;urn:ogc:def:query:OGC-WFS::GetFeatureById&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;Title&gt;</span>Get<span class="w"> </span>feature<span class="w"> </span>by<span class="w"> </span>identifier<span class="nt">&lt;/Title&gt;</span>
<span class="w">    </span><span class="nt">&lt;Abstract&gt;</span>Returns<span class="w"> </span>the<span class="w"> </span>single<span class="w"> </span>feature<span class="w"> </span>whose<span class="w"> </span>value<span class="w"> </span>is<span class="w"> </span>equal<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>specified<span class="w"> </span>value<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>ID<span class="w"> </span>argument<span class="nt">&lt;/Abstract&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;ID&quot;</span><span class="w"> </span><span class="na">xmlns:xs=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;xs:string&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;QueryExpressionText</span><span class="w"> </span><span class="na">isPrivate=</span><span class="s">&quot;true&quot;</span>
<span class="w">                        </span><span class="na">language=</span><span class="s">&quot;urn:ogc:def:queryLanguage:OGC-WFS::WFS_QueryExpression&quot;</span>
<span class="w">                        </span><span class="na">returnFeatureTypes=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;Query</span><span class="w"> </span><span class="na">xmlns:fes=</span><span class="s">&quot;http://www.opengis.net/fes/2.0&quot;</span><span class="w"> </span><span class="na">typeNames=</span><span class="s">&quot;?&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;fes:Filter&gt;</span>
<span class="w">                </span><span class="nt">&lt;fes:ResourceId</span><span class="w"> </span><span class="na">rid=</span><span class="s">&quot;${ID}&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;/fes:Filter&gt;</span>
<span class="w">        </span><span class="nt">&lt;/Query&gt;</span>
<span class="w">    </span><span class="nt">&lt;/QueryExpressionText&gt;</span>
<span class="nt">&lt;/StoredQueryDescription&gt;</span>
</pre></div>
</div>
<p>Comparing to a more standard stored query description, there are 2 oddities :
The value of the “returnFeatureTypes” attribute is replaced at runtime by
the name of the valid WFS layers of the mapfile (when issuing the response document to DescribeStoredQueries
request). And the value of the typeNames attribute is deduced at runtime from the value
of the passed ID parameter.</p>
<p>It is possible to override this hardcoded definition by a custom one (for example
to provide alternate values for other languages) by defining
“wfs_urn:ogc:def:query:OGC-WFS::GetFeatureById_inlinedef” or “wfs_urn:ogc:def:query:OGC-WFS::GetFeatureById_filedef”.
The value of &lt;QueryExpressionText&gt; attributes and child elements must however be
strictly identical to the hard-coded definition for correct execution.</p>
<p>A GetFeature using <a class="reference external" href="urn:ogc:def:query:OGC-WFS::GetFeatureById">urn:ogc:def:query:OGC-WFS::GetFeatureById</a> seems to be identical
to a GetFeature with a RESOURCEID parameter, but there is a difference. GetFeatureById
returns the feature directly as the response :</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&#39;1.0&#39; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="nt">&lt;ms:province</span><span class="w"> </span><span class="na">gml:id=</span><span class="s">&quot;province.977&quot;</span><span class="w"> </span><span class="na">xmlns:ms=</span><span class="s">&quot;http://mapserver.gis.umn.edu/mapserver&quot;</span>
<span class="w">            </span><span class="na">xmlns:gml=</span><span class="s">&quot;http://www.opengis.net/gml/3.2&quot;</span>
<span class="w">            </span><span class="na">xmlns:wfs=</span><span class="s">&quot;http://www.opengis.net/wfs/2.0&quot;</span>
<span class="w">            </span><span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
<span class="w">            </span><span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://mapserver.gis.umn.edu/mapserver http://localhost/path/to/wfs_simple?myparam=something&amp;amp;SERVICE=WFS&amp;amp;VERSION=2.0.0&amp;amp;REQUEST=DescribeFeatureType&amp;amp;TYPENAME=province&amp;amp;OUTPUTFORMAT=application%2Fgml%2Bxml%3B%20version%3D3.2 http://www.opengis.net/wfs/2.0 http://schemas.opengis.net/wfs/2.0/wfs.xsd http://www.opengis.net/gml/3.2 http://schemas.opengis.net/gml/3.2.1/gml.xsd&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;gml:boundedBy&gt;</span>
<span class="w">    </span><span class="nt">&lt;gml:Envelope</span><span class="w"> </span><span class="na">srsName=</span><span class="s">&quot;urn:ogc:def:crs:EPSG::4326&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;gml:lowerCorner&gt;</span>47.76789<span class="w"> </span>-61.51051<span class="nt">&lt;/gml:lowerCorner&gt;</span>
<span class="w">    </span><span class="nt">&lt;gml:upperCorner&gt;</span>47.79644<span class="w"> </span>-61.45764<span class="nt">&lt;/gml:upperCorner&gt;</span>
<span class="w">    </span><span class="nt">&lt;/gml:Envelope&gt;</span>
<span class="nt">&lt;/gml:boundedBy&gt;</span>
<span class="nt">&lt;ms:msGeometry&gt;</span>
<span class="w">    </span><span class="nt">&lt;gml:Polygon</span><span class="w"> </span><span class="na">gml:id=</span><span class="s">&quot;province.977.1&quot;</span><span class="w"> </span><span class="na">srsName=</span><span class="s">&quot;urn:ogc:def:crs:EPSG::4326&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;gml:exterior&gt;</span>
<span class="w">        </span><span class="nt">&lt;gml:LinearRing&gt;</span>
<span class="w">        </span><span class="nt">&lt;gml:posList</span><span class="w"> </span><span class="na">srsDimension=</span><span class="s">&quot;2&quot;</span><span class="nt">&gt;</span>47.77424<span class="w"> </span>-61.51051<span class="w"> </span>47.78860<span class="w"> </span>-61.50894<span class="w"> </span>47.79644<span class="w"> </span>-61.49272<span class="w"> </span>47.78743<span class="w"> </span>-61.45764<span class="w"> </span>47.76789<span class="w"> </span>-61.45998<span class="w"> </span>47.76961<span class="w"> </span>-61.48350<span class="w"> </span>47.77424<span class="w"> </span>-61.51051<span class="w"> </span><span class="nt">&lt;/gml:posList&gt;</span>
<span class="w">        </span><span class="nt">&lt;/gml:LinearRing&gt;</span>
<span class="w">    </span><span class="nt">&lt;/gml:exterior&gt;</span>
<span class="w">    </span><span class="nt">&lt;/gml:Polygon&gt;</span>
<span class="nt">&lt;/ms:msGeometry&gt;</span>
<span class="nt">&lt;/ms:province&gt;</span>
</pre></div>
</div>
</section>
<section id="liststoredqueries">
<h3>ListStoredQueries<a class="headerlink" href="#liststoredqueries" title="Link to this heading">¶</a></h3>
<p>The ListStoredQueries operation has no argument and returned a simplified
description of all stored queries (title and return feature types).</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;wfs:ListStoredQueriesResponse</span><span class="w"> </span><span class="na">xmlns:wfs=</span><span class="s">&quot;http://www.opengis.net/wfs/2.0&quot;</span><span class="w"> </span><span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;http://www.opengis.net/wfs/2.0&quot;</span><span class="w"> </span><span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.opengis.net/wfs/2.0 http://schemas.opengis.net/wfs/2.0/wfs.xsd&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;StoredQuery</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;urn:ogc:def:query:OGC-WFS::GetFeatureById&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;Title&gt;</span>Get<span class="w"> </span>feature<span class="w"> </span>by<span class="w"> </span>identifier<span class="nt">&lt;/Title&gt;</span>
<span class="w">    </span><span class="nt">&lt;ReturnFeatureType</span><span class="w"> </span><span class="na">xmlns:ms=</span><span class="s">&quot;http://mapserver.gis.umn.edu/mapserver&quot;</span><span class="nt">&gt;</span>ms:province<span class="nt">&lt;/ReturnFeatureType&gt;</span>
<span class="w">    </span><span class="nt">&lt;ReturnFeatureType</span><span class="w"> </span><span class="na">xmlns:ms=</span><span class="s">&quot;http://mapserver.gis.umn.edu/mapserver&quot;</span><span class="nt">&gt;</span>ms:point<span class="nt">&lt;/ReturnFeatureType&gt;</span>
<span class="w">    </span><span class="nt">&lt;ReturnFeatureType</span><span class="w"> </span><span class="na">xmlns:ms=</span><span class="s">&quot;http://mapserver.gis.umn.edu/mapserver&quot;</span><span class="nt">&gt;</span>ms:multipoint<span class="nt">&lt;/ReturnFeatureType&gt;</span>
<span class="nt">&lt;/StoredQuery&gt;</span>
<span class="nt">&lt;StoredQuery</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;myquery&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;Title&gt;</span>query<span class="w"> </span>title<span class="nt">&lt;/Title&gt;</span>
<span class="w">    </span><span class="nt">&lt;ReturnFeatureType</span><span class="w"> </span><span class="na">xmlns:ms=</span><span class="s">&quot;http://mapserver.gis.umn.edu/mapserver&quot;</span><span class="nt">&gt;</span>ms:point<span class="nt">&lt;/ReturnFeatureType&gt;</span>
<span class="nt">&lt;/StoredQuery&gt;</span>
<span class="nt">&lt;/wfs:ListStoredQueriesResponse&gt;</span>
</pre></div>
</div>
</section>
<section id="describestoredqueries">
<h3>DescribeStoredQueries<a class="headerlink" href="#describestoredqueries" title="Link to this heading">¶</a></h3>
<p>The DescribeStoredQueries operation accept an optional STOREDQUERY_ID parameter
that list the ids of stored queries. If not specified, all stored queries will
be returned with their full description.</p>
<p>MapServer will honour the value of the isPrivate attribute of &lt;QueryExpressionText&gt;.
If defined to “true”, the &lt;Query&gt; nodes will not be returned in the response to
a DescribeStoredQueries request.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;wfs:DescribeStoredQueriesResponse</span><span class="w"> </span><span class="na">xmlns:wfs=</span><span class="s">&quot;http://www.opengis.net/wfs/2.0&quot;</span><span class="w"> </span><span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;http://www.opengis.net/wfs/2.0&quot;</span><span class="w"> </span><span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.opengis.net/wfs/2.0 http://schemas.opengis.net/wfs/2.0/wfs.xsd&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;StoredQueryDescription</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;urn:ogc:def:query:OGC-WFS::GetFeatureById&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;Title&gt;</span>Get<span class="w"> </span>feature<span class="w"> </span>by<span class="w"> </span>identifier<span class="nt">&lt;/Title&gt;</span>
<span class="w">    </span><span class="nt">&lt;Abstract&gt;</span>Returns<span class="w"> </span>the<span class="w"> </span>single<span class="w"> </span>feature<span class="w"> </span>whose<span class="w"> </span>value<span class="w"> </span>is<span class="w"> </span>equal<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>specified<span class="w"> </span>value<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>ID<span class="w"> </span>argument<span class="nt">&lt;/Abstract&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">xmlns:xs=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;ID&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;xs:string&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;QueryExpressionText</span><span class="w"> </span><span class="na">xmlns:ms=</span><span class="s">&quot;http://mapserver.gis.umn.edu/mapserver&quot;</span><span class="w"> </span><span class="na">isPrivate=</span><span class="s">&quot;true&quot;</span><span class="w"> </span><span class="na">language=</span><span class="s">&quot;urn:ogc:def:queryLanguage:OGC-WFS::WFS_QueryExpression&quot;</span><span class="w"> </span><span class="na">returnFeatureTypes=</span><span class="s">&quot;ms:province ms:point&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/StoredQueryDescription&gt;</span>
<span class="nt">&lt;StoredQueryDescription</span><span class="w"> </span><span class="na">xmlns:xs=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema&quot;</span><span class="w"> </span><span class="na">xmlns:gml=</span><span class="s">&quot;http://www.opengis.net/gml/3.2&quot;</span><span class="w"> </span><span class="na">xmlns:fes=</span><span class="s">&quot;http://www.opengis.net/fes/2.0&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;myquery&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;Title&gt;</span>query<span class="w"> </span>title<span class="nt">&lt;/Title&gt;</span>
<span class="w">    </span><span class="nt">&lt;Abstract&gt;</span>query<span class="w"> </span>abstract<span class="nt">&lt;/Abstract&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;longmin&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;xs:double&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;latmin&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;xs:double&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;longmax&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;xs:double&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;latmax&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;xs:double&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;QueryExpressionText</span><span class="w"> </span><span class="na">xmlns:ms=</span><span class="s">&quot;http://mapserver.gis.umn.edu/mapserver&quot;</span><span class="w"> </span><span class="na">isPrivate=</span><span class="s">&quot;false&quot;</span><span class="w"> </span><span class="na">language=</span><span class="s">&quot;urn:ogc:def:queryLanguage:OGC-WFS::WFS_QueryExpression&quot;</span><span class="w"> </span><span class="na">returnFeatureTypes=</span><span class="s">&quot;ms:point&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;Query</span><span class="w"> </span><span class="na">xmlns:fes=</span><span class="s">&quot;http://www.opengis.net/fes/2.0&quot;</span><span class="w"> </span><span class="na">typeNames=</span><span class="s">&quot;ms:point&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;fes:Filter&gt;</span>
<span class="w">                </span><span class="nt">&lt;fes:BBOX&gt;</span>
<span class="w">                    </span><span class="nt">&lt;fes:ValueReference&gt;</span>msGeometry<span class="nt">&lt;/fes:ValueReference&gt;</span>
<span class="w">                    </span><span class="nt">&lt;gml:Envelope</span><span class="w"> </span><span class="na">srsName=</span><span class="s">&quot;urn:ogc:def:crs:EPSG::4326&quot;</span><span class="nt">&gt;</span>
<span class="w">                    </span><span class="nt">&lt;gml:lowerCorner&gt;</span>${latmin}<span class="w"> </span>${longmin}<span class="nt">&lt;/gml:lowerCorner&gt;</span>
<span class="w">                    </span><span class="nt">&lt;gml:upperCorner&gt;</span>${latmax}<span class="w"> </span>${longmax}<span class="nt">&lt;/gml:upperCorner&gt;</span>
<span class="w">                    </span><span class="nt">&lt;/gml:Envelope&gt;</span>
<span class="w">                </span><span class="nt">&lt;/fes:BBOX&gt;</span>
<span class="w">            </span><span class="nt">&lt;/fes:Filter&gt;</span>
<span class="w">        </span><span class="nt">&lt;/Query&gt;</span>
<span class="w">    </span><span class="nt">&lt;/QueryExpressionText&gt;</span>
<span class="nt">&lt;/StoredQueryDescription&gt;</span>
<span class="nt">&lt;/wfs:DescribeStoredQueriesResponse&gt;</span>
</pre></div>
</div>
</section>
</section>
<section id="getpropertyvalue-operation">
<h2>GetPropertyValue operation<a class="headerlink" href="#getpropertyvalue-operation" title="Link to this heading">¶</a></h2>
<p>REQUEST=GetPropertyValue&amp;TYPENAMES=layername&amp;VALUEREFERENCE=propertyname.</p>
<p>The response document has a &lt;ValueCollection&gt; top element and includes only
the asked VALUEREFRENCE element as a child of &lt;wfs:member&gt;</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;wfs:ValueCollection&gt;</span>
<span class="w">    </span><span class="nt">&lt;wfs:member&gt;</span>
<span class="w">        </span><span class="nt">&lt;ms:aProperty&gt;</span>foo<span class="nt">&lt;/ms:aProperty&gt;</span>
<span class="w">    </span><span class="nt">&lt;/wfs:member&gt;</span>
<span class="nt">&lt;/wfs:ValueCollection&gt;</span>
</pre></div>
</div>
<p>Most parameters of GetFeature operation,
such as FILTER, RESOURCEID, BBOX, STOREDQUERY_ID or paging,
can also be used for a GetPropertyValue operation, so most of the logic of
msWFSGetFeature() has been refactored so that it can be also reused by msWFSGetPropertyValue().</p>
</section>
<section id="sorting">
<h2>Sorting<a class="headerlink" href="#sorting" title="Link to this heading">¶</a></h2>
<p>Sorting was already a capability that should have been offered in WFS 1.1 but
was not yet supported. We now support sorting with OGR and PostGIS connections.</p>
<p>Other providers relying on RDBMS (Oracle, MSSpatial, …) that support the
“ORDER BY” SQL clause could be upgraded to support sorting, but this is not
covered by this RFC.</p>
<p>MapServer shapefile provider does not support sorting. If this needed, you must
use the OGR Shapefile provider.</p>
<p>The support for sorting relies on the following additions in mapserver.h and
mapfile.c</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">SORT_ASC</span><span class="p">,</span>
<span class="w">    </span><span class="n">SORT_DESC</span>
<span class="p">}</span><span class="w"> </span><span class="n">sortOrderEnum</span><span class="p">;</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">item</span><span class="p">;</span>
<span class="w">    </span><span class="n">sortOrderEnum</span><span class="w"> </span><span class="n">sortOrder</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">sortByProperties</span><span class="p">;</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">nProperties</span><span class="p">;</span>
<span class="w">    </span><span class="n">sortByProperties</span><span class="o">*</span><span class="w"> </span><span class="n">properties</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">sortByClause</span><span class="p">;</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">layerObj</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">[...]</span>
<span class="w">  </span><span class="n">sortByClause</span><span class="w"> </span><span class="n">sortBy</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">msLayerSupportsSorting</span><span class="p">(</span><span class="n">layerObj</span><span class="w"> </span><span class="o">*</span><span class="n">layer</span><span class="p">);</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">msLayerSetSort</span><span class="p">(</span><span class="n">layerObj</span><span class="w"> </span><span class="o">*</span><span class="n">layer</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">sortByClause</span><span class="o">*</span><span class="w"> </span><span class="n">sortBy</span><span class="p">);</span>
<span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="nf">msLayerBuildSQLOrderBy</span><span class="p">(</span><span class="n">layerObj</span><span class="w"> </span><span class="o">*</span><span class="n">layer</span><span class="p">);</span>
</pre></div>
</div>
<p>msLayerSupportsSorting() must be updated if a new provider supports sorting.
msLayerSetSort() is called by the WFS code. And msLayerBuildSQLOrderBy() can
be called by providers that implement sorting as a “ORDER BY” SQL clause, which
is the case for PostGIS and OGR.</p>
</section>
<section id="kvp-and-xml-syntax">
<h2>KVP and XML syntax<a class="headerlink" href="#kvp-and-xml-syntax" title="Link to this heading">¶</a></h2>
<p>Both Key Value Pair (as GET, or POST) and XML syntax (as POST) are
handled for all supported operations.</p>
</section>
<section id="optional-mandatory-gml-items">
<h2>Optional / mandatory GML items<a class="headerlink" href="#optional-mandatory-gml-items" title="Link to this heading">¶</a></h2>
<p>Tickets <a class="reference external" href="https://github.com/MapServer/MapServer/issues/3563">https://github.com/MapServer/MapServer/issues/3563</a> and
<a class="reference external" href="https://github.com/MapServer/MapServer/issues/3319">https://github.com/MapServer/MapServer/issues/3319</a> raise an issue about how
mandatory/optional GML items are handled. Up to now, all advertized properties
in the DescribeFeatureType response documents were mandatory (since minOccurs
was not specified). But when issuing a GetFeature with PROPERTYNAME, only
the specified properties were returned in the GetFeature response document, which
results in a document not compliant with the GML application schema.</p>
<p>The solution for this is to introduce a “gml_optional_items” element in the LAYER
metadata. By default,
now all items will be considered as optional (minOccurs=”0” in the GML application
schema). If “gml_optional_items” is specified, only the listed elements will be
optional and other included items will be mandatory. This change is the most backward
compatible solution for the current behaviour : only the output of DescribeFeatureType
will be changed (minOccurs=”0”), but GetFeature with PROPERTYNAME will still return
only the mentioned properties.
If there are more mandatory items, it might be more convenient to specify
“gml_mandatory_items”.</p>
<p>Default behaviour with this implementation :</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="s">&quot;gml_optional_items&quot;</span> <span class="s">&quot;all&quot;</span>
</pre></div>
</div>
<p>All items optional except the ones mentioned :</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="s">&quot;gml_mandatory_items&quot;</span> <span class="s">&quot;a_required_item,another_one&quot;</span>
</pre></div>
</div>
<p>All items mandatory :</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="s">&quot;gml_mandatory_items&quot;</span> <span class="s">&quot;all&quot;</span>
</pre></div>
</div>
<p>All items mandatory except the ones mentioned :</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="s">&quot;gml_optional_items&quot;</span>  <span class="s">&quot;an_optional_item,another_one&quot;</span>
</pre></div>
</div>
<p>In addition to this, again for backward compatibility, when a GetFeature request
without explicit PROPERTYNAME is processed, we will return all items,
either optional or mandatory. This behaviour can now be amended by specifying
“gml_default_items” to specify which items (among the optional ones) must be
returned.</p>
<p>An example combining all the related metadata items :</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="s">&quot;gml_include_items&quot;</span>   <span class="s">&quot;all&quot;</span>
<span class="s">&quot;gml_exclude_items&quot;</span>   <span class="s">&quot;REG_CODE&quot;</span>
<span class="s">&quot;gml_optional_items&quot;</span>  <span class="s">&quot;all&quot;</span>
<span class="s">&quot;gml_mandatory_items&quot;</span> <span class="s">&quot;NAME&quot;</span>
<span class="s">&quot;gml_default_items&quot;</span>   <span class="s">&quot;NAME_E,NAME_F&quot;</span>
</pre></div>
</div>
</section>
<section id="inspire-download-services">
<h2>Inspire Download Services<a class="headerlink" href="#inspire-download-services" title="Link to this heading">¶</a></h2>
<p><a class="reference external" href="http://inspire.jrc.ec.europa.eu/documents/Network_Services/Technical_Guidance_Download_Services_v3.1.pdf">INSPIRE Technical Guidance Download Services v3.1</a> can be implemented with
Atom feeds (not supported by this RFC) and/or WFS 2.0. So we will implement
Inspire D.S. conformance classes 2 (Pre-defined WFS) and 3 (Direct WFS).
The mandatory conformance class “4: Quality of Service” must be addressed by other means than
the WFS 2.0 implementation itself.</p>
<p>Regarding mapfile configuration, the same metadata items as in “Provision of INSPIRE specific metadata”
of <a class="reference internal" href="../../ogc/inspire.html#inspire-view-service"><span class="std std-ref">INSPIRE View Service</span></a> must be provided (in the WFS or OWS namespaces).
In addition to them, for Download Services, the mandatory “wfs_inspire_dsid_code” metadata
item must be set with a Spatial Data Set Identifier (or a list of identifiers
separated by commas). The semantics attached to this parameter is described
at paragraph 4.1.3 of the technical guidance. If needed, the namespace linked to
the dataset identifier can be specified with “wfs_inspire_dsid_ns”.</p>
<p>Those metadata items are used to generate a &lt;inspire_dls:ExtendedCapabilities&gt; element
in the &lt;ows:ExtendedCapabilities&gt; element of the GetCapabilities response document.</p>
<p>INSPIRE Download Services also include support for several languages.
The definition of which languages are supported is done with the “wfs_languages” metadata
keyword similarly to View Services.
A “LANGUAGE=xxx” extra parameter in WFS KVP requests will then have
effect on the GetCapabilities response documents where the information under the
&lt;ows:ServiceProvider&gt; element as well as &lt;Title&gt;, &lt;Abstract&gt; and  &lt;ows:Keywords&gt;
in the &lt;FeatureTypeList&gt; section will be translated into the request language, provided
that the translated version is provided in the mapfile. As an extension of
the recommandations of the technical guidance, the values of the DATA and CONNECTION
keywords can contain a “%language%” string that will be replaced by the requested
language.</p>
<section id="scenario-1-inspire-related-fields-using-referenced-external-service-metadata">
<h3>Scenario 1 - INSPIRE related fields using referenced external service metadata<a class="headerlink" href="#scenario-1-inspire-related-fields-using-referenced-external-service-metadata" title="Link to this heading">¶</a></h3>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="s">&quot;wfs_inspire_capabilities&quot;</span> <span class="s">&quot;url&quot;</span>

<span class="s">&quot;wfs_inspire_metadataurl_href&quot;</span> <span class="s">&quot;http://inspire.service/metadata&quot;</span>
<span class="s">&quot;wfs_inspire_metadataurl_format&quot;</span> <span class="s">&quot;application/vnd.ogc.csw.capabilities.response_xml&quot;</span>
<span class="s">&quot;wfs_inspire_dsid_code&quot;</span> <span class="s">&quot;mycode&quot;</span>

<span class="s">&quot;wfs_languages&quot;</span> <span class="s">&quot;eng&quot;</span>                                                 <span class="c">#first default, values according ISO 639-2/B</span>
</pre></div>
</div>
<p>generates:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ows:ExtendedCapabilities&gt;</span>
<span class="w">  </span><span class="nt">&lt;inspire_dls:ExtendedCapabilities&gt;</span>
<span class="w">    </span><span class="nt">&lt;inspire_common:MetadataUrl</span><span class="w"> </span><span class="na">xsi:type=</span><span class="s">&quot;inspire_common:resourceLocatorType&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;inspire_common:URL&gt;</span>http://inspire.service/metadata<span class="nt">&lt;/inspire_common:URL&gt;</span>
<span class="w">      </span><span class="nt">&lt;inspire_common:MediaType&gt;</span>application/vnd.ogc.csw.capabilities.response_xml<span class="nt">&lt;/inspire_common:MediaType&gt;</span>
<span class="w">    </span><span class="nt">&lt;/inspire_common:MetadataUrl&gt;</span>
<span class="w">    </span><span class="nt">&lt;inspire_common:SupportedLanguages&gt;</span>
<span class="w">      </span><span class="nt">&lt;inspire_common:DefaultLanguage&gt;</span>
<span class="w">        </span><span class="nt">&lt;inspire_common:Language&gt;</span>eng<span class="nt">&lt;/inspire_common:Language&gt;</span>
<span class="w">      </span><span class="nt">&lt;/inspire_common:DefaultLanguage&gt;</span>
<span class="w">    </span><span class="nt">&lt;/inspire_common:SupportedLanguages&gt;</span>
<span class="w">    </span><span class="nt">&lt;inspire_common:ResponseLanguage&gt;</span>
<span class="w">      </span><span class="nt">&lt;inspire_common:Language&gt;</span>eng<span class="nt">&lt;/inspire_common:Language&gt;</span>
<span class="w">    </span><span class="nt">&lt;/inspire_common:ResponseLanguage&gt;</span>
<span class="w">    </span><span class="nt">&lt;inspire_dls:SpatialDataSetIdentifier&gt;</span>
<span class="w">      </span><span class="nt">&lt;inspire_common:Code&gt;</span>mycode<span class="nt">&lt;/inspire_common:Code&gt;</span>
<span class="w">    </span><span class="nt">&lt;/inspire_dls:SpatialDataSetIdentifier&gt;</span>
<span class="w">  </span><span class="nt">&lt;/inspire_dls:ExtendedCapabilities&gt;</span>
<span class="nt">&lt;/ows:ExtendedCapabilities&gt;</span>
</pre></div>
</div>
</section>
<section id="scenario-2-inspire-related-fields-using-embedded-service-metadata">
<h3>Scenario 2 - INSPIRE related fields using embedded service metadata<a class="headerlink" href="#scenario-2-inspire-related-fields-using-embedded-service-metadata" title="Link to this heading">¶</a></h3>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="s">&quot;wfs_inspire_capabilities&quot;</span> <span class="s">&quot;embed&quot;</span>

<span class="s">&quot;wfs_languages&quot;</span> <span class="s">&quot;eng,fre,ger&quot;</span>                                                 <span class="c">#first default, values according ISO 639-2/B</span>
<span class="s">&quot;wfs_inspire_temporal_reference&quot;</span> <span class="s">&quot;2011-09-19&quot;</span>                                 <span class="c">#date of last revision, value according YYYY-MM-DD</span>
<span class="s">&quot;wfs_inspire_mpoc_name&quot;</span> <span class="s">&quot;mympocname&quot;</span>                                          <span class="c">#point of contact</span>
<span class="s">&quot;wfs_inspire_mpoc_email&quot;</span> <span class="s">&quot;mympoc@e.mail&quot;</span>                                      <span class="c">#point of contact</span>
<span class="s">&quot;wfs_inspire_metadatadate&quot;</span> <span class="s">&quot;2011-09-19&quot;</span>
<span class="s">&quot;wfs_inspire_resourcelocator&quot;</span> <span class="s">&quot;http://myinspireresource&quot;</span>                      <span class="c">#URL for ResourceLocator</span>
<span class="s">&quot;wfs_inspire_keyword&quot;</span> <span class="s">&quot;infoMapAccessService&quot;</span>                                  <span class="c">#value according &quot;classification of spatial data services&quot;</span>
<span class="s">&quot;wfs_inspire_dsid_code&quot;</span> <span class="s">&quot;mycode,mycode2,mycode3&quot;</span>
<span class="s">&quot;wfs_inspire_dsid_ns&quot;</span> <span class="s">&quot;http://mycode,,http://mycode3&quot;</span>
</pre></div>
</div>
<p>generates:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ows:ExtendedCapabilities&gt;</span>
<span class="w">  </span><span class="nt">&lt;inspire_dls:ExtendedCapabilities&gt;</span>
<span class="w">    </span><span class="nt">&lt;inspire_common:ResourceLocator&gt;</span>
<span class="w">      </span><span class="nt">&lt;inspire_common:URL&gt;</span>http://myinspireresource<span class="nt">&lt;/inspire_common:URL&gt;</span>
<span class="w">    </span><span class="nt">&lt;/inspire_common:ResourceLocator&gt;</span>
<span class="w">    </span><span class="nt">&lt;inspire_common:ResourceType&gt;</span>service<span class="nt">&lt;/inspire_common:ResourceType&gt;</span>
<span class="w">    </span><span class="nt">&lt;inspire_common:TemporalReference&gt;</span>
<span class="w">      </span><span class="nt">&lt;inspire_common:DateOfLastRevision&gt;</span>2011-09-19<span class="nt">&lt;/inspire_common:DateOfLastRevision&gt;</span>
<span class="w">    </span><span class="nt">&lt;/inspire_common:TemporalReference&gt;</span>
<span class="w">    </span><span class="nt">&lt;inspire_common:Conformity&gt;</span>
<span class="w">      </span><span class="nt">&lt;inspire_common:Specification&gt;</span>
<span class="w">        </span><span class="nt">&lt;inspire_common:Title&gt;</span>-<span class="nt">&lt;/inspire_common:Title&gt;</span>
<span class="w">        </span><span class="nt">&lt;inspire_common:DateOfLastRevision&gt;</span>2011-09-19<span class="nt">&lt;/inspire_common:DateOfLastRevision&gt;</span>
<span class="w">      </span><span class="nt">&lt;/inspire_common:Specification&gt;</span>
<span class="w">      </span><span class="nt">&lt;inspire_common:Degree&gt;</span>notEvaluated<span class="nt">&lt;/inspire_common:Degree&gt;</span>
<span class="w">    </span><span class="nt">&lt;/inspire_common:Conformity&gt;</span>
<span class="w">    </span><span class="nt">&lt;inspire_common:MetadataPointOfContact&gt;</span>
<span class="w">      </span><span class="nt">&lt;inspire_common:OrganisationName&gt;</span>mympocname<span class="nt">&lt;/inspire_common:OrganisationName&gt;</span>
<span class="w">      </span><span class="nt">&lt;inspire_common:EmailAddress&gt;</span>mympoc@e.mail<span class="nt">&lt;/inspire_common:EmailAddress&gt;</span>
<span class="w">    </span><span class="nt">&lt;/inspire_common:MetadataPointOfContact&gt;</span>
<span class="w">    </span><span class="nt">&lt;inspire_common:MetadataDate&gt;</span>2011-09-19<span class="nt">&lt;/inspire_common:MetadataDate&gt;</span>
<span class="w">    </span><span class="nt">&lt;inspire_common:SpatialDataServiceType&gt;</span>download<span class="nt">&lt;/inspire_common:SpatialDataServiceType&gt;</span>
<span class="w">    </span><span class="nt">&lt;inspire_common:MandatoryKeyword</span><span class="w"> </span><span class="na">xsi:type=</span><span class="s">&quot;inspire_common:classificationOfSpatialDataService&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;inspire_common:KeywordValue&gt;</span>infoMapAccessService<span class="nt">&lt;/inspire_common:KeywordValue&gt;</span>
<span class="w">    </span><span class="nt">&lt;/inspire_common:MandatoryKeyword&gt;</span>
<span class="w">    </span><span class="nt">&lt;inspire_common:SupportedLanguages&gt;</span>
<span class="w">      </span><span class="nt">&lt;inspire_common:DefaultLanguage&gt;</span>
<span class="w">        </span><span class="nt">&lt;inspire_common:Language&gt;</span>eng<span class="nt">&lt;/inspire_common:Language&gt;</span>
<span class="w">      </span><span class="nt">&lt;/inspire_common:DefaultLanguage&gt;</span>
<span class="w">      </span><span class="nt">&lt;inspire_common:SupportedLanguage&gt;</span>
<span class="w">        </span><span class="nt">&lt;inspire_common:Language&gt;</span>fre<span class="nt">&lt;/inspire_common:Language&gt;</span>
<span class="w">      </span><span class="nt">&lt;/inspire_common:SupportedLanguage&gt;</span>
<span class="w">      </span><span class="nt">&lt;inspire_common:SupportedLanguage&gt;</span>
<span class="w">        </span><span class="nt">&lt;inspire_common:Language&gt;</span>ger<span class="nt">&lt;/inspire_common:Language&gt;</span>
<span class="w">      </span><span class="nt">&lt;/inspire_common:SupportedLanguage&gt;</span>
<span class="w">    </span><span class="nt">&lt;/inspire_common:SupportedLanguages&gt;</span>
<span class="w">    </span><span class="nt">&lt;inspire_common:ResponseLanguage&gt;</span>
<span class="w">      </span><span class="nt">&lt;inspire_common:Language&gt;</span>eng<span class="nt">&lt;/inspire_common:Language&gt;</span>
<span class="w">    </span><span class="nt">&lt;/inspire_common:ResponseLanguage&gt;</span>
<span class="w">    </span><span class="nt">&lt;inspire_dls:SpatialDataSetIdentifier&gt;</span>
<span class="w">      </span><span class="nt">&lt;inspire_common:Code&gt;</span>mycode<span class="nt">&lt;/inspire_common:Code&gt;</span>
<span class="w">      </span><span class="nt">&lt;inspire_common:Namespace&gt;</span>http://mycode<span class="nt">&lt;/inspire_common:Namespace&gt;</span>
<span class="w">    </span><span class="nt">&lt;/inspire_dls:SpatialDataSetIdentifier&gt;</span>
<span class="w">    </span><span class="nt">&lt;inspire_dls:SpatialDataSetIdentifier&gt;</span>
<span class="w">      </span><span class="nt">&lt;inspire_common:Code&gt;</span>mycode2<span class="nt">&lt;/inspire_common:Code&gt;</span>
<span class="w">    </span><span class="nt">&lt;/inspire_dls:SpatialDataSetIdentifier&gt;</span>
<span class="w">    </span><span class="nt">&lt;inspire_dls:SpatialDataSetIdentifier&gt;</span>
<span class="w">      </span><span class="nt">&lt;inspire_common:Code&gt;</span>mycode3<span class="nt">&lt;/inspire_common:Code&gt;</span>
<span class="w">      </span><span class="nt">&lt;inspire_common:Namespace&gt;</span>http://mycode3<span class="nt">&lt;/inspire_common:Namespace&gt;</span>
<span class="w">    </span><span class="nt">&lt;/inspire_dls:SpatialDataSetIdentifier&gt;</span>
<span class="w">  </span><span class="nt">&lt;/inspire_dls:ExtendedCapabilities&gt;</span>
<span class="nt">&lt;/ows:ExtendedCapabilities&gt;</span>
</pre></div>
</div>
</section>
</section>
<section id="mapfile-impacts">
<h2>Mapfile impacts<a class="headerlink" href="#mapfile-impacts" title="Link to this heading">¶</a></h2>
<p>A valid WFS 1.1 configuration can be used without modification for WFS 2.0.</p>
<p>INSPIRE Download Services support requires to specify the metadata items
specified in an above paragraph.</p>
</section>
<section id="implementation-details">
<h2>3. Implementation Details<a class="headerlink" href="#implementation-details" title="Link to this heading">¶</a></h2>
<section id="files-affected">
<h3>3.1 Files affected<a class="headerlink" href="#files-affected" title="Link to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>CMakeLists.txt : add mapwfs20.c, fix a few dependency issues
mapfile.c : refactoring of msLoadProjectionString(), initialization/free of
            layer-&gt;sortBy
mapgml.c : GML 3.2.1 and WFS 2.0 GetFeature output specificities. Part of handling
           of &quot;gml_optional_items&quot;, &quot;gml_mandatory_items&quot; and &quot;gml_default_items&quot;
mapgml.h : move some #define into another include files
mapio.h/.c : add msIO_pushStdoutToBufferAndGetOldContext() and
             msIO_restoreOldStdoutContext(), so that we can reuse without any change
             the generation of Inspire View Services extended metadata in a libxml2 DOM document
maplayer.c : new sorting functions
mapogcfilter.h/.c : Filter Encoding 2.0 support, temporal filtering, simplification
                 of existing code
mapogcfiltercommon.c : temporal filtering
mapogcsld.c: adaptation for a renaming of a function called
mapogcsos.c: adaptations for a renaming of a function called and change of prototypes
mapogr.cpp: support for a filter string that combine both a SQL where clause that
            can be passed to OGR, and a time filtering part that is processed on
            MapServer side; support for sorting
mapows.c : fixes for a few memory leaks; wfs_cite_wfs2 hack; other misc minor changes;
           add msOWSGetInspireSchemasLocation()
mapows.h : extend wfsParamsObj and gmlItemObj structures; other misc changes
mapowscommon.c : support for translation of ServiceIdentification and
                 ServiceProvider sections; support for validation of WFS 2.0
                 XML post requests
mapowscommon.h : #define for namespaces, URIs
mappostgis.c : support for sorting
mapproject.h/.c : hack for reprojection worldwide long/lat BBOX to projected SRS;
               add msIsAxisInvertedProj() and msAxisSwapShape()
mapquery.c : use only_cache_result_count flag if &quot;wfs_compute_number_matched&quot; &quot;true&quot;
             is specified; fix a bug in msQueryByRect when reprojection is involved;
mapserver.h : prototype and structure changes for sorting support; other misc changes
maptime.h/.c : const sanitization
maputil.c : add msMapSetLanguageSpecificConnection()
mapwcs11.c : adaptations for change of prototypes
mapwcs20.c : adaptations for change of prototypes
mapwfs.c : lots of changes !
mapwfs11.c : a few changes to make msWFSDumpLayer11() usable by WFS 2.0 too
mapwfs20.c : new file with the code that only applies to WFS 2.0 : GetCapabilities,
             stored queries management.
mapwms.c : adaptations for change of prototypes
</pre></div>
</div>
</section>
<section id="backwards-compatibility-issues">
<h3>3.2 Backwards Compatibility Issues<a class="headerlink" href="#backwards-compatibility-issues" title="Link to this heading">¶</a></h3>
<p>The only potential compatibility issue foreseen is related to the GetCapabilities
request. Without any explicit version mentioned in the request, the WFS
implementation will serve a GetCapabilities response document that conforms
to the latest version of WFS it implements (as recommended by OWS 1.1), that
is to say 2.0 with this new development. Which could cause confusion to
WFS clients not ready to deal with it (OWS 1.1 recommand that clients specify in
the ACCEPTVERSIONS parameter the list of versions they can deal with.)
The solution for this is to define the <cite>wfs_getcapabilities_version</cite> keyword in
the WEB.METADATA to “1.0” or “1.1”.</p>
</section>
<section id="mapscript-changes">
<h3>3.3 MapScript changes<a class="headerlink" href="#mapscript-changes" title="Link to this heading">¶</a></h3>
<p>None</p>
</section>
<section id="performance-implications">
<h3>3.4 Performance implications<a class="headerlink" href="#performance-implications" title="Link to this heading">¶</a></h3>
<p>The default configuration should exhibit the same performance as WFS 1.1.0.</p>
<p>Sorting might be slow on big OGR datasources that are not RDBMS drivers, such as
shapefile, since a full scan of the features of the layer is done.</p>
</section>
<section id="related-bug-fixes">
<h3>3.5 Related bug fixes<a class="headerlink" href="#related-bug-fixes" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/MapServer/MapServer/issues/1583">https://github.com/MapServer/MapServer/issues/1583</a> : [WFS-Server] enable temporal support on filters</p></li>
<li><p><a class="reference external" href="https://github.com/MapServer/MapServer/issues/3563">https://github.com/MapServer/MapServer/issues/3563</a> : WFS property name should respect gml_include/exclude_items</p></li>
<li><p><a class="reference external" href="https://github.com/MapServer/MapServer/issues/3319">https://github.com/MapServer/MapServer/issues/3319</a> : WFS 1.1 property names, mandatory, optional attributes</p></li>
</ul>
</section>
<section id="restrictions">
<h3>3.6 Restrictions<a class="headerlink" href="#restrictions" title="Link to this heading">¶</a></h3>
<p>The following features are not covered by this RFC :</p>
<ul class="simple">
<li><p>Standard, spatial or temporal joins in GetFeature operation. All are optional
conformance classes of <cite>Filter Encoding 2.0</cite></p></li>
<li><p>A very small subset of XPath 2.0 is supported (even if we shamelessly advertize
ImplementsMinimumXPath to make CITE tests happy). This is limited to property
names, “groupname/propertyname” syntax when using gml_group, as well as &#64;gml:id for
the VALUEREFERENCE parameter of GetPropertyValue.</p></li>
<li><p>Locking WFS</p></li>
<li><p>Transactional WFS</p></li>
<li><p>Feature versions</p></li>
<li><p>Inheritance / schema-element() XPath function</p></li>
<li><p>SOAP</p></li>
<li><p>Namespaces: the NAMESPACE KVP parameter is ignored. namespace prefixes in
layer and property names are just removed.</p></li>
<li><p>the ALIAS parameter in a GetFeature request</p></li>
<li><p>the various RESOLVExxxx parameters</p></li>
<li><p>upgrade of the MapServer WFS client for WFS 2.0 protocol</p></li>
</ul>
</section>
<section id="documentation">
<h3>3.7 Documentation<a class="headerlink" href="#documentation" title="Link to this heading">¶</a></h3>
<p>The <a class="reference internal" href="../../ogc/wfs_server.html#wfs-server"><span class="std std-ref">WFS Server</span></a> documentation page will be updated.</p>
<p>A new page will be created for Inspire Download Services with references
to <a class="reference internal" href="../../ogc/inspire.html#inspire-view-service"><span class="std std-ref">INSPIRE View Service</span></a>.</p>
</section>
<section id="tests">
<h3>3.8 Tests<a class="headerlink" href="#tests" title="Link to this heading">¶</a></h3>
<p>15 new mapfiles, with more than 200 test request, have been added to test the
various aspects of the implementation.</p>
<p>No regression has been observed on the existing WFS 1.0 or 1.1 tests.</p>
<p>The XML output of the expected documents has been validated against the WFS or
the generated GML application schemas with the new
msautotest/pymod/xmlvalidate.py script described in
<a class="reference external" href="http://lists.osgeo.org/pipermail/mapserver-dev/2013-October/013708.html">http://lists.osgeo.org/pipermail/mapserver-dev/2013-October/013708.html</a></p>
</section>
</section>
<section id="bug-id">
<h2>4. Bug ID<a class="headerlink" href="#bug-id" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Code pull request: <a class="reference external" href="https://github.com/MapServer/MapServer/pull/4815">pull4815</a></p></li>
<li><p>msautotest pull request: <a class="reference external" href="https://github.com/MapServer/msautotest/pull/25">pull25</a></p></li>
</ul>
</section>
<section id="ocg-compliance-tests">
<h2>5. OCG compliance tests<a class="headerlink" href="#ocg-compliance-tests" title="Link to this heading">¶</a></h2>
<p>The OGC Compliance and Interoperability Testing Initiative (CITE) provides
automatic tests to validate the implementation. As of today, the tests for WFS 2.0
are in beta : <a class="reference external" href="https://cite.opengeospatial.org/teamengine/">https://cite.opengeospatial.org/teamengine/</a></p>
<p>The implementation passes all the tests for the following conformance levels (on
CITE WFS 2.0 r12 beta):
- All GML application schemas (7/7)
- GML application schemas defining features and feature collections (2/2)
- Simple WFS (22/22)
- Basic WFS  (44/44)</p>
<p>The mapfiles used on the CITE engine are <a class="reference external" href="https://github.com/rouault/msautotest/blob/wfs2/wxs/wfs_200_cite.map">wfs_200_cite.map</a> (Shapefile with OGR
connection, require GDAL &gt;= 1.10) and <a class="reference external" href="https://github.com/rouault/msautotest/blob/wfs2/wxs/wfs_200_cite_postgis.map">wfs_200_cite_postgis.map</a>.</p>
<p>Note: one of the CITE test consists in sending a REQUEST=GetCapabilities GET request
without any SERVICE. As MapServer implements different OGC services in different
versions, it is impossible to serve a response that please all specifications
together. By default, MapServer sends an HTML error that doesn’t respect WFS 2.0.
In order to get CITE compliance, consequently, one needs to define a “wfs_cite_wfs2”
WEB metadata that will return the right exception.</p>
</section>
<section id="implementation-resources">
<h2>6. Implementation resources<a class="headerlink" href="#implementation-resources" title="Link to this heading">¶</a></h2>
<p>The implementation will be done by Even Rouault with funding from <a class="reference external" href="http://www.brgm.eu/">BRGM</a>
(Bureau de Recherches Géologiques et Minières).</p>
</section>
<section id="reference-documents">
<h2>7. Reference documents<a class="headerlink" href="#reference-documents" title="Link to this heading">¶</a></h2>
<p>The following documents apply for this development:</p>
<ul class="simple">
<li><p><a class="reference external" href="http://inspire.jrc.ec.europa.eu/documents/Network_Services/Technical_Guidance_Download_Services_v3.1.pdf">INSPIRE Technical Guidance Download Services v3.1</a></p></li>
<li><p><a class="reference external" href="https://portal.ogc.org/files/?artifact_id=39967">WFS 2.0</a>: ISO 19142:2010 Geographic information – Web Feature Service, ISO 19142</p></li>
<li><p><a class="reference external" href="https://portal.ogc.org/files/?artifact_id=39968">Filter Encoding 2.0</a>: ISO 19143:2010 Geographic information – Filter encoding, ISO 19143</p></li>
<li><p><a class="reference external" href="https://portal.ogc.org/files/?artifact_id=20509">GML 3.2.1</a>: OGC 10-129r1.1 OpenGIS Geography Markup Language (GML) Encoding Standard</p></li>
<li><p><a class="reference external" href="https://portal.ogc.org/files/?artifact_id=20040">OWS 1.1.0</a>:OGC 06-121r3 OpenGIS Web Service Common Implementation Specification</p></li>
</ul>
</section>
<section id="voting-history">
<h2>8. Voting history<a class="headerlink" href="#voting-history" title="Link to this heading">¶</a></h2>
<p>TBD</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p>
<a href="../../about.html" title="About">About</a><br>
<a href="../../products.html" title="Products">Products</a><br>
<a href="../../community/index.html" title="Community">Community</a><br>
<a href="../index.html" title="Development">Development</a><br>
<a href="../../download.html" title="Downloads">Downloads</a><br>
<a href="../../documentation.html" title="Documentation">Documentation</a><br>
<a href="../../faq.html" title="FAQ">FAQ</a><br>
<a href="../../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</h3>
  <ul>
<li><a class="reference internal" href="#">MS RFC 105: Support for WFS 2.0 (server side)</a><ul>
<li><a class="reference internal" href="#overview">1. Overview</a></li>
<li><a class="reference internal" href="#changes">2. Changes</a></li>
<li><a class="reference internal" href="#summary-of-changes-in-wfs-2-0">Summary of changes in WFS 2.0</a></li>
<li><a class="reference internal" href="#getcapabilities-changes">GetCapabilities changes</a></li>
<li><a class="reference internal" href="#gml-3-2-1">GML 3.2.1</a></li>
<li><a class="reference internal" href="#filter-encoding-2-0">Filter Encoding 2.0</a></li>
<li><a class="reference internal" href="#response-paging-support">Response paging support</a></li>
<li><a class="reference internal" href="#getfeature-operation">GetFeature operation</a></li>
<li><a class="reference internal" href="#stored-queries">Stored queries</a><ul>
<li><a class="reference internal" href="#predefined-urn-ogc-def-query-ogc-wfs-getfeaturebyid-stored-query">Predefined urn:ogc:def:query:OGC-WFS::GetFeatureById stored query</a></li>
<li><a class="reference internal" href="#liststoredqueries">ListStoredQueries</a></li>
<li><a class="reference internal" href="#describestoredqueries">DescribeStoredQueries</a></li>
</ul>
</li>
<li><a class="reference internal" href="#getpropertyvalue-operation">GetPropertyValue operation</a></li>
<li><a class="reference internal" href="#sorting">Sorting</a></li>
<li><a class="reference internal" href="#kvp-and-xml-syntax">KVP and XML syntax</a></li>
<li><a class="reference internal" href="#optional-mandatory-gml-items">Optional / mandatory GML items</a></li>
<li><a class="reference internal" href="#inspire-download-services">Inspire Download Services</a><ul>
<li><a class="reference internal" href="#scenario-1-inspire-related-fields-using-referenced-external-service-metadata">Scenario 1 - INSPIRE related fields using referenced external service metadata</a></li>
<li><a class="reference internal" href="#scenario-2-inspire-related-fields-using-embedded-service-metadata">Scenario 2 - INSPIRE related fields using embedded service metadata</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mapfile-impacts">Mapfile impacts</a></li>
<li><a class="reference internal" href="#implementation-details">3. Implementation Details</a><ul>
<li><a class="reference internal" href="#files-affected">3.1 Files affected</a></li>
<li><a class="reference internal" href="#backwards-compatibility-issues">3.2 Backwards Compatibility Issues</a></li>
<li><a class="reference internal" href="#mapscript-changes">3.3 MapScript changes</a></li>
<li><a class="reference internal" href="#performance-implications">3.4 Performance implications</a></li>
<li><a class="reference internal" href="#related-bug-fixes">3.5 Related bug fixes</a></li>
<li><a class="reference internal" href="#restrictions">3.6 Restrictions</a></li>
<li><a class="reference internal" href="#documentation">3.7 Documentation</a></li>
<li><a class="reference internal" href="#tests">3.8 Tests</a></li>
</ul>
</li>
<li><a class="reference internal" href="#bug-id">4. Bug ID</a></li>
<li><a class="reference internal" href="#ocg-compliance-tests">5. OCG compliance tests</a></li>
<li><a class="reference internal" href="#implementation-resources">6. Implementation resources</a></li>
<li><a class="reference internal" href="#reference-documents">7. Reference documents</a></li>
<li><a class="reference internal" href="#voting-history">8. Voting history</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ms-rfc-106.html" title="MS RFC 106: Support of Geomtransform JavaScript Plugin"
             >next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-104.html" title="MS RFC 104: Replace BITMAP labels with embedded Truetype font"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 105: Support for WFS 2.0 (server side)</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; <a href="../../copyright.html">Copyright</a> 2023, Open Source Geospatial Foundation.
      Last updated on 2023-12-22.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.5.
    </div>
  </body>
</html>