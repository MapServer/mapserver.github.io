<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>MS RFC 54: Rendering Interface API &#8212; MapServer 8.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx.css?v=6c7b17ac" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=dd298242" />
    <link rel="stylesheet" type="text/css" href="../../_static/ribbon.css?v=ea091bf4" />
    
    <script src="../../_static/documentation_options.js?v=521b6f53"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="icon" href="../../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="MS RFC 55: Improve control of output resolution" href="ms-rfc-55.html" />
    <link rel="prev" title="MS RFC 53: Guidelines for MapScript method return values" href="ms-rfc-53.html" /> 
  </head><body>


<!-- for main branch only, do not backport this -->

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../../index.html" title="Home"><img src="../../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../../index.html" title="Home">Home</a> |
      <a href="../../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter" target="_blank">Twitter</a> |
      <a href="../../download.html" title="Download Source or Binaries">Download </a> |
      <a class="badge" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=KRJ2X44N3HA6U&source=url" target="_blank">
        <img src="https://img.shields.io/badge/donate-%E2%9D%A4%C2%A0-ff69b4.svg?style=flat" alt="Donate to MapServer">
      </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../../ar/development/rfc/ms-rfc-54.html"><img src="../../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../../de/development/rfc/ms-rfc-54.html"><img src="../../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../../el/development/rfc/ms-rfc-54.html"><img src="../../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../../es/development/rfc/ms-rfc-54.html"><img src="../../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../../fr/development/rfc/ms-rfc-54.html"><img src="../../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../../id/development/rfc/ms-rfc-54.html"><img src="../../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../../it/development/rfc/ms-rfc-54.html"><img src="../../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../../ja/development/rfc/ms-rfc-54.html"><img src="../../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../../nl_NL/development/rfc/ms-rfc-54.html"><img src="../../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../../pl/development/rfc/ms-rfc-54.html"><img src="../../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../../ru/development/rfc/ms-rfc-54.html"><img src="../../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../../sq/development/rfc/ms-rfc-54.html"><img src="../../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../../tr/development/rfc/ms-rfc-54.html"><img src="../../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ms-rfc-55.html" title="MS RFC 55: Improve control of output resolution"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-53.html" title="MS RFC 53: Guidelines for MapScript method return values"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 54: Rendering Interface API</a></li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="ms-rfc-54-rendering-interface-api">
<span id="rfc54"></span><h1>MS RFC 54: Rendering Interface API<a class="headerlink" href="#ms-rfc-54-rendering-interface-api" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Date<span class="colon">:</span></dt>
<dd class="field-odd"><p>2009/03/01</p>
</dd>
<dt class="field-even">Authors<span class="colon">:</span></dt>
<dd class="field-even"><p>Thomas Bonfort</p>
</dd>
<dt class="field-odd">Contact<span class="colon">:</span></dt>
<dd class="field-odd"><p>Thomas.Bonfort at camptocamp.com</p>
</dd>
<dt class="field-even">Status<span class="colon">:</span></dt>
<dd class="field-even"><p>Planning</p>
</dd>
<dt class="field-odd">Version<span class="colon">:</span></dt>
<dd class="field-odd"><p>MapServer 6.0</p>
</dd>
</dl>
<section id="purpose">
<h2>Purpose<a class="headerlink" href="#purpose" title="Link to this heading">¶</a></h2>
<p>This RFC proposes the refactoring of MapServer’s rendering backends, following
an approach similar to the vtable architecture used by the input drivers.</p>
<p>The motivation for this refactoring is that in the current code, each renderer
is responsible both for low-level drawing functionality (eg. strokes, fills,
symbology) and for higher level interpretation of the combination of mapfile
keywords (eg. scale-dependant size adjustments, line-folowing orientation for
symbols …). This leads to a lot of code duplication and difficult
maintenance.</p>
<p>In a first phase, a cairo (<a class="reference external" href="https://www.cairographics.org/">https://www.cairographics.org/</a>) renderer will be added
following this architecture,, and will support traditional raster formats (png,
jpeg) as well as vector formats (pdf, svg).  Support for openGL and KML
rendering backends will also be added similarly. During this phase, the new
renderers will live alongside the older ones, and the functionality of the
existing renderers should not be affected.</p>
<p>In a second phase, the existing renderers will be ported to the new
architecture. Idealy all renderers should be ported to the new architecture,
although this task might take more time and/or financing. The current PDF and
SVG renderers could be phased out and replaced by the ones natively provided by
cairo.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>While the current GD renderer could be ported to the API architecture, it
probably isn’t something we want to do as we  would be losing some
performance induced by the switching from GD’s internal pixel representation
to the generic one used by this API.</p>
</div>
</section>
<section id="low-level-rendering-api">
<h2>Low Level Rendering API<a class="headerlink" href="#low-level-rendering-api" title="Link to this heading">¶</a></h2>
<p>A new <em>renderObj</em> structure is defined and is attached to each outputformat
depending on which driver is configured. A renderObj contains function pointers
to the low-level functionality that each renderer should implement, and
configuration options which can tell the higher level calling code what is
supported or implemented by the renderer.</p>
<p>Adding a new output driver to mapserver therefore consists in two steps:</p>
<ul class="simple">
<li><p>implementing the low-level rendering functions (depending on the renderer’s
capabilities and configuration options, not all functions need be implemented)</p></li>
<li><p>creating and registering a new outputformat driver, by making the
renderObj function pointers point to the low-level functions</p></li>
</ul>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">renderer</span><span class="p">{</span>
<span class="w">    </span><span class="c1">// configuration parameters</span>

<span class="w">    </span><span class="c1">// image creation functions</span>

<span class="w">    </span><span class="c1">// raster handling functions (input and output)</span>

<span class="w">    </span><span class="c1">// image saving functions (only for the renderers that cannot export a</span>
<span class="w">    </span><span class="c1">// raster format)</span>

<span class="w">    </span><span class="c1">// low level rendering functions lines and polygons symbology vector</span>
<span class="w">    </span><span class="c1">// ellipse pixmap truetype text handling label size calculation label</span>
<span class="w">    </span><span class="c1">// rendering</span>

<span class="w">    </span><span class="c1">// support for using an image cache for symbology creation of a tile</span>
<span class="w">    </span><span class="c1">// representing a cached symbol vector ellipse ...  placement of a</span>
<span class="w">    </span><span class="c1">// cached tile at a point using a tile as a fill pattern on lines and</span>
<span class="w">    </span><span class="c1">// polygons</span>

<span class="w">    </span><span class="c1">// freeing functions (main imageObj and caches)</span>
<span class="p">}</span>
</pre></div>
</div>
<section id="configuration-parameters">
<h3>Configuration parameters<a class="headerlink" href="#configuration-parameters" title="Link to this heading">¶</a></h3>
<p>Each renderer can inform the higher level calling code of what functionality it
supports or implements. This will primarily allow us to support vector and
raster renderers. More details on each configuration parameter will be given
when appropriate in the rest of this document.</p>
</section>
<section id="image-creation-functions">
<h3>Image Creation Functions<a class="headerlink" href="#image-creation-functions" title="Link to this heading">¶</a></h3>
<p>Each renderer must provide a function to create a new image. MapServer’s
imageObj structure will have an additional void* member that will be used by
the renderer to store a structure containing any useful information it may
need.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">imageObj</span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">createImage</span><span class="p">)(</span><span class="kt">int</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">height</span><span class="p">,</span><span class="w"> </span><span class="n">outputFormatObj</span><span class="w"> </span><span class="o">*</span><span class="n">format</span><span class="p">,</span>
<span class="w">            </span><span class="n">colorObj</span><span class="o">*</span><span class="w"> </span><span class="n">bg</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Renderer specific creation options would be extracted by each renderer from the
outputFormatObj passed to it. (This would be used eg by the PDF renderer for page
layout options).</p>
</div>
</section>
<section id="raster-handling-functions">
<h3>Raster Handling Functions<a class="headerlink" href="#raster-handling-functions" title="Link to this heading">¶</a></h3>
<p>Raster handling will follow different code paths depending on whether the
underlying renderer is already natively a raster renderer (eg. PNG, JPEG) , or if
it is a vector one (eg. PDF, SVG).</p>
<section id="raster-buffer-structure">
<h4>Raster Buffer Structure<a class="headerlink" href="#raster-buffer-structure" title="Link to this heading">¶</a></h4>
<p>A new structure defining a raster object in memory is defined, and is used to
replace the current code that uses a gdImage as a common format.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="n">height</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// pointers to the start of each band in the pixel buffer</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">a</span><span class="p">,</span><span class="o">*</span><span class="n">r</span><span class="p">,</span><span class="o">*</span><span class="n">g</span><span class="p">,</span><span class="o">*</span><span class="n">b</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// step between one component and its successor (inside the same band)</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">pixel_step</span>

<span class="w">    </span><span class="c1">//step between the beginning of each row in the image</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">row_step</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// pointer to the actual pixels (should not be used by the high-level</span>
<span class="w">    </span><span class="c1">// code)</span>
<span class="w">    </span><span class="c1">// TODO: as this member is actually private, it should probably be</span>
<span class="w">    </span><span class="c1">// a void* so that any internal representation can be used</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">pixelbuffer</span><span class="p">;</span>

<span class="p">}</span><span class="w"> </span><span class="n">rasterBufferObj</span><span class="p">;</span>
</pre></div>
</div>
<p>A renderer must provide a function to initialize a rasterBuffer where the pixel
alignment and the order of the bands best fits its internal representation of a
raster array.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">initializeRasterBuffer</span><span class="p">)(</span><span class="n">rasterBufferObj</span><span class="w"> </span><span class="o">*</span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">height</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="handling-raster-layers">
<h4>Handling Raster Layers<a class="headerlink" href="#handling-raster-layers" title="Link to this heading">¶</a></h4>
<p>Depending on the renderer’s capabilities, there are two possibilities here,
that are determined by the <em>supports_pixel_buffer</em> parameter:</p>
<ul>
<li><p>if the renderer supports a pixel buffer, then the raster layer code is
given a handle to the memory buffer used by the renderer, and direclty
sets individual pixels where needed. Such a renderer will thus implement
a function to export a rasterBufferObj pointing to its internal pixel
buffer:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">getRasterBuffer</span><span class="p">)(</span><span class="n">imageObj</span><span class="w"> </span><span class="o">*</span><span class="n">img</span><span class="p">,</span><span class="n">rasterBufferObj</span><span class="w"> </span><span class="o">*</span><span class="n">rb</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>if the renderer does not use an internal representation that can be
directly filled by the raster layer code, it must provide two functions
that will allow the higher level code to merge the created raster:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">mergeRasterBuffer</span><span class="p">)(</span><span class="n">imageObj</span><span class="w"> </span><span class="o">*</span><span class="n">dest</span><span class="p">,</span><span class="w"> </span><span class="n">rasterBufferObj</span><span class="w"> </span><span class="o">*</span><span class="n">overlay</span><span class="p">,</span>
<span class="w">            </span><span class="kt">double</span><span class="w"> </span><span class="n">opacity</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">dstX</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">dstY</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</section>
</section>
<section id="image-saving-functions">
<h3>Image Saving Functions<a class="headerlink" href="#image-saving-functions" title="Link to this heading">¶</a></h3>
<p>Similarly to raster layers, there are two code paths for saving a created image
to a stream or to a buffer, depending also on the <em>supports_pixel_buffer</em>
configuration parameter:</p>
<ul>
<li><p>if the renderer supports a pixel buffer, the exported rasterBufferObj
will be treated by some new image writing code (relying on
libpng/libjpeg/libgif) This will allow each renderer to not have to
implement image saving and will allow us to treat all the formatoptions
in a single place.</p></li>
<li><p>if the renderer does not support exproting to a rasterBuffer, it should
provide a function for writing itself to a given stream:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">saveImage</span><span class="p">)(</span><span class="n">imageObj</span><span class="w"> </span><span class="o">*</span><span class="n">img</span><span class="p">,</span><span class="w"> </span><span class="kt">FILE</span><span class="w"> </span><span class="o">*</span><span class="n">fp</span><span class="p">,</span><span class="w"> </span><span class="n">outputFormatObj</span><span class="w"> </span><span class="o">*</span><span class="n">format</span><span class="p">);</span>
</pre></div>
</div>
</li>
</ul>
<p>TODO: exporting to a buffer for mapscript getBytes()</p>
</section>
<section id="low-level-functions-to-be-implemented-by-a-renderer">
<h3>Low Level Functions to be Implemented by a renderer<a class="headerlink" href="#low-level-functions-to-be-implemented-by-a-renderer" title="Link to this heading">¶</a></h3>
<section id="polygons">
<h4>Polygons<a class="headerlink" href="#polygons" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p>solid filled: The simplest case, needs only be passed a color</p></li>
<li><p>pattern filled: is passed a tile. The size of the tile (i.e. the amount of
transparent space around the actual marker inside the tile allows to tweak
the spacing between markers inside the polygon)</p></li>
<li><p>hatch fill: TBD - probably by drawing individual lines at a higher level</p></li>
</ul>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">renderPolygon</span><span class="p">)(</span><span class="n">imageObj</span><span class="w"> </span><span class="o">*</span><span class="n">img</span><span class="p">,</span><span class="w"> </span><span class="n">shapeObj</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">colorObj</span><span class="w"> </span><span class="o">*</span><span class="n">color</span><span class="p">);</span>
<span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">renderPolygonTiled</span><span class="p">)(</span><span class="n">imageObj</span><span class="w"> </span><span class="o">*</span><span class="n">img</span><span class="p">,</span><span class="w"> </span><span class="n">shapeObj</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">tile</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="lines">
<h4>Lines<a class="headerlink" href="#lines" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p>simple stroke: is passed a pattern (dashes) and line style (caps, joins)</p></li>
<li><p>pattern fill: is passed a tile</p></li>
</ul>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">renderLine</span><span class="p">)(</span><span class="n">imageObj</span><span class="w"> </span><span class="o">*</span><span class="n">img</span><span class="p">,</span><span class="w"> </span><span class="n">shapeObj</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">strokeStyleObj</span><span class="w"> </span><span class="o">*</span><span class="n">style</span><span class="p">);</span>
<span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">renderLineTiled</span><span class="p">)(</span><span class="n">imageObj</span><span class="w"> </span><span class="o">*</span><span class="n">img</span><span class="p">,</span><span class="w"> </span><span class="n">shapeObj</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">tile</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="markers">
<h4>Markers<a class="headerlink" href="#markers" title="Link to this heading">¶</a></h4>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">renderVectorSymbol</span><span class="p">)(</span><span class="n">imageObj</span><span class="w"> </span><span class="o">*</span><span class="n">img</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">y</span><span class="p">,</span>
<span class="w">            </span><span class="n">symbolObj</span><span class="w"> </span><span class="o">*</span><span class="n">symbol</span><span class="p">,</span><span class="w"> </span><span class="n">symbolStyleObj</span><span class="w"> </span><span class="o">*</span><span class="n">style</span><span class="p">);</span>

<span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">renderPixmapSymbol</span><span class="p">)(</span><span class="n">imageObj</span><span class="w"> </span><span class="o">*</span><span class="n">img</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">y</span><span class="p">,</span>
<span class="w">            </span><span class="n">symbolObj</span><span class="w"> </span><span class="o">*</span><span class="n">symbol</span><span class="p">,</span><span class="w"> </span><span class="n">symbolStyleObj</span><span class="w"> </span><span class="o">*</span><span class="n">style</span><span class="p">);</span>

<span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">renderEllipseSymbol</span><span class="p">)(</span><span class="n">imageObj</span><span class="w"> </span><span class="o">*</span><span class="n">image</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">y</span><span class="p">,</span>
<span class="w">            </span><span class="n">symbolObj</span><span class="w"> </span><span class="o">*</span><span class="n">symbol</span><span class="p">,</span><span class="w"> </span><span class="n">symbolStyleObj</span><span class="w"> </span><span class="o">*</span><span class="n">style</span><span class="p">);</span>

<span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">renderTruetypeSymbol</span><span class="p">)(</span><span class="n">imageObj</span><span class="w"> </span><span class="o">*</span><span class="n">img</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">y</span><span class="p">,</span>
<span class="w">        </span><span class="n">symbolObj</span><span class="w"> </span><span class="o">*</span><span class="n">symbol</span><span class="p">,</span><span class="w"> </span><span class="n">symbolStyleObj</span><span class="w"> </span><span class="o">*</span><span class="n">style</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">renderTile</span><span class="p">)(</span><span class="n">imageObj</span><span class="w"> </span><span class="o">*</span><span class="n">img</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">tile</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">angle</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="labels-and-text">
<h4>Labels and Text<a class="headerlink" href="#labels-and-text" title="Link to this heading">¶</a></h4>
<ul>
<li><p>label size calculation: If passed an “advances pointer”, also calculates individual
advances for each glyphs (for anlge foloow text)</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">getTruetypeTextBBox</span><span class="p">)(</span><span class="n">imageObj</span><span class="w"> </span><span class="o">*</span><span class="n">img</span><span class="p">,</span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">font</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">string</span><span class="p">,</span>
<span class="w">            </span><span class="n">rectObj</span><span class="w"> </span><span class="o">*</span><span class="n">rect</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">**</span><span class="n">advances</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>glyph rendering: no real change</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">renderGlyphs</span><span class="p">)(</span><span class="n">imageObj</span><span class="w"> </span><span class="o">*</span><span class="n">img</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">labelStyleObj</span>
<span class="w">        </span><span class="o">*</span><span class="n">style</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">text</span><span class="p">);</span>

<span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">renderGlyphsLine</span><span class="p">)(</span><span class="n">imageObj</span><span class="w"> </span><span class="o">*</span><span class="n">img</span><span class="p">,</span><span class="n">labelPathObj</span><span class="w"> </span><span class="o">*</span><span class="n">labelpath</span><span class="p">,</span>
<span class="w">        </span><span class="n">labelStyleObj</span><span class="w"> </span><span class="o">*</span><span class="n">style</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">text</span><span class="p">);</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="tiles-and-caches">
<h4>Tiles and Caches<a class="headerlink" href="#tiles-and-caches" title="Link to this heading">¶</a></h4>
<p>For some symbols and renderer combinations, it might be benficial to use a cache so
as not to have to render a complicated symbol over and over again. This behavior would
probably have to be deactivated when using attribute binding (on size, angle, color…)
as there would be too many cache misses and no real gain.</p>
<p>TBD: use a renderer specific format for a tile (passed back as a void*), or would
a simple imageObj created by normally by the renderer suffice ? Second solution is much
simpler as we’d use the same functions for rendering a symbol than for rendering a tile.
First solution is more flexible, as the renderer can cache anything.</p>
</section>
<section id="miscellaneous-functions">
<h4>Miscellaneous functions<a class="headerlink" href="#miscellaneous-functions" title="Link to this heading">¶</a></h4>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">transformShape</span><span class="p">)(</span><span class="n">shapeObj</span><span class="w"> </span><span class="o">*</span><span class="n">shape</span><span class="p">,</span><span class="w"> </span><span class="n">rectObj</span><span class="w"> </span><span class="n">extend</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">cellsize</span><span class="p">);</span>
</pre></div>
</div>
<p>These functions might be needed by some renderers. TBD</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">startNewLayer</span><span class="p">)(</span><span class="n">imageObj</span><span class="w"> </span><span class="o">*</span><span class="n">img</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">opacity</span><span class="p">);</span>
<span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">closeNewLayer</span><span class="p">)(</span><span class="n">imageObj</span><span class="w"> </span><span class="o">*</span><span class="n">img</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">opacity</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="cleanup-functions">
<h4>Cleanup functions<a class="headerlink" href="#cleanup-functions" title="Link to this heading">¶</a></h4>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">freeImage</span><span class="p">)(</span><span class="n">imageObj</span><span class="w"> </span><span class="o">*</span><span class="n">image</span><span class="p">);</span>
<span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">freeSymbol</span><span class="p">)(</span><span class="n">symbolObj</span><span class="w"> </span><span class="o">*</span><span class="n">symbol</span><span class="p">);</span>
<span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">freeShape</span><span class="p">)(</span><span class="n">shapeObj</span><span class="w"> </span><span class="o">*</span><span class="n">shape</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The freeSymbol and freeShape functions are added here as we will be adding a void*
pointer to the symbolObj and shapeObj objects where a renderer can store a private
cache containing an implementation specific representation of the object.</p>
</div>
</section>
</section>
</section>
<section id="high-level-usage-of-the-rendering-api">
<h2>High Level Usage of the rendering API<a class="headerlink" href="#high-level-usage-of-the-rendering-api" title="Link to this heading">¶</a></h2>
<section id="image-creation">
<h3>Image Creation<a class="headerlink" href="#image-creation" title="Link to this heading">¶</a></h3>
<p>nothing special. just pass on to the renderer.</p>
</section>
<section id="image-saving">
<h3>Image Saving<a class="headerlink" href="#image-saving" title="Link to this heading">¶</a></h3>
<p>Depending on whether the renderer can export a raster buffer or not:</p>
<ul class="simple">
<li><p>supported: get a raster buffer, eventually apply formatoptions (quantization)
and pass the buffer to the MapServer’s saving functions</p></li>
<li><p>unsupported: call the renderer’s saving function</p></li>
</ul>
</section>
<section id="raster-layers">
<h3>Raster Layers<a class="headerlink" href="#raster-layers" title="Link to this heading">¶</a></h3>
<p>MapServer’s Raster layer handling will be modified so that it can write to a
rasterBufferObj and not only to a gdImage.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>TODO (FrankW) add some detail here about the changes induced here</p>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="p">(</span><span class="n">renderer</span><span class="o">-&gt;</span><span class="n">supports_pixel_buffer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">rasterBufferObj</span><span class="w"> </span><span class="n">buffer</span><span class="p">;</span>
<span class="w">    </span><span class="n">renderer</span><span class="o">-&gt;</span><span class="n">getRasterBuffer</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="o">&amp;</span><span class="n">buffer</span><span class="p">);</span>
<span class="w">    </span><span class="n">msDrawRasterLayer</span><span class="p">(</span><span class="n">map</span><span class="p">,</span><span class="n">layer</span><span class="p">,</span><span class="o">&amp;</span><span class="n">buffer</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">rasterBufferObj</span><span class="w"> </span><span class="n">buffer</span><span class="p">;</span>
<span class="w">    </span><span class="n">renderer</span><span class="o">-&gt;</span><span class="n">initializeRasterBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">buffer</span><span class="p">,</span><span class="n">width</span><span class="p">,</span><span class="n">height</span><span class="p">);</span>
<span class="w">    </span><span class="n">msDrawRasterLayer</span><span class="p">(</span><span class="n">map</span><span class="p">,</span><span class="n">layer</span><span class="p">,</span><span class="o">&amp;</span><span class="n">buffer</span><span class="p">);</span>
<span class="w">    </span><span class="n">renderer</span><span class="o">-&gt;</span><span class="n">mergeRasterBuffer</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="o">&amp;</span><span class="n">buffer</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="n">renderer</span><span class="o">-&gt;</span><span class="n">freeRasterBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">buffer</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="symbol-cache-and-marker-rendering">
<h3>Symbol Cache and Marker Rendering<a class="headerlink" href="#symbol-cache-and-marker-rendering" title="Link to this heading">¶</a></h3>
<p>A symbol cache similar to the actual mapgd.c imagecache will be implemented in
mapimagecache.c .</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As pointed out earlier, it is yet to be decided if the cache will store
plain imageOjbs or if we allow renderers to store a specific structure.
This could also be a configuration option, with each renderer specifying if
it can treat it’s own created imageObj as a cache, or if it needs a void*
cache. This would keep the code simple for most renderers, while allowing
more flexibility for others (the openGL renderer will probably be needing
this)</p>
</div>
<p>The use of an image cache would be configurable by each renderer via the
supports_imagecache configuration option, as its use isn’t necessarily useful
depending on the format.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="p">(</span><span class="n">renderer</span><span class="o">-&gt;</span><span class="n">supports_imagecache</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// this function looks in the global image cache if it finds a tile</span>
<span class="w">    </span><span class="c1">// corresponding to the current symbol and styling and returns it. If</span>
<span class="w">    </span><span class="c1">// it wasn&#39;t found, it calls the renderer functions to create a new</span>
<span class="w">    </span><span class="c1">// cache tile and adds it to the global cache.</span>
<span class="w">    </span><span class="n">imageObj</span><span class="w"> </span><span class="o">*</span><span class="n">tile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getTile</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="w"> </span><span class="n">symbol</span><span class="p">,</span><span class="w"> </span><span class="n">symbolstyle</span><span class="p">);</span>
<span class="w">    </span><span class="n">renderer</span><span class="o">-&gt;</span><span class="n">renderTile</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="w"> </span><span class="n">tile</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">switch</span><span class="p">(</span><span class="n">symbol</span><span class="o">-&gt;</span><span class="n">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">VECTOR</span><span class="p">:</span>
<span class="w">            </span><span class="n">renderer</span><span class="o">-&gt;</span><span class="n">renderVectorSymbol</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="p">...);</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">ELLIPSE</span><span class="p">:</span>
<span class="w">            </span><span class="cm">/* ... */</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="line-rendering">
<h3>Line Rendering<a class="headerlink" href="#line-rendering" title="Link to this heading">¶</a></h3>
<ul>
<li><p>simple stroke: call the renderer directly</p></li>
<li><p>marker symbols:</p>
<blockquote>
<div><ul class="simple">
<li><p>compute positions and orientations along the geometry</p></li>
<li><p>render a marker symbol with the renderer’s marker functions for each of
these positions. It probably isn’t a good idea to use a tile cache if the
symbols have to follow line orientation, as rotating a cached tile will
produce poor results.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>pattern:</p>
<blockquote>
<div><ul class="simple">
<li><p>create the pattern’s tile (with the renderer’s marker functions)</p></li>
<li><p>pass the tile to the renderer</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
<section id="polygon-rendering">
<h3>Polygon Rendering<a class="headerlink" href="#polygon-rendering" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>simple fill</p></li>
<li><p>pattern fill:</p>
<ul>
<li><p>create the pattern tile</p></li>
<li><p>eventually cache the tile for future use on another geometry</p></li>
<li><p>pass the tile to the renderer</p></li>
</ul>
</li>
<li><p>hatch fill:
- compute the lines corresponding to the hatch
- use the renderer’s simple stroking function</p></li>
</ul>
</section>
<section id="text-rendering">
<h3>Text Rendering<a class="headerlink" href="#text-rendering" title="Link to this heading">¶</a></h3>
<p>Nothing special to add here, except that the basic preliminary tests (if the
font is defined, or if the string to render is NULL) and the lookup of the
system path of the truetype font file will be done once by the high level code
before calling the renderer drawing function.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Raster fonts will not be supported (at least in a first phase) by this
rendering API. Only truetype fonts are implemented.</p>
</div>
</section>
</section>
<section id="image-i-o">
<h2>Image I/O<a class="headerlink" href="#image-i-o" title="Link to this heading">¶</a></h2>
<p>Currently all image I/O is done through the GD library. To raise this dependency,
the RFC proposes to have mapserver implement image loading and saving by directly
interfacing the libpng / libjpeg / giflib libraries. The corresponding code will
be added to a new file “mapimageio.c”, and will produce or read rasterBufferObj’s.</p>
<p>These functions will implement the formatoptions that are currently supported.
Adding new formatoptions would be done by adding the code to these i/o functions,
and would thus add the support for all the renderers that use this rendering API
architecture:</p>
<ul class="simple">
<li><p>jpeg:</p>
<ul>
<li><p>quality: 0 - 100</p></li>
</ul>
</li>
<li><p>png:</p>
<ul>
<li><p>interlacing: will be set to OFF by default, as the creation is costlier,
produces heavier images, and is incompatible with TileCache’s
metatiling functionality.</p></li>
<li><p>compression: could be added to select the quality of zlib compression</p></li>
<li><p>quantization: produce palette-based pngs from rgb or rgba imagemodes.</p></li>
<li><p>palette: produce palette-based pngs given a precomputed palette. Further
enhancements could include automatically producing a palette by looping
through the input mapfile to extract the colors and ensure they end up
in the final image (this would only be supported for RGB, not RGBA)</p></li>
</ul>
</li>
<li><p>gif: TBD</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The initial implementation of this RFC will not include support for writing
GIF images.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The initial implementation of this RFC will not include image loading functions
by direct usage of the libjpeg/libpng/giflib libraries. It will instead fallback
to GD loading and convert the created gdImage to a rasterBuffer. This can be added
in a second phase as it is lower priority, and does not induce a major architectural
change.</p>
</div>
</section>
<section id="miscellaneous">
<h2>Miscellaneous<a class="headerlink" href="#miscellaneous" title="Link to this heading">¶</a></h2>
<section id="drawing-some-layers-as-rasters-in-vector-renderers">
<h3>Drawing some layers as rasters in vector renderers<a class="headerlink" href="#drawing-some-layers-as-rasters-in-vector-renderers" title="Link to this heading">¶</a></h3>
<p>The current pdf (and SVG?) renderers have the option of switching over to GD for
some layers, that are then incorporated as a raster image in the final map rather
than adding each feature in the usual way.</p>
<p>This functionality could probably be kept with this API with the mergeRasterBuffer
function.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A renderer using this functionality will have to take care as the rasterBuffer
that it will be passed will be in the native format of the delegated renderer,
and may not be in the exact same format it would have created with a call to
initializeRasterBuffer.</p>
</div>
</section>
<section id="legend">
<h3>Legend<a class="headerlink" href="#legend" title="Link to this heading">¶</a></h3>
<p>The legend rendering code will have to be refactored, as it currently produces a
gdImage. Legend rendering will be handled like a normal imageObj.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>TODO: “embed” mode is problematic.</p>
<p>If postlabelcache is on, then the created
imageObj can easily be added to the main image using the renderTile function
(for the renderers that support it. the others will probably have noe embedded
legend support)</p>
<p>If postlabelcache is off we have a problem, as the created legend is passed as
a pixmap symbol to the main map rendering. This is incompatible with the vector
renderers, as the imageObj they have created isn’t an array of pixels.</p>
</div>
</section>
<section id="scalebar">
<h3>Scalebar<a class="headerlink" href="#scalebar" title="Link to this heading">¶</a></h3>
<p>TBD</p>
</section>
<section id="reference-map">
<h3>Reference Map<a class="headerlink" href="#reference-map" title="Link to this heading">¶</a></h3>
<p>TBD. Should we even still be supporting this ?</p>
</section>
</section>
<section id="affected-files">
<h2>Affected Files<a class="headerlink" href="#affected-files" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>maprendering.c , mapimageio.c, mapcairo.c (added)</p></li>
<li><p>mapfile.c (defaults, and keywords moved from symbolObj to styleObj)</p></li>
<li><p>mapoutput.c (renderObj creation)</p></li>
<li><p>mapdraw.c (msDrawXXX functions moved to maprendering.c)</p></li>
<li><p>mapserver.h</p></li>
<li><p>…. lots more</p></li>
</ul>
</section>
<section id="documentation">
<h2>Documentation<a class="headerlink" href="#documentation" title="Link to this heading">¶</a></h2>
<p>No end documentation needed aside from the migration guide.</p>
</section>
<section id="mapscript">
<h2>Mapscript<a class="headerlink" href="#mapscript" title="Link to this heading">¶</a></h2>
<p>TBD</p>
</section>
<section id="backwards-incompatibility">
<h2>Backwards Incompatibility<a class="headerlink" href="#backwards-incompatibility" title="Link to this heading">¶</a></h2>
<p>Symbology should be better behaved between renderers, but does imply some backwards
incompatible changes in how some symbols can be rendered (although this can probably
seen as fixing bugs rather than backwards incompatibilities)</p>
<ul class="simple">
<li><p>reverse orientation of rotation for vector symbols. currently vector symbols are
rotated in the opposite direction of the other symbols.</p></li>
<li><p>for line geometries , the given pattern (dashes…) will be scaled by the actual width
of the line. A dotted line will therefore be defined as PATTERN 1 1 END whatever the
width of the line.</p></li>
<li><p>More to come ?</p></li>
</ul>
</section>
<section id="comments-from-review-period">
<h2>Comments from Review period<a class="headerlink" href="#comments-from-review-period" title="Link to this heading">¶</a></h2>
</section>
<section id="voting-history">
<h2>Voting History<a class="headerlink" href="#voting-history" title="Link to this heading">¶</a></h2>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p>
<a href="../../about.html" title="About">About</a><br>
<a href="../../products.html" title="Products">Products</a><br>
<a href="../../community/index.html" title="Community">Community</a><br>
<a href="../index.html" title="Development">Development</a><br>
<a href="../../download.html" title="Downloads">Downloads</a><br>
<a href="../../documentation.html" title="Documentation">Documentation</a><br>
<a href="../../faq.html" title="FAQ">FAQ</a><br>
<a href="../../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</h3>
  <ul>
<li><a class="reference internal" href="#">MS RFC 54: Rendering Interface API</a><ul>
<li><a class="reference internal" href="#purpose">Purpose</a></li>
<li><a class="reference internal" href="#low-level-rendering-api">Low Level Rendering API</a><ul>
<li><a class="reference internal" href="#configuration-parameters">Configuration parameters</a></li>
<li><a class="reference internal" href="#image-creation-functions">Image Creation Functions</a></li>
<li><a class="reference internal" href="#raster-handling-functions">Raster Handling Functions</a><ul>
<li><a class="reference internal" href="#raster-buffer-structure">Raster Buffer Structure</a></li>
<li><a class="reference internal" href="#handling-raster-layers">Handling Raster Layers</a></li>
</ul>
</li>
<li><a class="reference internal" href="#image-saving-functions">Image Saving Functions</a></li>
<li><a class="reference internal" href="#low-level-functions-to-be-implemented-by-a-renderer">Low Level Functions to be Implemented by a renderer</a><ul>
<li><a class="reference internal" href="#polygons">Polygons</a></li>
<li><a class="reference internal" href="#lines">Lines</a></li>
<li><a class="reference internal" href="#markers">Markers</a></li>
<li><a class="reference internal" href="#labels-and-text">Labels and Text</a></li>
<li><a class="reference internal" href="#tiles-and-caches">Tiles and Caches</a></li>
<li><a class="reference internal" href="#miscellaneous-functions">Miscellaneous functions</a></li>
<li><a class="reference internal" href="#cleanup-functions">Cleanup functions</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#high-level-usage-of-the-rendering-api">High Level Usage of the rendering API</a><ul>
<li><a class="reference internal" href="#image-creation">Image Creation</a></li>
<li><a class="reference internal" href="#image-saving">Image Saving</a></li>
<li><a class="reference internal" href="#raster-layers">Raster Layers</a></li>
<li><a class="reference internal" href="#symbol-cache-and-marker-rendering">Symbol Cache and Marker Rendering</a></li>
<li><a class="reference internal" href="#line-rendering">Line Rendering</a></li>
<li><a class="reference internal" href="#polygon-rendering">Polygon Rendering</a></li>
<li><a class="reference internal" href="#text-rendering">Text Rendering</a></li>
</ul>
</li>
<li><a class="reference internal" href="#image-i-o">Image I/O</a></li>
<li><a class="reference internal" href="#miscellaneous">Miscellaneous</a><ul>
<li><a class="reference internal" href="#drawing-some-layers-as-rasters-in-vector-renderers">Drawing some layers as rasters in vector renderers</a></li>
<li><a class="reference internal" href="#legend">Legend</a></li>
<li><a class="reference internal" href="#scalebar">Scalebar</a></li>
<li><a class="reference internal" href="#reference-map">Reference Map</a></li>
</ul>
</li>
<li><a class="reference internal" href="#affected-files">Affected Files</a></li>
<li><a class="reference internal" href="#documentation">Documentation</a></li>
<li><a class="reference internal" href="#mapscript">Mapscript</a></li>
<li><a class="reference internal" href="#backwards-incompatibility">Backwards Incompatibility</a></li>
<li><a class="reference internal" href="#comments-from-review-period">Comments from Review period</a></li>
<li><a class="reference internal" href="#voting-history">Voting History</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ms-rfc-55.html" title="MS RFC 55: Improve control of output resolution"
             >next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-53.html" title="MS RFC 53: Guidelines for MapScript method return values"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 54: Rendering Interface API</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; <a href="../../copyright.html">Copyright</a> 2023, Open Source Geospatial Foundation.
      Last updated on 2023-12-22.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.5.
    </div>
  </body>
</html>