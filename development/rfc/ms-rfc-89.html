<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>MS RFC 89: Layer Geomtransforms &#8212; MapServer 8.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx.css?v=6c7b17ac" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=dd298242" />
    <link rel="stylesheet" type="text/css" href="../../_static/ribbon.css?v=ea091bf4" />
    
    <script src="../../_static/documentation_options.js?v=521b6f53"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="icon" href="../../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="MS RFC 90: Enable/Disable Layers in OGC Web Services by IP Lists" href="ms-rfc-90.html" />
    <link rel="prev" title="MS RFC 88: Saving MapServer Objects to Strings" href="ms-rfc-88.html" /> 
  </head><body>


<!-- for main branch only, do not backport this -->

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../../index.html" title="Home"><img src="../../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../../index.html" title="Home">Home</a> |
      <a href="../../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter" target="_blank">Twitter</a> |
      <a href="../../download.html" title="Download Source or Binaries">Download </a> |
      <a class="badge" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=KRJ2X44N3HA6U&source=url" target="_blank">
        <img src="https://img.shields.io/badge/donate-%E2%9D%A4%C2%A0-ff69b4.svg?style=flat" alt="Donate to MapServer">
      </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../../ar/development/rfc/ms-rfc-89.html"><img src="../../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../../de/development/rfc/ms-rfc-89.html"><img src="../../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../../el/development/rfc/ms-rfc-89.html"><img src="../../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../../es/development/rfc/ms-rfc-89.html"><img src="../../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../../fr/development/rfc/ms-rfc-89.html"><img src="../../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../../id/development/rfc/ms-rfc-89.html"><img src="../../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../../it/development/rfc/ms-rfc-89.html"><img src="../../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../../ja/development/rfc/ms-rfc-89.html"><img src="../../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../../nl_NL/development/rfc/ms-rfc-89.html"><img src="../../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../../pl/development/rfc/ms-rfc-89.html"><img src="../../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../../ru/development/rfc/ms-rfc-89.html"><img src="../../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../../sq/development/rfc/ms-rfc-89.html"><img src="../../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../../tr/development/rfc/ms-rfc-89.html"><img src="../../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ms-rfc-90.html" title="MS RFC 90: Enable/Disable Layers in OGC Web Services by IP Lists"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-88.html" title="MS RFC 88: Saving MapServer Objects to Strings"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 89: Layer Geomtransforms</a></li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="ms-rfc-89-layer-geomtransforms">
<span id="rfc89"></span><h1>MS RFC 89: Layer Geomtransforms<a class="headerlink" href="#ms-rfc-89-layer-geomtransforms" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Date<span class="colon">:</span></dt>
<dd class="field-odd"><p>2013/02/05</p>
</dd>
<dt class="field-even">Author<span class="colon">:</span></dt>
<dd class="field-even"><p>Alan Boudreault</p>
</dd>
<dt class="field-odd">Contact<span class="colon">:</span></dt>
<dd class="field-odd"><p>aboudreault at mapgears.com</p>
</dd>
<dt class="field-even">Status<span class="colon">:</span></dt>
<dd class="field-even"><p>Adopted and Implemented</p>
</dd>
<dt class="field-odd">Version<span class="colon">:</span></dt>
<dd class="field-odd"><p>MapServer 6.4</p>
</dd>
</dl>
<section id="overview">
<h2>1. Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p>MapServer 6.0 introduced the concept of geometry expressions within a styleObj-geomtransform. For
example, one could write:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">STYLE</span>
  <span class="n">GEOMTRANSFORM</span> <span class="p">(</span><span class="n">buffer</span><span class="p">([</span><span class="n">shape</span><span class="p">],</span> <span class="o">-</span><span class="mi">5</span><span class="p">)</span>
  <span class="o">...</span>
<span class="n">END</span>
</pre></div>
</div>
<p>This would cause a buffer operation to be run on the shape before being rendered
with a given style. However, if we want to work with the transformed shape and
apply multiple styles, the performance of the rendering will be signicantly
affected since the geom transform have to be done on each style. There are some
other cases a layer geom transform would be useful. In example, if we want to
simplify our lines.</p>
<p>This is a proposal to add a the ability to set a geomtransform at the layer
level. For more information about the geomtransform implemented for the style
object: see <a class="reference external" href="https://mapserver.org/development/rfc/ms-rfc-48.html">https://mapserver.org/development/rfc/ms-rfc-48.html</a>.</p>
</section>
<section id="the-proposed-solution">
<h2>2. The proposed solution<a class="headerlink" href="#the-proposed-solution" title="Link to this heading">¶</a></h2>
<p>This RFC proposes the addition of a new layer option: GEOMTRANSFORM. The
functionality is mostly the same than the the style geomtransform, except that
not <em>all</em> the parameters will be implemented. Unless we really see a need for
the following transformations at the layer level, they <em>won’t</em> be implemented:
bbox, start, end, vertices. All other parameters will be accepted (EXPRESSIONS).</p>
<p>To set a geomtransform to a layer, you just need to add this option in the mapfile:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LAYER</span> <span class="n">NAME</span> <span class="s2">&quot;my_layer&quot;</span>
  <span class="n">TYPE</span> <span class="n">LINE</span>
  <span class="n">STATUS</span> <span class="n">DEFAULT</span>
  <span class="n">DATA</span> <span class="s2">&quot;lines.shp&quot;</span>
  <span class="n">GEOMTRANSFORM</span> <span class="p">(</span><span class="n">simplify</span><span class="p">([</span><span class="n">shape</span><span class="p">],</span> <span class="mi">10</span><span class="p">))</span>
  <span class="n">CLASS</span>
    <span class="n">STYLE</span>
      <span class="n">WIDTH</span> <span class="mi">2</span>
      <span class="n">COLOR</span> <span class="mi">255</span> <span class="mi">0</span> <span class="mi">0</span>
    <span class="n">END</span>
  <span class="n">END</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note that the layer geomtransform and the style geomtransform are
completely independent. Both can be used in your layer/class
definitions and they will be applied properly.</p>
</div>
</section>
<section id="implementation-details">
<h2>2.1 Implementation Details<a class="headerlink" href="#implementation-details" title="Link to this heading">¶</a></h2>
<p>Layer geomtransform would support all query requests. The logic of the
geomtransform will be done in msLayerNextShape() and msLayerGetShape()
functions. This would allow a user to interact with transformed
features. ie. mapscript, WFS.</p>
</section>
<section id="unit-coordinates">
<h2>2.2 Unit Coordinates<a class="headerlink" href="#unit-coordinates" title="Link to this heading">¶</a></h2>
<p>There is a particularity between STYLE and LAYER GEOMTRANSFORM. STYLE-level
GEOMTRANSFORM receives a shape in pixel coordinates, whereas the LAYER-level
GEOMTRANSFORM will receive the raw shape in ground coordinates (meters, degrees,
etc.). The argument to methods such as simplify() must be in the same units as
the coordinates of the shapes at that point of the rendering workflow,
i.e. pixels at the STYLE-level and in ground units at the LAYER-level.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LAYER</span> <span class="n">NAME</span> <span class="s2">&quot;my_layer&quot;</span>
  <span class="n">TYPE</span> <span class="n">LINE</span>
  <span class="n">STATUS</span> <span class="n">DEFAULT</span>
  <span class="n">DATA</span> <span class="s2">&quot;lines.shp&quot;</span>
  <span class="n">GEOMTRANSFORM</span> <span class="p">(</span><span class="n">simplify</span><span class="p">([</span><span class="n">shape</span><span class="p">],</span> <span class="mi">10</span><span class="p">))</span>  <span class="c1">## 10 ground units</span>
  <span class="n">CLASS</span>
    <span class="n">STYLE</span>
      <span class="n">GEOMTRANSFORM</span> <span class="p">(</span><span class="n">buffer</span><span class="p">([</span><span class="n">shape</span><span class="p">],</span> <span class="mi">5</span><span class="p">)</span>  <span class="c1">## 5 pixels</span>
      <span class="n">WIDTH</span> <span class="mi">2</span>
      <span class="n">COLOR</span> <span class="mi">255</span> <span class="mi">0</span> <span class="mi">0</span>
    <span class="n">END</span>
  <span class="n">END</span>
<span class="n">END</span>
</pre></div>
</div>
<p>It is also not possible at all to deal with values in ground units at the style
level because we do not have information about map cellsize at that level in the
code</p>
</section>
<section id="pixel-value-at-layer-level">
<h2>2.3 Pixel value at Layer level<a class="headerlink" href="#pixel-value-at-layer-level" title="Link to this heading">¶</a></h2>
<p>In cases where we want to pass a pixel value at the layer level, a
[map_cellsize] variable will be available.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LAYER</span> <span class="n">NAME</span> <span class="s2">&quot;my_layer&quot;</span>
  <span class="n">TYPE</span> <span class="n">LINE</span>
  <span class="n">STATUS</span> <span class="n">DEFAULT</span>
  <span class="n">DATA</span> <span class="s2">&quot;lines.shp&quot;</span>
  <span class="c1"># 10 * [map_cellsize] == 10 pixels converted to ground units</span>
  <span class="n">GEOMTRANSFORM</span> <span class="p">(</span><span class="n">simplify</span><span class="p">([</span><span class="n">shape</span><span class="p">],</span> <span class="p">[</span><span class="n">map_cellsize</span><span class="p">]</span><span class="o">*</span><span class="mi">10</span><span class="p">))</span>
<span class="o">...</span>
</pre></div>
</div>
<p>To get this variable working in the math expression parser, the [map_cellsize]
has to be converted into the layer ground unit. If you choose to use [map_cellsize]
in your GEOMTRANSFORM expression, you must explicitly set the UNITS option in
the layer.</p>
</section>
<section id="vector-formats-supported">
<h2>2.4 Vector formats supported<a class="headerlink" href="#vector-formats-supported" title="Link to this heading">¶</a></h2>
<p>All vector formats will be supported. This also include all formats of OGR
(CONNECTIONTYPE OGR).</p>
</section>
<section id="new-geomtransform-parameters">
<h2>3. New Geomtransform Parameters<a class="headerlink" href="#new-geomtransform-parameters" title="Link to this heading">¶</a></h2>
<p>3 new parameters will be added as a geomtransform parameter:</p>
<ul class="simple">
<li><p>simplify: Simplify using GEOS. More info: <a class="reference external" href="http://geos.refractions.net/ro/doxygen_docs/html/classgeos_1_1simplify_1_1DouglasPeuckerLineSimplifier.html">GEOS Simplify</a></p></li>
<li><p>simplifypt: SimplifyPreserveTopology using GEOS. More info: <a class="reference external" href="http://geos.refractions.net/ro/doxygen_docs/html/classgeos_1_1simplify_1_1TopologyPreservingSimplifier.html">GEOS SimplifyPreserveTopology</a></p></li>
<li><p>generalize: Custom implementation of the following algorithm: <a class="reference external" href="http://trac.osgeo.org/gdal/ticket/966">http://trac.osgeo.org/gdal/ticket/966</a></p></li>
</ul>
<p>Those parameters will be available through the style geomtransform as
well. Here is an example of the simplifypt geomtransform (the blue line is the
original shape and the red one the transformed shape):</p>
<blockquote>
<div><img alt="../../_images/simplifypt.png" src="../../_images/simplifypt.png" />
</div></blockquote>
</section>
<section id="mapscript">
<h2>4. MapScript<a class="headerlink" href="#mapscript" title="Link to this heading">¶</a></h2>
<p>The ability to get/set the layer-level geomtransform will be added to
mapscript. The geomtransform is handled internally and does not affect anything
else.</p>
</section>
<section id="backwards-compatibility-issues">
<h2>5. Backwards Compatibility Issues<a class="headerlink" href="#backwards-compatibility-issues" title="Link to this heading">¶</a></h2>
<p>This change provides a new functionality with no backwards
compatibility issues being considered.</p>
</section>
<section id="tests">
<h2>6. Tests<a class="headerlink" href="#tests" title="Link to this heading">¶</a></h2>
<p>msautotest will be modified to add some tests of this new functionality.</p>
</section>
<section id="bug-id">
<h2>7. Bug ID<a class="headerlink" href="#bug-id" title="Link to this heading">¶</a></h2>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference external" href="https://github.com/MapServer/MapServer/issues/4592">https://github.com/MapServer/MapServer/issues/4592</a></p></li>
</ul>
</div></blockquote>
</section>
<section id="voting-history">
<h2>8. Voting history<a class="headerlink" href="#voting-history" title="Link to this heading">¶</a></h2>
<p>+1 from Jeff, Olivier, Stephen, Michael, Umberto and Steve.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p>
<a href="../../about.html" title="About">About</a><br>
<a href="../../products.html" title="Products">Products</a><br>
<a href="../../community/index.html" title="Community">Community</a><br>
<a href="../index.html" title="Development">Development</a><br>
<a href="../../download.html" title="Downloads">Downloads</a><br>
<a href="../../documentation.html" title="Documentation">Documentation</a><br>
<a href="../../faq.html" title="FAQ">FAQ</a><br>
<a href="../../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</h3>
  <ul>
<li><a class="reference internal" href="#">MS RFC 89: Layer Geomtransforms</a><ul>
<li><a class="reference internal" href="#overview">1. Overview</a></li>
<li><a class="reference internal" href="#the-proposed-solution">2. The proposed solution</a></li>
<li><a class="reference internal" href="#implementation-details">2.1 Implementation Details</a></li>
<li><a class="reference internal" href="#unit-coordinates">2.2 Unit Coordinates</a></li>
<li><a class="reference internal" href="#pixel-value-at-layer-level">2.3 Pixel value at Layer level</a></li>
<li><a class="reference internal" href="#vector-formats-supported">2.4 Vector formats supported</a></li>
<li><a class="reference internal" href="#new-geomtransform-parameters">3. New Geomtransform Parameters</a></li>
<li><a class="reference internal" href="#mapscript">4. MapScript</a></li>
<li><a class="reference internal" href="#backwards-compatibility-issues">5. Backwards Compatibility Issues</a></li>
<li><a class="reference internal" href="#tests">6. Tests</a></li>
<li><a class="reference internal" href="#bug-id">7. Bug ID</a></li>
<li><a class="reference internal" href="#voting-history">8. Voting history</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ms-rfc-90.html" title="MS RFC 90: Enable/Disable Layers in OGC Web Services by IP Lists"
             >next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-88.html" title="MS RFC 88: Saving MapServer Objects to Strings"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 89: Layer Geomtransforms</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; <a href="../../copyright.html">Copyright</a> 2023, Open Source Geospatial Foundation.
      Last updated on 2023-12-22.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.5.
    </div>
  </body>
</html>