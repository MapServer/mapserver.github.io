<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>MS RFC 12: C code Unit tests &#8212; MapServer 8.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx.css?v=6c7b17ac" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=dd298242" />
    <link rel="stylesheet" type="text/css" href="../../_static/ribbon.css?v=ea091bf4" />
    
    <script src="../../_static/documentation_options.js?v=521b6f53"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="icon" href="../../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="MS RFC 13: Support of Sensor Observation Service in MapServer" href="ms-rfc-13.html" />
    <link rel="prev" title="MS RFC 11: Support for Curved Labels" href="ms-rfc-11.html" /> 
  </head><body>


<!-- for main branch only, do not backport this -->

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../../index.html" title="Home"><img src="../../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../../index.html" title="Home">Home</a> |
      <a href="../../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter" target="_blank">Twitter</a> |
      <a href="../../download.html" title="Download Source or Binaries">Download </a> |
      <a class="badge" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=KRJ2X44N3HA6U&source=url" target="_blank">
        <img src="https://img.shields.io/badge/donate-%E2%9D%A4%C2%A0-ff69b4.svg?style=flat" alt="Donate to MapServer">
      </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../../ar/development/rfc/ms-rfc-12.html"><img src="../../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../../de/development/rfc/ms-rfc-12.html"><img src="../../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../../el/development/rfc/ms-rfc-12.html"><img src="../../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../../es/development/rfc/ms-rfc-12.html"><img src="../../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../../fr/development/rfc/ms-rfc-12.html"><img src="../../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../../id/development/rfc/ms-rfc-12.html"><img src="../../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../../it/development/rfc/ms-rfc-12.html"><img src="../../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../../ja/development/rfc/ms-rfc-12.html"><img src="../../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../../nl_NL/development/rfc/ms-rfc-12.html"><img src="../../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../../pl/development/rfc/ms-rfc-12.html"><img src="../../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../../ru/development/rfc/ms-rfc-12.html"><img src="../../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../../sq/development/rfc/ms-rfc-12.html"><img src="../../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../../tr/development/rfc/ms-rfc-12.html"><img src="../../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ms-rfc-13.html" title="MS RFC 13: Support of Sensor Observation Service in MapServer"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-11.html" title="MS RFC 11: Support for Curved Labels"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 12: C code Unit tests</a></li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="ms-rfc-12-c-code-unit-tests">
<span id="rfc12"></span><h1>MS RFC 12: C code Unit tests<a class="headerlink" href="#ms-rfc-12-c-code-unit-tests" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Date<span class="colon">:</span></dt>
<dd class="field-odd"><p>2006/02/28</p>
</dd>
<dt class="field-even">Author<span class="colon">:</span></dt>
<dd class="field-even"><p>Umberto Nicoletti</p>
</dd>
<dt class="field-odd">Contact<span class="colon">:</span></dt>
<dd class="field-odd"><p>umberto.nicoletti at gmail.com</p>
</dd>
<dt class="field-even">Status<span class="colon">:</span></dt>
<dd class="field-even"><p>Draft</p>
</dd>
</dl>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p>Unit tests are a simple but effective way of checking progress
and code correctness while programming. MapServer  already has unit tests
for python MapScript and a functional testing suite but lacks
unit tests for the C code which represents the core of its functionality.</p>
<p>This rfc outlines how unit tests can be (gradually) added to the usual
development cycle of MapServer, without pretending that developers
switch to extreme programming or adopt test driven development.</p>
<p>Issue #1664 on bugzilla and mapserver-dev will be used to track code
samples and discussion.</p>
</section>
<section id="example">
<h2>Example<a class="headerlink" href="#example" title="Link to this heading">¶</a></h2>
<p>A patch has been attached to issue #1664 on bugzilla which implements
the basic infrastructure and some unit tests to demonstrate functionality.
The patch was created in under 6 hours by a single person, who is not a frequent
C programmer. This is meant to prove that unit tests do not take away
much time from developers and that in general the benefit is worth the cost.</p>
<p>The example already supports all the usual preprocessor flags (USE_FLAGS like
#ifdef PROJ) so only the relevant tests will be compiled and run. This is
necessary to avoid test failures due to a missing feature (as happens with
Python unit tests).</p>
</section>
<section id="unit-testing-software">
<h2>Unit testing software<a class="headerlink" href="#unit-testing-software" title="Link to this heading">¶</a></h2>
<p>This rfc recommends the use of the CUnit unit testing library for the C
language, version 2.0.x. The configure script must be updated to reflect this
new dependency and the following or a similar text will be displayed when
cunit is not found: “cunit not found, C unit testing disabled.”.</p>
<p>When cunit is available unit tests could be run by default at the end of
the compile phase: this will give users some more confidence in the software
they just compiled (most of them are linux newbies and have no experience
with programming) and could help in catching obvious bugs (like a typo
while committing to cvs).</p>
<p>Unit tests are placed in the cunit subdirectory of the MapServer source and
distributed with all future releases. Unit tests files should be named with
respect to the original MapServer source file they test plus the addition of
the _tests suffix: for instance unit tests for the mappool.c file should be
placed in a file called mappool_tests.c. The files can have an alphanumeric
code added to the suffix to keep them conveniently short
(like mappool_tests_1.c, mappool_tests_1b.c or mappool_tests_umberto.c).</p>
</section>
<section id="usage-recommendations">
<h2>Usage recommendations<a class="headerlink" href="#usage-recommendations" title="Link to this heading">¶</a></h2>
<p>Developers are not required to write unit tests but when they do we suggest to
follow this checklist.</p>
<section id="developer-implementing-a-new-feature">
<h3>Developer implementing a new feature<a class="headerlink" href="#developer-implementing-a-new-feature" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>she will try to reproduce the bug with a unit test; if this is not possible
or seems difficult she should consider asking on mapserver-dev. The unit
test must fail at this stage (if written)</p></li>
<li><p>she fixes the bug and verifies that the test written at the previous
item now passes (if written)</p></li>
<li><p>she verifies that also all other tests pass and only after she commits</p></li>
</ul>
</section>
<section id="developer-adding-functionality">
<h3>Developer adding functionality<a class="headerlink" href="#developer-adding-functionality" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>she writes a test that verifies the new functionality (this can also be
done afterward, as we have relaxed requirements)</p></li>
<li><p>she writes the code implementing the desired functionality</p></li>
<li><p>she now verifies that the test passes</p></li>
<li><p>she verifies that all other tests pass and only after she commits</p></li>
</ul>
</section>
<section id="general">
<h3>General<a class="headerlink" href="#general" title="Link to this heading">¶</a></h3>
<p>She will also use the usual preprocessor flags to ensure only the relevant
tests for the current configuration context will be compiled and run. The
example attached to issue #1664 already implements this feature.</p>
</section>
</section>
<section id="testing-specific-functionalities">
<h2>Testing specific functionalities<a class="headerlink" href="#testing-specific-functionalities" title="Link to this heading">¶</a></h2>
<p>Some aspects of MapServer like database connections and gd rendering are
inherently difficult to test. This section provides guidance on how to deal
with them in unit tests and will be expanded as new or better solutions
are devised.</p>
<section id="database-connections">
<h3>Database connections<a class="headerlink" href="#database-connections" title="Link to this heading">¶</a></h3>
<p>Database connections generally require a specific setup so that expected
tables, data and possibly other structures are in place. While this should be
a long term goal in the short term unit tests could be limited to
comparing the sql query against the expected one.</p>
<p>This quite likely requires a refactoring of current PostGIS code.</p>
<p>In the future a minimal setup script should be provided to create and
populate the database for the user (if she desires to do so).</p>
</section>
<section id="gd-and-others-rendering-engines">
<h3>GD (and others) rendering engines<a class="headerlink" href="#gd-and-others-rendering-engines" title="Link to this heading">¶</a></h3>
<p>Taking inspiration from the perl GD module a set of images must be produced and
then compared against those produced by MapServer. This kind of operation is
already performed by the msautotest suite, so effort should rather go toward
improving that instead of implementing yet another gd test suite.</p>
</section>
<section id="wfs-wms-support">
<h3>WFS/WMS support<a class="headerlink" href="#wfs-wms-support" title="Link to this heading">¶</a></h3>
<blockquote>
<div><p>Note: The author is not an expert here</p>
</div></blockquote>
<p>In this case unit tests can be used to verify that for certain requests (possibly
using the test data supplied with MapServer) the string returned by MapServer
equals the expected one.</p>
<p>A refactoring of existing code could be necessary.</p>
</section>
<section id="mapscript">
<h3>Mapscript<a class="headerlink" href="#mapscript" title="Link to this heading">¶</a></h3>
<p>Unit tests should be developed by the MapScript mantainers by following the
guidelines given here.</p>
</section>
</section>
<section id="running-unit-tests-and-functional-tests-continuos-integration">
<h2>Running unit tests and functional tests ( Continuos integration )<a class="headerlink" href="#running-unit-tests-and-functional-tests-continuos-integration" title="Link to this heading">¶</a></h2>
<blockquote>
<div><p>Not part of unit tests for now, but useful in perspective</p>
</div></blockquote>
<p>Effort should be put toward developing a build system capable of</p>
<ol class="loweralpha simple">
<li><p>testing the overall build/test of MapServer and of the various MapServers
with different configure options</p></li>
<li><p>and integrating those results with the msautotest suite.</p></li>
</ol>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p>
<a href="../../about.html" title="About">About</a><br>
<a href="../../products.html" title="Products">Products</a><br>
<a href="../../community/index.html" title="Community">Community</a><br>
<a href="../index.html" title="Development">Development</a><br>
<a href="../../download.html" title="Downloads">Downloads</a><br>
<a href="../../documentation.html" title="Documentation">Documentation</a><br>
<a href="../../faq.html" title="FAQ">FAQ</a><br>
<a href="../../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</h3>
  <ul>
<li><a class="reference internal" href="#">MS RFC 12: C code Unit tests</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#example">Example</a></li>
<li><a class="reference internal" href="#unit-testing-software">Unit testing software</a></li>
<li><a class="reference internal" href="#usage-recommendations">Usage recommendations</a><ul>
<li><a class="reference internal" href="#developer-implementing-a-new-feature">Developer implementing a new feature</a></li>
<li><a class="reference internal" href="#developer-adding-functionality">Developer adding functionality</a></li>
<li><a class="reference internal" href="#general">General</a></li>
</ul>
</li>
<li><a class="reference internal" href="#testing-specific-functionalities">Testing specific functionalities</a><ul>
<li><a class="reference internal" href="#database-connections">Database connections</a></li>
<li><a class="reference internal" href="#gd-and-others-rendering-engines">GD (and others) rendering engines</a></li>
<li><a class="reference internal" href="#wfs-wms-support">WFS/WMS support</a></li>
<li><a class="reference internal" href="#mapscript">Mapscript</a></li>
</ul>
</li>
<li><a class="reference internal" href="#running-unit-tests-and-functional-tests-continuos-integration">Running unit tests and functional tests ( Continuos integration )</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ms-rfc-13.html" title="MS RFC 13: Support of Sensor Observation Service in MapServer"
             >next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-11.html" title="MS RFC 11: Support for Curved Labels"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 12: C code Unit tests</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; <a href="../../copyright.html">Copyright</a> 2023, Open Source Geospatial Foundation.
      Last updated on 2023-12-22.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.5.
    </div>
  </body>
</html>