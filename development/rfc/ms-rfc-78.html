<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>MS RFC 78: Vector Field Rendering (CONNECTIONTYPE UVRASTER) &#8212; MapServer 8.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx.css?v=6c7b17ac" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=dd298242" />
    <link rel="stylesheet" type="text/css" href="../../_static/ribbon.css?v=ea091bf4" />
    
    <script src="../../_static/documentation_options.js?v=521b6f53"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="icon" href="../../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="MS RFC 79: Layer Masking" href="ms-rfc-79.html" />
    <link rel="prev" title="MS RFC 77: Support for Multiple Label Objects Within a Class" href="ms-rfc-77.html" /> 
  </head><body>


<!-- for main branch only, do not backport this -->

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../../index.html" title="Home"><img src="../../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../../index.html" title="Home">Home</a> |
      <a href="../../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter" target="_blank">Twitter</a> |
      <a href="../../download.html" title="Download Source or Binaries">Download </a> |
      <a class="badge" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=KRJ2X44N3HA6U&source=url" target="_blank">
        <img src="https://img.shields.io/badge/donate-%E2%9D%A4%C2%A0-ff69b4.svg?style=flat" alt="Donate to MapServer">
      </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../../ar/development/rfc/ms-rfc-78.html"><img src="../../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../../de/development/rfc/ms-rfc-78.html"><img src="../../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../../el/development/rfc/ms-rfc-78.html"><img src="../../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../../es/development/rfc/ms-rfc-78.html"><img src="../../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../../fr/development/rfc/ms-rfc-78.html"><img src="../../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../../id/development/rfc/ms-rfc-78.html"><img src="../../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../../it/development/rfc/ms-rfc-78.html"><img src="../../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../../ja/development/rfc/ms-rfc-78.html"><img src="../../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../../nl_NL/development/rfc/ms-rfc-78.html"><img src="../../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../../pl/development/rfc/ms-rfc-78.html"><img src="../../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../../ru/development/rfc/ms-rfc-78.html"><img src="../../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../../sq/development/rfc/ms-rfc-78.html"><img src="../../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../../tr/development/rfc/ms-rfc-78.html"><img src="../../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ms-rfc-79.html" title="MS RFC 79: Layer Masking"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-77.html" title="MS RFC 77: Support for Multiple Label Objects Within a Class"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 78: Vector Field Rendering (CONNECTIONTYPE UVRASTER)</a></li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="ms-rfc-78-vector-field-rendering-connectiontype-uvraster">
<span id="rfc78"></span><h1>MS RFC 78: Vector Field Rendering (CONNECTIONTYPE UVRASTER)<a class="headerlink" href="#ms-rfc-78-vector-field-rendering-connectiontype-uvraster" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Date<span class="colon">:</span></dt>
<dd class="field-odd"><p>2011/11/04</p>
</dd>
<dt class="field-even">Author<span class="colon">:</span></dt>
<dd class="field-even"><p>Alan Boudreault</p>
</dd>
<dt class="field-odd">Contact<span class="colon">:</span></dt>
<dd class="field-odd"><p>aboudreault at mapgears.com</p>
</dd>
<dt class="field-even">Status<span class="colon">:</span></dt>
<dd class="field-even"><p>Adopted on 2011-11-24. Implementation completed.</p>
</dd>
<dt class="field-odd">Version<span class="colon">:</span></dt>
<dd class="field-odd"><p>MapServer 6.2</p>
</dd>
</dl>
<section id="overview">
<h2>1. Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p>This is a proposal to add the ability to render vector field layers in
MapServer. Vector fields are used for instance in meteorology to
store/display wind direction and magnitude.</p>
<p>The source is two bands of raster data, one band represents the U
component of the vector, and the 2nd band the V component. Using the u,v
values at a given location we can compute a rotation and magnitude and use
that to draw an arrow of a size proportional to the magnitude and pointing
in the direction of the phenomenon (wind, current, etc.)</p>
<p>For more details about vector fields, refer to: <a class="reference external" href="http://en.wikipedia.org/wiki/Vector_field">http://en.wikipedia.org/wiki/Vector_field</a></p>
<p>Visual example (rendered with MapServer):</p>
<blockquote>
<div><img alt="../../_images/uv.png" src="../../_images/uv.png" />
</div></blockquote>
</section>
<section id="the-proposed-solution">
<h2>2. The proposed solution<a class="headerlink" href="#the-proposed-solution" title="Link to this heading">¶</a></h2>
<p>This RFC proposes the addition of a new type of layer in MapServer:
CONNECTIONTYPE UVRASTER.
The new type is a hybrid layer, which has a raster data source as input and
vector features as output. Initially, only the point representation of those
vector features will be supported. Also, queries won’t be supported in this
phase.</p>
<p>Since the data source is a raster, all raster processing options can be
used (e.g. RESAMPLE). After a few tests, we determined that the best results
(for all different zoom levels) for vector fields were when using
RESAMPLE=AVERAGE and this will be set by default for UV layers unless another
type of resampling is explicitly specified in the layer definition.</p>
<p>To render a vector field layer, we need to define a layer in the mapfile
with the following options:</p>
<blockquote>
<div><ul class="simple">
<li><p>Set the layer TYPE to POINT.</p></li>
<li><p>Set CONNECTIONTYPE to UVRASTER.</p></li>
<li><p>Set the DATA to the raster file that contains u/v bands.</p></li>
<li><p>Specify the 2 bands to use as u and v.</p></li>
<li><p>Specify a class to render the point features.</p></li>
</ul>
</div></blockquote>
<p>Optional “PROCESSING” settings:</p>
<blockquote>
<div><ul class="simple">
<li><p>UV_SPACING: The spacing is simply the distance, in pixels, between arrows
to be displayed in the vector field. Default is 32.</p></li>
<li><p>UV_SIZE_SCALE: The uv size scale is used to convert the vector
lengths (magnitude) of the raster to pixels for a better rendering. Default
is 1.</p></li>
</ul>
</div></blockquote>
<p>The UVRASTER layer has 4 attribute bindings that can be used in the layer
definition and/or class expressions:</p>
<blockquote>
<div><ul class="simple">
<li><p>[u]: the raw u value</p></li>
<li><p>[v]: the raw v value</p></li>
<li><p>[uv_angle]: the vector angle</p></li>
<li><p>[uv_length]: the vector length (scaled with the UV_SIZE_SCALE option value)</p></li>
</ul>
</div></blockquote>
<p>Example of a layer definition:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LAYER</span>
 <span class="n">NAME</span> <span class="s2">&quot;my_uv_layer&quot;</span>
 <span class="n">TYPE</span> <span class="n">POINT</span>
 <span class="n">STATUS</span> <span class="n">DEFAULT</span>
 <span class="n">CONNECTIONTYPE</span> <span class="n">UVRASTER</span>
 <span class="n">DATA</span> <span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">raster</span><span class="o">/</span><span class="n">grib</span><span class="o">/</span><span class="n">wind</span><span class="o">.</span><span class="n">grib2</span>
 <span class="n">PROCESSING</span> <span class="s2">&quot;BANDS=1,2&quot;</span>
 <span class="n">PROCESSING</span> <span class="s2">&quot;UV_SPACING=40&quot;</span>
 <span class="n">PROCESSING</span> <span class="s2">&quot;UV_SIZE_SCALE=0.2&quot;</span>
 <span class="n">CLASS</span>
  <span class="n">STYLE</span>
  <span class="n">ANGLE</span> <span class="p">[</span><span class="n">uv_angle</span><span class="p">]</span>
  <span class="n">SYMBOL</span> <span class="s2">&quot;arrow&quot;</span>
  <span class="n">SIZE</span> <span class="p">[</span><span class="n">uv_length</span><span class="p">]</span>
  <span class="n">COLOR</span> <span class="mi">255</span> <span class="mi">0</span> <span class="mi">0</span>
  <span class="n">POSITION</span> <span class="n">CC</span>
  <span class="n">MINSIZE</span> <span class="mi">5</span>
 <span class="n">END</span>
<span class="n">END</span>
</pre></div>
</div>
</section>
<section id="implementation-details">
<h2>3. Implementation Details<a class="headerlink" href="#implementation-details" title="Link to this heading">¶</a></h2>
<p>Internally, a UVRASTER layer will have its own renderer/driver code. It’s a
hybrid layer because it reads the raster source as a normal raster
layer does, but all other functions behave like a vector layer. The
layer can be drawn as a normal point layer using whichShape, GetShape
etc.</p>
<p>Basic internal draw process of a UVRASTER layer:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>whichShape() is called: the raster data source is read using the
internal GDAL functions, resample and all other raster options are applied
and the u,v pixels result is stored in the internal layer structure.</p></li>
<li><p>getShape() is called: loop through the raster pixels and returns a
shapeObj (Point) created with the pixel location.</p></li>
<li><p>MapServer draws its point feature as any other vector layer.</p></li>
</ol>
</div></blockquote>
</section>
<section id="files-affected">
<h2>3.1 Files affected<a class="headerlink" href="#files-affected" title="Link to this heading">¶</a></h2>
<p>The following files will be modified/created by this RFC:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mapserver</span><span class="o">.</span><span class="n">h</span><span class="o">/</span><span class="n">mapfile</span><span class="o">.</span><span class="n">c</span> <span class="p">(</span><span class="n">Connection</span> <span class="nb">type</span> <span class="n">UVRASTER</span> <span class="n">support</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">mapfile</span><span class="p">)</span>
<span class="n">mapuvraster</span><span class="o">.</span><span class="n">c</span> <span class="p">(</span><span class="n">new</span> <span class="n">file</span> <span class="k">for</span> <span class="n">the</span> <span class="n">UVRASTER</span> <span class="n">renderer</span><span class="p">)</span>
<span class="n">maplayer</span><span class="o">.</span><span class="n">c</span> <span class="p">(</span><span class="n">new</span> <span class="n">layer</span> <span class="nb">type</span> <span class="n">handling</span><span class="p">,</span> <span class="n">virtual</span> <span class="n">tables</span> <span class="n">init</span> <span class="n">etc</span><span class="o">.</span><span class="p">)</span>
<span class="n">maplexer</span><span class="o">.</span><span class="n">l</span> <span class="p">(</span><span class="n">add</span> <span class="n">additional</span> <span class="n">UVRASTER</span> <span class="n">keyword</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="mapscript">
<h2>3.2 MapScript<a class="headerlink" href="#mapscript" title="Link to this heading">¶</a></h2>
<p>No issue for any MapScript bindings. The UVRASTER layer is handled/rendered internally as
any other layer..</p>
</section>
<section id="backwards-compatibility-issues">
<h2>3.4 Backwards Compatibility Issues<a class="headerlink" href="#backwards-compatibility-issues" title="Link to this heading">¶</a></h2>
<p>This change provides a new functionality with no backwards compatibility issues being considered.</p>
</section>
<section id="bug-id">
<h2>4. Bug ID<a class="headerlink" href="#bug-id" title="Link to this heading">¶</a></h2>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference external" href="https://github.com/MapServer/MapServer/issues/4094">https://github.com/MapServer/MapServer/issues/4094</a></p></li>
</ul>
</div></blockquote>
</section>
<section id="voting-history">
<h2>5. Voting history<a class="headerlink" href="#voting-history" title="Link to this heading">¶</a></h2>
<p>+1 from Jeff, Olivier, Assefa, Perry, FrankW, Daniel, Stephen, Michael, Thomas, Tom and Steve.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p>
<a href="../../about.html" title="About">About</a><br>
<a href="../../products.html" title="Products">Products</a><br>
<a href="../../community/index.html" title="Community">Community</a><br>
<a href="../index.html" title="Development">Development</a><br>
<a href="../../download.html" title="Downloads">Downloads</a><br>
<a href="../../documentation.html" title="Documentation">Documentation</a><br>
<a href="../../faq.html" title="FAQ">FAQ</a><br>
<a href="../../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</h3>
  <ul>
<li><a class="reference internal" href="#">MS RFC 78: Vector Field Rendering (CONNECTIONTYPE UVRASTER)</a><ul>
<li><a class="reference internal" href="#overview">1. Overview</a></li>
<li><a class="reference internal" href="#the-proposed-solution">2. The proposed solution</a></li>
<li><a class="reference internal" href="#implementation-details">3. Implementation Details</a></li>
<li><a class="reference internal" href="#files-affected">3.1 Files affected</a></li>
<li><a class="reference internal" href="#mapscript">3.2 MapScript</a></li>
<li><a class="reference internal" href="#backwards-compatibility-issues">3.4 Backwards Compatibility Issues</a></li>
<li><a class="reference internal" href="#bug-id">4. Bug ID</a></li>
<li><a class="reference internal" href="#voting-history">5. Voting history</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ms-rfc-79.html" title="MS RFC 79: Layer Masking"
             >next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-77.html" title="MS RFC 77: Support for Multiple Label Objects Within a Class"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 78: Vector Field Rendering (CONNECTIONTYPE UVRASTER)</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; <a href="../../copyright.html">Copyright</a> 2023, Open Source Geospatial Foundation.
      Last updated on 2023-12-22.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.5.
    </div>
  </body>
</html>