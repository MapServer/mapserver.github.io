<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>MS RFC 44: Restore URL modification of mapfiles to pre-5.0 levels &#8212; MapServer 8.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx.css?v=6c7b17ac" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=dd298242" />
    <link rel="stylesheet" type="text/css" href="../../_static/ribbon.css?v=ea091bf4" />
    
    <script src="../../_static/documentation_options.js?v=521b6f53"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="icon" href="../../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="MS RFC 45: Symbology, Labeling, and Cartography Improvements" href="ms-rfc-45.html" />
    <link rel="prev" title="MS RFC 43: Direct tile generation for Google Maps and Virtual Earth API" href="ms-rfc-43.html" /> 
  </head><body>


<!-- for main branch only, do not backport this -->

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../../index.html" title="Home"><img src="../../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../../index.html" title="Home">Home</a> |
      <a href="../../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter" target="_blank">Twitter</a> |
      <a href="../../download.html" title="Download Source or Binaries">Download </a> |
      <a class="badge" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=KRJ2X44N3HA6U&source=url" target="_blank">
        <img src="https://img.shields.io/badge/donate-%E2%9D%A4%C2%A0-ff69b4.svg?style=flat" alt="Donate to MapServer">
      </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../../ar/development/rfc/ms-rfc-44.html"><img src="../../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../../de/development/rfc/ms-rfc-44.html"><img src="../../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../../el/development/rfc/ms-rfc-44.html"><img src="../../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../../es/development/rfc/ms-rfc-44.html"><img src="../../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../../fr/development/rfc/ms-rfc-44.html"><img src="../../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../../id/development/rfc/ms-rfc-44.html"><img src="../../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../../it/development/rfc/ms-rfc-44.html"><img src="../../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../../ja/development/rfc/ms-rfc-44.html"><img src="../../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../../nl_NL/development/rfc/ms-rfc-44.html"><img src="../../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../../pl/development/rfc/ms-rfc-44.html"><img src="../../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../../ru/development/rfc/ms-rfc-44.html"><img src="../../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../../sq/development/rfc/ms-rfc-44.html"><img src="../../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../../tr/development/rfc/ms-rfc-44.html"><img src="../../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ms-rfc-45.html" title="MS RFC 45: Symbology, Labeling, and Cartography Improvements"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-43.html" title="MS RFC 43: Direct tile generation for Google Maps and Virtual Earth API"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 44: Restore URL modification of mapfiles to pre-5.0 levels</a></li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="ms-rfc-44-restore-url-modification-of-mapfiles-to-pre-5-0-levels">
<span id="rfc44"></span><h1>MS RFC 44: Restore URL modification of mapfiles to pre-5.0 levels<a class="headerlink" href="#ms-rfc-44-restore-url-modification-of-mapfiles-to-pre-5-0-levels" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Date<span class="colon">:</span></dt>
<dd class="field-odd"><p>2008/08/19</p>
</dd>
<dt class="field-even">Author<span class="colon">:</span></dt>
<dd class="field-even"><p>Steve Lime</p>
</dd>
<dt class="field-odd">Contact<span class="colon">:</span></dt>
<dd class="field-odd"><p>Steve.Lime at dnr.state.mn.us</p>
</dd>
<dt class="field-even">Last Edited<span class="colon">:</span></dt>
<dd class="field-even"><p>2008/08/19</p>
</dd>
<dt class="field-odd">Status<span class="colon">:</span></dt>
<dd class="field-odd"><p>Adopted</p>
</dd>
</dl>
<p><a class="reference internal" href="ms-rfc-31.html#rfc31"><span class="std std-ref">MS RFC 31: Loading MapServer Objects from Strings</span></a> introduced a new syntax for modifying <a class="reference internal" href="../../mapfile/index.html#mapfile"><span class="std std-ref">mapfiles</span></a>
via URL. Object parameters could specified together in mapfile snippets making
it easier to make changes with far fewer characters. At the same time access
to a number of parameters, particularly those that mapfile parsing did no
value checks on (mostly strings) were removed for security purposes.
In hindsight I underestimated the degree to which that functionality was used
by developers. This RFC aims to restore that functionality albeit with
security in mind.</p>
<section id="proposed-changes">
<h2>Proposed Changes<a class="headerlink" href="#proposed-changes" title="Link to this heading">¶</a></h2>
<p>Presently a few widely modified (and risky) parameters (e.g. layer TEMPLATE
and DATA) can be changed via URL <strong>if</strong> a regular expression
(e.g. TEMPLATEPATTERN and DATAPATTERN) is set to validate the incoming value.
I propose using the same approach for all un-checked mapfile input.
Parameters that represent numbers, colors or have a value domain
(e.g. ON/OFF/DEFAULT) are subject to the same checks as when a mapfile is
read from disk and as a result should be ok. Those that don’t would require
specific validation values be set before input would be allowed. For example,
the LAYER VALIDATION block below defines patterns that would be used to
validate DATA or FILTER parameter changes. If the appropriate validation key
doesn’t exist the value cannot change.</p>
<p>Grouping all validation in a new VALIDATION block will ease use by
simplifying key names to match MapServer token names. The block would be
valid for <a class="reference internal" href="../../mapfile/map.html#map"><span class="std std-ref">MAP</span></a>, <a class="reference internal" href="../../mapfile/web.html#web"><span class="std std-ref">WEB</span></a>, <a class="reference internal" href="../../mapfile/layer.html#layer"><span class="std std-ref">LAYER</span></a> and <a class="reference internal" href="../../mapfile/class.html#class"><span class="std std-ref">CLASS</span></a> objects and
its core type would be a hashTableObj. The MAP level VALIDATION
block would be useful for applying a pattern for all LAYERs or CLASSes (since
there is only 1 WEB object there is no need to rely on the MAP object). This
would save lots of duplication in cases where a mapfile contains similar
layers and the same data validation pattern applies to all. The logic would
simply be: look for validation pattern in layer, if not found then
look for validation pattern at map level, if not found then no modifications
are allowed.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">VALIDATION</span>
<span class="n">data</span> <span class="s1">&#39;my pattern&#39;</span>
<span class="nb">filter</span> <span class="s1">&#39;another pattern&#39;</span>
<span class="o">...</span>
<span class="n">END</span>
</pre></div>
</div>
<p>The validation would only be invoked if the token source is a URL.
Mapfile file or string-based processing would be unaffected. An example of
how this would work can be seen in mapfile.c near line 2683 with the
DATA/DATAPATTERN parameters.</p>
</section>
<section id="files-affected">
<h2>Files Affected<a class="headerlink" href="#files-affected" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>maplexer.l: all parameters (a few will never be modifiable, like
VALIDATION) will be changed to be recognized in the URL_VARIABLE lexer
state; VALIDATION token needs to be added</p></li>
<li><p>mapfile.h: add VALIDATION token</p></li>
<li><p>mapfile.c: all non-value checked parameters will require regex validation
before changes will be allowed via URL; recognize validation token;
write validation hash with mapfile</p></li>
<li><p>mapserv.c: update code for runtime substitution and qstring validation to
check the validation hash as well</p></li>
</ul>
<p>A complete list of parameters affected will be attached to this document in the
post-implementation notes below.</p>
</section>
<section id="mapfile-changes">
<h2>Mapfile Changes<a class="headerlink" href="#mapfile-changes" title="Link to this heading">¶</a></h2>
<p>New VALIDATION token will be recognized.</p>
</section>
<section id="mapscript-changes">
<h2>MapScript Changes<a class="headerlink" href="#mapscript-changes" title="Link to this heading">¶</a></h2>
<p>None. MapScript already has a general class for hashTableObj management.</p>
</section>
<section id="backwards-compatibility-issues">
<h2>Backwards Compatibility Issues<a class="headerlink" href="#backwards-compatibility-issues" title="Link to this heading">¶</a></h2>
<p>The parameters DATAPATTERN and TEMPLATE pattern will become deprecated
though. The objects in question (LAYER and CLASS) already contain
validation blocks that can be used for this.</p>
<p>URL runtime substitution and qstring validation are currently supported
through metadata, This would become deprecated as well. The runtime variables
and the word “qstring” can be used as keys in the validation block instead.</p>
</section>
<section id="post-implementation-notes">
<h2>Post-Implementation Notes<a class="headerlink" href="#post-implementation-notes" title="Link to this heading">¶</a></h2>
<p>A HowTo will be developed that covers this topic and run-time substitutions.</p>
</section>
<section id="bug-id">
<h2>Bug ID<a class="headerlink" href="#bug-id" title="Link to this heading">¶</a></h2>
<p><a class="reference external" href="https://github.com/MapServer/MapServer/issues/2699">https://github.com/MapServer/MapServer/issues/2699</a></p>
</section>
<section id="voting-history">
<h2>Voting History<a class="headerlink" href="#voting-history" title="Link to this heading">¶</a></h2>
<p>+1 Lime, Woodbridge, Morissette, Assefa</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p>
<a href="../../about.html" title="About">About</a><br>
<a href="../../products.html" title="Products">Products</a><br>
<a href="../../community/index.html" title="Community">Community</a><br>
<a href="../index.html" title="Development">Development</a><br>
<a href="../../download.html" title="Downloads">Downloads</a><br>
<a href="../../documentation.html" title="Documentation">Documentation</a><br>
<a href="../../faq.html" title="FAQ">FAQ</a><br>
<a href="../../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</h3>
  <ul>
<li><a class="reference internal" href="#">MS RFC 44: Restore URL modification of mapfiles to pre-5.0 levels</a><ul>
<li><a class="reference internal" href="#proposed-changes">Proposed Changes</a></li>
<li><a class="reference internal" href="#files-affected">Files Affected</a></li>
<li><a class="reference internal" href="#mapfile-changes">Mapfile Changes</a></li>
<li><a class="reference internal" href="#mapscript-changes">MapScript Changes</a></li>
<li><a class="reference internal" href="#backwards-compatibility-issues">Backwards Compatibility Issues</a></li>
<li><a class="reference internal" href="#post-implementation-notes">Post-Implementation Notes</a></li>
<li><a class="reference internal" href="#bug-id">Bug ID</a></li>
<li><a class="reference internal" href="#voting-history">Voting History</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ms-rfc-45.html" title="MS RFC 45: Symbology, Labeling, and Cartography Improvements"
             >next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-43.html" title="MS RFC 43: Direct tile generation for Google Maps and Virtual Earth API"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 44: Restore URL modification of mapfiles to pre-5.0 levels</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; <a href="../../copyright.html">Copyright</a> 2023, Open Source Geospatial Foundation.
      Last updated on 2023-12-22.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.5.
    </div>
  </body>
</html>