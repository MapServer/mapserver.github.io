<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>MS RFC 19: Style &amp; Label attribute binding &#8212; MapServer 8.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx.css?v=6c7b17ac" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=dd298242" />
    <link rel="stylesheet" type="text/css" href="../../_static/ribbon.css?v=ea091bf4" />
    
    <script src="../../_static/documentation_options.js?v=521b6f53"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="icon" href="../../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="MS RFC 21: MapServer Raster Color Correction" href="ms-rfc-21.html" />
    <link rel="prev" title="MS RFC 18: Encryption of passwords in mapfiles" href="ms-rfc-18.html" /> 
  </head><body>


<!-- for main branch only, do not backport this -->

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../../index.html" title="Home"><img src="../../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../../index.html" title="Home">Home</a> |
      <a href="../../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter" target="_blank">Twitter</a> |
      <a href="../../download.html" title="Download Source or Binaries">Download </a> |
      <a class="badge" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=KRJ2X44N3HA6U&source=url" target="_blank">
        <img src="https://img.shields.io/badge/donate-%E2%9D%A4%C2%A0-ff69b4.svg?style=flat" alt="Donate to MapServer">
      </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../../ar/development/rfc/ms-rfc-19.html"><img src="../../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../../de/development/rfc/ms-rfc-19.html"><img src="../../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../../el/development/rfc/ms-rfc-19.html"><img src="../../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../../es/development/rfc/ms-rfc-19.html"><img src="../../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../../fr/development/rfc/ms-rfc-19.html"><img src="../../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../../id/development/rfc/ms-rfc-19.html"><img src="../../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../../it/development/rfc/ms-rfc-19.html"><img src="../../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../../ja/development/rfc/ms-rfc-19.html"><img src="../../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../../nl_NL/development/rfc/ms-rfc-19.html"><img src="../../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../../pl/development/rfc/ms-rfc-19.html"><img src="../../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../../ru/development/rfc/ms-rfc-19.html"><img src="../../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../../sq/development/rfc/ms-rfc-19.html"><img src="../../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../../tr/development/rfc/ms-rfc-19.html"><img src="../../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ms-rfc-21.html" title="MS RFC 21: MapServer Raster Color Correction"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-18.html" title="MS RFC 18: Encryption of passwords in mapfiles"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 19: Style &amp; Label attribute binding</a></li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="ms-rfc-19-style-label-attribute-binding">
<span id="rfc19"></span><h1>MS RFC 19: Style &amp; Label attribute binding<a class="headerlink" href="#ms-rfc-19-style-label-attribute-binding" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Date<span class="colon">:</span></dt>
<dd class="field-odd"><p>2006/06/07</p>
</dd>
<dt class="field-even">Author<span class="colon">:</span></dt>
<dd class="field-even"><p>Steve Lime</p>
</dd>
<dt class="field-odd">Contact<span class="colon">:</span></dt>
<dd class="field-odd"><p>steve.lime at DNR.STATE.MN.US</p>
</dd>
<dt class="field-even">Status<span class="colon">:</span></dt>
<dd class="field-even"><p>Passed (in process)</p>
</dd>
<dt class="field-odd">Version<span class="colon">:</span></dt>
<dd class="field-odd"><p>MapServer 5.0</p>
</dd>
</dl>
<p>Description: Presently MapServer supports binding of label and style
properties for a few select attributes (e.g. angle). However, it is
cumbersome to add new bindings which leads to unnecessarily complex
structures and code that is difficult to maintain. This RFC presents ideas to
bring a bit of order to that chaos and make expansion of this capability
easier to achieve.</p>
<section id="c-structural-changes">
<h2>C Structural Changes<a class="headerlink" href="#c-structural-changes" title="Link to this heading">¶</a></h2>
<p>A new structure called attributeBindingObj would be added:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">typedef</span> <span class="n">struct</span> <span class="p">{</span>
  <span class="n">char</span> <span class="o">*</span><span class="n">item</span><span class="p">;</span>
  <span class="n">char</span> <span class="n">index</span><span class="p">;</span>
<span class="p">}</span> <span class="n">attributeBindingObj</span><span class="p">;</span>
</pre></div>
</div>
<p>Several new enumerations would then define what properties could be bound:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#define MS_STYLE_BINDING_LENGTH ...</span>
<span class="c1">#define MS_STYLE_BINDING_ENUM { MS_STYLE_BINDING_SIZE, MS_STYLE_BINDING_ANGLE, ... };</span>

<span class="c1">#define MS_LABEL_BINDING_LENGTH ...</span>
<span class="c1">#define MS_LABEL_BINDING_ENUM { MS_LABEL_BINDING_SIZE, MS_LABEL_BINDING_ANGLE, ... };</span>
</pre></div>
</div>
<p>Several elements would be removed from layerObj and styleObj. For example,
angleitem, angleitemindex and similar members would be removed.
styleObj’s and labelObj’s would each take on 2 new members:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">char</span> <span class="n">hasBindings</span><span class="p">;</span>
<span class="n">attributeBindingObj</span> <span class="n">bindings</span><span class="p">[</span><span class="n">MS_STYLE_BINDING_LENGTH</span><span class="p">];</span>
</pre></div>
</div>
</section>
<section id="mapfile-mapscript-changes">
<h2>Mapfile/MapScript Changes<a class="headerlink" href="#mapfile-mapscript-changes" title="Link to this heading">¶</a></h2>
<p>Options like SIZEITEM and ANGLEITEM would go away. Instead a more
logical syntax such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">STYLE</span>
  <span class="n">SIZE</span> <span class="p">[</span><span class="n">mySizeItem</span><span class="p">]</span>
  <span class="n">ANGLE</span> <span class="p">[</span><span class="n">myAngleItem</span><span class="p">]</span>
  <span class="n">COLOR</span> <span class="mi">255</span> <span class="mi">0</span> <span class="mi">0</span>
  <span class="n">SYMBOL</span> <span class="s1">&#39;square&#39;</span>
<span class="n">END</span>
</pre></div>
</div>
<p>Square brackets have been used in MapServer templates and expressions to
bind to attributes so they are a natural choice to denote attribute
bindings in this case.</p>
<p>Similarly MapScript would loose the ability to set/get the xxxITEM
properties. Instead the style and label objects would get setBinding
and deleteBinding methods:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(in Perl)
$style-&gt;setBinding($mapscript::MS_STYLE_BINDING_SIZE, &#39;mySizeItem&#39;);
$style-&gt;deleteBinding($mapscript::MS_STYLE_BINDING_COLOR);
</pre></div>
</div>
</section>
<section id="files-affected">
<h2>Files Affected<a class="headerlink" href="#files-affected" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>map.h =&gt; structure changes, enum and define additions</p></li>
<li><p>maputil.c =&gt; add msStyleBindAttributes();</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">msStyleBindAttributes</span><span class="p">(</span><span class="n">shapeObj</span> <span class="o">*</span><span class="n">shape</span><span class="p">,</span> <span class="n">styleObj</span> <span class="o">*</span><span class="n">style</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">style</span><span class="o">-&gt;</span><span class="n">bindings</span><span class="p">[</span><span class="n">MS_STYLE_BINDING_SIZE</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">)</span>
    <span class="n">style</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">shape</span><span class="o">-&gt;</span><span class="n">values</span><span class="p">[</span><span class="n">style</span><span class="o">-&gt;</span><span class="n">bindings</span><span class="p">[</span><span class="n">MS_STYLE_BINDING_SIZE</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">]);</span>
  <span class="k">if</span><span class="p">(</span><span class="n">style</span><span class="o">-&gt;</span><span class="n">bindings</span><span class="p">[</span><span class="n">MS_STYLE_BINDING_ANGLE</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">)</span>
    <span class="n">style</span><span class="o">-&gt;</span><span class="n">angle</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">shape</span><span class="o">-&gt;</span><span class="n">values</span><span class="p">[</span><span class="n">style</span><span class="o">-&gt;</span><span class="n">bindings</span><span class="p">[</span><span class="n">MS_STYLE_BINDING_ANGLE</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">]);</span>
  <span class="o">...</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>maplabel.c =&gt; add msLabelBindAttributes();</p></li>
<li><p>maplayer.c =&gt; fix msWhichItems() to populate the binding indexes</p></li>
<li><p>mapdraw.c =&gt; remove references to the xxxITEM properties, if a style or
label has bindings then call msStyleBindAttributes or msLabelBindAttributes</p></li>
<li><p>mapfile.c =&gt; fix parsing to hangle strings in addition to numbers for all
supported bindings (symbols already allow this), if a binding is defined
flip the hasBindings flag, remove all references to xxxITEM properties,
alter style and label writing code to honor bindings as part of output</p></li>
<li><p>mapcopy.c =&gt; fix style and labeling copying</p></li>
<li><p>maplexer.l/mapfile.h =&gt; remove xxxITEM defines and lexer references, and
to define a new raw type (similar to MS_STRING) called MS_BINDING</p></li>
<li><p>mapscript/swiginc/style.i =&gt; add setBinding and deleteBinding methods
(similar for PHP/MapScript)</p></li>
</ul>
</section>
<section id="testing">
<h2>Testing<a class="headerlink" href="#testing" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Python suite: need tests to set and delete bindings</p></li>
<li><p>MsAutoTest suite: a mapfile testing various bindings would be
developed (DNR tests have one example for labels)</p></li>
</ul>
</section>
<section id="backwards-compatibility-issues">
<h2>Backwards compatibility issues<a class="headerlink" href="#backwards-compatibility-issues" title="Link to this heading">¶</a></h2>
<p>This does affect a number of parameters, however they are lightly used so
this is probably worth the risk. The primary risk is breaking mapfiles as
opposed to scripts. Given that this will definitely break some stuff I
think it is most appropriate as a 5.0 change.</p>
</section>
<section id="bug-id">
<h2>Bug ID<a class="headerlink" href="#bug-id" title="Link to this heading">¶</a></h2>
<p><a class="reference external" href="https://github.com/MapServer/MapServer/issues/2100">2100</a></p>
</section>
<section id="voting-history">
<h2>Voting history<a class="headerlink" href="#voting-history" title="Link to this heading">¶</a></h2>
<p>+1 Lime, Morissette, Woodbridge</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p>
<a href="../../about.html" title="About">About</a><br>
<a href="../../products.html" title="Products">Products</a><br>
<a href="../../community/index.html" title="Community">Community</a><br>
<a href="../index.html" title="Development">Development</a><br>
<a href="../../download.html" title="Downloads">Downloads</a><br>
<a href="../../documentation.html" title="Documentation">Documentation</a><br>
<a href="../../faq.html" title="FAQ">FAQ</a><br>
<a href="../../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</h3>
  <ul>
<li><a class="reference internal" href="#">MS RFC 19: Style &amp; Label attribute binding</a><ul>
<li><a class="reference internal" href="#c-structural-changes">C Structural Changes</a></li>
<li><a class="reference internal" href="#mapfile-mapscript-changes">Mapfile/MapScript Changes</a></li>
<li><a class="reference internal" href="#files-affected">Files Affected</a></li>
<li><a class="reference internal" href="#testing">Testing</a></li>
<li><a class="reference internal" href="#backwards-compatibility-issues">Backwards compatibility issues</a></li>
<li><a class="reference internal" href="#bug-id">Bug ID</a></li>
<li><a class="reference internal" href="#voting-history">Voting history</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ms-rfc-21.html" title="MS RFC 21: MapServer Raster Color Correction"
             >next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-18.html" title="MS RFC 18: Encryption of passwords in mapfiles"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 19: Style &amp; Label attribute binding</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; <a href="../../copyright.html">Copyright</a> 2023, Open Source Geospatial Foundation.
      Last updated on 2023-12-22.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.5.
    </div>
  </body>
</html>