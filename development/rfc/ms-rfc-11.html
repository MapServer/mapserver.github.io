<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>MS RFC 11: Support for Curved Labels &#8212; MapServer 8.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx.css?v=6c7b17ac" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=dd298242" />
    <link rel="stylesheet" type="text/css" href="../../_static/ribbon.css?v=ea091bf4" />
    
    <script src="../../_static/documentation_options.js?v=521b6f53"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="icon" href="../../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="MS RFC 12: C code Unit tests" href="ms-rfc-12.html" />
    <link rel="prev" title="MS RFC 10: Joining the Open Source Geospatial Foundation" href="ms-rfc-10.html" /> 
  </head><body>


<!-- for main branch only, do not backport this -->

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../../index.html" title="Home"><img src="../../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../../index.html" title="Home">Home</a> |
      <a href="../../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter" target="_blank">Twitter</a> |
      <a href="../../download.html" title="Download Source or Binaries">Download </a> |
      <a class="badge" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=KRJ2X44N3HA6U&source=url" target="_blank">
        <img src="https://img.shields.io/badge/donate-%E2%9D%A4%C2%A0-ff69b4.svg?style=flat" alt="Donate to MapServer">
      </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../../ar/development/rfc/ms-rfc-11.html"><img src="../../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../../de/development/rfc/ms-rfc-11.html"><img src="../../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../../el/development/rfc/ms-rfc-11.html"><img src="../../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../../es/development/rfc/ms-rfc-11.html"><img src="../../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../../fr/development/rfc/ms-rfc-11.html"><img src="../../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../../id/development/rfc/ms-rfc-11.html"><img src="../../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../../it/development/rfc/ms-rfc-11.html"><img src="../../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../../ja/development/rfc/ms-rfc-11.html"><img src="../../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../../nl_NL/development/rfc/ms-rfc-11.html"><img src="../../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../../pl/development/rfc/ms-rfc-11.html"><img src="../../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../../ru/development/rfc/ms-rfc-11.html"><img src="../../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../../sq/development/rfc/ms-rfc-11.html"><img src="../../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../../tr/development/rfc/ms-rfc-11.html"><img src="../../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ms-rfc-12.html" title="MS RFC 12: C code Unit tests"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-10.html" title="MS RFC 10: Joining the Open Source Geospatial Foundation"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 11: Support for Curved Labels</a></li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="ms-rfc-11-support-for-curved-labels">
<span id="rfc11"></span><h1>MS RFC 11: Support for Curved Labels<a class="headerlink" href="#ms-rfc-11-support-for-curved-labels" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Date<span class="colon">:</span></dt>
<dd class="field-odd"><p>2006/02/09</p>
</dd>
<dt class="field-even">Author<span class="colon">:</span></dt>
<dd class="field-even"><p>Benj Carson</p>
</dd>
<dt class="field-odd">Contact<span class="colon">:</span></dt>
<dd class="field-odd"><p>benjcarson at digitaljunkies.ca</p>
</dd>
<dt class="field-even">Author<span class="colon">:</span></dt>
<dd class="field-even"><p>Stephen Lime</p>
</dd>
<dt class="field-odd">Contact<span class="colon">:</span></dt>
<dd class="field-odd"><p>sdlime at comcast.net</p>
</dd>
<dt class="field-even">Status<span class="colon">:</span></dt>
<dd class="field-even"><p>passed</p>
</dd>
</dl>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p>One of the features most frequently asked for are labels that follow
along linear features. This RFC describes an initial implementation
of this feature.</p>
</section>
<section id="technical-details">
<h2>Technical Details<a class="headerlink" href="#technical-details" title="Link to this heading">¶</a></h2>
<p>The proposed solution has a couple of primary goals:</p>
<blockquote>
<div><ul class="simple">
<li><p>isolate virtually all computations and data storage into a minimum
number of functions and structures.</p></li>
<li><p>integrates easily into the existing labelCacheObj structure and
label cache processing routines.</p></li>
</ul>
</div></blockquote>
<p>A single, new function- msPolylineLabelPath() serves as the sole computational
function for this new functionality. Like the existing msPolylineLabelPoint()
function it takes an input feature and annotation string and computes a
labeling position.  However, instead of computing a single point (and
optionally, angle) it computes a label point and angle for each character
in the annotation string.  The computation results are returned in a new
structure called a “labelPathObj” that looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">typedef</span> <span class="n">struct</span> <span class="p">{</span>
  <span class="n">multipointObj</span> <span class="n">path</span><span class="p">;</span>
  <span class="n">shapeObj</span> <span class="n">bounds</span><span class="p">;</span>
  <span class="n">double</span> <span class="o">*</span><span class="n">angles</span><span class="p">;</span>
<span class="p">}</span> <span class="n">labelPathObj</span><span class="p">;</span>
</pre></div>
</div>
<p>The function will return NULL if a curved label is not appropriate for
the feature in question so traditional labeling can take place (for
example, if the feature has only 2 points a curved label is not necessary).
The curved label’s bounding polygon will be calculated in this function
as well and stored in the “bounds” member of the labelPathObj structure.</p>
<p>In order to get the labelPathObj into the label cache it will be necessary
to do 2 things:</p>
<blockquote>
<div><ul class="simple">
<li><p>extend labelCacheMemberObj to optionally reference a labelPathObj</p></li>
<li><p>extend the function msAddLabel to take a labelPathObj in addition
to the parameters it already accepts</p></li>
</ul>
</div></blockquote>
<p>Since each labelPathObj will contain the boundary for the curved label,
it will be ready to use with the existing label cache rendering code.</p>
<p>The only addition to the label cache rendering is code to detect when
a text path should be rendered instead of a traditional label. Driver
specific code to render a text path will have to be written but in
general this is trivial and just involves calling the normal text
rendering code once for each character in the path.</p>
</section>
<section id="mapfile-implications">
<h2>Mapfile Implications<a class="headerlink" href="#mapfile-implications" title="Link to this heading">¶</a></h2>
<p>It is proposed that we simply extend the labelObj ANGLE parameter.
Currently it takes an angle (given in degrees) or the keyword AUTO.
We suggest adding support for the keyword FOLLOW. This would set a new
labelObj member, anglefollow, to MS_TRUE (and also angleauto to MS_TRUE
as ANGLE FOLLOW implies ANGLE AUTO if a curved label is not appropriate).</p>
</section>
<section id="support-for-non-gd-renderers">
<h2>Support for Non-GD Renderers<a class="headerlink" href="#support-for-non-gd-renderers" title="Link to this heading">¶</a></h2>
<p>Presently all MapServer output renders use the contents of the label
cache, which is basically render agnostic. This will not be the case
any more. The placement computations necessary to support curved labels
do leverage font metrics derived from the GD/Freetype interface. It may
well be possible for the SWF, PDF and SVG renders to leverage even the
GD-based curved labels, however it is probably best to consider this a
raster-only output feature in this implementation.  If font metrics
support for other renderers is developed in the future then this feature
can be easily extended to support them.</p>
</section>
<section id="bug-tracking">
<h2>Bug Tracking<a class="headerlink" href="#bug-tracking" title="Link to this heading">¶</a></h2>
<p>Bug 1620 has be setup to track this feature addition.</p>
</section>
<section id="voting-history">
<h2>Voting History<a class="headerlink" href="#voting-history" title="Link to this heading">¶</a></h2>
<p>+1: Lime, Assefa, Nacionales, Warmerdam, Morissette</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p>
<a href="../../about.html" title="About">About</a><br>
<a href="../../products.html" title="Products">Products</a><br>
<a href="../../community/index.html" title="Community">Community</a><br>
<a href="../index.html" title="Development">Development</a><br>
<a href="../../download.html" title="Downloads">Downloads</a><br>
<a href="../../documentation.html" title="Documentation">Documentation</a><br>
<a href="../../faq.html" title="FAQ">FAQ</a><br>
<a href="../../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</h3>
  <ul>
<li><a class="reference internal" href="#">MS RFC 11: Support for Curved Labels</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#technical-details">Technical Details</a></li>
<li><a class="reference internal" href="#mapfile-implications">Mapfile Implications</a></li>
<li><a class="reference internal" href="#support-for-non-gd-renderers">Support for Non-GD Renderers</a></li>
<li><a class="reference internal" href="#bug-tracking">Bug Tracking</a></li>
<li><a class="reference internal" href="#voting-history">Voting History</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ms-rfc-12.html" title="MS RFC 12: C code Unit tests"
             >next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-10.html" title="MS RFC 10: Joining the Open Source Geospatial Foundation"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 11: Support for Curved Labels</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; <a href="../../copyright.html">Copyright</a> 2023, Open Source Geospatial Foundation.
      Last updated on 2023-12-22.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.5.
    </div>
  </body>
</html>