<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>MS RFC 119: Mapbox Vector Tile (MVT) Support &#8212; MapServer 8.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx.css?v=6c7b17ac" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=dd298242" />
    <link rel="stylesheet" type="text/css" href="../../_static/ribbon.css?v=ea091bf4" />
    
    <script src="../../_static/documentation_options.js?v=521b6f53"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="icon" href="../../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="MS RFC 120: INSPIRE download service support for WCS 2.0" href="ms-rfc-120.html" />
    <link rel="prev" title="MS RFC 118: Support Vendor-Specific OGC FILTER parameter in WMS requests" href="ms-rfc-118.html" /> 
  </head><body>


<!-- for main branch only, do not backport this -->

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../../index.html" title="Home"><img src="../../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../../index.html" title="Home">Home</a> |
      <a href="../../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter" target="_blank">Twitter</a> |
      <a href="../../download.html" title="Download Source or Binaries">Download </a> |
      <a class="badge" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=KRJ2X44N3HA6U&source=url" target="_blank">
        <img src="https://img.shields.io/badge/donate-%E2%9D%A4%C2%A0-ff69b4.svg?style=flat" alt="Donate to MapServer">
      </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../../ar/development/rfc/ms-rfc-119.html"><img src="../../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../../de/development/rfc/ms-rfc-119.html"><img src="../../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../../el/development/rfc/ms-rfc-119.html"><img src="../../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../../es/development/rfc/ms-rfc-119.html"><img src="../../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../../fr/development/rfc/ms-rfc-119.html"><img src="../../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../../id/development/rfc/ms-rfc-119.html"><img src="../../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../../it/development/rfc/ms-rfc-119.html"><img src="../../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../../ja/development/rfc/ms-rfc-119.html"><img src="../../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../../nl_NL/development/rfc/ms-rfc-119.html"><img src="../../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../../pl/development/rfc/ms-rfc-119.html"><img src="../../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../../ru/development/rfc/ms-rfc-119.html"><img src="../../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../../sq/development/rfc/ms-rfc-119.html"><img src="../../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../../tr/development/rfc/ms-rfc-119.html"><img src="../../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ms-rfc-120.html" title="MS RFC 120: INSPIRE download service support for WCS 2.0"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-118.html" title="MS RFC 118: Support Vendor-Specific OGC FILTER parameter in WMS requests"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 119: Mapbox Vector Tile (MVT) Support</a></li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="ms-rfc-119-mapbox-vector-tile-mvt-support">
<span id="rfc119"></span><h1>MS RFC 119: Mapbox Vector Tile (MVT) Support<a class="headerlink" href="#ms-rfc-119-mapbox-vector-tile-mvt-support" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Date<span class="colon">:</span></dt>
<dd class="field-odd"><p>2017-08-07</p>
</dd>
<dt class="field-even">Authors<span class="colon">:</span></dt>
<dd class="field-even"><p>Thomas Bonfort, Stephen Lime</p>
</dd>
<dt class="field-odd">Contacts<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="mailto:thomas&#46;bonfort&#37;&#52;&#48;gmail&#46;com">thomas<span>&#46;</span>bonfort<span>&#64;</span>gmail<span>&#46;</span>com</a>, <a class="reference external" href="mailto:sdlime&#37;&#52;&#48;comcast&#46;net">sdlime<span>&#64;</span>comcast<span>&#46;</span>net</a></p>
</dd>
<dt class="field-even">Status<span class="colon">:</span></dt>
<dd class="field-even"><p>Draft</p>
</dd>
<dt class="field-odd">Version<span class="colon">:</span></dt>
<dd class="field-odd"><p>MapServer 7.2</p>
</dd>
</dl>
<section id="overview">
<h2>1. Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p>Mapbox vector tiles (MVT) represent an alternative to delivering tiled map data to the client. In contrast to raster tiles, vector tiles encode coordinate and attribute information across any number of geospatial layers. This allows for rich application development where geospatial data can be filtered and symbolized on the client without the need for extra server interactions. See the <a class="reference external" href="https://www.mapbox.com/vector-tiles/specification/">specification</a>.</p>
</section>
<section id="proposed-solution">
<h2>2. Proposed solution<a class="headerlink" href="#proposed-solution" title="Link to this heading">¶</a></h2>
<p>This RFC proposes the implementation of the MVT specification (version 2.1) within MapServer and MapCache. Highlights include:</p>
<ul class="simple">
<li><p>the introduction of no new mapfile keywords, all configuration uses existing mechanisms</p></li>
<li><p>MVT are implemented as a new output driver and can be used with mode=map, mode=tile or WMS actions</p></li>
<li><p>the implementation introduces a new dependency on protobuf/protobuf-c</p></li>
</ul>
</section>
<section id="new-and-updated-files">
<h2>2.1 New and Updated Files<a class="headerlink" href="#new-and-updated-files" title="Link to this heading">¶</a></h2>
<p>New and updated files are described here:</p>
</section>
<section id="mapserver">
<h2>2.1.1 MapServer<a class="headerlink" href="#mapserver" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>mapmvt.c (new): MVT implementation code</p></li>
<li><p>renderers/mvt/vector_tile.proto (new): protocol buffer definition file</p></li>
<li><p>mapoutput.c (updated): register MVT renderer and default output format (application/x-protobuf)</p></li>
<li><p>mapservutil.c (updated): intercept calls to produce MVT output</p></li>
<li><p>mapwfs.c (updated): there are remnants of Thomas’ original work where bounding box (bbox) is expanded using the EDGE_BUFFER output format option. Currently there is no mechanism to create MVT output via WFS or queries in general although it could be added in the future (similar to drawing a query map).</p></li>
<li><p>mapwms.c (updated): intercept calls to produce MVT output</p></li>
<li><p>mapserver.h (updated): register MVT renderer and public function (e.g. msMVTWriteTile())</p></li>
<li><p>CMakeLists.txt (updated): add protobuf/protobuf-c rules</p></li>
</ul>
</section>
<section id="mapcache">
<h2>2.1.2 MapCache<a class="headerlink" href="#mapcache" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>include/mapcache.h (updated): new definitions for raw image format</p></li>
<li><p>lib/cache_disk.c (updated): add raw image format support</p></li>
<li><p>lib/configuration_xml.c (updated): process raw image format related configuration</p></li>
<li><p>lib/core.c (updated): handle response for raw image format</p></li>
<li><p>lib/image.c (updated): add raw image format support - no metatiling</p></li>
<li><p>lib/image_raw.c (new): add raw image format support</p></li>
<li><p>lib/service_wms.c (updated): add raw image format support</p></li>
<li><p>lib/source_wms.c (updated): add raw image format support</p></li>
<li><p>lib/tileset.c (updated): add raw image format support</p></li>
</ul>
</section>
<section id="configuration-notes">
<h2>2.2 Configuration Notes<a class="headerlink" href="#configuration-notes" title="Link to this heading">¶</a></h2>
</section>
<section id="id1">
<h2>2.2.1 MapServer<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>configuration of attribute data uses <cite>gml_</cite> or <cite>ows_</cite> metadata elements</p></li>
<li><p>WMS_SRS metadata (layer and server) should include epsg:3857 and epsg:900913</p></li>
<li><p>layers must define a projection</p></li>
<li><p>the MVT output format supports an option called EDGE_BUFFER which defines the amount of overlap between tiles in map units (default is 10)</p></li>
<li><p>the MVT output format supports an option called EXTENT which defines tile extent in coordinate units (default is 4096). Feature geometries are converted from map coordinates to tile coordinates using this value.</p></li>
</ul>
</section>
<section id="id2">
<h2>2.2.2 MapCache<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h2>
<p>Sample configuration follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;format name=&quot;MVT&quot; type=&quot;RAW&quot;&gt;
  &lt;extension&gt;mvt&lt;/extension&gt;
  &lt;mime_type&gt;application/vnd.mapbox-vector-tile&lt;/mime_type&gt;
&lt;/format&gt;

&lt;source name=&quot;test_wms_mvt&quot; type=&quot;wms&quot;&gt;
  &lt;http&gt;
    &lt;url&gt;http://mapserver.localhost/cgi-bin/mapserv?&lt;/url&gt;
  &lt;/http&gt;
  &lt;getmap&gt;
    &lt;params&gt;
      &lt;LAYERS&gt;layer1,layer2,layer3&lt;/LAYERS&gt;
      &lt;FORMAT&gt;application/vnd.mapbox-vector-tile&lt;/FORMAT&gt;
      &lt;MAP&gt;/mapserver/test.map&lt;/MAP&gt;
    &lt;/params&gt;
  &lt;/getmap&gt;
&lt;/source&gt;

&lt;tileset name=&quot;test_mvt&quot;&gt;
  &lt;source&gt;test_wms_mvt&lt;/source&gt;
  &lt;grid&gt;g&lt;/grid&gt;
  &lt;cache&gt;sqlite&lt;/cache&gt;
  &lt;format&gt;MVT&lt;/format&gt;
&lt;/tileset&gt;
</pre></div>
</div>
</section>
<section id="sample-mapserver-requests">
<h2>2.3 Sample MapServer Requests<a class="headerlink" href="#sample-mapserver-requests" title="Link to this heading">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>/cgi-bin/mapserv?map=mvt.map&amp;mode=tile&amp;tilemode=gmap&amp;tile=1935+2856+13&amp;layers=all&amp;map.imagetype=mvt
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>/cgi-bin/mapserv?map=mvt.map&amp;SERVICE=WMS&amp;VERSION=1.1.1&amp;REQUEST=GetMap&amp;LAYERS=major_roads,lakes,sna,wma&amp;STYLES=
&amp;SRS=EPSG:3857&amp;BBOX=-10434562.049185,5909509.084589,-10429689.188632,5914381.945142&amp;WIDTH=256&amp;HEIGHT=256&amp;FORMAT=application/x-protobuf
</pre></div>
</div>
</section>
<section id="implementation-details">
<h2>3. Implementation Details<a class="headerlink" href="#implementation-details" title="Link to this heading">¶</a></h2>
</section>
<section id="id3">
<h2>3.1.1 MapServer<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h2>
<p>The implementation has three primary components. The MVT output driver, driver registration and calling the driver as appropriate when making a map, tile or WMS request, The implementation is non-invasive and has mimimal impact on the existing code base.</p>
</section>
<section id="id4">
<h2>3.1.2 MapCache<a class="headerlink" href="#id4" title="Link to this heading">¶</a></h2>
<p>The implementation implements a new raw image format. Basically we don’t know anything about the format other that a file extension and mime-type. As a result features like metatile support and symbolic links for blank tiles are not supported. One bonus is that this image format can also be used for UTFGrids generated by MapServer - and presumably other sources.</p>
</section>
<section id="limitations">
<h2>4. Limitations<a class="headerlink" href="#limitations" title="Link to this heading">¶</a></h2>
</section>
<section id="id5">
<h2>4.1.1 MapServer<a class="headerlink" href="#id5" title="Link to this heading">¶</a></h2>
<p>The current implementation can only be used with mode=map, mode=tile and WMS requests. Rendering a query result (think QUERYMAP) is possible but is not implemented at this time. It is not clear what the use case is for that support.</p>
</section>
<section id="id6">
<h2>4.1.2 MapCache<a class="headerlink" href="#id6" title="Link to this heading">¶</a></h2>
<p>Only the WMS source was updated to handle the raw image format.</p>
<p>Testing was done with disk and SQLite caches. The latter required no changes so it is possible that other caches will work out-of-the-box. The disk cache needed update to address blank tile handling.</p>
<p>The WMS service does not support pass-through requests for raw image caches. It may be possible but seems like it would provide limited value.</p>
</section>
<section id="backwards-compatibility-issues">
<h2>5. Backwards Compatibility Issues<a class="headerlink" href="#backwards-compatibility-issues" title="Link to this heading">¶</a></h2>
<p>None anticipated, but as mentioned previously this does introduce new dependencies on the protobuf and protobuf-c libraries.</p>
</section>
<section id="security-implications">
<h2>6. Security implications<a class="headerlink" href="#security-implications" title="Link to this heading">¶</a></h2>
<p>None anticipated.</p>
</section>
<section id="performance-implications">
<h2>7. Performance implications<a class="headerlink" href="#performance-implications" title="Link to this heading">¶</a></h2>
<p>No impacts on core performance are anticipated.</p>
</section>
<section id="documentation-needs">
<h2>8. Documentation needs<a class="headerlink" href="#documentation-needs" title="Link to this heading">¶</a></h2>
<p>The primary need will be in educating users on what do with MVT files. In reality that goes beyond the scope of MapServer but letting folks know what clients exist to render MVT tiles will be important. A number of clients exist at this point with the most prominent being Mapbox GL JS and OpenLayers 3.x.</p>
</section>
<section id="bug-id-and-references">
<h2>9. Bug ID and references<a class="headerlink" href="#bug-id-and-references" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>MapServer <a class="reference external" href="https://github.com/MapServer/MapServer/pull/5376">pull request#5376</a></p></li>
<li><p>MapCache <a class="reference external" href="https://github.com/MapServer/mapcache/pull/166">pull request#166</a></p></li>
<li><p>initial MapServer <a class="reference external" href="https://github.com/sdlime/mapserver/tree/vector-tiles">implementation</a></p></li>
<li><p>demo using <a class="reference external" href="https://github.com/sdlime/mvt-demo">Mapbox GL JS and mode=tile</a></p></li>
<li><p>loads of resources at <a class="reference external" href="https://openmaptiles.org/">openmaptiles.org</a></p></li>
<li><p><a class="reference external" href="https://www.mapbox.com/mapbox-gl-js/api/">Mapbox GL JS</a></p></li>
</ul>
</section>
<section id="voting-history">
<h2>10. Voting history<a class="headerlink" href="#voting-history" title="Link to this heading">¶</a></h2>
<p>No vote yet</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p>
<a href="../../about.html" title="About">About</a><br>
<a href="../../products.html" title="Products">Products</a><br>
<a href="../../community/index.html" title="Community">Community</a><br>
<a href="../index.html" title="Development">Development</a><br>
<a href="../../download.html" title="Downloads">Downloads</a><br>
<a href="../../documentation.html" title="Documentation">Documentation</a><br>
<a href="../../faq.html" title="FAQ">FAQ</a><br>
<a href="../../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</h3>
  <ul>
<li><a class="reference internal" href="#">MS RFC 119: Mapbox Vector Tile (MVT) Support</a><ul>
<li><a class="reference internal" href="#overview">1. Overview</a></li>
<li><a class="reference internal" href="#proposed-solution">2. Proposed solution</a></li>
<li><a class="reference internal" href="#new-and-updated-files">2.1 New and Updated Files</a></li>
<li><a class="reference internal" href="#mapserver">2.1.1 MapServer</a></li>
<li><a class="reference internal" href="#mapcache">2.1.2 MapCache</a></li>
<li><a class="reference internal" href="#configuration-notes">2.2 Configuration Notes</a></li>
<li><a class="reference internal" href="#id1">2.2.1 MapServer</a></li>
<li><a class="reference internal" href="#id2">2.2.2 MapCache</a></li>
<li><a class="reference internal" href="#sample-mapserver-requests">2.3 Sample MapServer Requests</a></li>
<li><a class="reference internal" href="#implementation-details">3. Implementation Details</a></li>
<li><a class="reference internal" href="#id3">3.1.1 MapServer</a></li>
<li><a class="reference internal" href="#id4">3.1.2 MapCache</a></li>
<li><a class="reference internal" href="#limitations">4. Limitations</a></li>
<li><a class="reference internal" href="#id5">4.1.1 MapServer</a></li>
<li><a class="reference internal" href="#id6">4.1.2 MapCache</a></li>
<li><a class="reference internal" href="#backwards-compatibility-issues">5. Backwards Compatibility Issues</a></li>
<li><a class="reference internal" href="#security-implications">6. Security implications</a></li>
<li><a class="reference internal" href="#performance-implications">7. Performance implications</a></li>
<li><a class="reference internal" href="#documentation-needs">8. Documentation needs</a></li>
<li><a class="reference internal" href="#bug-id-and-references">9. Bug ID and references</a></li>
<li><a class="reference internal" href="#voting-history">10. Voting history</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ms-rfc-120.html" title="MS RFC 120: INSPIRE download service support for WCS 2.0"
             >next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-118.html" title="MS RFC 118: Support Vendor-Specific OGC FILTER parameter in WMS requests"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 119: Mapbox Vector Tile (MVT) Support</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; <a href="../../copyright.html">Copyright</a> 2023, Open Source Geospatial Foundation.
      Last updated on 2023-12-22.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.5.
    </div>
  </body>
</html>