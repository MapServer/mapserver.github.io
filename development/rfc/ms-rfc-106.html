<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>MS RFC 106: Support of Geomtransform JavaScript Plugin &mdash; MapServer 7.0.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '7.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="top" title="MapServer 7.0.0 documentation" href="../../index.html" />
    <link rel="up" title="Request for Comments" href="index.html" />
    <link rel="next" title="MS RFC 107: Support for the edge of pixel (OGC) extent model in MapServer" href="ms-rfc-107.html" />
    <link rel="prev" title="MS RFC 105: Support for WFS 2.0 (server side)" href="ms-rfc-105.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../../index.html" title="Home"><img src="../../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../../index.html" title="Home">Home</a> |
      <a href="../../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../../faq.html" title="FAQ">FAQ</a> |
      <a href="../../download.html" title="Download">Download </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../../ar/development/rfc/ms-rfc-106.html"><img src="../../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../../de/development/rfc/ms-rfc-106.html"><img src="../../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../../el/development/rfc/ms-rfc-106.html"><img src="../../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../../es/development/rfc/ms-rfc-106.html"><img src="../../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../../fr/development/rfc/ms-rfc-106.html"><img src="../../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../../id/development/rfc/ms-rfc-106.html"><img src="../../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../../it/development/rfc/ms-rfc-106.html"><img src="../../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../../ja/development/rfc/ms-rfc-106.html"><img src="../../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../../nl_NL/development/rfc/ms-rfc-106.html"><img src="../../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../../pl/development/rfc/ms-rfc-106.html"><img src="../../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../../ru/development/rfc/ms-rfc-106.html"><img src="../../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../../sq/development/rfc/ms-rfc-106.html"><img src="../../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../../tr/development/rfc/ms-rfc-106.html"><img src="../../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        
        
          <a href="../../uk/development/rfc/ms-rfc-106.html"><img src="../../_static/flagicons/uk.png" alt="uk" title="uk" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ms-rfc-107.html" title="MS RFC 107: Support for the edge of pixel (OGC) extent model in MapServer"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-105.html" title="MS RFC 105: Support for WFS 2.0 (server side)"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Request for Comments</a> &raquo;</li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="ms-rfc-106-support-of-geomtransform-javascript-plugin">
<span id="rfc106"></span><h1>MS RFC 106: Support of Geomtransform JavaScript Plugin<a class="headerlink" href="#ms-rfc-106-support-of-geomtransform-javascript-plugin" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Date:</th><td class="field-body">2013/11</td>
</tr>
<tr class="field-even field"><th class="field-name">Author:</th><td class="field-body">Alan Boudreault</td>
</tr>
<tr class="field-odd field"><th class="field-name">Contact:</th><td class="field-body"><a class="reference external" href="mailto:aboudreault&#37;&#52;&#48;mapgears&#46;com">aboudreault<span>&#64;</span>mapgears<span>&#46;</span>com</a></td>
</tr>
<tr class="field-even field"><th class="field-name">Status:</th><td class="field-body">Adopted</td>
</tr>
<tr class="field-odd field"><th class="field-name">Version:</th><td class="field-body">MapServer 7.0</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This feature is experimental and backwards compatibility may be broken in
the not-so-short term as the functionality evolves. It is the evolution of the <a class="reference internal" href="ms-rfc-102.html#rfc102"><span>MS RFC 102: Support of Styleitem JavaScript Plugin</span></a>.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Refer to <a class="reference internal" href="../../mapfile/geomtransform.html#geomtransformjs"><span>Javascript transformation</span></a> for the up-to-date documentation.</p>
</div>
<div class="section" id="overview">
<h2>1. Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Being able to style our features programmatically through javascript is a nice
feature. This was added in <a class="reference internal" href="ms-rfc-102.html#rfc102"><span>MS RFC 102: Support of Styleitem JavaScript Plugin</span></a>. It allows us to avoid writing many
classes and styles in the mapfile. An additional use case of javascript could be
the ability to modify the geometry of the feature based on the input geometry
and/or its attributes.</p>
</div>
<div class="section" id="proposed-solution">
<h2>2. Proposed solution<a class="headerlink" href="#proposed-solution" title="Permalink to this headline">¶</a></h2>
<p>This RFC proposes the addition of a GEOMTRANSFORM javascript plugin. It will
allow us to modify the geometry programmatically through javascript. This is
similar to the built-in geomtransform (buffer, centroid, etc.), but allows you
to implement your own logic using javascript. Additionally, you will be able to modify
a geometry based on its attributes values.</p>
</div>
<div class="section" id="implementation-details">
<h2>3. Implementation Details<a class="headerlink" href="#implementation-details" title="Permalink to this headline">¶</a></h2>
<p>MapServer will have a new GEOMTRANSFORM keyword: <cite>javascript</cite>. This will point
to a javascript file, which needs to return a new geometry. The following objects
will be exposed for the purpose:</p>
<ul class="simple">
<li>shapeObj</li>
<li>lineObj</li>
<li>pointObj</li>
</ul>
<p>Hovewer, only a limited set of their properties will be available in JavaScript
(for the moment). The geomtransform looks for a function named <cite>geomtransform</cite>
and calls it.</p>
<div class="section" id="internal-implementation-details">
<h3>3.1 Internal Implementation Details<a class="headerlink" href="#internal-implementation-details" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>New binding v8 file structure: will be in mapscript/v8.</li>
<li>Upgrade v8 binding to use v8 3.20. (Synched with NodeJS, future possibility?)</li>
<li>Expose shapeObj, lineObj and pointObj to v8:</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>The objects will be exposed the same way we expose objects in nodejs. (future possibility?)</li>
<li>The objects will have a constructor, so a &#8220;new pointObj()&#8221; will be
possible. This is also mandatory to create a new geometry.</li>
<li>Modify the internal to use pre-determined function names for styleitem and
geomtransform rather than coding in the global scope.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="mapfile-and-javascript-examples">
<h3>3.2 Mapfile and JavaScript Examples<a class="headerlink" href="#mapfile-and-javascript-examples" title="Permalink to this headline">¶</a></h3>
<p>Here is an example of GEOMTRANSFORM javascript.</p>
<p>mapfile:</p>
<div class="highlight-mapfile"><div class="highlight"><pre><span></span><span class="k">LAYER</span>
    <span class="k">NAME</span> <span class="s">&quot;my_vector_layer&quot;</span>
    <span class="k">TYPE</span> <span class="nb">POINT</span>
    <span class="k">STATUS</span> <span class="nb">ON</span>
    <span class="k">GEOMTRANSFORM</span> <span class="s">&quot;javascript:///path/to/my/file.js&quot;</span>
    <span class="k">CLASS</span>
      <span class="k">STYLE</span>
      <span class="p">...</span>
      <span class="k">END</span>
    <span class="k">END</span>
<span class="k">END</span>
</pre></div>
</div>
<p>javascript:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">geomtransform</span><span class="p">(</span><span class="nx">shape</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">new_shape</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">shapeObj</span><span class="p">();</span> <span class="c1">// constructor</span>
  <span class="nx">new_shape</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="k">new</span> <span class="nx">lineObj</span><span class="p">());</span>

  <span class="nx">new_point</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">pointObj</span><span class="p">();</span>
  <span class="nx">new_point</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">clone_shape</span><span class="p">.</span><span class="nx">line</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">point</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">x</span><span class="p">;</span>
  <span class="nx">new_point</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">clone_shape</span><span class="p">.</span><span class="nx">line</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">point</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">y</span><span class="o">+</span><span class="mi">30000</span><span class="p">;</span> <span class="c1">// vertical translation in meters</span>
  <span class="nx">new_shape</span><span class="p">.</span><span class="nx">line</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">add</span><span class="p">(</span><span class="nx">new_point</span><span class="p">);</span>

  <span class="k">return</span> <span class="nx">new_shape</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="modifying-the-geometry-in-styleitem-javascript">
<h3>3.3 Modifying the geometry in Styleitem Javascript<a class="headerlink" href="#modifying-the-geometry-in-styleitem-javascript" title="Permalink to this headline">¶</a></h3>
<p>You can use styleitem javascript in combination with the geomtransform
javascript. However, this adds some overhead since two javascript scripts are
executed for each shape. For this reason, it will also be possible to modify the geometry in the
styleitem javascript method without having to use geomtransform. The difference in the styleitem javascript case is that instead of returning a new geometry, we modify the existing one. There might be some limitations with using
this method though. (ie. not sure if it is safe to return another type of geometry in this case).</p>
<p>Here is an example:</p>
<p>javascript:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">styleitem</span><span class="p">(</span><span class="nx">shape</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">new_shape</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">shapeObj</span><span class="p">();</span> <span class="c1">// constructor</span>
  <span class="nx">new_shape</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="k">new</span> <span class="nx">lineObj</span><span class="p">());</span>

  <span class="nx">new_point</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">pointObj</span><span class="p">();</span>
  <span class="nx">new_point</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">shape</span><span class="p">.</span><span class="nx">line</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">point</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">x</span><span class="p">;</span>
  <span class="nx">new_point</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">shape</span><span class="p">.</span><span class="nx">line</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">point</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">y</span><span class="o">+</span><span class="mi">30000</span><span class="p">;</span> <span class="c1">// vertical translation in meters</span>
  <span class="nx">new_shape</span><span class="p">.</span><span class="nx">line</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">add</span><span class="p">(</span><span class="nx">new_point</span><span class="p">);</span>

  <span class="nx">shape</span><span class="p">.</span><span class="nx">setGeometry</span><span class="p">(</span><span class="nx">new_shape</span><span class="p">);</span>

  <span class="k">return</span> <span class="s2">&quot;STYLE SYMBOL &#39;star&#39; COLOR 255 0 0  SIZE 10 END&quot;</span><span class="p">;</span> <span class="c1">// or compute your style..</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="files-affected">
<h3>3.4 Files affected<a class="headerlink" href="#files-affected" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>mapv8.cpp: Generic implementation of the V8 support.</li>
<li>mapscript/v8: New mapscript directory for the binding.</li>
</ul>
</div>
<div class="section" id="backwards-compatibility-issues">
<h3>3.5 Backwards Compatibility Issues<a class="headerlink" href="#backwards-compatibility-issues" title="Permalink to this headline">¶</a></h3>
<p>New functionality, but affects a little bit the <a class="reference internal" href="ms-rfc-102.html#rfc102"><span>MS RFC 102: Support of Styleitem JavaScript Plugin</span></a> (We don&#8217;t return values in the global scope any more).</p>
</div>
<div class="section" id="mapscript-changes">
<h3>3.6 MapScript changes<a class="headerlink" href="#mapscript-changes" title="Permalink to this headline">¶</a></h3>
<p>New mapscript bindings.</p>
</div>
</div>
<div class="section" id="bug-id">
<h2>4. Bug ID<a class="headerlink" href="#bug-id" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Pull request: <a class="reference external" href="https://github.com/mapserver/mapserver/pull/4827">https://github.com/mapserver/mapserver/pull/4827</a></li>
</ul>
</div>
<div class="section" id="voting-history">
<h2>5. Voting history<a class="headerlink" href="#voting-history" title="Permalink to this headline">¶</a></h2>
<p>Passed with +1 from Stephen, Daniel, Thomas, Stephan, Tamas, Jeff, Mike, Assefa, Steve and Perry</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Navigation</h3>
<p>
<a href="../../about.html" title="About">About</a><br>
<a href="../../products.html" title="Products">Products</a><br>
<a href="../../community/index.html" title="Community">Community</a><br>
<a href="../index.html" title="Development">Development</a><br>
<a href="../../download.html" title="Downloads">Downloads</a><br>
<a href="../../documentation.html" title="Documentation">Documentation</a><br>
<a href="../../faq.html" title="FAQ">FAQ</a>
</p>
  <h3>Current Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">MS RFC 106: Support of Geomtransform JavaScript Plugin</a><ul>
<li><a class="reference internal" href="#overview">1. Overview</a></li>
<li><a class="reference internal" href="#proposed-solution">2. Proposed solution</a></li>
<li><a class="reference internal" href="#implementation-details">3. Implementation Details</a><ul>
<li><a class="reference internal" href="#internal-implementation-details">3.1 Internal Implementation Details</a></li>
<li><a class="reference internal" href="#mapfile-and-javascript-examples">3.2 Mapfile and JavaScript Examples</a></li>
<li><a class="reference internal" href="#modifying-the-geometry-in-styleitem-javascript">3.3 Modifying the geometry in Styleitem Javascript</a></li>
<li><a class="reference internal" href="#files-affected">3.4 Files affected</a></li>
<li><a class="reference internal" href="#backwards-compatibility-issues">3.5 Backwards Compatibility Issues</a></li>
<li><a class="reference internal" href="#mapscript-changes">3.6 MapScript changes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#bug-id">4. Bug ID</a></li>
<li><a class="reference internal" href="#voting-history">5. Voting history</a></li>
</ul>
</li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Open Source Geospatial Foundation.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.4</a>
      
    </div>

    

    
  </body>
</html>