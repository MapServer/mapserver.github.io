<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>MS RFC 32: Support for Anti-Grain Geometry (AGG) Rendering Engine &#8212; MapServer 8.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx.css?v=6c7b17ac" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=dd298242" />
    <link rel="stylesheet" type="text/css" href="../../_static/ribbon.css?v=ea091bf4" />
    
    <script src="../../_static/documentation_options.js?v=521b6f53"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="icon" href="../../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="MS RFC 33: Removing msLayerWhichItems() from maplayer.c" href="ms-rfc-33.html" />
    <link rel="prev" title="MS RFC 31: Loading MapServer Objects from Strings" href="ms-rfc-31.html" /> 
  </head><body>


<!-- for main branch only, do not backport this -->

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../../index.html" title="Home"><img src="../../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../../index.html" title="Home">Home</a> |
      <a href="../../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter" target="_blank">Twitter</a> |
      <a href="../../download.html" title="Download Source or Binaries">Download </a> |
      <a class="badge" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=KRJ2X44N3HA6U&source=url" target="_blank">
        <img src="https://img.shields.io/badge/donate-%E2%9D%A4%C2%A0-ff69b4.svg?style=flat" alt="Donate to MapServer">
      </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../../ar/development/rfc/ms-rfc-32.html"><img src="../../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../../de/development/rfc/ms-rfc-32.html"><img src="../../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../../el/development/rfc/ms-rfc-32.html"><img src="../../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../../es/development/rfc/ms-rfc-32.html"><img src="../../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../../fr/development/rfc/ms-rfc-32.html"><img src="../../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../../id/development/rfc/ms-rfc-32.html"><img src="../../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../../it/development/rfc/ms-rfc-32.html"><img src="../../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../../ja/development/rfc/ms-rfc-32.html"><img src="../../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../../nl_NL/development/rfc/ms-rfc-32.html"><img src="../../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../../pl/development/rfc/ms-rfc-32.html"><img src="../../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../../ru/development/rfc/ms-rfc-32.html"><img src="../../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../../sq/development/rfc/ms-rfc-32.html"><img src="../../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../../tr/development/rfc/ms-rfc-32.html"><img src="../../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ms-rfc-33.html" title="MS RFC 33: Removing msLayerWhichItems() from maplayer.c"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-31.html" title="MS RFC 31: Loading MapServer Objects from Strings"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 32: Support for Anti-Grain Geometry (AGG) Rendering Engine</a></li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="ms-rfc-32-support-for-anti-grain-geometry-agg-rendering-engine">
<span id="rfc32"></span><h1>MS RFC 32: Support for Anti-Grain Geometry (AGG) Rendering Engine<a class="headerlink" href="#ms-rfc-32-support-for-anti-grain-geometry-agg-rendering-engine" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Date<span class="colon">:</span></dt>
<dd class="field-odd"><p>2007/07/09</p>
</dd>
<dt class="field-even">Author<span class="colon">:</span></dt>
<dd class="field-even"><p>Steve Lime, John Novak</p>
</dd>
<dt class="field-odd">Contact<span class="colon">:</span></dt>
<dd class="field-odd"><p>Steve.Lime at DNR.State.MN.US</p>
</dd>
<dt class="field-even">Status<span class="colon">:</span></dt>
<dd class="field-even"><p>Pending</p>
</dd>
</dl>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p>Presently MapServer supports GD (www.libgd.org) as its primary raster
rendering backend. While GD is sufficient in many instances it is not capable
of high quality output especially with regards to anti-aliased line work.
MapServer does support pseudo anti-aliased wide lines using variable opacity
“fuzzy” buffers, but the results are not as good as they could be.</p>
<p>AGG has emerged as one of the premier software-only rendering solutions and it
holds the promise of superior output quality with little or no apparent loss
in performance. In fact, AGG may well be faster than GD in some instances even
with the higher quality output.</p>
<p>That said, we are still heavily vested in GD for many things. Text positioning
and raster rendering in particular use GD functions directly. On the other
hand, AGG does not have built in functions to read or write popular graphics
formats such as GIF, JPEG or PNG. It makes sense then to consider a hybrid
solution wherein we can take advantage of aspects of GD that make sense such
as buffer management and I/O capabilities, and let AGG worry about rendering
features. That’s exactly what is proposed- AGG rendering into a GD managed
image buffer. A secondary benefit is that AGG functionality can be added
incrementally as time and resources permit. For example, since an AGG imageObj
is really just a gdImagePtr we can use current code that renders to a GD image
along side any AGG routines.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>See <a class="reference internal" href="../../output/agg.html#agg"><span class="std std-ref">AGG Rendering Specifics</span></a> for more information.</p>
</div>
</section>
<section id="technical-solution">
<h2>Technical Solution<a class="headerlink" href="#technical-solution" title="Link to this heading">¶</a></h2>
<p>The goal of this initial implementation is to be able to render the symbol and
style definitions the same way as GD does. That is, the AGG renderer should
produce output similar to GD but of a higher quality. No attempts are made at
this stage to introduce rendering capabilities specific to AGG unless
otherwise noted. As a result no additions to the MapServer symbolObj or
styleObj are necessary at this point.</p>
<p>For the most part, the AGG renderer can ingest processed shapeObj’s,
styleObj’s and symbolObj’s just as GD. That said, since AGG uses sub-pixel
computations to render features it does not want feature coordinates rounded
to integer values, so a special AGG-only map to image coordinate conversion
function msTransformShapeAGG. Note, that it may be that GD could also make use
of the non-rounded features and could just cast the doubles to ints when
passing x’s and y’s to GD (in fact the code already does this), but further
testing will be necessary.</p>
</section>
<section id="c-api-changes">
<h2>C API Changes<a class="headerlink" href="#c-api-changes" title="Link to this heading">¶</a></h2>
<p>In reality adding a new renderer has little or no effect on the MapServer
core. The following files are to be modified to add AGG specific processing
blocks that are basically straight copies of GD support:</p>
<ul class="simple">
<li><p>mapdraw.c</p></li>
<li><p>mapdrawgdal.c</p></li>
<li><p>maperror.c</p></li>
<li><p>maplegend.c</p></li>
<li><p>mapoutput.c</p></li>
<li><p>mapraster.c</p></li>
<li><p>mapresample.c</p></li>
<li><p>maputil.c</p></li>
</ul>
<p>No new functionality is added to these files, rather just else-if blocks.</p>
<p>The bulk of the AGG functionality can be found in a new source file,
mapagg.cpp. For better or worse it mimics the rendering API found in mapgd.c.
So, for example msDrawLineSymbolGD has a counter part in msDrawLineSymbolAGG.
Various helper functions/methods can also be found in that file.</p>
</section>
<section id="mapscript">
<h2>MapScript<a class="headerlink" href="#mapscript" title="Link to this heading">¶</a></h2>
<p>No changes.</p>
</section>
<section id="mapfiles">
<h2>Mapfiles<a class="headerlink" href="#mapfiles" title="Link to this heading">¶</a></h2>
<p>An output block like this will trigger AGG rendering:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">OUTPUTFORMAT</span>
  <span class="n">NAME</span> <span class="s1">&#39;AGG_PNG24&#39;</span>
  <span class="n">DRIVER</span> <span class="n">AGG</span><span class="o">/</span><span class="n">PNG</span>
  <span class="n">IMAGEMODE</span> <span class="n">RGB</span>
<span class="n">END</span>
</pre></div>
</div>
</section>
<section id="issues-and-caveats">
<h2>Issues and Caveats<a class="headerlink" href="#issues-and-caveats" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>The AGG driver only supports RGB output at this time. A fundamental
difference in how GD and AGG interpret alpha channel values (GD is
backwards) means that AGG cannot write to a GD alpha channel and have the
output interpreted correctly. This really shouldn’t be a deal breaker though
since vector rendering in MapServer does not write to the alpha channel
except when dealing with layer transparency, otherwise alpha blending
occurs. In addition, GD is back under active development and there are plans
to define a proper RGBA buffer.</p></li>
<li><p>Text and raster layers are drawn using GD. While text placement could
certainly benefit from sub-pixel placement there are not enough resources to
complete that support at this time. Hopefully it can be addressed soon.
Raster layer rendering doesn’t appear to benefit from AGG and will remain a
GD function at this time.</p></li>
<li><p>The following symbol, style combinations do not work under AGG: TODO</p></li>
<li><p>The AGG license was changed between versions 2.4 (BSD style) and 2.5 (GPL)
(<a class="reference external" href="http://www.antigrain.com/license/index.html">http://www.antigrain.com/license/index.html</a>). MapServer should use version
2.4 of the library until all implications of this change are clarified.</p></li>
</ul>
</section>
<section id="bug-id">
<h2>Bug ID<a class="headerlink" href="#bug-id" title="Link to this heading">¶</a></h2>
<p>None assigned</p>
</section>
<section id="voting-history">
<h2>Voting history<a class="headerlink" href="#voting-history" title="Link to this heading">¶</a></h2>
<p>None</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p>
<a href="../../about.html" title="About">About</a><br>
<a href="../../products.html" title="Products">Products</a><br>
<a href="../../community/index.html" title="Community">Community</a><br>
<a href="../index.html" title="Development">Development</a><br>
<a href="../../download.html" title="Downloads">Downloads</a><br>
<a href="../../documentation.html" title="Documentation">Documentation</a><br>
<a href="../../faq.html" title="FAQ">FAQ</a><br>
<a href="../../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</h3>
  <ul>
<li><a class="reference internal" href="#">MS RFC 32: Support for Anti-Grain Geometry (AGG) Rendering Engine</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#technical-solution">Technical Solution</a></li>
<li><a class="reference internal" href="#c-api-changes">C API Changes</a></li>
<li><a class="reference internal" href="#mapscript">MapScript</a></li>
<li><a class="reference internal" href="#mapfiles">Mapfiles</a></li>
<li><a class="reference internal" href="#issues-and-caveats">Issues and Caveats</a></li>
<li><a class="reference internal" href="#bug-id">Bug ID</a></li>
<li><a class="reference internal" href="#voting-history">Voting history</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ms-rfc-33.html" title="MS RFC 33: Removing msLayerWhichItems() from maplayer.c"
             >next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-31.html" title="MS RFC 31: Loading MapServer Objects from Strings"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 32: Support for Anti-Grain Geometry (AGG) Rendering Engine</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; <a href="../../copyright.html">Copyright</a> 2023, Open Source Geospatial Foundation.
      Last updated on 2023-12-22.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.5.
    </div>
  </body>
</html>