<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>MS RFC 126: Port to PROJ 6 API &#8212; MapServer 8.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx.css?v=6c7b17ac" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=dd298242" />
    <link rel="stylesheet" type="text/css" href="../../_static/ribbon.css?v=ea091bf4" />
    
    <script src="../../_static/documentation_options.js?v=521b6f53"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="icon" href="../../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="MS RFC 127: Drop (broken) support for builds without GDAL and PROJ" href="ms-rfc-127.html" />
    <link rel="prev" title="MS RFC 125: Support for CONNECTIONOPTIONS in mapfiles" href="ms-rfc-125.html" /> 
  </head><body>


<!-- for main branch only, do not backport this -->

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../../index.html" title="Home"><img src="../../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../../index.html" title="Home">Home</a> |
      <a href="../../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter" target="_blank">Twitter</a> |
      <a href="../../download.html" title="Download Source or Binaries">Download </a> |
      <a class="badge" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=KRJ2X44N3HA6U&source=url" target="_blank">
        <img src="https://img.shields.io/badge/donate-%E2%9D%A4%C2%A0-ff69b4.svg?style=flat" alt="Donate to MapServer">
      </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../../ar/development/rfc/ms-rfc-126.html"><img src="../../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../../de/development/rfc/ms-rfc-126.html"><img src="../../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../../el/development/rfc/ms-rfc-126.html"><img src="../../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../../es/development/rfc/ms-rfc-126.html"><img src="../../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../../fr/development/rfc/ms-rfc-126.html"><img src="../../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../../id/development/rfc/ms-rfc-126.html"><img src="../../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../../it/development/rfc/ms-rfc-126.html"><img src="../../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../../ja/development/rfc/ms-rfc-126.html"><img src="../../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../../nl_NL/development/rfc/ms-rfc-126.html"><img src="../../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../../pl/development/rfc/ms-rfc-126.html"><img src="../../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../../ru/development/rfc/ms-rfc-126.html"><img src="../../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../../sq/development/rfc/ms-rfc-126.html"><img src="../../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../../tr/development/rfc/ms-rfc-126.html"><img src="../../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ms-rfc-127.html" title="MS RFC 127: Drop (broken) support for builds without GDAL and PROJ"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-125.html" title="MS RFC 125: Support for CONNECTIONOPTIONS in mapfiles"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 126: Port to PROJ 6 API</a></li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="ms-rfc-126-port-to-proj-6-api">
<span id="rfc126"></span><h1>MS RFC 126: Port to PROJ 6 API<a class="headerlink" href="#ms-rfc-126-port-to-proj-6-api" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Date<span class="colon">:</span></dt>
<dd class="field-odd"><p>2019-10-01</p>
</dd>
<dt class="field-even">Author<span class="colon">:</span></dt>
<dd class="field-even"><p>Even Rouault</p>
</dd>
<dt class="field-odd">Contact<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="mailto:even&#46;rouault&#37;&#52;&#48;spatialys&#46;com">even<span>&#46;</span>rouault<span>&#64;</span>spatialys<span>&#46;</span>com</a></p>
</dd>
<dt class="field-even">Status<span class="colon">:</span></dt>
<dd class="field-even"><p>Adopted</p>
</dd>
<dt class="field-odd">Last update<span class="colon">:</span></dt>
<dd class="field-odd"><p>2019-10-10</p>
</dd>
<dt class="field-even">Version<span class="colon">:</span></dt>
<dd class="field-even"><p>MapServer 8.0</p>
</dd>
</dl>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p>Since March 1st 2019, <a class="reference external" href="https://proj.org/news.html">PROJ 6.0</a> has been released. This version deprecates
the “traditional” API available in proj_api.h, in favor or the new API
available in proj.h. For now, traditional API is still usable by defining the
ACCEPT_USE_OF_DEPRECATED_PROJ_API_H macro, but starting with PROJ 7.0, proj_api.h
will no longer be available.</p>
<p>This RFC thus is about the changes needed in MapServer to use proj.h new API.
Support for traditional proj_api.h is still kept for now, when MapServer is
built against PROJ 4.x or PROJ 5.x.</p>
</section>
<section id="proposed-solution">
<h2>Proposed solution<a class="headerlink" href="#proposed-solution" title="Link to this heading">¶</a></h2>
<p>Most of the interface with PROJ is contained in mapproject.c, so most of
the changes are done there, and the projectionObj object is the abstraction used
consistently in the code base to model a coordinate reference system. There were
just a number of direct calls to pj_is_latlong() that have been abstracted by a
new msProjIsGeographicCRS() function.</p>
<p>However, during testing of the initial implementation, it
appeared quickly that other changes were needed to preserve MapServer
performance. PROJ 6 new mechanisms to compute coordinate operations are quite
powerful, using a “late binding” approach trying to find the most direct
transformations between the source and target coordinate reference systems,
instead of going systematically through WGS84, with the well-known +towgs84=
or +nadgrids= PROJ keyword. Going through that WGS84 pivot can lead to bad
results, for example when transforming between 2 plate-fixed CRS such as GDA94
and GDA2020 which differ by 1.8m, but where the transformation between each of
those and WGS84 is a zero-shift transformation.</p>
<p>That new capability has however a computation price.
Whereas with PROJ 4.x, pj_transform() can be used without any problem to
transform a single coordinate tuple, using naively the equivalent calls
proj_create_crs_to_crs() + proj_trans() would be a major performance killer,
since proj_create_crs_to_crs() can take a time in the order of 100 milliseconds
in the most complex situations. There is consequently a need to cache the
PJ object resulting from proj_create_crs_to_crs() and reuse it when transforming
between the same (source_crs, target_crs).</p>
<p>The solution is thus to have a global pool of projection contexts, through a
projectionContext opaque structure, which in the case of PROJ 6 holds a
PJ_CONTEXT as well as a cache of PJ* transformation objets between several
(source_crs, target_crs) pairs. The mapObj structure is extended to store
tha projectionContext, and acquires one from the global pool in loadMap().
It assigns it to the mapObj.projection member, and all call sites where a
projectionObj is created in MapServer are modified to inherit thie projection
context. When the mapObj is disposed, its projection context is returned to
the global pool, so it can be reused by another request (FastCGI or MapScript
loop typically).</p>
<p>To avoid researching for an existing PJ* object for a (source_crs, target_crs)
in the cache of the current projection context, which has a price by itself,
a variant API for a number of functions like msProjectPoint(), msProjectShape() or msProjectLine() have
has been created to directly take a reprojectionObj* pointer instead of the
(projectionObj <em>in, projectionObj *out) tuple. That reprojectionObj</em> is mostly
a holder for the underlying PJ* coordinate transformation object. This can
also help in the PROJ 4.x case, since msProjectPoint() had to do a number of
checks on the nature of the CRS for each coordinate transformation, whereas
reprojectionObj can cache them.</p>
<p>So to sum up, the new functions are:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">projectionContext</span><span class="o">*</span><span class="w"> </span><span class="nf">msProjectionContextGetFromPool</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">msProjectionContextReleaseToPool</span><span class="p">(</span><span class="n">projectionContext</span><span class="o">*</span><span class="w"> </span><span class="n">ctx</span><span class="p">);</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">msProjectionContextPoolCleanup</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="n">reprojectionObj</span><span class="o">*</span><span class="w"> </span><span class="nf">msProjectCreateReprojector</span><span class="p">(</span><span class="n">projectionObj</span><span class="o">*</span><span class="w"> </span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="n">projectionObj</span><span class="o">*</span><span class="w"> </span><span class="n">out</span><span class="p">);</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">msProjectDestroyReprojector</span><span class="p">(</span><span class="n">reprojectionObj</span><span class="o">*</span><span class="w"> </span><span class="n">reprojector</span><span class="p">);</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">msProjectPointEx</span><span class="p">(</span><span class="n">reprojectionObj</span><span class="o">*</span><span class="w"> </span><span class="n">reprojector</span><span class="p">,</span><span class="w"> </span><span class="n">pointObj</span><span class="w"> </span><span class="o">*</span><span class="n">point</span><span class="p">);</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">msProjectShapeEx</span><span class="p">(</span><span class="n">reprojectionObj</span><span class="o">*</span><span class="w"> </span><span class="n">reprojector</span><span class="p">,</span><span class="w"> </span><span class="n">shapeObj</span><span class="w"> </span><span class="o">*</span><span class="n">shape</span><span class="p">);</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">msProjectLineEx</span><span class="p">(</span><span class="n">reprojectionObj</span><span class="o">*</span><span class="w"> </span><span class="n">reprojector</span><span class="p">,</span><span class="w"> </span><span class="n">lineObj</span><span class="w"> </span><span class="o">*</span><span class="n">line</span><span class="p">);</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">msProjectionInheritContextFrom</span><span class="p">(</span><span class="n">projectionObj</span><span class="w"> </span><span class="o">*</span><span class="n">pDst</span><span class="p">,</span><span class="w"> </span><span class="n">projectionObj</span><span class="o">*</span><span class="w"> </span><span class="n">pSrc</span><span class="p">);</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">msProjectionSetContext</span><span class="p">(</span><span class="n">projectionObj</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">projectionContext</span><span class="o">*</span><span class="w"> </span><span class="n">ctx</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="continuous-integration-changes">
<h2>Continuous integration changes<a class="headerlink" href="#continuous-integration-changes" title="Link to this heading">¶</a></h2>
<p>The PHP 7.3 configurations is modified to use PROJ 6 API, whereas other targets still
use the PROJ 4.x API.
To make maintaince of the test suite easier, all the Travis configuration are modified
to use PROJ 6.1.1. For the configurations which are not using the PROJ 6 API,
the proj.h file is simply deleted, and thus MapServer will use proj_api.h.
The reason to align all configurations on the same PROJ version is that, independantly
of the API which is used, there have been changes in PROJ that make the result of
coordinate reprojection slightly different, which affected a number of expected
results (this is mostly due to PROJ 6 defaulting to the enhanced transverse mercator
method, instead of the traditional algorithm used previously). That way, the
expected results are the same when using proj_api.h or proj.h (except one single
case where there is a difference at the micrometer level in a WCS GeoTIFF geokeys,
since proj_api.h and proj.h use a slightly different algorithm for geographic to
geocentric conversion)</p>
<p>Vagrant is also modified to use PROJ 6.1.1, and it creates 2 builds:
build_vagrant against the PROJ 4.x API, and build_vagrant_proj6 against the PROJ 6 API.</p>
</section>
<section id="implementation-details">
<h2>Implementation Details<a class="headerlink" href="#implementation-details" title="Link to this heading">¶</a></h2>
<p>The following files are modified:</p>
<ul class="simple">
<li><p>.travis.yml: change name of the PHP 7.3 config</p></li>
<li><p>CMakeLists.txt: take into account removal of mapprojhack.c</p></li>
<li><p>kerneldensity.c: create a reprojectionObj object, and use it with msProjectShapeEx</p></li>
<li><p>mapchart.c: same as above</p></li>
<li><p>mapcluster.c: same as above</p></li>
<li><p>mapcopy.c: share context in msCopyProjectionExtended()</p></li>
<li><p>mapdraw.c: use a reprojectionObj object and msProjectShapeEx(). Use msProjIsGeographicCRS()</p></li>
<li><p>mapfile.c: move msInitProjection(), msFreeProjection() and _msProcessAutoProjection() to mapproject.c. Context sharing in initMap() and initLayer()</p></li>
<li><p>mapgml.c: use a reprojectionObj object and msProjectShapeEx()</p></li>
<li><p>mapgraticule.c: use a reprojectionObj object and msProjectShapeEx(). Use msProjIsGeographicCRS()</p></li>
<li><p>mapkmlrenderer.cpp: context sharing. Use msProjIsGeographicCRS()</p></li>
<li><p>maplayer.c: use a reprojectionObj object and msProjectShapeEx()</p></li>
<li><p>mapmvt.c: same as above</p></li>
<li><p>mapobject.c: release projection context to the projection pool in msFreeMap()</p></li>
<li><p>mapogcfilter.c: context sharing</p></li>
<li><p>mapogcfilter.h: modify prototype of FLTDoAxisSwappingIfNecessary() to accept a mapObj* for context sharing</p></li>
<li><p>mapogcfiltercommon.c: context sharing</p></li>
<li><p>mapogcsos.c: use a reprojectionObj object and msProjectShapeEx()</p></li>
<li><p>mapogr.cpp: context sharing, and avoid lossy step through PROJ string in msOGRSpatialRef2ProjectionObj() when the CRS is a EPSG code</p></li>
<li><p>mapogroutput.c: use a reprojectionObj object and msProjectShapeEx()</p></li>
<li><p>mapows.c: context sharing. Use msProjIsGeographicCRS()</p></li>
<li><p>mapproject.c: lots of changes !</p></li>
<li><p>mapproject.h: new functions and structures</p></li>
<li><p>mapquery.c: use a reprojectionObj object and msProjectShapeEx()</p></li>
<li><p>mapresample.c: some PROJ 6 specific code paths, as there are direct calls to PROJ API</p></li>
<li><p>mapserver.h: projContext member added to mapObj, and 2 reprojector objects stored in layerObj</p></li>
<li><p>mapservutil.c: use of msProjIsGeographicCRS()</p></li>
<li><p>mapshape.c: use a reprojectionObj object and msProjectShapeEx()</p></li>
<li><p>mapshape.h: store a reprojector object in msTiledSHPLayerInfo</p></li>
<li><p>maptemplate.c: use a reprojectionObj object and msProjectShapeEx()</p></li>
<li><p>mapunion.c: same as above</p></li>
<li><p>maputil.c: call msProjectionContextPoolCleanup() in msCleanup()</p></li>
<li><p>mapwcs.c: context sharing. Use msProjIsGeographicCRS()</p></li>
<li><p>mapwcs11.c: context sharing.</p></li>
<li><p>mapwcs20.c: context sharing. Use msProjIsGeographicCRS()</p></li>
<li><p>mapwfs.c: context sharing</p></li>
<li><p>mapwms.c: context sharing</p></li>
<li><p>Vagrantfile: call a proj6.sh script</p></li>
<li><p>ci/travis/before_install.sh: install curl</p></li>
<li><p>ci/travis/install.sh: download and build PROJ 6. modify PHP 7.3 target to use it</p></li>
<li><p>cmake/FindProj.cmake: detect PROJ 6 API</p></li>
<li><p>msautotest/pymod/testlib.py: logic to test for an alternative expected result</p></li>
<li><p>msautotest/wxs/expected/: a number of file changed due to PROJ 6 enhanced transverse mercator</p></li>
<li><p>scripts/vagrant/mapserver.sh: PROJ 6 related buid changes</p></li>
<li><p>scripts/vagrant/packages.sh: install curl and sqlite3</p></li>
</ul>
<p>The following files are added:</p>
<ul class="simple">
<li><p>scripts/vagrant/proj6.sh: download and build PROJ 6</p></li>
</ul>
<p>The following files are deleted:</p>
<ul class="simple">
<li><p>mapprojhack.c: merged into mapproject.c</p></li>
</ul>
</section>
<section id="backwards-compatibility-issues">
<h2>Backwards Compatibility Issues<a class="headerlink" href="#backwards-compatibility-issues" title="Link to this heading">¶</a></h2>
<p>None on the Mapfile syntax. There might be slight changes in coordinate
reprojections due to PROJ changes.</p>
</section>
<section id="security-implications">
<h2>Security implications<a class="headerlink" href="#security-implications" title="Link to this heading">¶</a></h2>
<p>None.</p>
</section>
<section id="performance-implications">
<h2>Performance implications<a class="headerlink" href="#performance-implications" title="Link to this heading">¶</a></h2>
<p>Using PROJ 6 API is slower, especially for single-time invocations of the
MapServer CGI binary. This shows up in the runtime of msautotest, which consists
in a lot of such single-time invokations. Typical runtimes showed on Travis-CI
show about 9 min for a PROJ 4 API build vs 15 min 30s for a PROJ 6 API build. There
isn’t much that can be done about that.</p>
<p>For use cases involving FastCGI or WSGI using MapScript where a process is long/longer
lived, the projection context pooling strategy helps a lot to alleviate that cost.</p>
<p>We have used the following simple MapScript python code and mapfile to bench
the performance.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
    <span class="nb">map</span> <span class="o">=</span> <span class="n">mapscript</span><span class="o">.</span><span class="n">mapObj</span><span class="p">(</span><span class="s1">&#39;bench.map&#39;</span><span class="p">)</span>
    <span class="n">mapscript</span><span class="o">.</span><span class="n">msIO_installStdoutToBuffer</span><span class="p">()</span>
    <span class="n">request</span> <span class="o">=</span> <span class="n">mapscript</span><span class="o">.</span><span class="n">OWSRequest</span><span class="p">()</span>
    <span class="n">request</span><span class="o">.</span><span class="n">loadParamsFromURL</span><span class="p">(</span><span class="s1">&#39;service=WMS&amp;version=1.1.1&amp;request=GetMap&amp;layers=grey&amp;srs=EPSG:4269&amp;bbox=-180,-90,180,90&amp;format=image/png&amp;width=80&amp;height=40&#39;</span><span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="nb">map</span><span class="o">.</span><span class="n">OWSDispatch</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mapscript</span><span class="o">.</span><span class="n">msIO_getStdoutBufferBytes</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">MAP</span>
    <span class="k">NAME</span> <span class="err">TEST</span>
    <span class="k">STATUS</span> <span class="nb">ON</span>
    <span class="k">SIZE</span> <span class="mi">80</span> <span class="mi">40</span>
    <span class="k">EXTENT</span> <span class="p">-</span><span class="mi">180</span> <span class="p">-</span><span class="mi">90</span> <span class="mi">180</span> <span class="mi">90</span>

    <span class="k">PROJECTION</span>
        <span class="s">&quot;init=epsg:4326&quot;</span>
    <span class="k">END</span>

    <span class="k">OUTPUTFORMAT</span>
        <span class="k">NAME</span> <span class="err">png</span><span class="mi">24</span><span class="err">_t</span>
        <span class="k">DRIVER</span> <span class="s">&quot;GDAL/PNG&quot;</span>
        <span class="k">IMAGEMODE</span> <span class="nb">RGBA</span>
    <span class="k">END</span>

    <span class="k">WEB</span>
    <span class="k">METADATA</span>
        <span class="s">&quot;ows_enable_request&quot;</span> <span class="s">&quot;*&quot;</span>
        <span class="s">&quot;wms_srs&quot;</span> <span class="s">&quot;EPSG:4326 EPSG:4269&quot;</span>
        <span class="s">&quot;ows_http_max_age&quot;</span> <span class="s">&quot;86400&quot;</span>
    <span class="k">END</span>
    <span class="k">END</span>

    <span class="k">LAYER</span>
        <span class="k">NAME</span> <span class="err">grey</span>
        <span class="k">TYPE</span> <span class="nb">raster</span>
        <span class="k">STATUS</span> <span class="nb">default</span>
        <span class="k">DATA</span> <span class="p">..</span><span class="o">/</span><span class="nb">gdal</span><span class="o">/</span><span class="k">data</span><span class="o">/</span><span class="err">grey</span><span class="p">.</span><span class="err">tif</span>
    <span class="k">END</span>
<span class="k">END</span>
</pre></div>
</div>
<p>This involves a reprojection from WGS84 to NAD83, which
With the same GDAL 2.4 and PROJ main branch (7.0dev) builds, looping 500 times
over test() leads to a 0.9 ms runtime per iteration using PROJ 4 API, whereas
1.1 ms using PROJ 6 API.</p>
<p>If doing single iteration, on hot runs, with PROJ 4 API, the runtime is 19 ms,
and with PROJ 6 API, 30 ms.</p>
<p>This case is a bit extreme, in that the rendering is extremely fast, and thus
coordinate operation setup is non neglectable. For use cases where the request
takes longer, it is expected that the time difference is proportionnaly lower.</p>
</section>
<section id="mapscript-implications">
<h2>MapScript implications<a class="headerlink" href="#mapscript-implications" title="Link to this heading">¶</a></h2>
<p>None.</p>
</section>
<section id="documentation-needs">
<h2>Documentation needs<a class="headerlink" href="#documentation-needs" title="Link to this heading">¶</a></h2>
<p>None in theory since there is no syntax change. However some words will be
added to <a class="reference external" href="https://mapserver.org/mapfile/projection.html">https://mapserver.org/mapfile/projection.html</a> to recommand the use
of the init=epsg:XXXX syntax instead of PROJ 4 CRS strings to benefit from
the more accurate late-binding coordinate transformations.</p>
</section>
<section id="ticket-id-and-references">
<h2>Ticket ID and references<a class="headerlink" href="#ticket-id-and-references" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Ticket: <a class="reference external" href="https://github.com/MapServer/MapServer/issues/5766">https://github.com/MapServer/MapServer/issues/5766</a></p></li>
<li><p>Pull request available at: <a class="reference external" href="https://github.com/MapServer/MapServer/pull/5888">https://github.com/MapServer/MapServer/pull/5888</a></p></li>
</ul>
</section>
<section id="voting-history">
<h2>Voting history<a class="headerlink" href="#voting-history" title="Link to this heading">¶</a></h2>
<p>+1 from PSC members Even Rouault, Mickael Smith,
Seth Girvin, Daniel Morissette and Jukka Rahkonen.</p>
</section>
<section id="credits">
<h2>Credits<a class="headerlink" href="#credits" title="Link to this heading">¶</a></h2>
<p>Thanks to funding from the French Ministry of Defense.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p>
<a href="../../about.html" title="About">About</a><br>
<a href="../../products.html" title="Products">Products</a><br>
<a href="../../community/index.html" title="Community">Community</a><br>
<a href="../index.html" title="Development">Development</a><br>
<a href="../../download.html" title="Downloads">Downloads</a><br>
<a href="../../documentation.html" title="Documentation">Documentation</a><br>
<a href="../../faq.html" title="FAQ">FAQ</a><br>
<a href="../../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</h3>
  <ul>
<li><a class="reference internal" href="#">MS RFC 126: Port to PROJ 6 API</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#proposed-solution">Proposed solution</a></li>
<li><a class="reference internal" href="#continuous-integration-changes">Continuous integration changes</a></li>
<li><a class="reference internal" href="#implementation-details">Implementation Details</a></li>
<li><a class="reference internal" href="#backwards-compatibility-issues">Backwards Compatibility Issues</a></li>
<li><a class="reference internal" href="#security-implications">Security implications</a></li>
<li><a class="reference internal" href="#performance-implications">Performance implications</a></li>
<li><a class="reference internal" href="#mapscript-implications">MapScript implications</a></li>
<li><a class="reference internal" href="#documentation-needs">Documentation needs</a></li>
<li><a class="reference internal" href="#ticket-id-and-references">Ticket ID and references</a></li>
<li><a class="reference internal" href="#voting-history">Voting history</a></li>
<li><a class="reference internal" href="#credits">Credits</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ms-rfc-127.html" title="MS RFC 127: Drop (broken) support for builds without GDAL and PROJ"
             >next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-125.html" title="MS RFC 125: Support for CONNECTIONOPTIONS in mapfiles"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 126: Port to PROJ 6 API</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; <a href="../../copyright.html">Copyright</a> 2023, Open Source Geospatial Foundation.
      Last updated on 2023-12-22.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.5.
    </div>
  </body>
</html>