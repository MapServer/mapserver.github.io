<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>MS RFC 68: Support for combining features from multiple layers &#8212; MapServer 8.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx.css?v=6c7b17ac" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=dd298242" />
    <link rel="stylesheet" type="text/css" href="../../_static/ribbon.css?v=ea091bf4" />
    
    <script src="../../_static/documentation_options.js?v=521b6f53"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="icon" href="../../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="MS RFC 69: Support for clustering of features in point layers" href="ms-rfc-69.html" />
    <link rel="prev" title="MS RFC 67: Enable/Disable Layers in OGC Web Services" href="ms-rfc-67.html" /> 
  </head><body>


<!-- for main branch only, do not backport this -->

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../../index.html" title="Home"><img src="../../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../../index.html" title="Home">Home</a> |
      <a href="../../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter" target="_blank">Twitter</a> |
      <a href="../../download.html" title="Download Source or Binaries">Download </a> |
      <a class="badge" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=KRJ2X44N3HA6U&source=url" target="_blank">
        <img src="https://img.shields.io/badge/donate-%E2%9D%A4%C2%A0-ff69b4.svg?style=flat" alt="Donate to MapServer">
      </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../../ar/development/rfc/ms-rfc-68.html"><img src="../../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../../de/development/rfc/ms-rfc-68.html"><img src="../../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../../el/development/rfc/ms-rfc-68.html"><img src="../../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../../es/development/rfc/ms-rfc-68.html"><img src="../../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../../fr/development/rfc/ms-rfc-68.html"><img src="../../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../../id/development/rfc/ms-rfc-68.html"><img src="../../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../../it/development/rfc/ms-rfc-68.html"><img src="../../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../../ja/development/rfc/ms-rfc-68.html"><img src="../../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../../nl_NL/development/rfc/ms-rfc-68.html"><img src="../../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../../pl/development/rfc/ms-rfc-68.html"><img src="../../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../../ru/development/rfc/ms-rfc-68.html"><img src="../../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../../sq/development/rfc/ms-rfc-68.html"><img src="../../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../../tr/development/rfc/ms-rfc-68.html"><img src="../../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ms-rfc-69.html" title="MS RFC 69: Support for clustering of features in point layers"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-67.html" title="MS RFC 67: Enable/Disable Layers in OGC Web Services"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 68: Support for combining features from multiple layers</a></li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="ms-rfc-68-support-for-combining-features-from-multiple-layers">
<span id="rfc68"></span><h1>MS RFC 68: Support for combining features from multiple layers<a class="headerlink" href="#ms-rfc-68-support-for-combining-features-from-multiple-layers" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Date<span class="colon">:</span></dt>
<dd class="field-odd"><p>2011/02/10</p>
</dd>
<dt class="field-even">Author<span class="colon">:</span></dt>
<dd class="field-even"><p>Tamas Szekeres</p>
</dd>
<dt class="field-odd">Contact<span class="colon">:</span></dt>
<dd class="field-odd"><p>szekerest at gmail.com</p>
</dd>
<dt class="field-even">Status<span class="colon">:</span></dt>
<dd class="field-even"><p>Adopted (Implemented on 2011-03-04)</p>
</dd>
<dt class="field-odd">Version<span class="colon">:</span></dt>
<dd class="field-odd"><p>MapServer 6.0</p>
</dd>
</dl>
<p>Description: This RFC proposes an implementation for creating a new data
provider (CONNECTIONTYPE=UNION) which provides an option to represent features
from multiple layers in a single layer.</p>
<section id="overview">
<h2>1. Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p>Today, you can combine multiple files using a tileindex, but only if they have
the same attributes, and description. In theory, it might be nice to be able to have
multiple source layers that have similar attributes and to be able to combine them
into a single layer (being called as union layer) using some compatible subset of the source
column attributes so that the combined layer could be treated as a single layer.
We could then use this single layer in the same way as any other layer when setting
up the classes styles and labels. This layer could also provide the option to use
features from multiple layers when configuring clustering support
as per <a class="reference internal" href="ms-rfc-69.html#rfc69"><span class="std std-ref">MS RFC 69</span></a>.</p>
</section>
<section id="the-proposed-solution">
<h2>2. The proposed solution<a class="headerlink" href="#the-proposed-solution" title="Link to this heading">¶</a></h2>
<p>This functionality will be implemented as a separate layer data provider (CONNECTIONTYPE=UNION).
The union layer will use the CONNECTION parameter to define the source layers in the
mapfiles as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LAYER</span>
  <span class="n">CONNECTIONTYPE</span> <span class="n">UNION</span>
  <span class="n">CONNECTION</span> <span class="s2">&quot;layer1,layer2,layer3&quot;</span> <span class="c1"># reference to the source layers</span>
  <span class="n">NAME</span> <span class="s2">&quot;union-layer&quot;</span>
  <span class="n">PROCESSING</span> <span class="s2">&quot;ITEMS=itemname1,itemname2,itemname3&quot;</span>
  <span class="o">...</span>
<span class="n">END</span>
<span class="n">LAYER</span>
  <span class="n">CONNECTIONTYPE</span> <span class="n">OGR</span>
  <span class="n">NAME</span> <span class="n">layer1</span>
  <span class="o">...</span>
<span class="n">END</span>
<span class="n">LAYER</span>
  <span class="n">CONNECTIONTYPE</span> <span class="n">SHAPE</span>
  <span class="n">NAME</span> <span class="n">layer2</span>
  <span class="o">...</span>
<span class="n">END</span>
<span class="n">LAYER</span>
  <span class="n">CONNECTIONTYPE</span> <span class="n">SHAPE</span>
  <span class="n">NAME</span> <span class="n">layer3</span>
  <span class="o">...</span>
<span class="n">END</span>
</pre></div>
</div>
<p>The new layer data provider will work in the following way:</p>
<ol class="arabic simple">
<li><p>In LayerOpen, it will open all of the source layers specified by the CONNECTION parameter</p></li>
<li><p>The LayerWhichShapes call will be delegated to the underlying layers and provide the rectangle
for the area of interest</p></li>
<li><p>LayerNextShape will iterate through the layers and call LayerNextShape for the subsequent shapes.
The layer index is assigned to the tileindex of the returned shapes. If we finish retrieving the
shapes from one layer we start retrieving the features from the next source layer.</p></li>
<li><p>LayerGetShape will identify the layer based on the tile index and then call LayerGetShape of this layer</p></li>
</ol>
<p>The union layer and the source layers must have the same geometry type otherwise an error is generated in
the LayerOpen call.</p>
</section>
<section id="handling-the-layer-attributes-items">
<h2>2.1 Handling the layer attributes (items)<a class="headerlink" href="#handling-the-layer-attributes-items" title="Link to this heading">¶</a></h2>
<p>In general the source layers must provide those attributes which are required when
rendering the union layer, however the underlying data may contain further attributes,
which are not used when fetching the data from the original source.
When all attributes are requested (in the query operations) then the union layer will
provide only some aggegated attributes (like the layer name or the group name of the source
layer the feature belongs to).
The set of the items can manually be overridden (and further attributes can be exposed)
by using the existing ITEMS processing option.
At this stage of the development, the driver will expose the following additional attributes:</p>
<ol class="arabic simple">
<li><p>Combine:SourceLayerName - The name of the source layer the feature belongs to</p></li>
<li><p>Combine:SourceLayerGroup - The group of the source layer the feature belongs to</p></li>
</ol>
</section>
<section id="projections">
<h2>2.2 Projections<a class="headerlink" href="#projections" title="Link to this heading">¶</a></h2>
<p>It is suggested to use the same projection of the union layer and the source layers. The layer provider
will however support transforming the feature positions between the source layers and the union layer.</p>
</section>
<section id="handling-classes-and-styles">
<h2>2.3 Handling classes and styles<a class="headerlink" href="#handling-classes-and-styles" title="Link to this heading">¶</a></h2>
<p>We can define the symbology and labelling of the union layers in the same way as
any other layer by specifying the classes and styles. In addition we will also support
the STYLEITEM AUTO option for the union layer, which is essential if we want to display
the features in the same way as with the source layers. The source layers
may also use the STYLEITEM AUTO setting if the underlying data source provides that.</p>
</section>
<section id="query-processing">
<h2>2.4 Query processing<a class="headerlink" href="#query-processing" title="Link to this heading">¶</a></h2>
<p>The driver will create (and operate on) a copy of the source layers which will allow to
keep the underlying layers open until the union layer is open. This will provide the
single pass query to work in case if the source layer supports it.
The queries on the union layer will anyway behave the same like with the other layers.</p>
</section>
<section id="implementation-details">
<h2>3. Implementation Details<a class="headerlink" href="#implementation-details" title="Link to this heading">¶</a></h2>
<p>In order to implement this enhancement the following changes should be made in the MapServer codebase:</p>
<ol class="arabic simple">
<li><p>Modify the lexer to interpret the new connection type (UNION).</p></li>
<li><p>Implement mapunion.c containing the code of the union layer data source.</p></li>
</ol>
</section>
<section id="files-affected">
<h2>3.1 Files affected<a class="headerlink" href="#files-affected" title="Link to this heading">¶</a></h2>
<p>The following files will be modified/created by this RFC:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">maplexer</span><span class="o">.</span><span class="n">l</span> <span class="p">(</span><span class="n">maplexer</span><span class="o">.</span><span class="n">c</span><span class="p">)</span>
<span class="n">mapserver</span><span class="o">.</span><span class="n">h</span>
<span class="n">Makefile</span><span class="o">.</span><span class="n">vc</span>
<span class="n">Makefile</span><span class="o">.</span><span class="ow">in</span>
<span class="n">mapunion</span><span class="o">.</span><span class="n">c</span> <span class="p">(</span><span class="n">new</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="mapscript-issues">
<h2>3.2 MapScript Issues<a class="headerlink" href="#mapscript-issues" title="Link to this heading">¶</a></h2>
<p>The connection type of this new layer will be exposed in the MapScript interface.
No further impact is taken into account at the moment.</p>
</section>
<section id="backwards-compatibility-issues">
<h2>3.3 Backwards Compatibility Issues<a class="headerlink" href="#backwards-compatibility-issues" title="Link to this heading">¶</a></h2>
<p>This change provides a new functionality with no backwards compatibility issues being considered.</p>
</section>
<section id="bug-id">
<h2>4. Bug ID<a class="headerlink" href="#bug-id" title="Link to this heading">¶</a></h2>
<p>The ticket for RFC-68 (containing implementation code) can be found here.</p>
<p>Bug <a class="reference external" href="https://github.com/MapServer/MapServer/issues/3674">3674</a></p>
</section>
<section id="voting-history">
<h2>5. Voting history<a class="headerlink" href="#voting-history" title="Link to this heading">¶</a></h2>
<p>+1 from SteveW, DanielM, AssefaY, PericlesN, ThomasB, SteveL, TamasS</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p>
<a href="../../about.html" title="About">About</a><br>
<a href="../../products.html" title="Products">Products</a><br>
<a href="../../community/index.html" title="Community">Community</a><br>
<a href="../index.html" title="Development">Development</a><br>
<a href="../../download.html" title="Downloads">Downloads</a><br>
<a href="../../documentation.html" title="Documentation">Documentation</a><br>
<a href="../../faq.html" title="FAQ">FAQ</a><br>
<a href="../../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</h3>
  <ul>
<li><a class="reference internal" href="#">MS RFC 68: Support for combining features from multiple layers</a><ul>
<li><a class="reference internal" href="#overview">1. Overview</a></li>
<li><a class="reference internal" href="#the-proposed-solution">2. The proposed solution</a></li>
<li><a class="reference internal" href="#handling-the-layer-attributes-items">2.1 Handling the layer attributes (items)</a></li>
<li><a class="reference internal" href="#projections">2.2 Projections</a></li>
<li><a class="reference internal" href="#handling-classes-and-styles">2.3 Handling classes and styles</a></li>
<li><a class="reference internal" href="#query-processing">2.4 Query processing</a></li>
<li><a class="reference internal" href="#implementation-details">3. Implementation Details</a></li>
<li><a class="reference internal" href="#files-affected">3.1 Files affected</a></li>
<li><a class="reference internal" href="#mapscript-issues">3.2 MapScript Issues</a></li>
<li><a class="reference internal" href="#backwards-compatibility-issues">3.3 Backwards Compatibility Issues</a></li>
<li><a class="reference internal" href="#bug-id">4. Bug ID</a></li>
<li><a class="reference internal" href="#voting-history">5. Voting history</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ms-rfc-69.html" title="MS RFC 69: Support for clustering of features in point layers"
             >next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-67.html" title="MS RFC 67: Enable/Disable Layers in OGC Web Services"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 68: Support for combining features from multiple layers</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; <a href="../../copyright.html">Copyright</a> 2023, Open Source Geospatial Foundation.
      Last updated on 2023-12-22.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.5.
    </div>
  </body>
</html>