<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>MS RFC 3: Feature Layer Plug-in Architecture &#8212; MapServer 8.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx.css?v=6c7b17ac" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=dd298242" />
    <link rel="stylesheet" type="text/css" href="../../_static/ribbon.css?v=ea091bf4" />
    
    <script src="../../_static/documentation_options.js?v=521b6f53"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="icon" href="../../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="MS RFC 4: MapServer Raster Resampling" href="ms-rfc-4.html" />
    <link rel="prev" title="MS RFC 2: Creating line features and/or shapes using WKT" href="ms-rfc-2.html" /> 
  </head><body>


<!-- for main branch only, do not backport this -->

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../../index.html" title="Home"><img src="../../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../../index.html" title="Home">Home</a> |
      <a href="../../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter" target="_blank">Twitter</a> |
      <a href="../../download.html" title="Download Source or Binaries">Download </a> |
      <a class="badge" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=KRJ2X44N3HA6U&source=url" target="_blank">
        <img src="https://img.shields.io/badge/donate-%E2%9D%A4%C2%A0-ff69b4.svg?style=flat" alt="Donate to MapServer">
      </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../../ar/development/rfc/ms-rfc-3.html"><img src="../../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../../de/development/rfc/ms-rfc-3.html"><img src="../../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../../el/development/rfc/ms-rfc-3.html"><img src="../../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../../es/development/rfc/ms-rfc-3.html"><img src="../../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../../fr/development/rfc/ms-rfc-3.html"><img src="../../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../../id/development/rfc/ms-rfc-3.html"><img src="../../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../../it/development/rfc/ms-rfc-3.html"><img src="../../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../../ja/development/rfc/ms-rfc-3.html"><img src="../../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../../nl_NL/development/rfc/ms-rfc-3.html"><img src="../../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../../pl/development/rfc/ms-rfc-3.html"><img src="../../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../../ru/development/rfc/ms-rfc-3.html"><img src="../../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../../sq/development/rfc/ms-rfc-3.html"><img src="../../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../../tr/development/rfc/ms-rfc-3.html"><img src="../../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ms-rfc-4.html" title="MS RFC 4: MapServer Raster Resampling"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-2.html" title="MS RFC 2: Creating line features and/or shapes using WKT"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 3: Feature Layer Plug-in Architecture</a></li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="ms-rfc-3-feature-layer-plug-in-architecture">
<span id="rfc3"></span><h1>MS RFC 3: Feature Layer Plug-in Architecture<a class="headerlink" href="#ms-rfc-3-feature-layer-plug-in-architecture" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Date<span class="colon">:</span></dt>
<dd class="field-odd"><p>2005/08/22</p>
</dd>
<dt class="field-even">Author<span class="colon">:</span></dt>
<dd class="field-even"><p>Jani Averbach</p>
</dd>
<dt class="field-odd">Contact<span class="colon">:</span></dt>
<dd class="field-odd"><p>javerbach at extendthereach.com</p>
</dd>
<dt class="field-even">Status<span class="colon">:</span></dt>
<dd class="field-even"><p>Adopted</p>
</dd>
<dt class="field-odd">Version<span class="colon">:</span></dt>
<dd class="field-odd"><p>MapServer 4.8</p>
</dd>
</dl>
<section id="abstract-solution">
<h2>Abstract Solution<a class="headerlink" href="#abstract-solution" title="Link to this heading">¶</a></h2>
<p>Implement a virtual table structure for <cite>layerObj</cite>. This structure
will contain function pointers for all layer specific operations.
This structure will be populated when the layer is opened or first
time accessed.  After that all back-end format specific layer
operations will happen through this vtable which is cached in the
<cite>layerObj</cite> struct.</p>
</section>
<section id="technical-solution">
<h2>Technical Solution<a class="headerlink" href="#technical-solution" title="Link to this heading">¶</a></h2>
<p>All file names and numbers are against released MapServer 4.6.0 source
code.</p>
<ol class="arabic">
<li><p>Add new field to the <cite>layerObj</cite>. It will be pointer to the vtable,
which will contain function pointers for this layer.</p></li>
<li><p>Add the virtual table architecture</p>
<p>The vtable will be initialized when the layer is accessed at the
first time.
The vtable will be populated with dummies when it is created and
these dummies will implement feasible default actions if there is
any (e.g. do nothing) or return error by default.</p>
<p>2.1. Standard functions which are found currently from <cite>maplayer.c</cite></p>
<blockquote>
<div><p>2.1.1. InitItemInfo</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="p">(</span><span class="o">*</span><span class="n">LayerInitItemInfo</span><span class="p">)(</span><span class="n">layerObj</span> <span class="o">*</span><span class="n">layer</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<p>2.1.2. FreeItemInfo</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="p">(</span><span class="o">*</span><span class="n">LayerFreeItemInfo</span><span class="p">)(</span><span class="n">layerObj</span> <span class="o">*</span><span class="n">layer</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<p>2.1.3. Open</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="p">(</span><span class="o">*</span><span class="n">LayerOpen</span><span class="p">)(</span><span class="n">layerObj</span> <span class="o">*</span><span class="n">layer</span><span class="p">);</span>
</pre></div>
</div>
<p>Currently there are two layers which accept more than
the generic layer arg for LayerOpen function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">msOGRLayerOpen</span><span class="p">(</span><span class="n">layerObj</span> <span class="o">*</span><span class="n">layer</span><span class="p">,</span>
                   <span class="n">const</span> <span class="n">char</span> <span class="o">*</span><span class="n">pszOverrideConnection</span><span class="p">);</span>
<span class="nb">int</span> <span class="n">msWFSLayerOpen</span><span class="p">(</span><span class="n">layerObj</span> <span class="o">*</span><span class="n">lp</span><span class="p">,</span>
                   <span class="n">const</span> <span class="n">char</span> <span class="o">*</span><span class="n">pszGMLFilename</span><span class="p">,</span>
                   <span class="n">rectObj</span> <span class="o">*</span><span class="n">defaultBBOX</span><span class="p">);</span>
</pre></div>
</div>
<p>However, these are called from <cite>msLayerOpen</cite> with
<cite>NULL</cite> args, so I think that proposed interface for
this virtual table function should be fine.</p>
</div></blockquote>
<p>2.1.4. IsOpen</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="p">(</span><span class="o">*</span><span class="n">LayerIsOpen</span><span class="p">)(</span><span class="n">layerObj</span> <span class="o">*</span><span class="n">layer</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<p>2.1.5. WhichShapes</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="p">(</span><span class="o">*</span><span class="n">LayerWhichShapes</span><span class="p">)(</span><span class="n">layerObj</span> <span class="o">*</span><span class="n">layer</span><span class="p">,</span>
                        <span class="n">rectObj</span> <span class="n">rect</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<p>2.1.6. NextShape</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="p">(</span><span class="o">*</span><span class="n">LayerNextShape</span><span class="p">)(</span><span class="n">layerObj</span> <span class="o">*</span><span class="n">layer</span><span class="p">,</span> <span class="n">shapeObj</span> <span class="o">*</span><span class="n">shape</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<p>2.1.7. GetShape</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="p">(</span><span class="o">*</span><span class="n">LayerGetShape</span><span class="p">)(</span><span class="n">layerObj</span> <span class="o">*</span><span class="n">layer</span><span class="p">,</span> <span class="n">shapeObj</span> <span class="o">*</span><span class="n">shape</span><span class="p">,</span>
                     <span class="nb">int</span> <span class="n">tile</span><span class="p">,</span> <span class="n">long</span> <span class="n">record</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<p>2.1.8. LayerClose</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="p">(</span><span class="o">*</span><span class="n">LayerClose</span><span class="p">)(</span><span class="n">layerObj</span> <span class="o">*</span><span class="n">layer</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<p>2.1.9. LayerGetItems</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="p">(</span><span class="o">*</span><span class="n">LayerGetItems</span><span class="p">)(</span><span class="n">layerObj</span> <span class="o">*</span><span class="n">layer</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<p>2.1.10. GetExtent</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="p">(</span><span class="o">*</span><span class="n">LayerGetExtent</span><span class="p">)(</span><span class="n">layerObj</span> <span class="o">*</span><span class="n">layer</span><span class="p">,</span>
                      <span class="n">rectObj</span> <span class="o">*</span><span class="n">extent</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<p>2.1.11. GetAutoStyle</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="p">(</span><span class="o">*</span><span class="n">LayerGetAutoStyle</span><span class="p">)(</span><span class="n">mapObj</span> <span class="o">*</span><span class="nb">map</span><span class="p">,</span> <span class="n">layerObj</span> <span class="o">*</span><span class="n">layer</span><span class="p">,</span>
                         <span class="n">classObj</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="nb">int</span> <span class="n">tile</span><span class="p">,</span>
                         <span class="n">long</span> <span class="n">record</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
<p>2.2.  New functions and/or fields for vtable</p>
<blockquote>
<div><p>2.2.1. CloseConnection</p>
<blockquote>
<div><p>This function is used to actually close the
connection, in case that layer implements some kind of
connection pooling by its own.  If layer doesn’t use
any connection pooling, this function should be
implemented as no-op. Caller should first call layer’s
“close” function, and finally at the very end
<cite>CloseConnection</cite>.</p>
<p>The signature of function is</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="p">(</span><span class="o">*</span><span class="n">LayerCloseConnection</span><span class="p">)(</span><span class="n">layerObj</span> <span class="o">*</span><span class="n">layer</span><span class="p">);</span>
</pre></div>
</div>
<p>And the main place where this function will be called,
is <cite>mapfile.c: 4822</cite></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">msCloseConnections</span><span class="p">(</span><span class="n">mapObj</span> <span class="o">*</span><span class="nb">map</span><span class="p">)</span>
</pre></div>
</div>
<p>This function is needed because e.g. <cite>POSTGIS</cite> is
implementing this usage pattern at the moment
<cite>maplayer.c:599</cite></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">void</span> <span class="n">msLayerClose</span><span class="p">(</span><span class="n">layerObj</span> <span class="o">*</span><span class="n">layer</span><span class="p">)</span>
 <span class="o">...</span>
<span class="o">/*</span>
 <span class="o">*</span> <span class="n">Due</span> <span class="n">to</span> <span class="n">connection</span> <span class="n">sharing</span><span class="p">,</span> <span class="n">we</span> <span class="n">need</span> <span class="n">to</span> <span class="n">close</span> <span class="n">the</span> <span class="n">results</span>
 <span class="o">*</span> <span class="ow">and</span> <span class="n">free</span> <span class="n">the</span> <span class="n">cursor</span><span class="p">,</span> <span class="n">but</span> <span class="ow">not</span> <span class="n">close</span> <span class="n">the</span> <span class="n">connection</span><span class="o">.</span>
 <span class="o">*/</span>
 <span class="n">msPOSTGISLayerResultClose</span><span class="p">(</span><span class="n">layer</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<p>2.2.2. SetTimeFilter</p>
<blockquote>
<div><p>This function is used to create a time filter for
layer. At the moment we have three special cases
(<cite>maplayer.c: 1635</cite>):</p>
<ol class="arabic simple">
<li><p><cite>POSTGIS</cite> with it’s own function</p></li>
<li><p>Layers with backticks delimited expressions</p></li>
<li><p>Layers without backticks</p></li>
</ol>
<p>The idea is provide a generic helper function,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">makeTimeFilter</span><span class="p">(</span><span class="n">layerObj</span> <span class="o">*</span><span class="n">lp</span><span class="p">,</span>
                   <span class="n">const</span> <span class="n">char</span> <span class="o">*</span><span class="n">timestring</span><span class="p">,</span>
                   <span class="n">const</span> <span class="n">char</span> <span class="o">*</span><span class="n">timefield</span><span class="p">,</span>
                   <span class="n">const</span> <span class="nb">bool</span> <span class="n">bBackTicks</span><span class="p">)</span>
</pre></div>
</div>
<p>And the actual layer’s <cite>SetTimeFilter</cite> could use the
above, or implement something totally different as
<cite>POSTGIS</cite> is doing at the moment.</p>
<p>The signature for layer’s vtable function is</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="p">(</span><span class="o">*</span><span class="n">LayerSetTimeFilter</span><span class="p">)(</span><span class="n">layerObj</span> <span class="o">*</span><span class="n">lp</span><span class="p">,</span>
                          <span class="n">const</span> <span class="n">char</span> <span class="o">*</span><span class="n">timestring</span><span class="p">,</span>
                          <span class="n">const</span> <span class="n">char</span> <span class="o">*</span><span class="n">timefield</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
<p>2.3. Extra functions to add to the vtable</p>
<blockquote>
<div><p>2.3.1. FLTApplyFilterToLayer (<cite>mapogcfilter.c: 1084</cite>)</p>
<blockquote>
<div><p>This is the main filter interface for layers.  We will
provide two helper functions, one for “SQL” case and
the another for “non-SQL” case, and set all layers,
except <cite>POSTGIS</cite>, <cite>ORACLESPATIAL</cite> and <cite>OGR</cite> to
call directly this “non-SQL” version of this helper
function (else-branch of if).</p>
<p><cite>ORACLESPATIAL</cite>, <cite>POSTGIS</cite> and <cite>OGR</cite> could use
“SQL” version of the helper function (actual if-branch)
if the conditions for this are met, otherwise they will
use Non-SQL version of the function.</p>
</div></blockquote>
<p>2.3.2. layerObj-&gt;items allocation</p>
<blockquote>
<div><p>There will be vtable function for allocation <cite>items</cite> and
initialization for <cite>numitems</cite>. If layer has some
special needs for these objects it can override default
function.</p>
<p>The signature for function will be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="p">(</span><span class="o">*</span><span class="n">CreateItems</span><span class="p">)(</span><span class="n">layerObj</span> <span class="o">*</span><span class="p">)</span>
</pre></div>
</div>
<p>which does the allocation and set numitems to correct
value.</p>
</div></blockquote>
<p>2.3.3. msCheckConnection (<cite>mapfile.c: 4779</cite>)</p>
<blockquote>
<div><p>This API is deprecated. It is called only from
<cite>msMYGISLayerOpen</cite>.  We will not provide this
functionality through vtable.</p>
</div></blockquote>
</div></blockquote>
<p>2.4. Interface functions for internal layers</p>
<blockquote>
<div><p>We have to add some new interface functions to access layers.</p>
<p>2.4.1 Function interface to initialize internal layer type</p>
<blockquote>
<div><p>We need a per layer type a function which will be called
when the layer’s vtable has to be initialized. These
functions will be</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">msXXXInitializeLayerVirtualTable</span><span class="p">(</span><span class="n">layerObj</span> <span class="o">*</span><span class="p">)</span>
</pre></div>
</div>
<p>where XXX will be name of the layer. This function is
called anytime when the vtable isn’t initialized and the
layer is accessed at the first time.</p>
</div></blockquote>
<p>2.4.2 Function interface to change the connectiontype of layer</p>
<blockquote>
<div><p>To change the connection type of layer, it has to be
done by function interface. Accessing directly
<cite>connectiontype</cite> field is not supported anymore.</p>
<p>To change the connectiontype and to connect to the new
layer, there will be following interface function</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">msConnectLayer</span><span class="p">(</span><span class="nb">int</span> <span class="n">connectiontype</span><span class="p">,</span>
                   <span class="n">const</span> <span class="n">char</span> <span class="o">*</span><span class="n">library_str</span><span class="p">)</span>
</pre></div>
</div>
<p>where <cite>connectiontype</cite> is the type of new layer, and
<cite>library_str</cite> is the name of library which will
prodive functionality for this new layer.  For internal
layer types this second argument is ignored.</p>
</div></blockquote>
</div></blockquote>
</li>
<li><p>Remove unwanted interfaces</p>
<p>Frank Warmerdam proposed <a class="reference internal" href="#fw1" id="id1"><span>[FW1]</span></a> that we remove all layer specific
interface functions from <cite>map.h</cite>.</p>
<blockquote>
<div><p>I see each “built-in” module such as mapsde.c providing a
registration function such as “msSDEInitializeLayerVirtualTable”
so that none of the layer type specific definitions need to
appear in map.h any more.</p>
</div></blockquote>
<div role="list" class="citation-list">
<div class="citation" id="fw1" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">FW1</a><span class="fn-bracket">]</span></span>
<div class="line-block">
<div class="line"><cite>Frank Warmerdam on the mapserver-dev:</cite></div>
<div class="line"><cite>Message-Id: &lt;smtpd.490f.4303f2ee.d8246.1&#64;mtaout-c.tc.umn.edu&gt;</cite></div>
<div class="line"><cite>Date:       Wed, 17 Aug 2005 22:31:09 -0400</cite></div>
<div class="line"><cite>Subject:    Re: MapServer  Plug-in Infastructure: RFC and PATCH</cite></div>
</div>
</div>
</div>
</li>
</ol>
</section>
<section id="files-and-objects-affected">
<h2>Files and objects affected<a class="headerlink" href="#files-and-objects-affected" title="Link to this heading">¶</a></h2>
<p>This proposal will affect at least following files and objects:</p>
<ul class="simple">
<li><p><cite>map.h</cite></p>
<ul>
<li><p><cite>layerObj</cite> will contain new fields. There will be a new
object <cite>vtableObj</cite> in the <cite>map.h</cite>.</p></li>
</ul>
</li>
<li><p><cite>maplayer.c</cite></p>
<ul>
<li><p>Various changes, layer specific <cite>switch</cite>-statements will go
away, vtable handling and layers vtable initialization will be
added.</p></li>
</ul>
</li>
<li><p><cite>mapfile.c</cite></p>
<ul>
<li><p>Cleaning of  <cite>msCheckConnection</cite></p></li>
<li><p>Vtable for <cite>msCloseConnection</cite></p></li>
</ul>
</li>
<li><p><cite>mapogcfilter.c</cite></p>
<ul>
<li><p>Remove layer-logic from <cite>FLTApplyFilterToLayer</cite></p></li>
</ul>
</li>
<li><p><cite>mapXXX.c</cite>, where <cite>XXX</cite> is the name of layer.</p>
<ul>
<li><p>Add new initialization function</p></li>
<li><p>Add all new interface functions</p></li>
<li><p>Fix existing interface functions, if needed / add wrappers for
<cite>msOGRLayerOpen</cite> and <cite>msWFSLayerOpen</cite>.</p></li>
</ul>
</li>
</ul>
</section>
<section id="backwards-compatibility-issues">
<h2>Backwards compatibility issues<a class="headerlink" href="#backwards-compatibility-issues" title="Link to this heading">¶</a></h2>
<p>This is binary and source code level backward incompatible change. The
proposal will remove some previously public functions, and add new
field(s) to the <cite>layerObj</cite> struct.</p>
<p>This proposal is not MapScript backward compatible, it will break
scripts which change directly <cite>connectiontype</cite> field in
<cite>layerObj</cite>.</p>
<p>The proposal is MAP-file backward compatible.</p>
</section>
<section id="implementation-issues">
<h2>Implementation Issues<a class="headerlink" href="#implementation-issues" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Biggest problem is probably that the author has ignored or missed
something by oversight which will show up during implementation.
However, there is a prototype implementation of external plug-in
architecture which works at the moment and is based on ideas
presented in this proposal.  So there is some real life experience
that this architecture change is feasible thing to do.</p></li>
<li><p>I also like to note that this proposal won’t remove all layer
specific code from MapServer e.g. <cite>WMF</cite>, <cite>WMS</cite> and <cite>GRATICULE</cite>
are used as special cases from place to place.</p></li>
</ul>
</section>
<section id="bug-id">
<h2>Bug ID<a class="headerlink" href="#bug-id" title="Link to this heading">¶</a></h2>
<p>Bug <a class="reference external" href="https://github.com/MapServer/MapServer/issues/1477">1477</a></p>
</section>
<section id="voting-history">
<h2>Voting history<a class="headerlink" href="#voting-history" title="Link to this heading">¶</a></h2>
<p>Vote proposed by Jani Averbach on 9/19/2005, result was +4
(3 non-voting members).</p>
<p>Voting +1: Howard Butler, Frank Warmerdam, Yewondwossen Assefa, Daniel Morissette</p>
<p>Proposal passes and will move forward.</p>
</section>
<section id="open-questions">
<h2>Open questions<a class="headerlink" href="#open-questions" title="Link to this heading">¶</a></h2>
<ul>
<li><p>How do we like to expose layer’s virtual table to the layers. We
have at least two different routes to go:</p>
<ul class="simple">
<li><p>expose it as a struct, layers will fill vtable pointers by
accessing directly struct’s field.</p></li>
<li><p>expose it as a complete opaque type, vtable pointers will be set
by accessing functions <cite>setLayerOpenFP</cite>, <cite>setLayerCloseFP</cite> and
so on.</p></li>
</ul>
<p>The advance of second option is that this way we could easily add
new functions to the struct if we refactor code more or found some
logic which is ignored by oversight in this proposal.</p>
</li>
<li><p>Are there any special issues with the raster query layer support
which is handled via the layer API?</p></li>
</ul>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p>
<a href="../../about.html" title="About">About</a><br>
<a href="../../products.html" title="Products">Products</a><br>
<a href="../../community/index.html" title="Community">Community</a><br>
<a href="../index.html" title="Development">Development</a><br>
<a href="../../download.html" title="Downloads">Downloads</a><br>
<a href="../../documentation.html" title="Documentation">Documentation</a><br>
<a href="../../faq.html" title="FAQ">FAQ</a><br>
<a href="../../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</h3>
  <ul>
<li><a class="reference internal" href="#">MS RFC 3: Feature Layer Plug-in Architecture</a><ul>
<li><a class="reference internal" href="#abstract-solution">Abstract Solution</a></li>
<li><a class="reference internal" href="#technical-solution">Technical Solution</a></li>
<li><a class="reference internal" href="#files-and-objects-affected">Files and objects affected</a></li>
<li><a class="reference internal" href="#backwards-compatibility-issues">Backwards compatibility issues</a></li>
<li><a class="reference internal" href="#implementation-issues">Implementation Issues</a></li>
<li><a class="reference internal" href="#bug-id">Bug ID</a></li>
<li><a class="reference internal" href="#voting-history">Voting history</a></li>
<li><a class="reference internal" href="#open-questions">Open questions</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ms-rfc-4.html" title="MS RFC 4: MapServer Raster Resampling"
             >next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-2.html" title="MS RFC 2: Creating line features and/or shapes using WKT"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 3: Feature Layer Plug-in Architecture</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; <a href="../../copyright.html">Copyright</a> 2023, Open Source Geospatial Foundation.
      Last updated on 2023-12-22.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.5.
    </div>
  </body>
</html>