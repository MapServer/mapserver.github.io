<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>MS RFC 104: Replace BITMAP labels with embedded Truetype font &#8212; MapServer 8.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx.css?v=6c7b17ac" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=dd298242" />
    <link rel="stylesheet" type="text/css" href="../../_static/ribbon.css?v=ea091bf4" />
    
    <script src="../../_static/documentation_options.js?v=521b6f53"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="icon" href="../../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="MS RFC 105: Support for WFS 2.0 (server side)" href="ms-rfc-105.html" />
    <link rel="prev" title="MS RFC 103: Layer Level Character Encoding Handling" href="ms-rfc-103.html" /> 
  </head><body>


<!-- for main branch only, do not backport this -->

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../../index.html" title="Home"><img src="../../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../../index.html" title="Home">Home</a> |
      <a href="../../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter" target="_blank">Twitter</a> |
      <a href="../../download.html" title="Download Source or Binaries">Download </a> |
      <a class="badge" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=KRJ2X44N3HA6U&source=url" target="_blank">
        <img src="https://img.shields.io/badge/donate-%E2%9D%A4%C2%A0-ff69b4.svg?style=flat" alt="Donate to MapServer">
      </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../../ar/development/rfc/ms-rfc-104.html"><img src="../../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../../de/development/rfc/ms-rfc-104.html"><img src="../../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../../el/development/rfc/ms-rfc-104.html"><img src="../../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../../es/development/rfc/ms-rfc-104.html"><img src="../../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../../fr/development/rfc/ms-rfc-104.html"><img src="../../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../../id/development/rfc/ms-rfc-104.html"><img src="../../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../../it/development/rfc/ms-rfc-104.html"><img src="../../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../../ja/development/rfc/ms-rfc-104.html"><img src="../../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../../nl_NL/development/rfc/ms-rfc-104.html"><img src="../../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../../pl/development/rfc/ms-rfc-104.html"><img src="../../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../../ru/development/rfc/ms-rfc-104.html"><img src="../../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../../sq/development/rfc/ms-rfc-104.html"><img src="../../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../../tr/development/rfc/ms-rfc-104.html"><img src="../../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ms-rfc-105.html" title="MS RFC 105: Support for WFS 2.0 (server side)"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-103.html" title="MS RFC 103: Layer Level Character Encoding Handling"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 104: Replace BITMAP labels with embedded Truetype font</a></li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="ms-rfc-104-replace-bitmap-labels-with-embedded-truetype-font">
<span id="rfc104"></span><h1>MS RFC 104: Replace BITMAP labels with embedded Truetype font<a class="headerlink" href="#ms-rfc-104-replace-bitmap-labels-with-embedded-truetype-font" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Date<span class="colon">:</span></dt>
<dd class="field-odd"><p>2013/09</p>
</dd>
<dt class="field-even">Author<span class="colon">:</span></dt>
<dd class="field-even"><p>Thomas Bonfort</p>
</dd>
<dt class="field-odd">Contact<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="mailto:thomas&#46;bonfort&#37;&#52;&#48;gmail&#46;com">thomas<span>&#46;</span>bonfort<span>&#64;</span>gmail<span>&#46;</span>com</a></p>
</dd>
<dt class="field-even">Status<span class="colon">:</span></dt>
<dd class="field-even"><p>Adopted</p>
</dd>
<dt class="field-odd">Version<span class="colon">:</span></dt>
<dd class="field-odd"><p>MapServer 7.0</p>
</dd>
</dl>
<section id="the-current-situation">
<h2>1. The Current Situation<a class="headerlink" href="#the-current-situation" title="Link to this heading">¶</a></h2>
<p>MapServer supports embedded BITMAP fonts for the simple rendering
of text without need for external font files or fontsets. These are
activated by using the TINY, SMALL, MEDIUM, LARGE and HUGE keywords
in the LABEL block, but have a number of limitations:</p>
<ul class="simple">
<li><p>They are only supported by the AGG renderer. The Cairo and KML renderers
will bailout if they are supplied with a bitmap font. GD was the other
only renderer to support them, it has however been removed in the 7.0 release.</p></li>
<li><p>They only support the ASCII character set. Accented letters
or common symbols are either ignored or replaced with a stopgap character</p></li>
<li><p>They do not support rotation. FOLLOW labels will result in an error, while
explicitly rotated or AUTO labels will be incorrectly rendered horizontally.</p></li>
<li><p>The quality of their rendering is not up to par with today’s cartographic
rendering expectations.</p></li>
</ul>
<p>They do however have the following advantages:</p>
<ul class="simple">
<li><p>They require no dependency on external font files, and therefore do not
require creating or maintaining a fontset file. As such they are ideal
for rapid mapfile prototyping.</p></li>
<li><p>They do not go through freetype for rendering and thus are extremely fast
to render (which seems only fair given their limitations)</p></li>
</ul>
<section id="upcoming-evolution">
<h3>1.1 Upcoming Evolution<a class="headerlink" href="#upcoming-evolution" title="Link to this heading">¶</a></h3>
<p>With the arrival of <a class="reference internal" href="ms-rfc-98.html#rfc98"><span class="std std-ref">MS RFC 98: Label/Text Rendering Overhaul</span></a> and <a class="reference internal" href="ms-rfc-99.html#rfc99"><span class="std std-ref">MS RFC 99: Remove support for GD renderer</span></a>, maintaining the support
for bitmap fonts requires quite a number of warts in the code. Given this and
the other limitations enumerated beforehand, this RFC proposes the removal of
the BITMAP font support throughout the MapServer codebase.</p>
<p>To maintain the ability to rapidly prototype mapfiles and/or to not have to
rely on external truetype fonts and fontsets, they will however be replaced
by an embedded truetype font.</p>
</section>
</section>
<section id="embedded-truetype-font">
<h2>2. Embedded Truetype Font<a class="headerlink" href="#embedded-truetype-font" title="Link to this heading">¶</a></h2>
<p>A Truetype font will be encoded and included as a binary blob inside the
mapserver library. It will be used whenever no specific font has been supplied
by the mapfile user, or as a backwards compatibility fallback when bitmap
fonts are requested.</p>
</section>
<section id="implications">
<h2>2.1 Implications<a class="headerlink" href="#implications" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Embedded truetype fonts will be automatically supported by all renderers</p></li>
<li><p>Embedded truetype fonts will cover a much larger character set</p></li>
<li><p>Embedded truetype fonts will support rotation and FOLLOW labels</p></li>
<li><p>Code will be cleaned up and easier to maintain</p></li>
<li><p>Rendering will be marginally slower than with bitmap fonts</p></li>
<li><p>Due to the graphic quality of the rendered text, image sizes will be slightly
larger than with bitmap fonts (due to the antialiasing).</p></li>
</ul>
</section>
<section id="backwards-compatibility">
<h2>2.2 Backwards Compatibility<a class="headerlink" href="#backwards-compatibility" title="Link to this heading">¶</a></h2>
<p>Rendered images when using embedded fonts will differ compared to the previous
renderings with bitmap fonts. Aside from this point, no backwards incompatibility
is to be expected: The bitmap keyword and label type will be ignored, and the
TINY, SMALL, MEDIUM, LARGE and HUGE keyboard will be mapped to integer font
sizes of matching visual height.</p>
</section>
<section id="performance-implications">
<h2>2.3 Performance Implications<a class="headerlink" href="#performance-implications" title="Link to this heading">¶</a></h2>
<p>Might be noticeable:</p>
<ul class="simple">
<li><p>Slower rendering of bitmap glyphs</p></li>
<li><p>Larger image sizes</p></li>
</ul>
</section>
<section id="future-improvements">
<h2>2.4 Future Improvements<a class="headerlink" href="#future-improvements" title="Link to this heading">¶</a></h2>
<p>These are not planned immediately, but could be investigated in the future
depending on interest or funding:</p>
<ul class="simple">
<li><p>Choosing at compile-time which truetype font should be embedded</p></li>
<li><p>Embedding multiple fonts</p></li>
<li><p>Allowing aliased glyph rendering from freetype to minimize image size</p></li>
</ul>
</section>
<section id="implementation-details">
<h2>3. Implementation Details<a class="headerlink" href="#implementation-details" title="Link to this heading">¶</a></h2>
<section id="affected-files">
<h3>3.1 Affected files<a class="headerlink" href="#affected-files" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>mapfile.c/h: parser, backwards compatibility</p></li>
<li><p>mapagg.cpp, maplabel.c, textlayout.c, others…: bitmap support removal</p></li>
</ul>
</section>
<section id="mapscript">
<h3>3.2 MapScript<a class="headerlink" href="#mapscript" title="Link to this heading">¶</a></h3>
<p>Bitmap related functions could be extended to provide a warning the feature
has been removed. No other changes should be required due to the transparent
backwards compatibility handling.</p>
</section>
<section id="tracking-issue">
<h3>3.3 Tracking Issue<a class="headerlink" href="#tracking-issue" title="Link to this heading">¶</a></h3>
<p>TBD</p>
</section>
</section>
<section id="discussion">
<h2>4. Discussion<a class="headerlink" href="#discussion" title="Link to this heading">¶</a></h2>
<p>The truetype file we embed shall have a licence that allows such usage,
and a glyph coverage supporting most used languages while not being too large
to limit memory consumption. Unless decided otherwise during the comment period,
the chosen font will be the DejaVuSansCondensed.ttf truetype font commonly
supplied with Linux distros.</p>
</section>
<section id="voting-history">
<h2>5. Voting History<a class="headerlink" href="#voting-history" title="Link to this heading">¶</a></h2>
<p>+1 from SteveL, ThomasB, PericlesN, TamasS, TomK,
StephanM, YewondwosssenA, MikeS, DanielM and StephenW</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p>
<a href="../../about.html" title="About">About</a><br>
<a href="../../products.html" title="Products">Products</a><br>
<a href="../../community/index.html" title="Community">Community</a><br>
<a href="../index.html" title="Development">Development</a><br>
<a href="../../download.html" title="Downloads">Downloads</a><br>
<a href="../../documentation.html" title="Documentation">Documentation</a><br>
<a href="../../faq.html" title="FAQ">FAQ</a><br>
<a href="../../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</h3>
  <ul>
<li><a class="reference internal" href="#">MS RFC 104: Replace BITMAP labels with embedded Truetype font</a><ul>
<li><a class="reference internal" href="#the-current-situation">1. The Current Situation</a><ul>
<li><a class="reference internal" href="#upcoming-evolution">1.1 Upcoming Evolution</a></li>
</ul>
</li>
<li><a class="reference internal" href="#embedded-truetype-font">2. Embedded Truetype Font</a></li>
<li><a class="reference internal" href="#implications">2.1 Implications</a></li>
<li><a class="reference internal" href="#backwards-compatibility">2.2 Backwards Compatibility</a></li>
<li><a class="reference internal" href="#performance-implications">2.3 Performance Implications</a></li>
<li><a class="reference internal" href="#future-improvements">2.4 Future Improvements</a></li>
<li><a class="reference internal" href="#implementation-details">3. Implementation Details</a><ul>
<li><a class="reference internal" href="#affected-files">3.1 Affected files</a></li>
<li><a class="reference internal" href="#mapscript">3.2 MapScript</a></li>
<li><a class="reference internal" href="#tracking-issue">3.3 Tracking Issue</a></li>
</ul>
</li>
<li><a class="reference internal" href="#discussion">4. Discussion</a></li>
<li><a class="reference internal" href="#voting-history">5. Voting History</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ms-rfc-105.html" title="MS RFC 105: Support for WFS 2.0 (server side)"
             >next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-103.html" title="MS RFC 103: Layer Level Character Encoding Handling"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 104: Replace BITMAP labels with embedded Truetype font</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; <a href="../../copyright.html">Copyright</a> 2023, Open Source Geospatial Foundation.
      Last updated on 2023-12-22.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.5.
    </div>
  </body>
</html>