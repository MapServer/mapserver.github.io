<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>MS RFC 5: MapServer Horizon Reprojection Improvements &#8212; MapServer 8.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx.css?v=6c7b17ac" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=dd298242" />
    <link rel="stylesheet" type="text/css" href="../../_static/ribbon.css?v=ea091bf4" />
    
    <script src="../../_static/documentation_options.js?v=521b6f53"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="icon" href="../../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="MS RFC 6: Color Range Mapping of Continuous Feature Values" href="ms-rfc-6.html" />
    <link rel="prev" title="MS RFC 4: MapServer Raster Resampling" href="ms-rfc-4.html" /> 
  </head><body>


<!-- for main branch only, do not backport this -->

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../../index.html" title="Home"><img src="../../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../../index.html" title="Home">Home</a> |
      <a href="../../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter" target="_blank">Twitter</a> |
      <a href="../../download.html" title="Download Source or Binaries">Download </a> |
      <a class="badge" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=KRJ2X44N3HA6U&source=url" target="_blank">
        <img src="https://img.shields.io/badge/donate-%E2%9D%A4%C2%A0-ff69b4.svg?style=flat" alt="Donate to MapServer">
      </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../../ar/development/rfc/ms-rfc-5.html"><img src="../../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../../de/development/rfc/ms-rfc-5.html"><img src="../../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../../el/development/rfc/ms-rfc-5.html"><img src="../../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../../es/development/rfc/ms-rfc-5.html"><img src="../../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../../fr/development/rfc/ms-rfc-5.html"><img src="../../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../../id/development/rfc/ms-rfc-5.html"><img src="../../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../../it/development/rfc/ms-rfc-5.html"><img src="../../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../../ja/development/rfc/ms-rfc-5.html"><img src="../../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../../nl_NL/development/rfc/ms-rfc-5.html"><img src="../../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../../pl/development/rfc/ms-rfc-5.html"><img src="../../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../../ru/development/rfc/ms-rfc-5.html"><img src="../../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../../sq/development/rfc/ms-rfc-5.html"><img src="../../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../../tr/development/rfc/ms-rfc-5.html"><img src="../../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ms-rfc-6.html" title="MS RFC 6: Color Range Mapping of Continuous Feature Values"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-4.html" title="MS RFC 4: MapServer Raster Resampling"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 5: MapServer Horizon Reprojection Improvements</a></li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="ms-rfc-5-mapserver-horizon-reprojection-improvements">
<span id="rfc5"></span><h1>MS RFC 5: MapServer Horizon Reprojection Improvements<a class="headerlink" href="#ms-rfc-5-mapserver-horizon-reprojection-improvements" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Date<span class="colon">:</span></dt>
<dd class="field-odd"><p>2005/09/16</p>
</dd>
<dt class="field-even">Author<span class="colon">:</span></dt>
<dd class="field-even"><p>Frank Warmerdam</p>
</dd>
<dt class="field-odd">Contact<span class="colon">:</span></dt>
<dd class="field-odd"><p>warmerdam at pobox.com</p>
</dd>
<dt class="field-even">Status<span class="colon">:</span></dt>
<dd class="field-even"><p>Adopted</p>
</dd>
<dt class="field-odd">Version<span class="colon">:</span></dt>
<dd class="field-odd"><p>MapServer 4.8</p>
</dd>
</dl>
<section id="purpose">
<h2>Purpose<a class="headerlink" href="#purpose" title="Link to this heading">¶</a></h2>
<p>To provide a practical solution to MapServer Bug 411 - Clipping Issue
with Ortho Projection:</p>
<blockquote>
<div><p><a class="reference external" href="https://github.com/MapServer/MapServer/issues/411">https://github.com/MapServer/MapServer/issues/411</a></p>
</div></blockquote>
</section>
<section id="approach">
<h2>Approach<a class="headerlink" href="#approach" title="Link to this heading">¶</a></h2>
<p>The msProjectShape() function would be altered support reprojection
of shapes where some, but not all, vertices fail to transform due to issues
such as falling over the horizon.  An iterative method would be used to
preserve a reduced geometry approximating the portion that can be transformed.</p>
</section>
<section id="point-features">
<h2>Point Features<a class="headerlink" href="#point-features" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Point features will be handled as they are now.  The either transform
successfully or not.  Those that fail to transform are dropped.</p></li>
</ul>
</section>
<section id="line-features">
<h2>Line Features<a class="headerlink" href="#line-features" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Line strings would potentially be split into multiple line strings, if
there were more than one discontinuous portion of a line string that
transforms.</p></li>
<li><p>Interpolated (horizon) points would be computed by transforming points
along the line segment between the last successful point and the first
unsuccessful point.  A binary search algorithm will be used to find the
closest point within our tolerance distance.</p></li>
<li><p>Line strings where no vertices transform successfully will still be dropped.</p></li>
</ul>
</section>
<section id="area-features">
<h2>Area Features<a class="headerlink" href="#area-features" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Each ring will be treated distinctly, without regard to the other rings.
This means no there is no assurance that an inner ring will remain
completely within the outer ring after clipping.  In particular, where
the horizon passes through an area and a hole in the area, it is likely
that the hole edge will touch over even overlap the outer area edge a bit.
Generally this should not matter much in the MapServer context since a
simple scanline rasterization (winding number based) technique is used.
So polygon “correctness” is not paramount.</p></li>
<li><p>A similar technique to that for lines is used to interpolate the edge
vertices when clipping is to be applied.</p></li>
<li><p>For polygons there will be two (or possibly 4, 6, 8…) interpolated
horizon points.  These will be connected with a straight line segment.
For very large polygons spanning a significant portion of the horizon
(ie. dozens of degrees of arc of the horizon) this will result in part of
the circle of the horizon getting clipped off.  Optionally an iterative
method could be applied to address this curvature issue (not priced into
this proposal).</p></li>
</ul>
</section>
<section id="tolerances">
<h2>Tolerances<a class="headerlink" href="#tolerances" title="Link to this heading">¶</a></h2>
<p>MapServer will need make a decision on how detailed to get when doing the
iterative horizon determination.   The tolerance will be fixed as half the
size of a pixel in the current map rendering.   In normal map drawing this
should mean that the final rendering is effectively exact.</p>
<p>However, communicating the tolerance into msProjectShape() will require
substantial work as the msProjectShape() function does not normally know
anything about the map or current rendering information.  To communicate
this information to msProjectShape(), I will add a transformation options
structure with this information (and possibly other flags controlling
transformation) which will be passed into msProjectShape().  If NULL
particular defaults will be used.</p>
<p>All appropriate uses of msProjectShape() will need to be updated to reflect
this change, and to setup the transformation options information ahead of
time.  layerObj level PROCESSING options will also be provided to control
(override) the default transformation options.</p>
</section>
<section id="caveats">
<h2>Caveats<a class="headerlink" href="#caveats" title="Link to this heading">¶</a></h2>
<ol class="arabic simple">
<li><p>msProjectShape() may produce slightly invalid polygons from a GIS
point of view, though it shouldn’t matter much for rendering purposes.</p></li>
<li><p>The straight line segment for “area horizon edges” will result in visible
“clipping” of the horizon for very large polygons (ie. the Soviet Union).</p></li>
<li><p>This change is too disruptive to back port to the stable 4.6.x release,
so it would only be available as part of CVS based MapServer builds
(aka 4.7) until such time as the 4.8 release is made, likely in December
or January.</p></li>
</ol>
</section>
<section id="mapfile-implications">
<h2>Mapfile Implications<a class="headerlink" href="#mapfile-implications" title="Link to this heading">¶</a></h2>
<p>There will be no changes to the mapfile.</p>
</section>
<section id="mapscript-implications">
<h2>MapScript Implications<a class="headerlink" href="#mapscript-implications" title="Link to this heading">¶</a></h2>
<p>There will be no changes to MapScript.</p>
</section>
<section id="backward-compatibility-issues">
<h2>Backward Compatibility Issues<a class="headerlink" href="#backward-compatibility-issues" title="Link to this heading">¶</a></h2>
<p>Some maps that previous dropped incompletely reprojected features will now
produce clipped features.  I don’t foresee this causing obvious problems
other than a slight change (improvement!) in appearance.</p>
</section>
<section id="staffing-and-timeline">
<h2>Staffing and Timeline<a class="headerlink" href="#staffing-and-timeline" title="Link to this heading">¶</a></h2>
<p>The new feature will be implemented by October 15th, 2005, in time for
inclusion in MapServer 4.8. It will be implemented by Frank Warmerdam with
generous funding from TMC Technologies.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p>
<a href="../../about.html" title="About">About</a><br>
<a href="../../products.html" title="Products">Products</a><br>
<a href="../../community/index.html" title="Community">Community</a><br>
<a href="../index.html" title="Development">Development</a><br>
<a href="../../download.html" title="Downloads">Downloads</a><br>
<a href="../../documentation.html" title="Documentation">Documentation</a><br>
<a href="../../faq.html" title="FAQ">FAQ</a><br>
<a href="../../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</h3>
  <ul>
<li><a class="reference internal" href="#">MS RFC 5: MapServer Horizon Reprojection Improvements</a><ul>
<li><a class="reference internal" href="#purpose">Purpose</a></li>
<li><a class="reference internal" href="#approach">Approach</a></li>
<li><a class="reference internal" href="#point-features">Point Features</a></li>
<li><a class="reference internal" href="#line-features">Line Features</a></li>
<li><a class="reference internal" href="#area-features">Area Features</a></li>
<li><a class="reference internal" href="#tolerances">Tolerances</a></li>
<li><a class="reference internal" href="#caveats">Caveats</a></li>
<li><a class="reference internal" href="#mapfile-implications">Mapfile Implications</a></li>
<li><a class="reference internal" href="#mapscript-implications">MapScript Implications</a></li>
<li><a class="reference internal" href="#backward-compatibility-issues">Backward Compatibility Issues</a></li>
<li><a class="reference internal" href="#staffing-and-timeline">Staffing and Timeline</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ms-rfc-6.html" title="MS RFC 6: Color Range Mapping of Continuous Feature Values"
             >next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-4.html" title="MS RFC 4: MapServer Raster Resampling"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 5: MapServer Horizon Reprojection Improvements</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; <a href="../../copyright.html">Copyright</a> 2023, Open Source Geospatial Foundation.
      Last updated on 2023-12-22.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.5.
    </div>
  </body>
</html>