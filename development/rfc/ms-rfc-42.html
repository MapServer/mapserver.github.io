<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>MS RFC 42: Support of Cookies Forwarding &#8212; MapServer 8.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx.css?v=6c7b17ac" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=dd298242" />
    <link rel="stylesheet" type="text/css" href="../../_static/ribbon.css?v=ea091bf4" />
    
    <script src="../../_static/documentation_options.js?v=521b6f53"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="icon" href="../../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="MS RFC 43: Direct tile generation for Google Maps and Virtual Earth API" href="ms-rfc-43.html" />
    <link rel="prev" title="MS RFC 41: Support of WCS 1.1.x Protocol" href="ms-rfc-41.html" /> 
  </head><body>


<!-- for main branch only, do not backport this -->

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../../index.html" title="Home"><img src="../../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../../index.html" title="Home">Home</a> |
      <a href="../../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter" target="_blank">Twitter</a> |
      <a href="../../download.html" title="Download Source or Binaries">Download </a> |
      <a class="badge" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=KRJ2X44N3HA6U&source=url" target="_blank">
        <img src="https://img.shields.io/badge/donate-%E2%9D%A4%C2%A0-ff69b4.svg?style=flat" alt="Donate to MapServer">
      </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../../ar/development/rfc/ms-rfc-42.html"><img src="../../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../../de/development/rfc/ms-rfc-42.html"><img src="../../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../../el/development/rfc/ms-rfc-42.html"><img src="../../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../../es/development/rfc/ms-rfc-42.html"><img src="../../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../../fr/development/rfc/ms-rfc-42.html"><img src="../../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../../id/development/rfc/ms-rfc-42.html"><img src="../../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../../it/development/rfc/ms-rfc-42.html"><img src="../../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../../ja/development/rfc/ms-rfc-42.html"><img src="../../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../../nl_NL/development/rfc/ms-rfc-42.html"><img src="../../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../../pl/development/rfc/ms-rfc-42.html"><img src="../../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../../ru/development/rfc/ms-rfc-42.html"><img src="../../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../../sq/development/rfc/ms-rfc-42.html"><img src="../../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../../tr/development/rfc/ms-rfc-42.html"><img src="../../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ms-rfc-43.html" title="MS RFC 43: Direct tile generation for Google Maps and Virtual Earth API"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-41.html" title="MS RFC 41: Support of WCS 1.1.x Protocol"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 42: Support of Cookies Forwarding</a></li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="ms-rfc-42-support-of-cookies-forwarding">
<span id="rfc42"></span><h1>MS RFC 42: Support of Cookies Forwarding<a class="headerlink" href="#ms-rfc-42-support-of-cookies-forwarding" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Date<span class="colon">:</span></dt>
<dd class="field-odd"><p>2008/03/26</p>
</dd>
<dt class="field-even">Author<span class="colon">:</span></dt>
<dd class="field-even"><p>Julien-Samuel Lacroix</p>
</dd>
<dt class="field-odd">Contact<span class="colon">:</span></dt>
<dd class="field-odd"><p>jlacroix at mapgears.com</p>
</dd>
<dt class="field-even">Last Edited<span class="colon">:</span></dt>
<dd class="field-even"><p>2008/04/01</p>
</dd>
<dt class="field-odd">Status<span class="colon">:</span></dt>
<dd class="field-odd"><p>Adopted 2008/04/01 - Implementation completed</p>
</dd>
<dt class="field-even">version<span class="colon">:</span></dt>
<dd class="field-even"><p>MapServer 5.2</p>
</dd>
</dl>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p>This RFC propose to extend MapServer to forward HTTP Cookies when doing OWS
requests.</p>
<p>One method of authentication in distributed server environment is the use of
HTTP Cookies. HTTP cookies are used by Web servers to differentiate users and
to maintain data related to the user during navigation, possibly across
multiple visits and for state information. Technically, cookies are arbitrary
pieces of data chosen by the Web server and sent to the browser. The browser
returns them unchanged to the server. The enhancement to MapServer would allow
the application to forward any HTTP cookie (either from a http or https
request for get or post) received from a client to any other server or service
that MapServer would request information from.</p>
<p>This would require MapServer to receive and forward any cookies to new
services during requests for operations (cascades) such as (but not limited
to) WMS requests for: getmaps, getfeatureinfo and WFS requests for GetFeature.</p>
</section>
<section id="implementation-methodology">
<h2>Implementation Methodology<a class="headerlink" href="#implementation-methodology" title="Link to this heading">¶</a></h2>
<p>A new metadata (http_cookie_data) will be added at the mapfile level to
temporarily store HTTP cookie data. Another metadata (ows_http_cookie) will
also be added at the layer and mapfile level to control the use of cookies.
The later will be set to either “forward”, to forward the cookie stored in the
http_cookie_data metadata, or to a hardcoded cookie value, to forward this
hardcoded value only.</p>
<p>Example of ows_http_cookie in the metadata:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LAYER</span>
  <span class="o">...</span>
  <span class="n">METADATA</span>
    <span class="s2">&quot;ows_http_cookie&quot;</span> <span class="s2">&quot;forward&quot;</span> <span class="c1"># This will forward the cookie sent to MapServer</span>
  <span class="n">END</span>
  <span class="o">...</span>
</pre></div>
</div>
<p>The user can also pass direct cookie values instead of the cookies behing
passed to MapServer. To pass multiple cookies, use the following syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LAYER</span>
  <span class="o">...</span>
  <span class="n">METADATA</span>
    <span class="s2">&quot;ows_http_cookie&quot;</span> <span class="s2">&quot;cookie1=my_value; cookie2=myvalue; &quot;</span> <span class="c1"># This will forward the metadata value</span>
  <span class="n">END</span>
  <span class="o">...</span>
</pre></div>
</div>
<p>By using the metadata configuration, a MapScript application will be able to
forward a HTTP Cookie by setting the correct metadata.</p>
<p>Currently only WMS and WFS code will use this since they are the only places
where MapServer request an outside webserver.</p>
</section>
<section id="implementation-issues">
<h2>Implementation Issues<a class="headerlink" href="#implementation-issues" title="Link to this heading">¶</a></h2>
<p>It was pointed out during the RFC review period that passing and storing the
cookie data using an “http_cookie_data” metadata is a poor use of MapServer’s
metadata mechanism.</p>
<p>Since MapServer currently lacks a mechanism to associate application state
information to a mapObj, there is currently no better mechanism in place to
store the cookie data received from the client and pass it to the rendering
code that calls the remote WMS. Due to lack of a better solution, for the time
being we will use the “http_cookie_data” metadata as proposed in this RFC,
with the knowledge that this is a poor use of metadata and that we as soon as
a better mechanism is in place to store and pass application state in a mapObj
then this metadata will be deprecated and replaced by this new mechanism.
Developers of MapScript applications setting this “http_cookie_data” metadata
should be aware of this and be prepared to change their code in future
revisions of MapServer.</p>
<p>Another issue is that no encoding currently is planned to be made with the
http_cookie_data metadata. Poorly formatted metadata could break the HTTP
header of a request. If it is found that Curl doesn’t encode the cookie value,
only character with a value between 32 and 126 (printable ascii characters)
will be allowed.</p>
</section>
<section id="modifications-to-the-source-code">
<h2>Modifications to the Source Code<a class="headerlink" href="#modifications-to-the-source-code" title="Link to this heading">¶</a></h2>
<p>The HTTP Cookie data will need to be stored in cgiRequestObj in a new member
variable to be able to pass it to the mapfile. If HTTP Cookies are present the
cookies will always be stored there. The mapserv.c main function will then be
responsible of the HTTP Cookies in the mapfile just after the loadMap()
function and before msOWSDispatch() if the ows_http_cookie metadata is set.
The WMS and WFS code will set the newly created variable in the httpRequestObj
when it prepares the URL for a server request.</p>
<p>The WMS/WFS msPrepareWMSLayerRequest function will check for the
ows_http_cookie metadata in the layer and the map objects. If the value is set
to forward, the content of the http_cookie_data metadata will be forwarded as
HTTP Cookie to the WMS/WFS server.</p>
<p>Curl as an option in the curl_easy_setopt() function when doing a request
called CURLOPT_COOKIE to send cookies with a request.</p>
</section>
<section id="mapscript">
<h2>MapScript<a class="headerlink" href="#mapscript" title="Link to this heading">¶</a></h2>
<p>By storing the HTTP Cookie data in a mapfile metadata MapScript will be able
to use this new functionality. Here’s an example of a PHP/MapScript use of
HTTP Cookie:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>foreach($_COOKIE as $szKey =&gt; $szValue)
{
    $szHTTPCookies .= &quot;$szKey=$szValue; &quot;;
}
$oMap-&gt;setMetadata(&quot;http_cookie_data&quot;, $szHTTPCookies);
$oMap-&gt;setMetadata(&quot;ows_http_cookie&quot;, &quot;forward&quot;);
$oMap-&gt;draw();
</pre></div>
</div>
</section>
<section id="file-affected">
<h2>File Affected<a class="headerlink" href="#file-affected" title="Link to this heading">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cgiutil</span><span class="o">.</span><span class="n">h</span>           <span class="p">(</span><span class="n">add</span> <span class="n">http_cookies</span> <span class="ow">in</span> <span class="n">cgiRequestObj</span><span class="p">)</span>
<span class="n">cgiutil</span><span class="o">.</span><span class="n">c</span>           <span class="p">(</span><span class="n">read</span> <span class="ow">and</span> <span class="n">store</span> <span class="n">the</span> <span class="n">http</span> <span class="n">cookies</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">cgiRequestObj</span><span class="p">)</span>
<span class="n">maphttp</span><span class="o">.</span><span class="n">c</span>           <span class="p">(</span><span class="n">send</span> <span class="n">cookies</span> <span class="k">with</span> <span class="n">the</span> <span class="n">request</span> <span class="n">via</span> <span class="n">curl</span> <span class="n">option</span><span class="p">)</span>
<span class="n">mapows</span><span class="o">.</span><span class="n">h</span>            <span class="p">(</span><span class="n">add</span> <span class="n">http_cookies</span> <span class="n">to</span> <span class="n">httpRequestObj</span><span class="p">)</span>
<span class="n">mapserv</span><span class="o">.</span><span class="n">c</span>           <span class="p">(</span><span class="n">store</span> <span class="n">cookies</span> <span class="ow">in</span> <span class="n">mapfile</span> <span class="n">metadata</span><span class="p">)</span>
<span class="n">mapwmslayer</span><span class="o">.</span><span class="n">c</span>       <span class="p">(</span><span class="nb">set</span> <span class="n">cookies</span> <span class="ow">in</span> <span class="n">httpRequestObj</span><span class="p">)</span>
<span class="n">mapwfslayer</span><span class="o">.</span><span class="n">c</span>       <span class="p">(</span><span class="nb">set</span> <span class="n">cookies</span> <span class="ow">in</span> <span class="n">httpRequestObj</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="backwards-compatibility">
<h2>Backwards Compatibility<a class="headerlink" href="#backwards-compatibility" title="Link to this heading">¶</a></h2>
<p>None.</p>
</section>
<section id="bug-id">
<h2>Bug ID<a class="headerlink" href="#bug-id" title="Link to this heading">¶</a></h2>
<p><a class="reference external" href="https://github.com/MapServer/MapServer/issues/2566">https://github.com/MapServer/MapServer/issues/2566</a></p>
</section>
<section id="voting-history">
<h2>Voting History<a class="headerlink" href="#voting-history" title="Link to this heading">¶</a></h2>
<p>Adopted on 2008/04/01 with +1 from FrankW, DanielM, TomK and AssefaY, and +0
from JeffM and PericlesN.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p>
<a href="../../about.html" title="About">About</a><br>
<a href="../../products.html" title="Products">Products</a><br>
<a href="../../community/index.html" title="Community">Community</a><br>
<a href="../index.html" title="Development">Development</a><br>
<a href="../../download.html" title="Downloads">Downloads</a><br>
<a href="../../documentation.html" title="Documentation">Documentation</a><br>
<a href="../../faq.html" title="FAQ">FAQ</a><br>
<a href="../../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</h3>
  <ul>
<li><a class="reference internal" href="#">MS RFC 42: Support of Cookies Forwarding</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#implementation-methodology">Implementation Methodology</a></li>
<li><a class="reference internal" href="#implementation-issues">Implementation Issues</a></li>
<li><a class="reference internal" href="#modifications-to-the-source-code">Modifications to the Source Code</a></li>
<li><a class="reference internal" href="#mapscript">MapScript</a></li>
<li><a class="reference internal" href="#file-affected">File Affected</a></li>
<li><a class="reference internal" href="#backwards-compatibility">Backwards Compatibility</a></li>
<li><a class="reference internal" href="#bug-id">Bug ID</a></li>
<li><a class="reference internal" href="#voting-history">Voting History</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ms-rfc-43.html" title="MS RFC 43: Direct tile generation for Google Maps and Virtual Earth API"
             >next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-41.html" title="MS RFC 41: Support of WCS 1.1.x Protocol"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 42: Support of Cookies Forwarding</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; <a href="../../copyright.html">Copyright</a> 2023, Open Source Geospatial Foundation.
      Last updated on 2023-12-22.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.5.
    </div>
  </body>
</html>