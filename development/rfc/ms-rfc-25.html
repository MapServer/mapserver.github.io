<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>MS RFC 25: Align MapServer pixel and extent models with OGC models &#8212; MapServer 8.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx.css?v=6c7b17ac" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=dd298242" />
    <link rel="stylesheet" type="text/css" href="../../_static/ribbon.css?v=ea091bf4" />
    
    <script src="../../_static/documentation_options.js?v=521b6f53"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="icon" href="../../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="MS RFC 26: Version 5 Terminology Cleanup" href="ms-rfc-26.html" />
    <link rel="prev" title="MS RFC 23: Technical Steering Committee Guidelines" href="ms-rfc-23.html" /> 
  </head><body>


<!-- for main branch only, do not backport this -->

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../../index.html" title="Home"><img src="../../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../../index.html" title="Home">Home</a> |
      <a href="../../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter" target="_blank">Twitter</a> |
      <a href="../../download.html" title="Download Source or Binaries">Download </a> |
      <a class="badge" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=KRJ2X44N3HA6U&source=url" target="_blank">
        <img src="https://img.shields.io/badge/donate-%E2%9D%A4%C2%A0-ff69b4.svg?style=flat" alt="Donate to MapServer">
      </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../../ar/development/rfc/ms-rfc-25.html"><img src="../../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../../de/development/rfc/ms-rfc-25.html"><img src="../../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../../el/development/rfc/ms-rfc-25.html"><img src="../../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../../es/development/rfc/ms-rfc-25.html"><img src="../../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../../fr/development/rfc/ms-rfc-25.html"><img src="../../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../../id/development/rfc/ms-rfc-25.html"><img src="../../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../../it/development/rfc/ms-rfc-25.html"><img src="../../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../../ja/development/rfc/ms-rfc-25.html"><img src="../../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../../nl_NL/development/rfc/ms-rfc-25.html"><img src="../../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../../pl/development/rfc/ms-rfc-25.html"><img src="../../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../../ru/development/rfc/ms-rfc-25.html"><img src="../../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../../sq/development/rfc/ms-rfc-25.html"><img src="../../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../../tr/development/rfc/ms-rfc-25.html"><img src="../../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ms-rfc-26.html" title="MS RFC 26: Version 5 Terminology Cleanup"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-23.html" title="MS RFC 23: Technical Steering Committee Guidelines"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 25: Align MapServer pixel and extent models with OGC models</a></li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="ms-rfc-25-align-mapserver-pixel-and-extent-models-with-ogc-models">
<span id="rfc25"></span><h1>MS RFC 25: Align MapServer pixel and extent models with OGC models<a class="headerlink" href="#ms-rfc-25-align-mapserver-pixel-and-extent-models-with-ogc-models" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Date<span class="colon">:</span></dt>
<dd class="field-odd"><p>2007/10/23</p>
</dd>
<dt class="field-even">Author<span class="colon">:</span></dt>
<dd class="field-even"><p>Steve Lime</p>
</dd>
<dt class="field-odd">Contact<span class="colon">:</span></dt>
<dd class="field-odd"><p>steve.lime at DNR.STATE.MN.US</p>
</dd>
<dt class="field-even">Status<span class="colon">:</span></dt>
<dd class="field-even"><p>Draft</p>
</dd>
</dl>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p>At present MapServer uses different pixel and extent model than defined by OGC
services such as WCS and WMS. MapServer uses the center of a pixel to represent
its unique coordinate value. An extent is interpreted as the bounding box that
runs from the center of the UL pixel in an image to the center of the LR pixel
in an image. Why? Well, it goes back to companion software that existed along
side MapServer to display satellite data stored in ERDAS that used the center
to center extent model. The math is simple and there is a certain logic in
having the extent actually represent pixel values - that is, if you render the
extent as a polygon you get the exact edge of the image as one might expect.</p>
<p>On the other hand, OGC service specifications define an extent (BBOX) to refer
to the dimensions of the outside edges of the image being requested. This
appears to be a far more common means of expressing an area of interest.</p>
<p>I’ve not been able to ascertain where the coordinate of an individual pixel
is located from various OGC specifications. MapServer ‘’’could’’’ retain a
center-based pixel model. That does add complexity to the map &lt;=&gt; image
coordinate transformations since you have to offset things by one-half
cellsize. Since that computation is done many times I would expect a
performance hit. We could optimize things by computing and storing the
one-half cellsize value once (as cellsize is now), but that complicates the
C APIs and requires huge amounts of change. I propose moving to a
upper-left-based pixel model to simplify these conversions.</p>
<p>Note: In looking at the code there were past efforts to go to the OGC extent
in 4.8 and 4.10, but it was not universally applied. This RFC would ensure
that the same extent and pixel model is in use throughout MapServer and that
it is consistent with OGC.</p>
</section>
<section id="technical-details">
<h2>Technical Details<a class="headerlink" href="#technical-details" title="Link to this heading">¶</a></h2>
<p>Affected files (relative to what is in main development trunk):</p>
<ul class="simple">
<li><p>map.h: change definition of MS_CELLSIZE</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#define MS_CELLSIZE(min,max,d)    ((max - min)/d)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>map.h: change coordinate conversion macros (no change just add comments)</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/*</span>
<span class="o">**</span> <span class="n">These</span> <span class="n">macros</span> <span class="n">work</span> <span class="n">relative</span> <span class="n">to</span> <span class="n">the</span> <span class="n">UL</span> <span class="n">corner</span> <span class="n">of</span> <span class="n">the</span> <span class="n">UL</span> <span class="n">pixel</span> <span class="n">of</span> <span class="n">a</span> <span class="nb">map</span> <span class="n">exent</span><span class="o">.</span> <span class="n">Pixel</span>
<span class="o">**</span> <span class="n">model</span> <span class="ow">is</span> <span class="p">(</span><span class="k">as</span> <span class="n">of</span> <span class="mf">5.0</span><span class="p">)</span> <span class="n">the</span> <span class="n">UL</span> <span class="n">corner</span> <span class="n">of</span> <span class="n">a</span> <span class="n">pixel</span><span class="o">.</span> <span class="n">UL</span> <span class="n">pixel</span> <span class="o">=</span> <span class="n">minx</span><span class="p">,</span><span class="n">maxy</span><span class="o">.</span>
<span class="o">*/</span>
<span class="c1">#define MS_MAP2IMAGE_X(x,minx,cx) (MS_NINT((x - minx)/cx))</span>
<span class="c1">#define MS_MAP2IMAGE_Y(y,maxy,cy) (MS_NINT((maxy - y)/cy))</span>
<span class="c1">#define MS_IMAGE2MAP_X(x,minx,cx) (minx + cx*x)</span>
<span class="c1">#define MS_IMAGE2MAP_Y(y,maxy,cy) (maxy - cy*y)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>maputil.c: update msAdjustExtent()</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ox</span> <span class="o">=</span> <span class="n">MS_MAX</span><span class="p">((</span><span class="n">width</span> <span class="o">-</span> <span class="p">(</span><span class="n">rect</span><span class="o">-&gt;</span><span class="n">maxx</span> <span class="o">-</span> <span class="n">rect</span><span class="o">-&gt;</span><span class="n">minx</span><span class="p">)</span><span class="o">/</span><span class="n">cellsize</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
<span class="n">oy</span> <span class="o">=</span> <span class="n">MS_MAX</span><span class="p">((</span><span class="n">height</span> <span class="o">-</span> <span class="p">(</span><span class="n">rect</span><span class="o">-&gt;</span><span class="n">maxy</span> <span class="o">-</span> <span class="n">rect</span><span class="o">-&gt;</span><span class="n">miny</span><span class="p">)</span><span class="o">/</span><span class="n">cellsize</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
</pre></div>
</div>
<ul class="simple">
<li><p>mapwcs.c: remove code to convert between MapServer extent and OWS extent</p></li>
<li><p>mapwms.c: remove code to convert between MapServer extent and OWS extent</p></li>
<li><p>mapwmsclient.c remove code to convert between MapServer extent and OWS extent</p></li>
<li><p>various raster layer handlers: Need Frank’s comments here.</p></li>
<li><p>mapscript …zoom functions: I don’t believe these will need any change.</p></li>
</ul>
<p>The affect of these changes on end-users should be minimal since it is
unlikely they the are aware of differences in extent interpretation. The
larger impact may be on 3rd party applications like dBox, Chameleon and QGIS
that manage extents and call MapServer.  Efforts must be made to make those
folks aware of the change.</p>
</section>
<section id="mapfile-implications">
<h2>Mapfile Implications<a class="headerlink" href="#mapfile-implications" title="Link to this heading">¶</a></h2>
<p>None, these are internal changes only.</p>
</section>
<section id="mapscript-implications">
<h2>MapScript Implications<a class="headerlink" href="#mapscript-implications" title="Link to this heading">¶</a></h2>
<p>None, these are internal changes only.</p>
</section>
<section id="documentation-implications">
<h2>Documentation Implications<a class="headerlink" href="#documentation-implications" title="Link to this heading">¶</a></h2>
<p>The models for a pixel and an extent need to documented in a couple of
places: mapfile reference, the related OWS service how-to’s and perhaps a
new how-to pertaining to just this topic.</p>
</section>
<section id="test-plan">
<h2>Test Plan<a class="headerlink" href="#test-plan" title="Link to this heading">¶</a></h2>
<p>Need to develop some tests to somehow validate the math. The WCS interface
or output drivers using GDAL are excellent candidates since they produce
georeferenced output. Some testing has already been done to verify the
existence of the issue (first discovered via WCS) and the proposed fix.</p>
<p>Mini-images (e.g. 7x7) can be used to verify rendering makes sense.
For example, if you draw the extent as a polygon you would expect to see
lines for the left and top edges, but not for the bottom and right. That is
because the maxx,miny extent values won’t represent a pixel in the output
(rather the next tile to the right and/or below).</p>
</section>
<section id="staffing-timeline">
<h2>Staffing / Timeline<a class="headerlink" href="#staffing-timeline" title="Link to this heading">¶</a></h2>
<p>Changes to maputil.h, map.h, mapwcs.c and mapwms.c would be done by Steve
Lime. Changes to other portions of MapServer would be coordinated with the
various component owners. This RFC would be completed for the 5.0 release.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p>
<a href="../../about.html" title="About">About</a><br>
<a href="../../products.html" title="Products">Products</a><br>
<a href="../../community/index.html" title="Community">Community</a><br>
<a href="../index.html" title="Development">Development</a><br>
<a href="../../download.html" title="Downloads">Downloads</a><br>
<a href="../../documentation.html" title="Documentation">Documentation</a><br>
<a href="../../faq.html" title="FAQ">FAQ</a><br>
<a href="../../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</h3>
  <ul>
<li><a class="reference internal" href="#">MS RFC 25: Align MapServer pixel and extent models with OGC models</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#technical-details">Technical Details</a></li>
<li><a class="reference internal" href="#mapfile-implications">Mapfile Implications</a></li>
<li><a class="reference internal" href="#mapscript-implications">MapScript Implications</a></li>
<li><a class="reference internal" href="#documentation-implications">Documentation Implications</a></li>
<li><a class="reference internal" href="#test-plan">Test Plan</a></li>
<li><a class="reference internal" href="#staffing-timeline">Staffing / Timeline</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ms-rfc-26.html" title="MS RFC 26: Version 5 Terminology Cleanup"
             >next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-23.html" title="MS RFC 23: Technical Steering Committee Guidelines"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 25: Align MapServer pixel and extent models with OGC models</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; <a href="../../copyright.html">Copyright</a> 2023, Open Source Geospatial Foundation.
      Last updated on 2023-12-22.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.5.
    </div>
  </body>
</html>