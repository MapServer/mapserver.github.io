<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>MS RFC 2: Creating line features and/or shapes using WKT &#8212; MapServer 8.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx.css?v=6c7b17ac" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=dd298242" />
    <link rel="stylesheet" type="text/css" href="../../_static/ribbon.css?v=ea091bf4" />
    
    <script src="../../_static/documentation_options.js?v=521b6f53"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="icon" href="../../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="MS RFC 3: Feature Layer Plug-in Architecture" href="ms-rfc-3.html" />
    <link rel="prev" title="MS RFC 1: Technical Steering Committee Guidelines" href="ms-rfc-1.html" /> 
  </head><body>


<!-- for main branch only, do not backport this -->

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../../index.html" title="Home"><img src="../../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../../index.html" title="Home">Home</a> |
      <a href="../../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter" target="_blank">Twitter</a> |
      <a href="../../download.html" title="Download Source or Binaries">Download </a> |
      <a class="badge" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=KRJ2X44N3HA6U&source=url" target="_blank">
        <img src="https://img.shields.io/badge/donate-%E2%9D%A4%C2%A0-ff69b4.svg?style=flat" alt="Donate to MapServer">
      </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../../ar/development/rfc/ms-rfc-2.html"><img src="../../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../../de/development/rfc/ms-rfc-2.html"><img src="../../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../../el/development/rfc/ms-rfc-2.html"><img src="../../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../../es/development/rfc/ms-rfc-2.html"><img src="../../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../../fr/development/rfc/ms-rfc-2.html"><img src="../../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../../id/development/rfc/ms-rfc-2.html"><img src="../../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../../it/development/rfc/ms-rfc-2.html"><img src="../../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../../ja/development/rfc/ms-rfc-2.html"><img src="../../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../../nl_NL/development/rfc/ms-rfc-2.html"><img src="../../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../../pl/development/rfc/ms-rfc-2.html"><img src="../../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../../ru/development/rfc/ms-rfc-2.html"><img src="../../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../../sq/development/rfc/ms-rfc-2.html"><img src="../../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../../tr/development/rfc/ms-rfc-2.html"><img src="../../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ms-rfc-3.html" title="MS RFC 3: Feature Layer Plug-in Architecture"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-1.html" title="MS RFC 1: Technical Steering Committee Guidelines"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 2: Creating line features and/or shapes using WKT</a></li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="ms-rfc-2-creating-line-features-and-or-shapes-using-wkt">
<span id="rfc2"></span><h1>MS RFC 2: Creating line features and/or shapes using WKT<a class="headerlink" href="#ms-rfc-2-creating-line-features-and-or-shapes-using-wkt" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Date<span class="colon">:</span></dt>
<dd class="field-odd"><p>2005/07/13</p>
</dd>
<dt class="field-even">Author<span class="colon">:</span></dt>
<dd class="field-even"><p>Steve Lime</p>
</dd>
<dt class="field-odd">Contact<span class="colon">:</span></dt>
<dd class="field-odd"><p>steve.lime at DNR.STATE.MN.US</p>
</dd>
<dt class="field-even">Status<span class="colon">:</span></dt>
<dd class="field-even"><p>Completed</p>
</dd>
<dt class="field-odd">Version<span class="colon">:</span></dt>
<dd class="field-odd"><p>MapServer 4.8</p>
</dd>
</dl>
<p>Description: Developing inline features or shapes within MapScript can be a
bit cumbersome.  One alternative would be to allow users to define feature
using the Well-Known Text format.  The proposed solution would allow users
to use this format:</p>
<ol class="arabic simple">
<li><p>within a mapfile</p></li>
<li><p>via URL</p></li>
<li><p>via MapScript</p></li>
<li><p>via MapServer query template</p></li>
</ol>
<p>Instead of writing a new WKT parser we would provide access to underlying GEOS
or OGR functionality to do this. Notes about the actual implementation are
included below.</p>
<section id="files-affected">
<h2>Files affected<a class="headerlink" href="#files-affected" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>mapfile.h =&gt; new constant, WKT</p></li>
<li><p>maplexer.l =&gt; recognize the new constant</p></li>
<li><p>mapfile.c =&gt; process new mapfile parameter with FEATURE block (WKT), and
update URL parsing in a similar manner</p></li>
<li><p>mapgeos.cpp =&gt; wrap GEOS WKT reading/writing code</p></li>
<li><p>mapogr.cpp =&gt; wrap OGR WKT reading/writing code</p></li>
<li><p>mapprimitive.c =&gt; wrap the GEOS and OGR WKT writer/reading code, this would
be the “public” interface</p></li>
<li><p>maptemplate.c =&gt; update the shpxy tag with a “-wkt” option so it would output
the WKT version of a shape. Placing here would allow us to take advantage of
the projection support already in place, plus any future options (thining, buffers
and so on).</p></li>
<li><p>mapscript/swiginc/shape.i =&gt; update constructor to pass a WKT string and to
define a “toString” method that would output a WKT string. Similar modifications
would have to be made within PHP/MapScript, patterned after the SWIG-based
interface.</p></li>
</ul>
</section>
<section id="backwards-compatibility-issues">
<h2>Backwards compatibility issues<a class="headerlink" href="#backwards-compatibility-issues" title="Link to this heading">¶</a></h2>
<p>N/A, new functionality</p>
</section>
<section id="implementation-details">
<h2>Implementation Details<a class="headerlink" href="#implementation-details" title="Link to this heading">¶</a></h2>
<blockquote>
<div><ul class="simple">
<li><p>The C API will take the form:</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">shapeObj</span> <span class="o">*</span><span class="n">msShapeFromWKT</span><span class="p">(</span> <span class="n">const</span> <span class="n">char</span> <span class="o">*</span> <span class="p">);</span>
<span class="n">char</span> <span class="o">*</span><span class="n">msShapeToWKT</span><span class="p">(</span> <span class="n">shapeObj</span> <span class="o">*</span> <span class="p">);</span>
</pre></div>
</div>
<p>These are contrary to some of the older code (e.g. msLayerNextShape()). However there
are 2 places the WKT APIs will be used: 1) MapScript and 2) creating inline features
via URL or MapFiles. In both cases the above functions would be preferred.</p>
</div></blockquote>
<ul>
<li><p>In MapScript, creating a shape will take the form of an overloaded constructor, e.g.:</p>
<p>$shape = new shapeObj($mapscript::MS_SHAPE_LINE);  OR
$shape = new shapeObj(‘LINESTRING(0 0,1 1,1 2)’);</p>
</li>
<li><p>In MapScript, a toWKT() method will be added to shapeObj object.</p></li>
<li><p>WKT is geometry only.  The attributes, index, tileindex, classindex,
and text fields do not exist in WKT and will have to be set “elsewhere”.</p></li>
<li><p>There is no widely supported, or standardized approach to “measure”
values in WKT though Refractions does support it in “EWKT”.  For now it
is assumed that measure values will not be preserved from WKT.</p></li>
<li><p>There is a well defined way of including Z coordinates and these should
be carried through if MapServer is built with Z and M support enabled.</p></li>
<li><p>Development will be accompanied by a set of tests. Sean Gillies has already created
a test case or two.</p></li>
</ul>
</div></blockquote>
<section id="transformations-shapeobj-to-wkt">
<h3>Transformations shapeObj to WKT<a class="headerlink" href="#transformations-shapeobj-to-wkt" title="Link to this heading">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>MS_SHAPE_POINT: If numlines and numpoints are one, then this is converted
to a POINT object in WKT.  If there are more points, this is converted
to a MULTIPOINT object.</p></li>
<li><p>MS_SHAPE_LINE: if numlines is 1 then this will be translated to a LINESTRING
otherwise it will be translated to a MULTILINESTRING.</p></li>
<li><p>MS_SHAPE_POLYGON: MapServer does not keep track of interior and exterior
rings in a shape, since the scanline rasterization mechanism of GD
does not require this information.  However, when converting to WKT we
need to know whether we have a single polygon with holes, or multiple
polygons (more than one exterior ring).   If numlines is 1, we can directly
translate to POLYGON(), otherwise the rings will need to be analysed to
identify outer rings, and to associate inner rings with their outher ring.
If more than one outer ring exist, a MULTIPOLYGON will be produced,
otherwise a POLYGON will be produced.</p></li>
<li><p>MS_SHAPE_NULL: This results in an empty WKT string.</p></li>
</ul>
</div></blockquote>
</section>
<section id="transformations-wkt-to-shapeobj">
<h3>Transformations WKT to shapeObj<a class="headerlink" href="#transformations-wkt-to-shapeobj" title="Link to this heading">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>POINT: Translates to an MS_SHAPE_POINT object with one point and one line.</p></li>
<li><p>LINESTRING: Translates to an MS_SHAPE_LINE object with one line.</p></li>
<li><p>POLYGON: Translates to an MS_SHAPE_POLYGON object with one line for the
outer ring and one line for each inner ring.</p></li>
<li><p>MULTIPOINT: Translates to an MS_SHAPE_POINT object with one line, and one
point for each line.</p></li>
<li><p>MULTILINESTRING: Translates to an MS_SHAPE_LINE object with one line for
each linestring in the container.</p></li>
<li><p>MULTIPOLYGON: Translates into an MS_SHAPE_POLYGON with each ring of each
polygon being a line in the resulting polygon object.</p></li>
<li><p>GEOMETRYCOLLECTION: Treat as MULTIPOINT, MULTILINESTRING or MULTIPOLYGON if
the contents are all compatible, otherwise throw an exception.</p></li>
</ul>
</div></blockquote>
</section>
</section>
<section id="bug-id">
<h2>Bug ID<a class="headerlink" href="#bug-id" title="Link to this heading">¶</a></h2>
<p><a class="reference external" href="https://github.com/MapServer/MapServer/issues/1466">https://github.com/MapServer/MapServer/issues/1466</a>
(primary bug, addition entries for MapScript and OGR will follow)</p>
</section>
<section id="voting-history">
<h2>Voting history<a class="headerlink" href="#voting-history" title="Link to this heading">¶</a></h2>
<p>Vote proposed by Steve Lime on 9/4/2005, result was +4 (3 non-voting members).</p>
<p>Voting +1: Lime, Warmerdam, Morissette, Gillies</p>
<p>Proposal passes and will move forward.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p>
<a href="../../about.html" title="About">About</a><br>
<a href="../../products.html" title="Products">Products</a><br>
<a href="../../community/index.html" title="Community">Community</a><br>
<a href="../index.html" title="Development">Development</a><br>
<a href="../../download.html" title="Downloads">Downloads</a><br>
<a href="../../documentation.html" title="Documentation">Documentation</a><br>
<a href="../../faq.html" title="FAQ">FAQ</a><br>
<a href="../../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</h3>
  <ul>
<li><a class="reference internal" href="#">MS RFC 2: Creating line features and/or shapes using WKT</a><ul>
<li><a class="reference internal" href="#files-affected">Files affected</a></li>
<li><a class="reference internal" href="#backwards-compatibility-issues">Backwards compatibility issues</a></li>
<li><a class="reference internal" href="#implementation-details">Implementation Details</a><ul>
<li><a class="reference internal" href="#transformations-shapeobj-to-wkt">Transformations shapeObj to WKT</a></li>
<li><a class="reference internal" href="#transformations-wkt-to-shapeobj">Transformations WKT to shapeObj</a></li>
</ul>
</li>
<li><a class="reference internal" href="#bug-id">Bug ID</a></li>
<li><a class="reference internal" href="#voting-history">Voting history</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ms-rfc-3.html" title="MS RFC 3: Feature Layer Plug-in Architecture"
             >next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-1.html" title="MS RFC 1: Technical Steering Committee Guidelines"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 2: Creating line features and/or shapes using WKT</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; <a href="../../copyright.html">Copyright</a> 2023, Open Source Geospatial Foundation.
      Last updated on 2023-12-22.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.5.
    </div>
  </body>
</html>