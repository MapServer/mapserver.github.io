<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>MS RFC 123: Support for MapML output in MapServer &#8212; MapServer 8.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx.css?v=6c7b17ac" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=dd298242" />
    <link rel="stylesheet" type="text/css" href="../../_static/ribbon.css?v=ea091bf4" />
    
    <script src="../../_static/documentation_options.js?v=521b6f53"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="icon" href="../../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="MS RFC 124: Improving SLD Support in MapServer" href="ms-rfc-124.html" />
    <link rel="prev" title="MS RFC 122: A Tool for Coverage Analysis of MapCache Multi-SQLite Caches" href="ms-rfc-122.html" /> 
  </head><body>


<!-- for main branch only, do not backport this -->

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../../index.html" title="Home"><img src="../../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../../index.html" title="Home">Home</a> |
      <a href="../../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter" target="_blank">Twitter</a> |
      <a href="../../download.html" title="Download Source or Binaries">Download </a> |
      <a class="badge" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=KRJ2X44N3HA6U&source=url" target="_blank">
        <img src="https://img.shields.io/badge/donate-%E2%9D%A4%C2%A0-ff69b4.svg?style=flat" alt="Donate to MapServer">
      </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../../ar/development/rfc/ms-rfc-123.html"><img src="../../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../../de/development/rfc/ms-rfc-123.html"><img src="../../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../../el/development/rfc/ms-rfc-123.html"><img src="../../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../../es/development/rfc/ms-rfc-123.html"><img src="../../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../../fr/development/rfc/ms-rfc-123.html"><img src="../../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../../id/development/rfc/ms-rfc-123.html"><img src="../../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../../it/development/rfc/ms-rfc-123.html"><img src="../../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../../ja/development/rfc/ms-rfc-123.html"><img src="../../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../../nl_NL/development/rfc/ms-rfc-123.html"><img src="../../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../../pl/development/rfc/ms-rfc-123.html"><img src="../../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../../ru/development/rfc/ms-rfc-123.html"><img src="../../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../../sq/development/rfc/ms-rfc-123.html"><img src="../../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../../tr/development/rfc/ms-rfc-123.html"><img src="../../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ms-rfc-124.html" title="MS RFC 124: Improving SLD Support in MapServer"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-122.html" title="MS RFC 122: A Tool for Coverage Analysis of MapCache Multi-SQLite Caches"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 123: Support for MapML output in MapServer</a></li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="ms-rfc-123-support-for-mapml-output-in-mapserver">
<span id="rfc123"></span><h1>MS RFC 123: Support for MapML output in MapServer<a class="headerlink" href="#ms-rfc-123-support-for-mapml-output-in-mapserver" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Author<span class="colon">:</span></dt>
<dd class="field-odd"><p>Daniel Morissette</p>
</dd>
<dt class="field-even">Contact<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference external" href="mailto:dmorissette&#37;&#52;&#48;mapgears&#46;com">dmorissette<span>&#64;</span>mapgears<span>&#46;</span>com</a></p>
</dd>
<dt class="field-odd">Status<span class="colon">:</span></dt>
<dd class="field-odd"><p>Adopted (2020-03-31)</p>
</dd>
<dt class="field-even">Last update<span class="colon">:</span></dt>
<dd class="field-even"><p>2020-03-31</p>
</dd>
<dt class="field-odd">Version<span class="colon">:</span></dt>
<dd class="field-odd"><p>MapServer 8.0</p>
</dd>
</dl>
<section id="overview">
<h2>1. Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p>A common way to deploy web mapping sites in 2019 is to embed JavaScript code in a web page using OpenLayers or Leaflet as the navigation interface.  Those JavaScript libraries can interact with OGC WMS and Tile Services (as well as other OGC service types) if provided with the correct configuration via JavaScript code.  In other words, the map contents, the list of layers, SRS, zoom levels, extents, etc, are specified as JavaScript statements and then rendered by a JavaScript library in a “custom” way that the web browser itself does not “understand”.</p>
<p>The W3C Maps for HTML Community Group is working to define a (new) “map” HTML element that would be used to define map contents in a web page and would be directly supported and rendered by web browsers in a standardized way. All this is done by building on existing standards such as WMS, WFS and Tile Services. In addition to standardizing the encoding and access to map elements in web browsers, this encoding also aims to make the map contents more easily discoverable and indexable by search bots on the Web.</p>
<p>A draft specification is available through the working group, and the goal of this RFC is to provide a reference implementation to test the draft spec in real life use cases and promote its more widespread usage.  A similar reference implementation is also available for GeoServer, and we will aim to align this implementation with the GeoServer implementation when possible.</p>
<p>This project is supported by funding from Natural Resources Canada.</p>
</section>
<section id="proposed-solution">
<h2>2. Proposed solution<a class="headerlink" href="#proposed-solution" title="Link to this heading">¶</a></h2>
<p>This RFC proposes the implementation of MapML output in MapServer which consists in two parts:</p>
<ol class="arabic simple">
<li><p>Enabling generation of a &lt;mapml&gt; document for a given layer in a mapfile. This will be implemented as a vendor-specific REQUEST=GetMapML extension.</p></li>
<li><p>Enabling text/mapml as a new INFO_FORMAT for WMS GetFeatureInfo requests, and as a new feature encoding format for WFS GetFeature requests.</p></li>
</ol>
<section id="building-enabling-the-mapml-option">
<h3>2.1 Building/enabling the MapML option<a class="headerlink" href="#building-enabling-the-mapml-option" title="Link to this heading">¶</a></h3>
<p>MapML support will be enabled by default if WMS support is enabled. It can be disabled at compile time using the following CMake options:</p>
<blockquote>
<div><p>cmake .. -DWITH_MAPML=0</p>
</div></blockquote>
<p>There are no additional dependencies required for basic MapML support.</p>
<p>If the (optional) OGR MapML driver is available then it will be used for enhanced text/mapml output in WMS GetFeatureInfo and WFS GetFeature responses (see section 4.3 below).</p>
</section>
<section id="mapfile-configuration-parameters">
<h3>2.2 MapFile configuration parameters<a class="headerlink" href="#mapfile-configuration-parameters" title="Link to this heading">¶</a></h3>
<p>Since MapML is mostly a mechanism to refer to OGC services (WMS, WFS and tile services), the MapML implementation automatically leverages existing WMS and WFS mapfile configuration parameters for the map and layers being served.</p>
<p>In particular, the following mapfile configuration parameters will impact the MapML output and behaviours:</p>
<ul class="simple">
<li><p><strong>ows_enable_requests</strong>: Either use “*” or add “GetMapML” to the list of requests to enable &lt;mapml&gt; output for specific layers (or at the map level for all layers)</p></li>
<li><p><strong>wms_getfeatureinfo_formatlist</strong>: add “text/mapml” to the list to enable WMS GetFeatureInfo in text/mapml format for a specific layer (or at the map level for all layers)</p></li>
<li><p><strong>wfs_getfeature_formatlist</strong>: add “text/mapml” to the list to enable WFS GetFeature in text/mapml format for a specific layer (or at the map level for all layers)</p></li>
<li><dl class="simple">
<dt><strong>ows_srs</strong>: the list of SRS codes specified in the ows_srs (or wms_srs/wfs_srs) metadata controls the MapML projection codes that will be enabled for &lt;mapml&gt; output</dt><dd><ul>
<li><p>EPSG:3857 enables MapML PROJECTION OSMTILE</p></li>
<li><p>EPSG:3978 enables MapML PROJECTION CBMTILE</p></li>
<li><p>EPSG:5936 enables MapML PROJECTION APSTILE</p></li>
<li><p>EPSG:4326 and CRS:84 enable MapML PROJECTION WGS84</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>Other mapml-specific metada entries will also be supported:</p>
<ul class="simple">
<li><p><strong>mapml_wms_link_rel</strong>: one of “tile” or “image”. Controls whether WMS outputs URL templates as &lt;link rel=”image”…&gt; or &lt;link rel=”tile”…&gt;.  Defaults to “image”.</p></li>
<li><p><strong>mapml_wms_image_format</strong>: can be used to specify the preferred image format to use for a given WMS layer (e.g. image/png, image/jpeg)</p></li>
<li><p>TBD: other metadata entries may be added as needed during the final implementation.</p></li>
</ul>
</section>
<section id="the-vendor-specific-getmapml-request">
<h3>2.4 The Vendor-specific GetMapML Request<a class="headerlink" href="#the-vendor-specific-getmapml-request" title="Link to this heading">¶</a></h3>
<p>A new vendor-specific “REQUEST=GetMapML” has been added to MapServer to request a &lt;mapml&gt; document for a specified service type (WMS, WFS) and map/layer/style/projection combination. A valid WMS mapfile is required and the request supports the following URL parameters:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>R/O</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>MAP</p></td>
<td><p>R</p></td>
<td><p>/path/to/mapfile.map</p></td>
</tr>
<tr class="row-odd"><td><p>SERVICE</p></td>
<td><p>R</p></td>
<td><dl class="simple">
<dt>Type of service that the &lt;mapml&gt; response should link to.</dt><dd><ul class="simple">
<li><p>WMS: links to WMS GetMap, GetFeatureInfo, etc</p></li>
<li><p>WFS: links to WFS GetFeature</p></li>
</ul>
</dd>
</dl>
<p>Note: support for other service types such as MapCache xyz/tms/wmts references may be added at a later time</p>
</td>
</tr>
<tr class="row-even"><td><p>REQUEST</p></td>
<td><p>R</p></td>
<td><p>GetMapML</p></td>
</tr>
<tr class="row-odd"><td><p>LAYER</p></td>
<td><p>R</p></td>
<td><p>A layer name</p></td>
</tr>
<tr class="row-even"><td><p>STYLE</p></td>
<td><p>O</p></td>
<td><p>WMS Style name (an empty value will be used by default)</p></td>
</tr>
<tr class="row-odd"><td><p>PROJECTION</p></td>
<td><p>O</p></td>
<td><p>One of OSMTILE, CBMTILE, APSTILE or WGS84, defaults to OSMTILE if not specified (as per spec)</p></td>
</tr>
</tbody>
</table>
<p>R/O: R=Required or O=Optional</p>
<p>Example:</p>
<blockquote>
<div><p><a class="reference external" href="http://localhost/cgi-bin/mapserv?map=/path/to/test.map&amp;service=WMS&amp;request=GetMapML&amp;layer=layer1&amp;style=&amp;projection=OSMTILE">http://localhost/cgi-bin/mapserv?map=/path/to/test.map&amp;service=WMS&amp;request=GetMapML&amp;layer=layer1&amp;style=&amp;projection=OSMTILE</a></p>
</div></blockquote>
<p>The returned MapML document will contain URL templates for the requested service type and layer with all the required MapML &lt;input&gt; parameter definitions to allow the client viewer to implement the logic required to zoom/pan the map and automatically generate the new GetMap (for WMS) or GetFeature (for WFS) on the client side.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The MapML spec does not define a GetMapML request, so this is a vendor-specific extension, and it is worth noting that the behaviour proposed in this RFC for the GetMapML request is slightly different from the approach which was discussed in OGC Testbed 13 (<a class="reference external" href="https://docs.ogc.org/per/17-019.html#_wms_to_serve_mapml">https://docs.ogc.org/per/17-019.html#_wms_to_serve_mapml</a>) which expected the client viewer to go back to the server for each zoom/pan operation to evaluate the new extents and return a static set of image or tile URLs for each operation. The URL template approach is simpler to implement for the server and will result in a better user experience in the viewer.</p>
</div>
</section>
<section id="updates-to-getcapabilities">
<h3>2.5 Updates to GetCapabilities<a class="headerlink" href="#updates-to-getcapabilities" title="Link to this heading">¶</a></h3>
<dl class="simple">
<dt>If MapML is enabled in the mapfile then:</dt><dd><ul class="simple">
<li><p>WMS GetCapabilities will include a reference to the vendor-specific GetMapML request, and text/mapml will be listed as a GetFeatureInfo format if enabled.</p></li>
<li><p>WFS GetCapabilities will include a reference to the vendor-specific GetMapML request, and text/mapml will be listed as a GetFeature format.</p></li>
</ul>
</dd>
</dl>
</section>
<section id="mapml-usage-example">
<h3>2.6 MapML usage example<a class="headerlink" href="#mapml-usage-example" title="Link to this heading">¶</a></h3>
<p>In a typical use case, a web developer includes a &lt;mm-map&gt; HTML element in a web page as follows (this example uses the Leaflet polyfill viewer):</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>MapServer MapML Demo<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#39;utf-8&#39;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;/mapml/viewer/bower_components/webcomponentsjs/webcomponents-lite.min.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;import&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/mapml/viewer/bower_components/web-map/web-map.html&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="w">     </span><span class="o">*</span><span class="w"> </span><span class="p">{</span><span class="k">margin</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;}</span>
<span class="w">     </span><span class="nt">map</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="n">flexbox</span><span class="p">;</span><span class="w"> </span><span class="k">height</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="kt">vh</span><span class="p">;}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">mm-map</span> <span class="na">is</span><span class="o">=</span><span class="s">&quot;web-map&quot;</span> <span class="na">projection</span><span class="o">=</span><span class="s">&quot;OSMTILE&quot;</span> <span class="na">zoom</span><span class="o">=</span><span class="s">&quot;5&quot;</span> <span class="na">lat</span><span class="o">=</span><span class="s">&quot;45&quot;</span> <span class="na">lon</span><span class="o">=</span><span class="s">&quot;-80&quot;</span> <span class="na">controls</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">layer-</span> <span class="na">label</span><span class="o">=</span><span class="s">&quot;MapServer Demo WMS&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;http://localhost/cgi-bin/mapserv?map=/path/to/test.map&amp;service=WMS&amp;request=GetMapML&amp;layer=layer1&amp;style=&amp;projection=OSMTILE&quot;</span> <span class="na">checked</span><span class="p">&gt;&lt;/</span><span class="nt">layer-</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">mm-map</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>The src attribute of the &lt;layer-&gt; in the &lt;mm-map&gt; element above links to a &lt;mapml&gt; document that defines the map contents (layers, projections, query urls, etc.) and how the browser should interact with them.</p>
<p>In the WMS case, the &lt;mapml&gt; document returned by MapServer in response to a SERVICE=WMS&amp;REQUEST=GetMapML looks like this:</p>
<p><a class="reference external" href="http://localhost/cgi-bin/mapserv?map=/path/to/test.map&amp;service=WMS&amp;request=GetMapML&amp;layer=layer1&amp;style=&amp;projection=OSMTILE">http://localhost/cgi-bin/mapserv?map=/path/to/test.map&amp;service=WMS&amp;request=GetMapML&amp;layer=layer1&amp;style=&amp;projection=OSMTILE</a></p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">mapml</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Demo WMS<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span> <span class="p">/&gt;</span>
<span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;Content-Type&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;text/mapml;projection=OSMTILE&quot;</span> <span class="p">/&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">extent</span> <span class="na">units</span><span class="o">=</span><span class="s">&quot;OSMTILE&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;w&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;width&quot;</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;h&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;height&quot;</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;xmin&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;location&quot;</span> <span class="na">units</span><span class="o">=</span><span class="s">&quot;pcrs&quot;</span> <span class="na">position</span><span class="o">=</span><span class="s">&quot;top-left&quot;</span> <span class="na">axis</span><span class="o">=</span><span class="s">&quot;easting&quot;</span> <span class="na">min</span><span class="o">=</span><span class="s">&quot;-9.50126e+06&quot;</span> <span class="na">max</span><span class="o">=</span><span class="s">&quot;-7.57178e+06&quot;</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;ymin&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;location&quot;</span> <span class="na">units</span><span class="o">=</span><span class="s">&quot;pcrs&quot;</span> <span class="na">position</span><span class="o">=</span><span class="s">&quot;bottom-left&quot;</span> <span class="na">axis</span><span class="o">=</span><span class="s">&quot;northing&quot;</span> <span class="na">min</span><span class="o">=</span><span class="s">&quot;5.00048e+06&quot;</span> <span class="na">max</span><span class="o">=</span><span class="s">&quot;6.17829e+06&quot;</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;xmax&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;location&quot;</span> <span class="na">units</span><span class="o">=</span><span class="s">&quot;pcrs&quot;</span> <span class="na">position</span><span class="o">=</span><span class="s">&quot;top-right&quot;</span> <span class="na">axis</span><span class="o">=</span><span class="s">&quot;easting&quot;</span> <span class="na">min</span><span class="o">=</span><span class="s">&quot;-9.50126e+06&quot;</span> <span class="na">max</span><span class="o">=</span><span class="s">&quot;-7.57178e+06&quot;</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;ymax&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;location&quot;</span> <span class="na">units</span><span class="o">=</span><span class="s">&quot;pcrs&quot;</span> <span class="na">position</span><span class="o">=</span><span class="s">&quot;top-left&quot;</span> <span class="na">axis</span><span class="o">=</span><span class="s">&quot;northing&quot;</span> <span class="na">min</span><span class="o">=</span><span class="s">&quot;5.00048e+06&quot;</span> <span class="na">max</span><span class="o">=</span><span class="s">&quot;6.17829e+06&quot;</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;image&quot;</span> <span class="na">tref</span><span class="o">=</span><span class="s">&quot;http://localhost/cgi-bin/mapserv?map=/path/to/test.map&amp;amp;SERVICE=WMS&amp;amp;REQUEST=GetMap&amp;amp;FORMAT=image/png&amp;amp;TRANSPARENT=TRUE&amp;amp;VERSION=1.3.0&amp;amp;LAYERS=layer1&amp;amp;STYLES=&amp;amp;WIDTH={w}&amp;amp;HEIGHT={h}&amp;amp;CRS=EPSG:3857&amp;amp;BBOX={xmin},{ymin},{xmax},{ymax}&amp;amp;m4h=t&quot;</span><span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;i&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;location&quot;</span> <span class="na">axis</span><span class="o">=</span><span class="s">&quot;i&quot;</span> <span class="na">units</span><span class="o">=</span><span class="s">&quot;map&quot;</span> <span class="na">min</span><span class="o">=</span><span class="s">&quot;0.0&quot;</span> <span class="na">max</span><span class="o">=</span><span class="s">&quot;0.0&quot;</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;j&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;location&quot;</span> <span class="na">axis</span><span class="o">=</span><span class="s">&quot;j&quot;</span> <span class="na">units</span><span class="o">=</span><span class="s">&quot;map&quot;</span> <span class="na">min</span><span class="o">=</span><span class="s">&quot;0.0&quot;</span> <span class="na">max</span><span class="o">=</span><span class="s">&quot;0.0&quot;</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;query&quot;</span> <span class="na">tref</span><span class="o">=</span><span class="s">&quot;http://localhost/cgi-bin/mapserv?map=/path/to/test.map&amp;amp;SERVICE=WMS&amp;amp;REQUEST=GetFeatureInfo&amp;amp;INFO_FORMAT=text/mapml&amp;amp;FEATURE_COUNT=1&amp;amp;TRANSPARENT=TRUE&amp;amp;VERSION=1.3.0&amp;amp;LAYERS=layer1&amp;amp;STYLES=&amp;amp;QUERY_LAYERS=layer1&amp;amp;WIDTH={w}&amp;amp;HEIGHT={h}&amp;amp;CRS=EPSG:3857&amp;amp;BBOX={xmin},{ymin},{xmax},{ymax}&amp;amp;x={i}&amp;amp;y={j}&amp;amp;m4h=t&quot;</span><span class="p">/&gt;</span>
  <span class="p">&lt;/</span><span class="nt">extent</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">mapml</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>Don’t worry about the complexity of the &lt;mapml&gt; document. It is automatically generated by MapServer and consumed by the viewer. It is not intended to be generated by humans.</p>
<p>Finally, when the user queries the map, the resulting WMS GetFeatureInfo or WFS GetFeature requests can return a “text/mapml” feature collection response which look like this:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">mapml</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>GetFeatureInfo Results<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span> <span class="p">/&gt;</span>
<span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;Content-Type&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;text/mapml&quot;</span> <span class="p">/&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">extent</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">feature</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;pop_place.1696&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;pop_place&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">properties</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">table</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">thead</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
              <span class="p">&lt;</span><span class="nt">th</span> <span class="na">role</span><span class="o">=</span><span class="s">&quot;columnheader&quot;</span> <span class="na">scope</span><span class="o">=</span><span class="s">&quot;col&quot;</span><span class="p">&gt;</span>Property Name<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
              <span class="p">&lt;</span><span class="nt">th</span> <span class="na">role</span><span class="o">=</span><span class="s">&quot;columnheader&quot;</span> <span class="na">scope</span><span class="o">=</span><span class="s">&quot;col&quot;</span><span class="p">&gt;</span>Property Value<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
          <span class="p">&lt;/</span><span class="nt">thead</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">tbody</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
              <span class="p">&lt;</span><span class="nt">th</span> <span class="na">scope</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span>pname_en<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
              <span class="p">&lt;</span><span class="nt">td</span> <span class="na">itemprop</span><span class="o">=</span><span class="s">&quot;pname_en&quot;</span><span class="p">&gt;</span>Ottawa<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
          <span class="p">&lt;/</span><span class="nt">tbody</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">properties</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">feature</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">mapml</span><span class="p">&gt;</span>
</pre></div>
</div>
</section>
</section>
<section id="implementation-details">
<h2>3. Implementation Details<a class="headerlink" href="#implementation-details" title="Link to this heading">¶</a></h2>
<p>Most of the MapML support code will live in mapml.c, with hooks calling it from mapwms.c and mapwfs.c.</p>
<p>A set of msautotests will be added to test the new features.</p>
</section>
<section id="limitations-caveats">
<h2>4. Limitations / caveats<a class="headerlink" href="#limitations-caveats" title="Link to this heading">¶</a></h2>
<section id="mapml-viewer-polyfill">
<h3>4.1 MapML Viewer Polyfill<a class="headerlink" href="#mapml-viewer-polyfill" title="Link to this heading">¶</a></h3>
<p>Since there is no direct support for MapML in web browsers at this time, the use of a MapML polyfill (based on Leaflet) is required in order to use MapML in web pages.  More details will be provided in the docs for this feature.</p>
</section>
<section id="experimental-spec">
<h3>4.2 Experimental spec<a class="headerlink" href="#experimental-spec" title="Link to this heading">¶</a></h3>
<p>This reference implementation should be considered experimental since the MapML spec itself is still a work in progress by the W3C Maps for HTML Community Group. The spec is likely to change over time until an official version is adopted and this should be kept in mind when deploying services.</p>
<p>You are also encouraged to get involved and provide feedback by joining the Maps for HTML Community Group at <a class="reference external" href="https://www.w3.org/community/maps4html/">https://www.w3.org/community/maps4html/</a></p>
<p>Most of the implementation is in a single mapml.c source file, so if this extension ever becomes unused or unsupported then it can be removed from the source base in a future release relatively easily.</p>
</section>
<section id="wms-getfeatureinfo-and-wfs-getfeature-output">
<h3>4.3 WMS GetFeatureInfo and WFS GetFeature output<a class="headerlink" href="#wms-getfeatureinfo-and-wfs-getfeature-output" title="Link to this heading">¶</a></h3>
<p>In the initial implementation, WMS GetFeatureInfo queries will only produce a basic attribute table response without the geometry, suitable for use in a popup over a map for instance.</p>
<p>In a second phase of work, an OGR &lt;mapml&gt; driver will be implemented and once it is available then MapServer will be upgraded to use this OGR driver for the text/mapml feature collection output format in response to WMS GetFeatureinfo and WFS GetFeature requests.  This will introduce a dependency on this OGR driver for full feature collection support but the rest of the MapML code can still work without the driver if not available.</p>
</section>
</section>
<section id="backwards-compatibility-issues">
<h2>5. Backwards Compatibility Issues<a class="headerlink" href="#backwards-compatibility-issues" title="Link to this heading">¶</a></h2>
<p>None anticipated as this is a new feature.</p>
</section>
<section id="security-implications">
<h2>6. Security implications<a class="headerlink" href="#security-implications" title="Link to this heading">¶</a></h2>
<p>None anticipated at the moment.</p>
</section>
<section id="performance-implications">
<h2>7. Performance implications<a class="headerlink" href="#performance-implications" title="Link to this heading">¶</a></h2>
<p>No impacts on core performance are anticipated.</p>
</section>
<section id="documentation-needs">
<h2>8. Documentation needs<a class="headerlink" href="#documentation-needs" title="Link to this heading">¶</a></h2>
<p>A new documentation page will be added outlining the various MapML output configuration scenarios and parameters (in the style of the OGC WMS Server page for instance).</p>
<p>A step by step example will also be provided including instructions to deploy the Leaflet viewer polyfill on a server and how to use it in a webpage.</p>
</section>
<section id="ticket-id-and-references">
<h2>9. Ticket ID and references<a class="headerlink" href="#ticket-id-and-references" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>MapServer Ticket: <a class="reference external" href="https://github.com/MapServer/MapServer/issues/6024">https://github.com/MapServer/MapServer/issues/6024</a></p></li>
<li><p>W3C Maps For HTML Community Group: <a class="reference external" href="https://www.w3.org/community/maps4html/">https://www.w3.org/community/maps4html/</a></p></li>
<li><p>Maps for HTML Community Group Resources Page: <a class="reference external" href="https://maps4html.github.io/">https://maps4html.github.io/</a></p></li>
<li><p>HTML &lt;map&gt; Element Spec: <a class="reference external" href="https://maps4html.org/HTML-Map-Element/spec/">https://maps4html.org/HTML-Map-Element/spec/</a></p></li>
<li><p>Map Markup Language (MapML) Spec: <a class="reference external" href="https://maps4html.org/MapML/spec/">https://maps4html.org/MapML/spec/</a></p></li>
<li><p>MapML Spec github repository: <a class="reference external" href="https://github.com/Maps4HTML/MapML">https://github.com/Maps4HTML/MapML</a></p></li>
<li><p>GeoServer MapML Support Docs: <a class="reference external" href="https://docs.geoserver.org/latest/en/user/community/mapml/index.html">https://docs.geoserver.org/latest/en/user/community/mapml/index.html</a></p></li>
<li><p>OGC Testbed-13 MapML ER: <a class="reference external" href="https://docs.ogc.org/per/17-019.html">https://docs.ogc.org/per/17-019.html</a></p></li>
</ul>
</section>
<section id="voting-history">
<h2>10. Voting history<a class="headerlink" href="#voting-history" title="Link to this heading">¶</a></h2>
<p>Adopted with +1 from PSC members EvenR, SethG, JeromeB, MichaelS, JukkaR, TomK, JeffM, SteveL, DanielM.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p>
<a href="../../about.html" title="About">About</a><br>
<a href="../../products.html" title="Products">Products</a><br>
<a href="../../community/index.html" title="Community">Community</a><br>
<a href="../index.html" title="Development">Development</a><br>
<a href="../../download.html" title="Downloads">Downloads</a><br>
<a href="../../documentation.html" title="Documentation">Documentation</a><br>
<a href="../../faq.html" title="FAQ">FAQ</a><br>
<a href="../../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</h3>
  <ul>
<li><a class="reference internal" href="#">MS RFC 123: Support for MapML output in MapServer</a><ul>
<li><a class="reference internal" href="#overview">1. Overview</a></li>
<li><a class="reference internal" href="#proposed-solution">2. Proposed solution</a><ul>
<li><a class="reference internal" href="#building-enabling-the-mapml-option">2.1 Building/enabling the MapML option</a></li>
<li><a class="reference internal" href="#mapfile-configuration-parameters">2.2 MapFile configuration parameters</a></li>
<li><a class="reference internal" href="#the-vendor-specific-getmapml-request">2.4 The Vendor-specific GetMapML Request</a></li>
<li><a class="reference internal" href="#updates-to-getcapabilities">2.5 Updates to GetCapabilities</a></li>
<li><a class="reference internal" href="#mapml-usage-example">2.6 MapML usage example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#implementation-details">3. Implementation Details</a></li>
<li><a class="reference internal" href="#limitations-caveats">4. Limitations / caveats</a><ul>
<li><a class="reference internal" href="#mapml-viewer-polyfill">4.1 MapML Viewer Polyfill</a></li>
<li><a class="reference internal" href="#experimental-spec">4.2 Experimental spec</a></li>
<li><a class="reference internal" href="#wms-getfeatureinfo-and-wfs-getfeature-output">4.3 WMS GetFeatureInfo and WFS GetFeature output</a></li>
</ul>
</li>
<li><a class="reference internal" href="#backwards-compatibility-issues">5. Backwards Compatibility Issues</a></li>
<li><a class="reference internal" href="#security-implications">6. Security implications</a></li>
<li><a class="reference internal" href="#performance-implications">7. Performance implications</a></li>
<li><a class="reference internal" href="#documentation-needs">8. Documentation needs</a></li>
<li><a class="reference internal" href="#ticket-id-and-references">9. Ticket ID and references</a></li>
<li><a class="reference internal" href="#voting-history">10. Voting history</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ms-rfc-124.html" title="MS RFC 124: Improving SLD Support in MapServer"
             >next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-122.html" title="MS RFC 122: A Tool for Coverage Analysis of MapCache Multi-SQLite Caches"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 123: Support for MapML output in MapServer</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; <a href="../../copyright.html">Copyright</a> 2023, Open Source Geospatial Foundation.
      Last updated on 2023-12-22.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.5.
    </div>
  </body>
</html>