<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>MS RFC 112: Retry “Follow” label positioning after maxoverlapangle colision &#8212; MapServer 8.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx.css?v=6c7b17ac" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=dd298242" />
    <link rel="stylesheet" type="text/css" href="../../_static/ribbon.css?v=ea091bf4" />
    
    <script src="../../_static/documentation_options.js?v=521b6f53"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="icon" href="../../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="MS RFC 113: Layer Compositing Pipeline" href="ms-rfc-113.html" />
    <link rel="prev" title="MS RFC 111: MapCache Support for animated time series" href="ms-rfc-111.html" /> 
  </head><body>


<!-- for main branch only, do not backport this -->

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../../index.html" title="Home"><img src="../../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../../index.html" title="Home">Home</a> |
      <a href="../../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter" target="_blank">Twitter</a> |
      <a href="../../download.html" title="Download Source or Binaries">Download </a> |
      <a class="badge" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=KRJ2X44N3HA6U&source=url" target="_blank">
        <img src="https://img.shields.io/badge/donate-%E2%9D%A4%C2%A0-ff69b4.svg?style=flat" alt="Donate to MapServer">
      </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../../ar/development/rfc/ms-rfc-112.html"><img src="../../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../../de/development/rfc/ms-rfc-112.html"><img src="../../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../../el/development/rfc/ms-rfc-112.html"><img src="../../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../../es/development/rfc/ms-rfc-112.html"><img src="../../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../../fr/development/rfc/ms-rfc-112.html"><img src="../../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../../id/development/rfc/ms-rfc-112.html"><img src="../../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../../it/development/rfc/ms-rfc-112.html"><img src="../../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../../ja/development/rfc/ms-rfc-112.html"><img src="../../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../../nl_NL/development/rfc/ms-rfc-112.html"><img src="../../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../../pl/development/rfc/ms-rfc-112.html"><img src="../../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../../ru/development/rfc/ms-rfc-112.html"><img src="../../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../../sq/development/rfc/ms-rfc-112.html"><img src="../../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../../tr/development/rfc/ms-rfc-112.html"><img src="../../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ms-rfc-113.html" title="MS RFC 113: Layer Compositing Pipeline"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-111.html" title="MS RFC 111: MapCache Support for animated time series"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 112: Retry “Follow” label positioning after maxoverlapangle colision</a></li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="ms-rfc-112-retry-follow-label-positioning-after-maxoverlapangle-colision">
<span id="rfc112"></span><h1>MS RFC 112: Retry “Follow” label positioning after maxoverlapangle colision<a class="headerlink" href="#ms-rfc-112-retry-follow-label-positioning-after-maxoverlapangle-colision" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Date<span class="colon">:</span></dt>
<dd class="field-odd"><p>2014/10</p>
</dd>
<dt class="field-even">Author<span class="colon">:</span></dt>
<dd class="field-even"><p>Thomas Bonfort</p>
</dd>
<dt class="field-odd">Contact<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="mailto:thomas&#46;bonfort&#37;&#52;&#48;gmail&#46;com">thomas<span>&#46;</span>bonfort<span>&#64;</span>gmail<span>&#46;</span>com</a></p>
</dd>
<dt class="field-even">Status<span class="colon">:</span></dt>
<dd class="field-even"><p>Implemented</p>
</dd>
<dt class="field-odd">Version<span class="colon">:</span></dt>
<dd class="field-odd"><p>MapServer 7.2</p>
</dd>
</dl>
<section id="the-current-situation">
<h2>1. The Current Situation<a class="headerlink" href="#the-current-situation" title="Link to this heading">¶</a></h2>
<p>The current algorithm used to place “FOLLOW” labels has the following limitations:</p>
<ul class="simple">
<li><p>When two subsequent caracters of the label have a relative angle that is over
the defined “maxoverlapangle”, the label is unconditionally discarded.</p></li>
<li><p>The function used to compute character positions relies on “gotos” that
interrupt the code flow</p></li>
<li><p>Placement of repeated labels works optimally for odd number of repetitions
only when using repeatdistance, i.e. even if there’s room for two labels,
only one will be rendered</p></li>
</ul>
</section>
<section id="proposed-enhancement">
<h2>2. Proposed enhancement<a class="headerlink" href="#proposed-enhancement" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>The algorithm will be extended to account for and try to correct for
colisions happening when maxoverlapangle kicks in, by ensuring that such
colisions may only occur between words:</p>
<ul>
<li><p>collisions hapenning on a ‘space’ character will be ignored</p></li>
<li><p>when a colision does occur, the label placement will be retried with an
offset placed such that the colision falls either on a space or at the
beginning or end of the string.</p></li>
</ul>
</li>
<li><p>Code will be refactored to avoid usage of gotos</p></li>
<li><p>The placement algorithm will be modified to optimally treat an even number of
label repetitions:</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>before:</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-------</span><span class="n">label</span><span class="o">--------</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>after:</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">label</span><span class="o">------</span><span class="n">label</span><span class="o">--</span>
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
</section>
<section id="questions-limitations">
<h2>2.1 Questions/Limitations<a class="headerlink" href="#questions-limitations" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Should the retrying behavior be enabled by default, and/or can it be
deactivated ? Computing and testing a retried offset is not costly, the
impact in terms of performance should be minimal and will result in more
labels being placed.</p></li>
<li><p>Should the maximum allowed offset be configurable?  Seems unnecessary for the
time being, all the relevant info as to what the maximum offset can be is contained
by the line length, label length, and repeatdistance.</p></li>
</ul>
</section>
<section id="backwards-compatibility">
<h2>2.2 Backwards Compatibility<a class="headerlink" href="#backwards-compatibility" title="Link to this heading">¶</a></h2>
<p>None expected aside from the fact created maps may contain more/different labels
than beforehand.</p>
</section>
<section id="performance-implications">
<h2>2.3 Performance Implications<a class="headerlink" href="#performance-implications" title="Link to this heading">¶</a></h2>
<p>Limited. Retrying a label after a colision is not a cpu-heavy operation. Costly
operations such as computing glyph advances and/or shaping text runs are not
re-run for each retry.</p>
</section>
<section id="implementation-details">
<h2>3. Implementation Details<a class="headerlink" href="#implementation-details" title="Link to this heading">¶</a></h2>
<section id="affected-files">
<h3>3.1 Affected files<a class="headerlink" href="#affected-files" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>mapprimitive.c: implement retrying behavior - compute retried offsets</p></li>
</ul>
</section>
<section id="tracking-issue">
<h3>3.2 Tracking Issue<a class="headerlink" href="#tracking-issue" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>code: <a class="reference external" href="https://github.com/MapServer/MapServer/pull/5048">https://github.com/MapServer/MapServer/pull/5048</a></p></li>
<li><p>tests: <a class="reference external" href="https://github.com/tbonfort/msautotest/tree/displace_follow_labels">https://github.com/tbonfort/msautotest/tree/displace_follow_labels</a></p></li>
</ul>
</section>
</section>
<section id="voting-history">
<h2>4. Voting History<a class="headerlink" href="#voting-history" title="Link to this heading">¶</a></h2>
<p>+1 from SteveL, DanielM, StephanM, PerryN, MikeS, StephenW, ThomasB</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p>
<a href="../../about.html" title="About">About</a><br>
<a href="../../products.html" title="Products">Products</a><br>
<a href="../../community/index.html" title="Community">Community</a><br>
<a href="../index.html" title="Development">Development</a><br>
<a href="../../download.html" title="Downloads">Downloads</a><br>
<a href="../../documentation.html" title="Documentation">Documentation</a><br>
<a href="../../faq.html" title="FAQ">FAQ</a><br>
<a href="../../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</h3>
  <ul>
<li><a class="reference internal" href="#">MS RFC 112: Retry “Follow” label positioning after maxoverlapangle colision</a><ul>
<li><a class="reference internal" href="#the-current-situation">1. The Current Situation</a></li>
<li><a class="reference internal" href="#proposed-enhancement">2. Proposed enhancement</a></li>
<li><a class="reference internal" href="#questions-limitations">2.1 Questions/Limitations</a></li>
<li><a class="reference internal" href="#backwards-compatibility">2.2 Backwards Compatibility</a></li>
<li><a class="reference internal" href="#performance-implications">2.3 Performance Implications</a></li>
<li><a class="reference internal" href="#implementation-details">3. Implementation Details</a><ul>
<li><a class="reference internal" href="#affected-files">3.1 Affected files</a></li>
<li><a class="reference internal" href="#tracking-issue">3.2 Tracking Issue</a></li>
</ul>
</li>
<li><a class="reference internal" href="#voting-history">4. Voting History</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ms-rfc-113.html" title="MS RFC 113: Layer Compositing Pipeline"
             >next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-111.html" title="MS RFC 111: MapCache Support for animated time series"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 112: Retry “Follow” label positioning after maxoverlapangle colision</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; <a href="../../copyright.html">Copyright</a> 2023, Open Source Geospatial Foundation.
      Last updated on 2023-12-22.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.5.
    </div>
  </body>
</html>