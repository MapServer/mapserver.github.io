<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>MS RFC 18: Encryption of passwords in mapfiles &#8212; MapServer 8.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx.css?v=6c7b17ac" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=dd298242" />
    <link rel="stylesheet" type="text/css" href="../../_static/ribbon.css?v=ea091bf4" />
    
    <script src="../../_static/documentation_options.js?v=521b6f53"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="icon" href="../../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="MS RFC 19: Style &amp; Label attribute binding" href="ms-rfc-19.html" />
    <link rel="prev" title="MS RFC 17: Dynamic Allocation of layers, styles, classes and symbols" href="ms-rfc-17.html" /> 
  </head><body>


<!-- for main branch only, do not backport this -->

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../../index.html" title="Home"><img src="../../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../../index.html" title="Home">Home</a> |
      <a href="../../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter" target="_blank">Twitter</a> |
      <a href="../../download.html" title="Download Source or Binaries">Download </a> |
      <a class="badge" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=KRJ2X44N3HA6U&source=url" target="_blank">
        <img src="https://img.shields.io/badge/donate-%E2%9D%A4%C2%A0-ff69b4.svg?style=flat" alt="Donate to MapServer">
      </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../../ar/development/rfc/ms-rfc-18.html"><img src="../../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../../de/development/rfc/ms-rfc-18.html"><img src="../../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../../el/development/rfc/ms-rfc-18.html"><img src="../../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../../es/development/rfc/ms-rfc-18.html"><img src="../../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../../fr/development/rfc/ms-rfc-18.html"><img src="../../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../../id/development/rfc/ms-rfc-18.html"><img src="../../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../../it/development/rfc/ms-rfc-18.html"><img src="../../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../../ja/development/rfc/ms-rfc-18.html"><img src="../../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../../nl_NL/development/rfc/ms-rfc-18.html"><img src="../../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../../pl/development/rfc/ms-rfc-18.html"><img src="../../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../../ru/development/rfc/ms-rfc-18.html"><img src="../../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../../sq/development/rfc/ms-rfc-18.html"><img src="../../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../../tr/development/rfc/ms-rfc-18.html"><img src="../../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ms-rfc-19.html" title="MS RFC 19: Style &amp; Label attribute binding"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-17.html" title="MS RFC 17: Dynamic Allocation of layers, styles, classes and symbols"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 18: Encryption of passwords in mapfiles</a></li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="ms-rfc-18-encryption-of-passwords-in-mapfiles">
<span id="rfc18"></span><h1>MS RFC 18: Encryption of passwords in mapfiles<a class="headerlink" href="#ms-rfc-18-encryption-of-passwords-in-mapfiles" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Date<span class="colon">:</span></dt>
<dd class="field-odd"><p>2006/05/26</p>
</dd>
<dt class="field-even">Author<span class="colon">:</span></dt>
<dd class="field-even"><p>Daniel Morissette</p>
</dd>
<dt class="field-odd">Contact<span class="colon">:</span></dt>
<dd class="field-odd"><p>dmorissette at mapgears.com</p>
</dd>
<dt class="field-even">Last Edited<span class="colon">:</span></dt>
<dd class="field-even"><p>2006/08/11</p>
</dd>
<dt class="field-odd">Status<span class="colon">:</span></dt>
<dd class="field-odd"><p>Completed (2006/08/11)</p>
</dd>
<dt class="field-even">Version<span class="colon">:</span></dt>
<dd class="field-even"><p>MapServer 4.10</p>
</dd>
</dl>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p>This proposal provides a mechanism to protect database connection passwords
used inside <a class="reference internal" href="../../mapfile/index.html#mapfile"><span class="std std-ref">mapfiles</span></a> by encrypting them instead of including
them in plain text.</p>
</section>
<section id="technical-solution">
<h2>Technical Solution<a class="headerlink" href="#technical-solution" title="Link to this heading">¶</a></h2>
<p>MapServer will be extended to allow the use of encrypted passwords as part
of the CONNECTION string for the following layer types:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../input/vector/oracle.html#oci"><span class="std std-ref">Oracle Spatial</span></a></p></li>
<li><p><a class="reference internal" href="../../input/vector/postgis.html#input-postgis"><span class="std std-ref">PostGIS</span></a></p></li>
<li><p><a class="reference internal" href="../../input/vector/arcsde.html#arcsde"><span class="std std-ref">ESRI SDE</span></a></p></li>
<li><p><a class="reference internal" href="../../input/vector/ogr.html#ogr"><span class="std std-ref">OGR</span></a></p></li>
</ul>
<p>The Tiny Encryption Algorithm (TEA) at
<a class="reference external" href="http://www.simonshepherd.supanet.com/tea.htm">http://www.simonshepherd.supanet.com/tea.htm</a> will be used for the
encryption/decryption functions.</p>
<p>The implementation details follow…</p>
</section>
<section id="encryption-key">
<h2>Encryption key<a class="headerlink" href="#encryption-key" title="Link to this heading">¶</a></h2>
<p>In order to safely protect the encrypted information, an encryption key will
be required by this mechanism. The key will NOT be stored in the mapfile: it
will be stored in a separate file on the server and should be kept in a
safe area by the server administrator (especially outside of the web
server’s document directories).</p>
<p>The location of the encryption key can be specified by two mechanisms,
either by setting the environment variable MS_ENCRYPTION_KEY or using a
CONFIG directive:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CONFIG</span> <span class="n">MS_ENCRYPTION_KEY</span> <span class="s2">&quot;/path/to/mykey.txt&quot;</span>
</pre></div>
</div>
</section>
<section id="new-msencrypt-command-line-utility">
<h2>New “msencrypt” command-line utility<a class="headerlink" href="#new-msencrypt-command-line-utility" title="Link to this heading">¶</a></h2>
<p>A “msencrypt” command-line utility will be provided to create an encryption
key and to encrypt passwords (or any string) for use in a mapfile.</p>
<p>To create an encryption key:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">msencrypt</span> <span class="o">-</span><span class="n">keygen</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">mykey</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
<p>To encrypt a password or any string:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">msencrypt</span> <span class="o">-</span><span class="n">key</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">mykey</span><span class="o">.</span><span class="n">txt</span> <span class="o">&lt;</span><span class="n">string_to_encrypt</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>If the MS_ENCRYPTION_KEY environment variable is set then the -key
argument does not need to be specified.</p>
</section>
<section id="encoding-of-encrypted-strings">
<h2>Encoding of encrypted strings<a class="headerlink" href="#encoding-of-encrypted-strings" title="Link to this heading">¶</a></h2>
<p>Since the result of encryption is binary data that is not suitable for
inclusion directly in a MapServer mapfile, hex encoding will be used for the
encrypted strings in the mapfile as well as for storing the encryption
key to disk.</p>
<p>The { and } characters will be used as delimiters for encrypted strings
inside database CONNECTIONs. This will allow the use of either plain text or
encrypted passwords in mapfiles without any backwards compatibility issues.</p>
<p>e.g.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CONNECTIONTYPE</span> <span class="n">ORACLESPATIAL</span>
<span class="n">CONNECTION</span> <span class="s2">&quot;user/{MIIBugIBAAKBgQCP0Yj+Seh8==}@service&quot;</span>
</pre></div>
</div>
<p>Any part of a CONNECTION string can be encrypted and not just the password.
This will allow protecting other information such as login name, hostname
or port numbers if necessary.</p>
<p>For reference, here are examples of typical connection strings for the
layer types that will be affected:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CONNECTIONTYPE</span> <span class="n">POSTGIS</span>
<span class="n">CONNECTION</span> <span class="s2">&quot;host=yourhostname dbname=yourdatabasename user=yourdbusername password=yourdbpassword port=yourpgport&quot;</span>

<span class="n">CONNECTIONTYPE</span> <span class="n">SDE</span>
<span class="n">CONNECTION</span> <span class="s2">&quot;sdemachine.iastate.edu,port:5151,sde,username,password&quot;</span>

<span class="n">CONNECTIONTYPE</span> <span class="n">ORACLESPATIAL</span>
<span class="n">CONNECTION</span> <span class="s2">&quot;user/pwd@service&quot;</span>

<span class="n">CONNECTIONTYPE</span> <span class="n">OGR</span>
<span class="n">CONNECTION</span> <span class="s2">&quot;OCI:user/pwd@service&quot;</span>
</pre></div>
</div>
</section>
<section id="modifications-to-the-source-code">
<h2>Modifications to the source code<a class="headerlink" href="#modifications-to-the-source-code" title="Link to this heading">¶</a></h2>
<p>A msDecryptString() function will be created, it will take a CONNECTION
string as input and decrypt any encrypted component that it may find in it.
This function will be called by the various msXXXLayerOpen() methods before
opening the connection to the database.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">char</span> <span class="o">*</span><span class="n">msDecryptString</span><span class="p">(</span><span class="n">mapObj</span> <span class="o">*</span><span class="nb">map</span><span class="p">,</span> <span class="n">const</span> <span class="n">char</span> <span class="o">*</span><span class="n">string</span><span class="p">)</span>
</pre></div>
</div>
<p>The first time that msDecryptString() is called for a given mapfile, it will
load the encryption key from the file and store the key in a new private
member of the mapObj (char * encryption_key).</p>
<p>To reduce the chances of false matches in long CONNECTION strings such as
OGR VRT data sources, msDecryptString() function will look for a pair of
{ + }, and then verify that all chars in the block are valid hex encoding
chars (0-9,A-F) before proceeding with decryption.</p>
<p>Note that the decrypted string will never be stored in the layerObj, it will
be kept local to the function that opens the connection and destroyed as
soon as the function is done with it. This is to prevent exposing the
decrypted information in error messages or in calls to msSaveMap().</p>
</section>
<section id="files-affected">
<h2>Files affected<a class="headerlink" href="#files-affected" title="Link to this heading">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">map</span><span class="o">.</span><span class="n">h</span>
<span class="n">mapfile</span><span class="o">.</span><span class="n">c</span>
<span class="n">maporaclespatial</span><span class="o">.</span><span class="n">c</span>
<span class="n">mappostgis</span><span class="o">.</span><span class="n">c</span>
<span class="n">mappostgresql</span><span class="o">.</span><span class="n">c</span>
<span class="n">mapsde</span><span class="o">.</span><span class="n">c</span>
<span class="n">mapogr</span><span class="o">.</span><span class="n">cpp</span>
</pre></div>
</div>
</section>
<section id="backwards-compatibility-issues">
<h2>Backwards compatibility issues<a class="headerlink" href="#backwards-compatibility-issues" title="Link to this heading">¶</a></h2>
<p>None.</p>
</section>
<section id="bug-id">
<h2>Bug ID<a class="headerlink" href="#bug-id" title="Link to this heading">¶</a></h2>
<p>1792: <a class="reference external" href="https://github.com/MapServer/MapServer/issues/1792">https://github.com/MapServer/MapServer/issues/1792</a></p>
</section>
<section id="voting-history">
<h2>Voting history<a class="headerlink" href="#voting-history" title="Link to this heading">¶</a></h2>
<p>Adopted on 2006/06/01.
+1: FrankW, DanielM, HowardB, YewondwossenA, SteveW</p>
</section>
<section id="comments-from-the-review-period">
<h2>Comments from the review period<a class="headerlink" href="#comments-from-the-review-period" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>There were concerns about the use of the {…} delimiter to indicate
encrypted strings inside CONNECTIONs. Since there was not a better
alternative we will stick to that.</p></li>
<li><p>There was a suggestion to use an ENCRYPTION_KEY mapfile keyword
instead of CONFIG MS_ENCRYPTION_KEY. Since there was no strong argument
either way we decided to stick to CONFIG MS_ENCRYPTION_KEY.</p></li>
<li><p>There was a suggestion to consider the Blowfish algorithm
(<a class="reference external" href="http://www.schneier.com/blowfish.html">http://www.schneier.com/blowfish.html</a>) instead of TEA. The sample
implementations of Blowfish would require much more work to integrate than
TEA, and since TEA is public domain and so much simpler (simpler is
better!), we’ll stick to TEA for now and can always change the underlying
algorithm at a later time if we find that TEA is too weak (which doesn’t
appear to be an issue).</p></li>
<li><p>Will the encryption methods be made available to MapScript? No plan to do
so at this time, but this could easily be added later on.</p></li>
<li><p>Since the user running the web server (and MapServer) needs to have
permissions to read the key, any web server process or user with permissions
to read the key can decrypt the passwords using a trivial program. It
should be made very clear in the documentation that this is just simple
obfuscation and is by no means secure and that users should not place
valuable passwords in mapfiles encrypted or not.</p></li>
</ul>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p>
<a href="../../about.html" title="About">About</a><br>
<a href="../../products.html" title="Products">Products</a><br>
<a href="../../community/index.html" title="Community">Community</a><br>
<a href="../index.html" title="Development">Development</a><br>
<a href="../../download.html" title="Downloads">Downloads</a><br>
<a href="../../documentation.html" title="Documentation">Documentation</a><br>
<a href="../../faq.html" title="FAQ">FAQ</a><br>
<a href="../../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</h3>
  <ul>
<li><a class="reference internal" href="#">MS RFC 18: Encryption of passwords in mapfiles</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#technical-solution">Technical Solution</a></li>
<li><a class="reference internal" href="#encryption-key">Encryption key</a></li>
<li><a class="reference internal" href="#new-msencrypt-command-line-utility">New “msencrypt” command-line utility</a></li>
<li><a class="reference internal" href="#encoding-of-encrypted-strings">Encoding of encrypted strings</a></li>
<li><a class="reference internal" href="#modifications-to-the-source-code">Modifications to the source code</a></li>
<li><a class="reference internal" href="#files-affected">Files affected</a></li>
<li><a class="reference internal" href="#backwards-compatibility-issues">Backwards compatibility issues</a></li>
<li><a class="reference internal" href="#bug-id">Bug ID</a></li>
<li><a class="reference internal" href="#voting-history">Voting history</a></li>
<li><a class="reference internal" href="#comments-from-the-review-period">Comments from the review period</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ms-rfc-19.html" title="MS RFC 19: Style &amp; Label attribute binding"
             >next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-17.html" title="MS RFC 17: Dynamic Allocation of layers, styles, classes and symbols"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 18: Encryption of passwords in mapfiles</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; <a href="../../copyright.html">Copyright</a> 2023, Open Source Geospatial Foundation.
      Last updated on 2023-12-22.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.5.
    </div>
  </body>
</html>