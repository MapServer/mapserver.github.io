<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>MS RFC 77: Support for Multiple Label Objects Within a Class &mdash; MapServer 7.0.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '7.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="top" title="MapServer 7.0.0 documentation" href="../../index.html" />
    <link rel="up" title="Request for Comments" href="index.html" />
    <link rel="next" title="MS RFC 78: Vector Field Rendering (CONNECTIONTYPE UVRASTER)" href="ms-rfc-78.html" />
    <link rel="prev" title="MS RFC 76: Adding License Metadata to Output Images" href="ms-rfc-76.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../../index.html" title="Home"><img src="../../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../../index.html" title="Home">Home</a> |
      <a href="../../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../../faq.html" title="FAQ">FAQ</a> |
      <a href="../../download.html" title="Download">Download </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../../ar/development/rfc/ms-rfc-77.html"><img src="../../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../../de/development/rfc/ms-rfc-77.html"><img src="../../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../../el/development/rfc/ms-rfc-77.html"><img src="../../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../../es/development/rfc/ms-rfc-77.html"><img src="../../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../../fr/development/rfc/ms-rfc-77.html"><img src="../../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../../id/development/rfc/ms-rfc-77.html"><img src="../../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../../it/development/rfc/ms-rfc-77.html"><img src="../../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../../ja/development/rfc/ms-rfc-77.html"><img src="../../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../../nl_NL/development/rfc/ms-rfc-77.html"><img src="../../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../../pl/development/rfc/ms-rfc-77.html"><img src="../../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../../ru/development/rfc/ms-rfc-77.html"><img src="../../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../../sq/development/rfc/ms-rfc-77.html"><img src="../../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../../tr/development/rfc/ms-rfc-77.html"><img src="../../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        
        
          <a href="../../uk/development/rfc/ms-rfc-77.html"><img src="../../_static/flagicons/uk.png" alt="uk" title="uk" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ms-rfc-78.html" title="MS RFC 78: Vector Field Rendering (CONNECTIONTYPE UVRASTER)"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-76.html" title="MS RFC 76: Adding License Metadata to Output Images"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Request for Comments</a> &raquo;</li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="ms-rfc-77-support-for-multiple-label-objects-within-a-class">
<h1>MS RFC 77: Support for Multiple Label Objects Within a Class<a class="headerlink" href="#ms-rfc-77-support-for-multiple-label-objects-within-a-class" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Date:</th><td class="field-body">2011/10/01</td>
</tr>
<tr class="field-even field"><th class="field-name">Author:</th><td class="field-body">Steve Lime, Thomas Bonfort</td>
</tr>
<tr class="field-odd field"><th class="field-name">Contact:</th><td class="field-body">sdlime at comcast.net,</td>
</tr>
<tr class="field-even field"><th class="field-name">Status:</th><td class="field-body">Adopted on 2011-12-15</td>
</tr>
<tr class="field-odd field"><th class="field-name">Version:</th><td class="field-body">MapServer 6.2</td>
</tr>
</tbody>
</table>
<div class="section" id="overview">
<h2>1. Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>This RFC proposes allowing for the definition of multiple label objects within a class. There are a number of use cases
where this would be valuable.</p>
<ul class="simple">
<li>Adding text below a label with different styling, for example an alternate name shown in italics.</li>
<li>Labeling roads with multiple shields and road numbers.</li>
<li>Supporting complex meteorlogical rendering where many values are placed around a point.</li>
</ul>
<p>Presently only very limited support for these use cases is available. Basically you have to draw layers multiple times and
place each piece of text separately. This is inefficient and does not allow for group label collision avoidance.</p>
</div>
<div class="section" id="proposed-technical-change">
<h2>2. Proposed Technical Change<a class="headerlink" href="#proposed-technical-change" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="core-object-changes">
<h2>2.1 Core Object Changes<a class="headerlink" href="#core-object-changes" title="Permalink to this headline">¶</a></h2>
<p>Class object would need to support multiple label objects in much the same way as the they support multiple styles. In
fact, implementation would follow the styleObj pattern.</p>
<p>A key requirement is that the extra labels be self-contained, that is, they need to allow for the definition of label
text and conditional display within the labelObj. To do this we propose adding the following attributes to labelObj&#8217;s:</p>
<ul class="simple">
<li>expression</li>
<li>text</li>
</ul>
<p>These attributes behave just like their classObj equivalents. In addition a labelObj will be extended with several attributes
that will be used to hold per-feature values in the context of the label cache. They are:</p>
<ul class="simple">
<li>labeltext (string to be drawn)</li>
<li>labelpoly (bounding box shapeObj)</li>
</ul>
<p>A label&#8217;s labeltext will be set according to the following order:</p>
<ul class="simple">
<li>label text (new for this RFC)</li>
<li>class text</li>
<li>layer labelitem</li>
<li>shape text</li>
</ul>
<p>A NULL labeltext value means that label will not be rendered.</p>
<p>The labelCacheMemberObj will also require change. First, it needs to support multiple labelObj&#8217;s (see point and polygon
discussion below) just like the styles attribute currently supported. A label counter will be added as well. Because the
text to be drawn will be carried in a label the text attribute can be removed.</p>
</div>
<div class="section" id="label-rendering-changes">
<h2>2.2 Label Rendering Changes<a class="headerlink" href="#label-rendering-changes" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="point-and-polygon-labels">
<h2>2.2.1 Point and Polygon Labels<a class="headerlink" href="#point-and-polygon-labels" title="Permalink to this headline">¶</a></h2>
<p>The labeling of point and polygon features is done based on a single computed label point. Multiple labels within a classObj
will be applied to a label point as a group, that is, all label text must be placed successfully or the entire group will not
be drawn. In this case a new function, msAddLabelGroup() is available to add all labels from a class to the label cache as
a single  element. The bounding shapes for a group of labels will be considered as one for collision avoidance computations.</p>
<p>Positioning of the multiple labels will be done as always- relative to the label point using label-&gt;position and/or
label-&gt;offset.</p>
<p>In the case of a label group label priority will be taken from the first label defined in a class. Scale thresholds will be
taken into account when a labels labeltext value is assigned (outside of the cache population code). A label that is out of
scale will set labeltext=NULL and will not be drawn although others in the group could be.</p>
<p>Label cache collision functions will have to be updated to look a multiple labels, especially the code that looks for duplicate
text (label-&gt;mindistance).</p>
</div>
<div class="section" id="line-labels">
<h2>2.2.2 Line Labels<a class="headerlink" href="#line-labels" title="Permalink to this headline">¶</a></h2>
<p>Line labeling is another story. Lines often are used to derive curved text, repeating labels and sometimes both. In this case
a single feature might contribute dozens of labels to the cache. It is impractical to handle these as we would a point or
polygon with a single label point. A for more common use will be to label a line with multiple names or a combination of a
name and a marker/text combination. So, for line labels the approach will be to simply use the existing cache faciliities
but with an added loop to process multiple labels if available.</p>
<p>It might be possible in the future to use the label grouping described above in certain instances but that is outside the
scope of this work.</p>
</div>
<div class="section" id="mapscript">
<h2>2.3 MapScript<a class="headerlink" href="#mapscript" title="Permalink to this headline">¶</a></h2>
<p>Class objects will need support for labels similar to what is in place for styles. Presently a classObj supports the following
methods: getStyle, insertStyle, removeStyle, moveStyleUp and moveStyleDown. We propose adding label equivalents for the first
three (label order is not nearly as import as style order).</p>
<p>It is not quite clear how classes label is defined/manipulated from within MapScript. In SWIG/MapScript labels are marked as
immutable. Further work needs to be done to understand if this represents a regression.</p>
</div>
<div class="section" id="implementation-details">
<h2>3. Implementation Details<a class="headerlink" href="#implementation-details" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="files-affected">
<h2>3.1. Files Affected<a class="headerlink" href="#files-affected" title="Permalink to this headline">¶</a></h2>
<p>Change lis limited primarily to:</p>
<ul class="simple">
<li>mapserver.h: core structure changes</li>
<li>mapfile.c: read/write/initialize changes</li>
<li>mapdraw.c: significant changes to msDrawShape() and msDrawLabelCache()</li>
<li>maplabel.c: changes to msAddLabel() and addition of msAddLabelGroup()</li>
<li>maplayer.c: changes to msLayerWhichItems() to account for label text and expressions</li>
<li>maputil.c: changes to msBindLayerToShape() and msShapeGetAnnotation()</li>
</ul>
<p>Various other files see small changes with the change in classObj from one label to many.</p>
</div>
<div class="section" id="documentation-changes">
<h2>3.2 Documentation Changes<a class="headerlink" href="#documentation-changes" title="Permalink to this headline">¶</a></h2>
<p>Documentation for classObj (labels 0 .. n) and labelObj (text and expression) will need update. MapScript documentation will
need changes to document new methods and the change in object hierarchy between classes and labels. Mapfile XML file must
be changed as well. A number of test cases will added to the MapServer regression test suite- all existing labeling tests
should continue to be useful.</p>
</div>
<div class="section" id="bug-id">
<h2>3.3 Bug ID<a class="headerlink" href="#bug-id" title="Permalink to this headline">¶</a></h2>
<p>#4127. Work is underway in a sandbox (<a class="reference external" href="http://svn.osgeo.org/mapserver/sandbox/sdlime/rfc-77/">http://svn.osgeo.org/mapserver/sandbox/sdlime/rfc-77/</a>).</p>
</div>
<div class="section" id="configuration-examples">
<h2>4 Configuration Examples<a class="headerlink" href="#configuration-examples" title="Permalink to this headline">¶</a></h2>
<p>Adding optional text below other text:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>LABELITEM &#39;item1&#39;
CLASS
  ...
  LABEL # always displayed using LAYER:LABELITEM as a source for text
    FONT &#39;arial&#39;
    ...
  END
  LABEL # conditionally displayed using LABEL:TEXT as a source for text
    EXPRESSION (&#39;[item2]&#39; ~ &#39;.&#39;) # item2 has something in it
    FONT &#39;arial-italic&#39;
    TEXT &#39;[item2]&#39;
    OFFSET 0 15
    ...
  END
END
</pre></div>
</div>
</div>
<div class="section" id="backwards-compatibility">
<h2>5. Backwards Compatibility<a class="headerlink" href="#backwards-compatibility" title="Permalink to this headline">¶</a></h2>
<p>At the mapfile level there are no issues, existing mapfiles should run without any change. It is possible that this could
introduce regressions within MapScript although the scope is not fully known.</p>
</div>
<div class="section" id="relationship-to-other-outstanding-label-bugs">
<h2>5.1 Relationship to Other Outstanding Label Bugs<a class="headerlink" href="#relationship-to-other-outstanding-label-bugs" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>#1355 - None, test is valid w/grouped labels too.</li>
<li>#2866 - None.</li>
<li>#2981 - None.</li>
<li>#3009 - None.</li>
<li>#3044 - This is already supported (ticket can be closed).</li>
<li>#3335 - Styles are supported for each additional label.</li>
<li>#3675 - This will be addressed by this RFC. Label content will be defined by the new TEXT attribute.</li>
</ul>
</div>
<div class="section" id="enhancements">
<h2>6. Enhancements<a class="headerlink" href="#enhancements" title="Permalink to this headline">¶</a></h2>
<p>Although beyond the scope of this work it seems that some interesting work related to the relative placement of grouped
labels might be possible. For example, it could be useful to define positions relative to the previous label instead of
relative to a label point.</p>
</div>
<div class="section" id="voting-history">
<h2>7. Voting history<a class="headerlink" href="#voting-history" title="Permalink to this headline">¶</a></h2>
<p>Adopted on 12-15-2011 with +1 from SteveL, DanM, JeffM, ThomasB, SteveW, HowardW.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Navigation</h3>
<p>
<a href="../../about.html" title="About">About</a><br>
<a href="../../products.html" title="Products">Products</a><br>
<a href="../../community/index.html" title="Community">Community</a><br>
<a href="../index.html" title="Development">Development</a><br>
<a href="../../download.html" title="Downloads">Downloads</a><br>
<a href="../../documentation.html" title="Documentation">Documentation</a><br>
<a href="../../faq.html" title="FAQ">FAQ</a>
</p>
  <h3>Current Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">MS RFC 77: Support for Multiple Label Objects Within a Class</a><ul>
<li><a class="reference internal" href="#overview">1. Overview</a></li>
<li><a class="reference internal" href="#proposed-technical-change">2. Proposed Technical Change</a></li>
<li><a class="reference internal" href="#core-object-changes">2.1 Core Object Changes</a></li>
<li><a class="reference internal" href="#label-rendering-changes">2.2 Label Rendering Changes</a></li>
<li><a class="reference internal" href="#point-and-polygon-labels">2.2.1 Point and Polygon Labels</a></li>
<li><a class="reference internal" href="#line-labels">2.2.2 Line Labels</a></li>
<li><a class="reference internal" href="#mapscript">2.3 MapScript</a></li>
<li><a class="reference internal" href="#implementation-details">3. Implementation Details</a></li>
<li><a class="reference internal" href="#files-affected">3.1. Files Affected</a></li>
<li><a class="reference internal" href="#documentation-changes">3.2 Documentation Changes</a></li>
<li><a class="reference internal" href="#bug-id">3.3 Bug ID</a></li>
<li><a class="reference internal" href="#configuration-examples">4 Configuration Examples</a></li>
<li><a class="reference internal" href="#backwards-compatibility">5. Backwards Compatibility</a></li>
<li><a class="reference internal" href="#relationship-to-other-outstanding-label-bugs">5.1 Relationship to Other Outstanding Label Bugs</a></li>
<li><a class="reference internal" href="#enhancements">6. Enhancements</a></li>
<li><a class="reference internal" href="#voting-history">7. Voting history</a></li>
</ul>
</li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Open Source Geospatial Foundation.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.4</a>
      
    </div>

    

    
  </body>
</html>