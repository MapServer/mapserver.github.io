<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>MS RFC 21: MapServer Raster Color Correction &#8212; MapServer 8.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx.css?v=6c7b17ac" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=dd298242" />
    <link rel="stylesheet" type="text/css" href="../../_static/ribbon.css?v=ea091bf4" />
    
    <script src="../../_static/documentation_options.js?v=521b6f53"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="icon" href="../../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="MS RFC 22a: Feature cache for long running processes and query processing" href="ms-rfc-22a.html" />
    <link rel="prev" title="MS RFC 19: Style &amp; Label attribute binding" href="ms-rfc-19.html" /> 
  </head><body>


<!-- for main branch only, do not backport this -->

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../../index.html" title="Home"><img src="../../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../../index.html" title="Home">Home</a> |
      <a href="../../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter" target="_blank">Twitter</a> |
      <a href="../../download.html" title="Download Source or Binaries">Download </a> |
      <a class="badge" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=KRJ2X44N3HA6U&source=url" target="_blank">
        <img src="https://img.shields.io/badge/donate-%E2%9D%A4%C2%A0-ff69b4.svg?style=flat" alt="Donate to MapServer">
      </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../../ar/development/rfc/ms-rfc-21.html"><img src="../../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../../de/development/rfc/ms-rfc-21.html"><img src="../../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../../el/development/rfc/ms-rfc-21.html"><img src="../../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../../es/development/rfc/ms-rfc-21.html"><img src="../../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../../fr/development/rfc/ms-rfc-21.html"><img src="../../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../../id/development/rfc/ms-rfc-21.html"><img src="../../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../../it/development/rfc/ms-rfc-21.html"><img src="../../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../../ja/development/rfc/ms-rfc-21.html"><img src="../../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../../nl_NL/development/rfc/ms-rfc-21.html"><img src="../../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../../pl/development/rfc/ms-rfc-21.html"><img src="../../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../../ru/development/rfc/ms-rfc-21.html"><img src="../../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../../sq/development/rfc/ms-rfc-21.html"><img src="../../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../../tr/development/rfc/ms-rfc-21.html"><img src="../../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ms-rfc-22a.html" title="MS RFC 22a: Feature cache for long running processes and query processing"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-19.html" title="MS RFC 19: Style &amp; Label attribute binding"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 21: MapServer Raster Color Correction</a></li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="ms-rfc-21-mapserver-raster-color-correction">
<span id="rfc21"></span><h1>MS RFC 21: MapServer Raster Color Correction<a class="headerlink" href="#ms-rfc-21-mapserver-raster-color-correction" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Date<span class="colon">:</span></dt>
<dd class="field-odd"><p>2006/10/13</p>
</dd>
<dt class="field-even">Author<span class="colon">:</span></dt>
<dd class="field-even"><p>Frank Warmerdam</p>
</dd>
<dt class="field-odd">Contact<span class="colon">:</span></dt>
<dd class="field-odd"><p>warmerdam at pobox.com</p>
</dd>
<dt class="field-even">Status<span class="colon">:</span></dt>
<dd class="field-even"><p>adopted</p>
</dd>
<dt class="field-odd">Version<span class="colon">:</span></dt>
<dd class="field-odd"><p>MapServer 5.0</p>
</dd>
</dl>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p>To add support to MapServer to apply color correction curves (aka lookup
tables) to raster images on the fly.</p>
</section>
<section id="technical-details">
<h2>Technical Details<a class="headerlink" href="#technical-details" title="Link to this heading">¶</a></h2>
<p>MapServer’s raster rendering engine (mapgdaldraw.c) will be extended to
support a PROCESSING option indicating a color correction file to be
applied on the fly when raster data is being read from disk.  The PROCESSING
option would take the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROCESSING</span> <span class="s2">&quot;LUT=&lt;lut_specification&gt;&quot;</span>
</pre></div>
</div>
<p>for a single LUT applied to all bands equally or:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROCESSING</span> <span class="s2">&quot;LUT_&lt;color#&gt;=&lt;lut_specification&gt;&quot;</span>
</pre></div>
</div>
<p>for a LUT applied only to one band.  The &lt;lut_specification&gt; can be
the name of a file containing a LUT, or an inline lut definition.  The inline
lut definition looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">lut_specification</span><span class="o">&gt;=&lt;</span><span class="n">in_value</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">out_value</span><span class="o">&gt;</span><span class="p">,</span><span class="o">&lt;</span><span class="n">in_value</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">out_value</span><span class="o">&gt;</span><span class="p">[,</span><span class="o">&lt;</span><span class="n">in_value</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">out_value</span><span class="o">&gt;</span><span class="p">]</span><span class="o">*</span>
</pre></div>
</div>
<p>The text file takes the same form, except that it may be multiline (lines will
be implicitly joined by commas).  So some common forms would be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROCESSING</span> <span class="s2">&quot;LUT=0:0,128:150,255:255&quot;</span>

<span class="n">PROCESSING</span> <span class="s2">&quot;LUT_2=green_lut.txt&quot;</span>
</pre></div>
</div>
<p>Note that the LUT specification files will be searched for relative to the
map file if a relative path is provided.</p>
<p>The LUT will be applied in LoadGDALImage(), after any scaling to 8bit.  So
currently only 8bit (0-255) input and output values are supported.  Optionally
we could consider non-8bit inputs, and allow the LUT to apply scaling to 8bit
but this would be somewhat complicated to do in a computationally efficient
manner.</p>
<p>A 256 entry LUT will be created by linear interpolation between the LUT
control points.  Note this is different than a true “curve” based approach
where some form of curve fitting is done to the control points.  For a
significant number of control points the difference will be very slight,
but it could be noticeable for LUTs with only a few control points (ie. 3).
Optionally we could compute a proper curve fit, but this will require extra
research and development.</p>
<p>If no control points exist for input values 0 and 255 a mapping of “0:0” and
“255:255” will be assumed.</p>
</section>
<section id="other-curve-formats">
<h2>Other Curve Formats<a class="headerlink" href="#other-curve-formats" title="Link to this heading">¶</a></h2>
<p>The GIMP’s ascii curve format will also be supported directly.  Exact
details of this are to be determined, and since a GIMP curve file contains
several curves (for different bands) it may be necessary to select which
is to be used in the PROCESSING statement.  Perhaps something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROCESSING</span> <span class="s2">&quot;LUT_2=GIMP_red:gimp.crv&quot;</span>
</pre></div>
</div>
</section>
<section id="mapfile-implications">
<h2>Mapfile Implications<a class="headerlink" href="#mapfile-implications" title="Link to this heading">¶</a></h2>
<p>All new options are selected via new PROCESSING options.   There is
no change in the mapfile syntax.  There should be no compatibility problems
with old mapfiles.</p>
</section>
<section id="mapscript-implications">
<h2>MapScript Implications<a class="headerlink" href="#mapscript-implications" title="Link to this heading">¶</a></h2>
<p>There are no additions or changes to the MapScript API.  The new
options are controlled via PROCESSING information on the layers which I
believe is already manipulatable from MapScript.</p>
</section>
<section id="documentation-implications">
<h2>Documentation Implications<a class="headerlink" href="#documentation-implications" title="Link to this heading">¶</a></h2>
<p>The new processing options will need to be documented in the Raster Access
HOWTO (and possibly the mapfile reference).</p>
</section>
<section id="test-plan">
<h2>Test Plan<a class="headerlink" href="#test-plan" title="Link to this heading">¶</a></h2>
<p>New test cases for each mode will be incorporated in msautotest/gdal.</p>
</section>
<section id="staffing-timeline">
<h2>Staffing / Timeline<a class="headerlink" href="#staffing-timeline" title="Link to this heading">¶</a></h2>
<p>The new feature will be implemented by Frank Warmerdam and completed
by November 30th, 2006, for inclusion in the MapServer 5.0 release.
Funding provided by the Information Center of the Ministry of Agriculture
and Forestry (Finland).</p>
</section>
<section id="tracking-bug">
<h2>Tracking Bug<a class="headerlink" href="#tracking-bug" title="Link to this heading">¶</a></h2>
<p><a class="reference external" href="https://github.com/MapServer/MapServer/issues/1943">https://github.com/MapServer/MapServer/issues/1943</a></p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p>
<a href="../../about.html" title="About">About</a><br>
<a href="../../products.html" title="Products">Products</a><br>
<a href="../../community/index.html" title="Community">Community</a><br>
<a href="../index.html" title="Development">Development</a><br>
<a href="../../download.html" title="Downloads">Downloads</a><br>
<a href="../../documentation.html" title="Documentation">Documentation</a><br>
<a href="../../faq.html" title="FAQ">FAQ</a><br>
<a href="../../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</h3>
  <ul>
<li><a class="reference internal" href="#">MS RFC 21: MapServer Raster Color Correction</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#technical-details">Technical Details</a></li>
<li><a class="reference internal" href="#other-curve-formats">Other Curve Formats</a></li>
<li><a class="reference internal" href="#mapfile-implications">Mapfile Implications</a></li>
<li><a class="reference internal" href="#mapscript-implications">MapScript Implications</a></li>
<li><a class="reference internal" href="#documentation-implications">Documentation Implications</a></li>
<li><a class="reference internal" href="#test-plan">Test Plan</a></li>
<li><a class="reference internal" href="#staffing-timeline">Staffing / Timeline</a></li>
<li><a class="reference internal" href="#tracking-bug">Tracking Bug</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ms-rfc-22a.html" title="MS RFC 22a: Feature cache for long running processes and query processing"
             >next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-19.html" title="MS RFC 19: Style &amp; Label attribute binding"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 21: MapServer Raster Color Correction</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; <a href="../../copyright.html">Copyright</a> 2023, Open Source Geospatial Foundation.
      Last updated on 2023-12-22.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.5.
    </div>
  </body>
</html>