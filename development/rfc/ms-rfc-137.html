<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>MS RFC 137: Native FlatGeobuf support &#8212; MapServer 8.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx.css?v=6c7b17ac" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=dd298242" />
    <link rel="stylesheet" type="text/css" href="../../_static/ribbon.css?v=ea091bf4" />
    
    <script src="../../_static/documentation_options.js?v=521b6f53"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="icon" href="../../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="GitHub" href="../git.html" />
    <link rel="prev" title="MS RFC 136: Rename shp2img to map2img" href="ms-rfc-136.html" /> 
  </head><body>


<!-- for main branch only, do not backport this -->

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../../index.html" title="Home"><img src="../../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../../index.html" title="Home">Home</a> |
      <a href="../../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter" target="_blank">Twitter</a> |
      <a href="../../download.html" title="Download Source or Binaries">Download </a> |
      <a class="badge" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=KRJ2X44N3HA6U&source=url" target="_blank">
        <img src="https://img.shields.io/badge/donate-%E2%9D%A4%C2%A0-ff69b4.svg?style=flat" alt="Donate to MapServer">
      </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../../ar/development/rfc/ms-rfc-137.html"><img src="../../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../../de/development/rfc/ms-rfc-137.html"><img src="../../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../../el/development/rfc/ms-rfc-137.html"><img src="../../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../../es/development/rfc/ms-rfc-137.html"><img src="../../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../../fr/development/rfc/ms-rfc-137.html"><img src="../../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../../id/development/rfc/ms-rfc-137.html"><img src="../../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../../it/development/rfc/ms-rfc-137.html"><img src="../../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../../ja/development/rfc/ms-rfc-137.html"><img src="../../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../../nl_NL/development/rfc/ms-rfc-137.html"><img src="../../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../../pl/development/rfc/ms-rfc-137.html"><img src="../../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../../ru/development/rfc/ms-rfc-137.html"><img src="../../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../../sq/development/rfc/ms-rfc-137.html"><img src="../../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../../tr/development/rfc/ms-rfc-137.html"><img src="../../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../git.html" title="GitHub"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-136.html" title="MS RFC 136: Rename shp2img to map2img"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 137: Native FlatGeobuf support</a></li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="ms-rfc-137-native-flatgeobuf-support">
<span id="rfc137"></span><h1>MS RFC 137: Native FlatGeobuf support<a class="headerlink" href="#ms-rfc-137-native-flatgeobuf-support" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Author<span class="colon">:</span></dt>
<dd class="field-odd"><p>Björn Harrtell</p>
</dd>
<dt class="field-even">Contact<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference external" href="mailto:bjorn&#46;harrtell&#37;&#52;&#48;gmail&#46;com">bjorn<span>&#46;</span>harrtell<span>&#64;</span>gmail<span>&#46;</span>com</a></p>
</dd>
<dt class="field-odd">Author<span class="colon">:</span></dt>
<dd class="field-odd"><p>Jeff McKenna</p>
</dd>
<dt class="field-even">Contact<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference external" href="mailto:jmckenna&#37;&#52;&#48;gatewaygeomatics&#46;com">jmckenna<span>&#64;</span>gatewaygeomatics<span>&#46;</span>com</a></p>
</dd>
<dt class="field-odd">Last Updated<span class="colon">:</span></dt>
<dd class="field-odd"><p>2022-06-24</p>
</dd>
<dt class="field-even">Version<span class="colon">:</span></dt>
<dd class="field-even"><p>MapServer 8.0</p>
</dd>
<dt class="field-odd">Status<span class="colon">:</span></dt>
<dd class="field-odd"><p>Adopted</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This document is outdated, please follow the official document: <a class="reference internal" href="../../input/vector/flatgeobuf.html#flatgeobuf"><span class="std std-ref">FlatGeobuf</span></a></p>
</div>
<section id="background">
<h2>1. Background<a class="headerlink" href="#background" title="Link to this heading">¶</a></h2>
<img alt="../../_images/flatgeobuf.jpg" class="no-scaled-link align-right" src="../../_images/flatgeobuf.jpg" style="width: 200px; height: 150px;" />
<p>FlatGeobuf is an optimized binary encoding for vectors based on
<a class="reference external" href="https://google.github.io/flatbuffers/">Flatbuffers</a>,
that focuses on read/query performance by leveraging a
<a class="reference external" href="https://en.wikipedia.org/wiki/Hilbert_R-tree#Packed_Hilbert_R-trees">Packed Hilbert R-Tree</a>
spatial index, that enables fast bounding box spatial filtering.
FlatGeobuf performance has helped make it become one of the
chosen formats for streaming spatial data through HTTP / “the cloud”.</p>
</section>
<section id="current-status-through-ogr">
<h2>2. Current Status through OGR<a class="headerlink" href="#current-status-through-ogr" title="Link to this heading">¶</a></h2>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../../input/vector/flatgeobuf.html#flatgeobuf"><span class="std std-ref">FlatGeobuf in MapServer</span></a></p>
</div>
<ul>
<li><p>Since GDAL 3.1.0, FlatGeobuf access is available in MapServer through <a class="reference external" href="https://gdal.org/drivers/vector/flatgeobuf.html">OGR</a></p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">CONNECTIONTYPE</span> <span class="nb">OGR</span>
<span class="k">CONNECTION</span> <span class="s">&quot;name.fgb&quot;</span>
<span class="k">DATA</span> <span class="s">&quot;layername&quot;</span>
<span class="k">CONNECTIONOPTIONS</span>
  <span class="s">&quot;VERIFY_BUFFERS&quot;</span> <span class="s">&quot;NO&quot;</span> <span class="c"># for maximum performance</span>
<span class="k">END</span>
</pre></div>
</div>
</li>
<li><p>There is some performance overhead connecting through OGR.  The following
rudimentary benchmark shows some overhead for shapefile through OGR</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Shapefile</span> <span class="p">(</span><span class="n">native</span><span class="p">)</span> <span class="mf">0.010</span><span class="n">s</span>
<span class="n">FlatGeobuf</span> <span class="p">(</span><span class="n">OGR</span><span class="p">)</span>   <span class="mf">0.013</span><span class="n">s</span>
<span class="n">Shapefile</span> <span class="p">(</span><span class="n">OGR</span><span class="p">)</span>    <span class="mf">0.023</span><span class="n">s</span>
<span class="n">GeoPackage</span> <span class="p">(</span><span class="n">OGR</span><span class="p">)</span>   <span class="mf">0.042</span><span class="n">s</span>
<span class="n">SpatiaLite</span> <span class="p">(</span><span class="n">OGR</span><span class="p">)</span>   <span class="mf">0.045</span><span class="n">s</span>
<span class="n">PostGIS</span> <span class="p">(</span><span class="n">native</span><span class="p">)</span>   <span class="mf">0.053</span><span class="n">s</span>
<span class="n">GeoJSON</span> <span class="p">(</span><span class="n">OGR</span><span class="p">)</span>      <span class="mf">0.089</span><span class="n">s</span>

<span class="n">environment</span><span class="p">:</span> <span class="n">MapServer</span><span class="o">-</span><span class="n">main</span> <span class="o">+</span> <span class="n">GDAL</span> <span class="mf">3.4.3</span> <span class="p">(</span><span class="n">MS4W</span><span class="o">/</span><span class="n">Windows</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="proposed-enhancement">
<h2>3. Proposed enhancement<a class="headerlink" href="#proposed-enhancement" title="Link to this heading">¶</a></h2>
<ul>
<li><p>add FlatGeobuf as a native format for MapServer</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">CONNECTIONTYPE</span> <span class="err">flatgeobuf</span>
<span class="k">DATA</span> <span class="s">&quot;name.fgb&quot;</span>
</pre></div>
</div>
</li>
<li><p>FlatGeobuf C++ implementation is small and doesn’t require any
dependencies</p></li>
<li><p>Flatbuffers source will be included</p></li>
<li><p>initial implementation will be read access only</p></li>
</ul>
</section>
<section id="backwards-compatibility">
<h2>3.1 Backwards Compatibility<a class="headerlink" href="#backwards-compatibility" title="Link to this heading">¶</a></h2>
<p>Not applicable</p>
</section>
<section id="performance-implications">
<h2>3.2 Performance Implications<a class="headerlink" href="#performance-implications" title="Link to this heading">¶</a></h2>
<p>As mentioned above, this should give a performance boost by reading
direct from the FlatGeobuf file.  More benchmarks will be included here
during the testing of this Pull Request.  For example, here is an
updated benchmark run on 2022-05-16 (note that this is for world extents,
with country labels) :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FlatGeobuf</span> <span class="p">(</span><span class="n">native</span><span class="p">)</span> <span class="mf">0.008</span><span class="n">s</span>
<span class="n">Shapefile</span> <span class="p">(</span><span class="n">native</span><span class="p">)</span>  <span class="mf">0.010</span><span class="n">s</span>
<span class="n">FlatGeobuf</span> <span class="p">(</span><span class="n">OGR</span><span class="p">)</span>    <span class="mf">0.013</span><span class="n">s</span>
<span class="n">Shapefile</span> <span class="p">(</span><span class="n">OGR</span><span class="p">)</span>     <span class="mf">0.023</span><span class="n">s</span>
<span class="n">GeoPackage</span> <span class="p">(</span><span class="n">OGR</span><span class="p">)</span>    <span class="mf">0.042</span><span class="n">s</span>
<span class="n">SpatiaLite</span> <span class="p">(</span><span class="n">OGR</span><span class="p">)</span>    <span class="mf">0.045</span><span class="n">s</span>
<span class="n">PostGIS</span> <span class="p">(</span><span class="n">native</span><span class="p">)</span>    <span class="mf">0.053</span><span class="n">s</span>
<span class="n">GeoJSON</span> <span class="p">(</span><span class="n">OGR</span><span class="p">)</span>       <span class="mf">0.089</span><span class="n">s</span>

<span class="n">environment</span><span class="p">:</span> <span class="n">MapServer</span><span class="o">-</span><span class="n">main</span> <span class="o">+</span> <span class="n">GDAL</span> <span class="mf">3.4.3</span> <span class="p">(</span><span class="n">MS4W</span><span class="o">/</span><span class="n">Windows</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="limitations">
<h2>3.3 Limitations<a class="headerlink" href="#limitations" title="Link to this heading">¶</a></h2>
<ol class="arabic simple">
<li><p>This will be read access only, initially.  This means that tricks such as
setting an OUTPUTFORMAT for direct FlatGeobuf output from MapServer, will
only work through OGR, for now.</p></li>
<li><p>The <em>VERIFY_BUFFERS</em> driver option of FlatGeobuf is not implemented
through this native driver (it is exposed through the OGR connection
in MapServer, if need be).  Specifically this means that currently
the value of <em>VERIFY_BUFFERS</em> is equivalent to <em>NO</em> for this native
driver, at the moment.</p></li>
</ol>
</section>
<section id="security-concerns">
<h2>3.4 Security Concerns<a class="headerlink" href="#security-concerns" title="Link to this heading">¶</a></h2>
<p>There are no known security concerns at the moment.</p>
</section>
<section id="mapscript">
<h2>3.5 MapScript<a class="headerlink" href="#mapscript" title="Link to this heading">¶</a></h2>
<p>The new format has been exposed through <em>layerObj-&gt;setConnectionType()</em>.</p>
</section>
<section id="implementation-details">
<h2>4. Implementation Details<a class="headerlink" href="#implementation-details" title="Link to this heading">¶</a></h2>
<section id="affected-files">
<h3>4.1 Affected files<a class="headerlink" href="#affected-files" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>new files will be stored in: <em>/flatgeobuf/</em></p></li>
<li><p>included files will be stored in: <em>/flatgeobuf/include/</em></p></li>
<li><p><em>mapflatgeobuf.c</em>: main logic</p></li>
<li><p><em>mapfile.c</em>: add new CONNECTIONTYPE</p></li>
<li><p>test has added in <em>/msautotest/misc/flatgeobuf.map</em></p></li>
<li><p>MapScript test has been added in <em>/msautotest/php/layerObjTest.php</em></p></li>
</ul>
</section>
<section id="ticket-reference">
<h3>4.2 Ticket Reference<a class="headerlink" href="#ticket-reference" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>pull request: <a class="reference external" href="https://github.com/MapServer/MapServer/pull/6520">https://github.com/MapServer/MapServer/pull/6520</a></p></li>
</ul>
</section>
<section id="documentation">
<h3>4.3 Documentation<a class="headerlink" href="#documentation" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>ticket: <a class="reference external" href="https://github.com/MapServer/MapServer-documentation/issues/701">https://github.com/MapServer/MapServer-documentation/issues/701</a></p></li>
</ul>
</section>
</section>
<section id="voting-history">
<h2>5. Voting History<a class="headerlink" href="#voting-history" title="Link to this heading">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="mi">1</span> <span class="kn">from</span> <span class="nn">JeromeB</span><span class="p">,</span> <span class="n">TomK</span><span class="p">,</span> <span class="n">SethG</span><span class="p">,</span> <span class="n">MikeS</span><span class="p">,</span> <span class="n">LarsS</span> <span class="p">(</span><span class="n">community</span> <span class="n">vote</span><span class="p">),</span> <span class="n">JeffM</span>
<span class="mi">0</span> <span class="kn">from</span> <span class="nn">EvenR</span>
</pre></div>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p>
<a href="../../about.html" title="About">About</a><br>
<a href="../../products.html" title="Products">Products</a><br>
<a href="../../community/index.html" title="Community">Community</a><br>
<a href="../index.html" title="Development">Development</a><br>
<a href="../../download.html" title="Downloads">Downloads</a><br>
<a href="../../documentation.html" title="Documentation">Documentation</a><br>
<a href="../../faq.html" title="FAQ">FAQ</a><br>
<a href="../../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</h3>
  <ul>
<li><a class="reference internal" href="#">MS RFC 137: Native FlatGeobuf support</a><ul>
<li><a class="reference internal" href="#background">1. Background</a></li>
<li><a class="reference internal" href="#current-status-through-ogr">2. Current Status through OGR</a></li>
<li><a class="reference internal" href="#proposed-enhancement">3. Proposed enhancement</a></li>
<li><a class="reference internal" href="#backwards-compatibility">3.1 Backwards Compatibility</a></li>
<li><a class="reference internal" href="#performance-implications">3.2 Performance Implications</a></li>
<li><a class="reference internal" href="#limitations">3.3 Limitations</a></li>
<li><a class="reference internal" href="#security-concerns">3.4 Security Concerns</a></li>
<li><a class="reference internal" href="#mapscript">3.5 MapScript</a></li>
<li><a class="reference internal" href="#implementation-details">4. Implementation Details</a><ul>
<li><a class="reference internal" href="#affected-files">4.1 Affected files</a></li>
<li><a class="reference internal" href="#ticket-reference">4.2 Ticket Reference</a></li>
<li><a class="reference internal" href="#documentation">4.3 Documentation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#voting-history">5. Voting History</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../git.html" title="GitHub"
             >next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-136.html" title="MS RFC 136: Rename shp2img to map2img"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 137: Native FlatGeobuf support</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; <a href="../../copyright.html">Copyright</a> 2023, Open Source Geospatial Foundation.
      Last updated on 2023-12-22.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.5.
    </div>
  </body>
</html>