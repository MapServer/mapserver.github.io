<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>MS RFC 57: Labeling enhancements: ability to repeat labels along a line/multiline &#8212; MapServer 8.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx.css?v=6c7b17ac" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=dd298242" />
    <link rel="stylesheet" type="text/css" href="../../_static/ribbon.css?v=ea091bf4" />
    
    <script src="../../_static/documentation_options.js?v=521b6f53"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="icon" href="../../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="MS RFC 58: Kml Output" href="ms-rfc-58.html" />
    <link rel="prev" title="MS RFC 56: Tighten control of access to mapfiles and templates" href="ms-rfc-56.html" /> 
  </head><body>


<!-- for main branch only, do not backport this -->

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../../index.html" title="Home"><img src="../../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../../index.html" title="Home">Home</a> |
      <a href="../../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter" target="_blank">Twitter</a> |
      <a href="../../download.html" title="Download Source or Binaries">Download </a> |
      <a class="badge" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=KRJ2X44N3HA6U&source=url" target="_blank">
        <img src="https://img.shields.io/badge/donate-%E2%9D%A4%C2%A0-ff69b4.svg?style=flat" alt="Donate to MapServer">
      </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../../ar/development/rfc/ms-rfc-57.html"><img src="../../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../../de/development/rfc/ms-rfc-57.html"><img src="../../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../../el/development/rfc/ms-rfc-57.html"><img src="../../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../../es/development/rfc/ms-rfc-57.html"><img src="../../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../../fr/development/rfc/ms-rfc-57.html"><img src="../../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../../id/development/rfc/ms-rfc-57.html"><img src="../../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../../it/development/rfc/ms-rfc-57.html"><img src="../../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../../ja/development/rfc/ms-rfc-57.html"><img src="../../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../../nl_NL/development/rfc/ms-rfc-57.html"><img src="../../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../../pl/development/rfc/ms-rfc-57.html"><img src="../../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../../ru/development/rfc/ms-rfc-57.html"><img src="../../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../../sq/development/rfc/ms-rfc-57.html"><img src="../../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../../tr/development/rfc/ms-rfc-57.html"><img src="../../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ms-rfc-58.html" title="MS RFC 58: Kml Output"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-56.html" title="MS RFC 56: Tighten control of access to mapfiles and templates"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 57: Labeling enhancements: ability to repeat labels along a line/multiline</a></li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="ms-rfc-57-labeling-enhancements-ability-to-repeat-labels-along-a-line-multiline">
<span id="rfc57"></span><h1>MS RFC 57: Labeling enhancements: ability to repeat labels along a line/multiline<a class="headerlink" href="#ms-rfc-57-labeling-enhancements-ability-to-repeat-labels-along-a-line-multiline" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Date<span class="colon">:</span></dt>
<dd class="field-odd"><p>2009/06/26</p>
</dd>
<dt class="field-even">Authors<span class="colon">:</span></dt>
<dd class="field-even"><p>Alan Boudreault</p>
</dd>
<dt class="field-odd">Contact<span class="colon">:</span></dt>
<dd class="field-odd"><p>aboudreault at mapgears.com</p>
</dd>
<dt class="field-even">Last Edited<span class="colon">:</span></dt>
<dd class="field-even"><p>2009/06/29</p>
</dd>
<dt class="field-odd">Status<span class="colon">:</span></dt>
<dd class="field-odd"><p>Adopted (2009/07/21) and Implemented.</p>
</dd>
<dt class="field-even">Version<span class="colon">:</span></dt>
<dd class="field-even"><p>MapServer 6.0</p>
</dd>
</dl>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p>Currently, MapServer draws labels on the longest segment of a linear
shape. Even if the shape is a long line or a multiline shape, only one
label is drawn. In some cases, the map quality could be highly improved
with more labels.</p>
<p>This RFC proposes a mechanism to fix this by adding the ability to add more
labels along long lines or multiline shapes. There are two major
enhancements that are proposed.</p>
<p>See the Images section to visualize the current and new behaviors.</p>
</section>
<section id="enhancement-1-label-all-the-lines-in-multiline-shape">
<h2>Enhancement 1: Label all the lines in MultiLine shape<a class="headerlink" href="#enhancement-1-label-all-the-lines-in-multiline-shape" title="Link to this heading">¶</a></h2>
<p>At the moment, if you’ve got a MultiLine shape (i.e. a shapeObj with
numlines &gt; 1) then only the longest of the Lines is labelled. This is fine
in most cases, but in some cases, we may want each individual Line in the
MultiLine to get a label. That’s the first proposed enhancement: make it
possible to label all lines in a MultiLine shape.</p>
</section>
<section id="enhancement-2-ability-to-repeat-labels-along-a-line">
<h2>Enhancement 2: Ability to repeat labels along a line<a class="headerlink" href="#enhancement-2-ability-to-repeat-labels-along-a-line" title="Link to this heading">¶</a></h2>
<p>At the moment, the label is placed at the center of a line in the case of
ANGLE FOLLOW, and at the center of the longest segment of a line in the
case of ANGLE AUTO|constant. In the case of very long lines (roads), and
especially when using metatiles to render a tile cache, we may want to
repeat the label at some interval along the line. That’s the second
enhancement: make it possible to repeat the label at a given interval along
a line.</p>
</section>
<section id="technical-solution">
<h2>Technical Solution<a class="headerlink" href="#technical-solution" title="Link to this heading">¶</a></h2>
<p>The way to control this in the mapfile is to add a LABEL.REPEATDISTANCE
parameter. By default this would be turned off and we would keep the
current behavior. If REPEATDISTANCE is set to any value &gt; 0 then the labels
would be repeated on every line of a multiline shape (enhancement 1 above),
and would be repeated multiple times along a given line at an interval of
REPEATDISTANCE pixels (item 2 above). In all cases the MINDISTANCE value
would still be handled by the label cache so that multiple labels ending up
too close to each other for various reasons would be eliminated by the
label cache.</p>
<p>To achieve better visual effect, here is an outline of the algorithm that
applies when REPEATDISTANCE is set:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Calculate the number of labels candidates (N) that can fit in the
length of the line.</p></li>
<li><p>Ensure that N is an odd number. If it’s even then subtract one to get
an odd number. We want an odd number of label candidates along a given
line so that there is always one candidate that falls at the center of
the line and which will remain in case of collisions. With an even
number of candidates, when collisions happen along a line, the
remaining labels are usually shifted one way or the other along the
line instead of being centered which does not look as good.</p></li>
<li><p>Calculate the offset between labels and the position of candidates
along the line.</p></li>
<li><p>Insert labels candidates into the label cache in an order that will
ensure that the label cache will eliminate the right labels in case of
collisions (keep in mind that collisions are still possible since
MINDISTANCE remains in effect). We want to give higher priority to the
label candidate at the center of the line and lower priority to other
candidates as they get further away from the center. Since the label
cache order is last in first out (LIFO), we start by inserting the
labels candidates at the extremities of the line into the cache end end
with the one at the center, giving it the highest priority.</p></li>
</ol>
</div></blockquote>
</section>
<section id="usage-example">
<h2>Usage example<a class="headerlink" href="#usage-example" title="Link to this heading">¶</a></h2>
<p>This example will repeat the labels every 80 pixels on each line of a
multiline shape.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MAP</span>
  <span class="o">...</span>
  <span class="n">LABEL</span>
     <span class="n">REPEATDISTANCE</span> <span class="mi">80</span>
  <span class="n">END</span>
  <span class="o">...</span>
<span class="n">END</span>
</pre></div>
</div>
</section>
<section id="backwards-compatibility-issues">
<h2>Backwards Compatibility Issues<a class="headerlink" href="#backwards-compatibility-issues" title="Link to this heading">¶</a></h2>
<p>There is no backwards compatibility issues. By default the
LABEL.REPEATDISTANCE parameter is set to 0, so not applied.</p>
</section>
<section id="files-impacted">
<h2>Files Impacted<a class="headerlink" href="#files-impacted" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>mapprimitive.c: Modify the labels placement algorithm</p></li>
<li><p>mapfile.c, maplexer.l: new LABEL.REPEATDISTANCE mapfile keyword</p></li>
<li><p>mapdraw.c: Modify the way how msPolylineLabel* calls are handled</p></li>
</ul>
</section>
<section id="ticket-id">
<h2>Ticket Id<a class="headerlink" href="#ticket-id" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/MapServer/MapServer/issues/3030">https://github.com/MapServer/MapServer/issues/3030</a></p></li>
</ul>
</section>
<section id="images">
<h2>Images<a class="headerlink" href="#images" title="Link to this heading">¶</a></h2>
<p>Since a picture is worth a thousand words:</p>
<ul class="simple">
<li><p>Repeat distance, visual explanation:
<a class="reference external" href="http://trac.osgeo.org/mapserver/attachment/ticket/3030/repeat_label.gif">http://trac.osgeo.org/mapserver/attachment/ticket/3030/repeat_label.gif</a></p></li>
<li><p>Label placement algorithm:
<a class="reference external" href="http://trac.osgeo.org/mapserver/attachment/ticket/3030/label_algorithm.gif">http://trac.osgeo.org/mapserver/attachment/ticket/3030/label_algorithm.gif</a></p></li>
<li><p>Labels comparison:
<a class="reference external" href="http://trac.osgeo.org/mapserver/attachment/ticket/3030/label-comparison.jpg">http://trac.osgeo.org/mapserver/attachment/ticket/3030/label-comparison.jpg</a></p></li>
<li><p>Shields comparison:
<a class="reference external" href="http://trac.osgeo.org/mapserver/attachment/ticket/3030/shield-comparison.jpg">http://trac.osgeo.org/mapserver/attachment/ticket/3030/shield-comparison.jpg</a></p></li>
</ul>
</section>
<section id="voting-history">
<h2>Voting History<a class="headerlink" href="#voting-history" title="Link to this heading">¶</a></h2>
<p>Adopted on 2009/07/21 with +1 from SteveW, DanielM, SteveL, AssefaY, ThomasB and PericlesN.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p>
<a href="../../about.html" title="About">About</a><br>
<a href="../../products.html" title="Products">Products</a><br>
<a href="../../community/index.html" title="Community">Community</a><br>
<a href="../index.html" title="Development">Development</a><br>
<a href="../../download.html" title="Downloads">Downloads</a><br>
<a href="../../documentation.html" title="Documentation">Documentation</a><br>
<a href="../../faq.html" title="FAQ">FAQ</a><br>
<a href="../../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</h3>
  <ul>
<li><a class="reference internal" href="#">MS RFC 57: Labeling enhancements: ability to repeat labels along a line/multiline</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#enhancement-1-label-all-the-lines-in-multiline-shape">Enhancement 1: Label all the lines in MultiLine shape</a></li>
<li><a class="reference internal" href="#enhancement-2-ability-to-repeat-labels-along-a-line">Enhancement 2: Ability to repeat labels along a line</a></li>
<li><a class="reference internal" href="#technical-solution">Technical Solution</a></li>
<li><a class="reference internal" href="#usage-example">Usage example</a></li>
<li><a class="reference internal" href="#backwards-compatibility-issues">Backwards Compatibility Issues</a></li>
<li><a class="reference internal" href="#files-impacted">Files Impacted</a></li>
<li><a class="reference internal" href="#ticket-id">Ticket Id</a></li>
<li><a class="reference internal" href="#images">Images</a></li>
<li><a class="reference internal" href="#voting-history">Voting History</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ms-rfc-58.html" title="MS RFC 58: Kml Output"
             >next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-56.html" title="MS RFC 56: Tighten control of access to mapfiles and templates"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 57: Labeling enhancements: ability to repeat labels along a line/multiline</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; <a href="../../copyright.html">Copyright</a> 2023, Open Source Geospatial Foundation.
      Last updated on 2023-12-22.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.5.
    </div>
  </body>
</html>