<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>MS RFC 103: Layer Level Character Encoding Handling &#8212; MapServer 8.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx.css?v=6c7b17ac" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=dd298242" />
    <link rel="stylesheet" type="text/css" href="../../_static/ribbon.css?v=ea091bf4" />
    
    <script src="../../_static/documentation_options.js?v=521b6f53"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="icon" href="../../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="MS RFC 104: Replace BITMAP labels with embedded Truetype font" href="ms-rfc-104.html" />
    <link rel="prev" title="MS RFC 102: Support of Styleitem JavaScript Plugin" href="ms-rfc-102.html" /> 
  </head><body>


<!-- for main branch only, do not backport this -->

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../../index.html" title="Home"><img src="../../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../../index.html" title="Home">Home</a> |
      <a href="../../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter" target="_blank">Twitter</a> |
      <a href="../../download.html" title="Download Source or Binaries">Download </a> |
      <a class="badge" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=KRJ2X44N3HA6U&source=url" target="_blank">
        <img src="https://img.shields.io/badge/donate-%E2%9D%A4%C2%A0-ff69b4.svg?style=flat" alt="Donate to MapServer">
      </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../../ar/development/rfc/ms-rfc-103.html"><img src="../../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../../de/development/rfc/ms-rfc-103.html"><img src="../../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../../el/development/rfc/ms-rfc-103.html"><img src="../../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../../es/development/rfc/ms-rfc-103.html"><img src="../../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../../fr/development/rfc/ms-rfc-103.html"><img src="../../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../../id/development/rfc/ms-rfc-103.html"><img src="../../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../../it/development/rfc/ms-rfc-103.html"><img src="../../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../../ja/development/rfc/ms-rfc-103.html"><img src="../../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../../nl_NL/development/rfc/ms-rfc-103.html"><img src="../../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../../pl/development/rfc/ms-rfc-103.html"><img src="../../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../../ru/development/rfc/ms-rfc-103.html"><img src="../../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../../sq/development/rfc/ms-rfc-103.html"><img src="../../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../../tr/development/rfc/ms-rfc-103.html"><img src="../../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ms-rfc-104.html" title="MS RFC 104: Replace BITMAP labels with embedded Truetype font"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-102.html" title="MS RFC 102: Support of Styleitem JavaScript Plugin"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 103: Layer Level Character Encoding Handling</a></li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="ms-rfc-103-layer-level-character-encoding-handling">
<span id="rfc103"></span><h1>MS RFC 103: Layer Level Character Encoding Handling<a class="headerlink" href="#ms-rfc-103-layer-level-character-encoding-handling" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Date<span class="colon">:</span></dt>
<dd class="field-odd"><p>2013/08</p>
</dd>
<dt class="field-even">Author<span class="colon">:</span></dt>
<dd class="field-even"><p>Thomas Bonfort</p>
</dd>
<dt class="field-odd">Contact<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="mailto:thomas&#46;bonfort&#37;&#52;&#48;gmail&#46;com">thomas<span>&#46;</span>bonfort<span>&#64;</span>gmail<span>&#46;</span>com</a></p>
</dd>
<dt class="field-even">Status<span class="colon">:</span></dt>
<dd class="field-even"><p>Adopted</p>
</dd>
<dt class="field-odd">Version<span class="colon">:</span></dt>
<dd class="field-odd"><p>MapServer 7.0</p>
</dd>
</dl>
<section id="the-current-situation">
<h2>1. The Current Situation<a class="headerlink" href="#the-current-situation" title="Link to this heading">¶</a></h2>
<p>MapServer has no knowledge of the character encoding of a datasource, which has
multiple implications:</p>
<ul class="simple">
<li><p>FILTERs and EXPRESSIONs inside a mapfile must be written in the mapfile in
the same encoding as the datasource. While this is no hassle for fully UTF8
datasources and mapfiles, this gets harder to maintain when using non UTF8
datasources (as the mapfile needs to be saved in another encoding), and becomes
unmanageable for datasources with mixed encodings (e.g. layer1 is UTF8 while
layer2 is latin1).</p></li>
<li><p>Handling of the encoding headers has to be manually specified so that correct
content-type headers and xml encoding tags get sent back to clients for OGC
documents (getcapabilities, getfeature, etc…)</p></li>
<li><p>For rendering, we ass-hatedly specify the encoding at the LABEL level to transform
label texts to UTF8, given that our renderers only supported that.</p></li>
</ul>
<section id="related-issues">
<h3>1.1 Related Issues<a class="headerlink" href="#related-issues" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/MapServer/MapServer/issues/4028">https://github.com/MapServer/MapServer/issues/4028</a></p></li>
<li><p><a class="reference external" href="https://github.com/MapServer/MapServer/issues/3297">https://github.com/MapServer/MapServer/issues/3297</a></p></li>
<li><p><a class="reference external" href="https://github.com/MapServer/MapServer/issues/2831">https://github.com/MapServer/MapServer/issues/2831</a></p></li>
<li><p><a class="reference external" href="https://github.com/MapServer/MapServer/issues/4255">https://github.com/MapServer/MapServer/issues/4255</a></p></li>
<li><p><a class="reference external" href="https://github.com/MapServer/MapServer/pull/4454">https://github.com/MapServer/MapServer/pull/4454</a></p></li>
</ul>
</section>
</section>
<section id="layer-level-encoding">
<h2>2. Layer Level Encoding<a class="headerlink" href="#layer-level-encoding" title="Link to this heading">¶</a></h2>
<p>This RFC proposes to add an ENCODING keyword at the LAYER level. Layer datasources
that have an ENCODING set, and different than UTF8, will have its attributes converted
to UTF8 in the GetShape and GetNextShape vtable wrappers.</p>
</section>
<section id="implications">
<h2>2.1 Implications<a class="headerlink" href="#implications" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>The core of MapServer can forget about handling encodings, and will treat all strings
as UTF8.</p></li>
<li><p>All text documents ( e.g. capabilities, getfeature, query, etc.. ) will be emitted as
UTF8.</p></li>
<li><p>There will be no need to specify encoding metadata entries in the mapfile in order to
produce somewhat correct ogc documents.</p></li>
</ul>
</section>
<section id="backwards-compatibility">
<h2>2.2 Backwards Compatibility<a class="headerlink" href="#backwards-compatibility" title="Link to this heading">¶</a></h2>
<p>This RFC has some notable backwards incompatibility issues for users who were treating
non UTF8 or ASCII datasets:</p>
<ul class="simple">
<li><p>Mapfiles themselves will be expected to be UTF8-encoded. Non UTF8-encoded mapfiles
will need to be iconv’d to utf8.</p></li>
<li><p>All textual documents will be emitted as UTF8, with corresponding headers and/or
preambles. Emitting in other encodings is unsupported.</p></li>
<li><p>LABEL level ENCODING will be removed. As a means of helping backwards
compatibility, we might want to set the LAYER level encoding to that of the
LABEL one when loading a mapfile.</p></li>
</ul>
<p>It should be noted however that these incompatibilities can and should be seen
as a way to fix MapServer’s flawed handling of these encoded datasources.</p>
</section>
<section id="performance-implications">
<h2>2.3 Performance Implications<a class="headerlink" href="#performance-implications" title="Link to this heading">¶</a></h2>
<p>None or barely noticeable:</p>
<ul class="simple">
<li><p>For UTF8 and ASCII datasources: none expected</p></li>
<li><p>For other datasources: the overhead of the iconv calls should be marginal.</p></li>
</ul>
</section>
<section id="implementation-details">
<h2>3. Implementation Details<a class="headerlink" href="#implementation-details" title="Link to this heading">¶</a></h2>
<section id="affected-files">
<h3>3.1 Affected files<a class="headerlink" href="#affected-files" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>mapfile.c : Layer level handling of the ENCODING keyword, possibly treating
LABEL level ENCODING for backwards compatibility</p></li>
<li><p>maplayer.c: iconv calls to convert the encoding of attributes in
msLayerGetShape() and msLayerGetNextShape()</p></li>
<li><p>TBD: removal of encoding workarounds and modification of header/preamble printing
to announce utf8.</p></li>
</ul>
</section>
<section id="tracking-issue">
<h3>3.2 Tracking Issue<a class="headerlink" href="#tracking-issue" title="Link to this heading">¶</a></h3>
<p>TBD</p>
</section>
</section>
<section id="discussion">
<h2>4. Discussion<a class="headerlink" href="#discussion" title="Link to this heading">¶</a></h2>
<p>While a more general treatment of this issue might also include handling the
encoding of the actual mapfile (to avoid forcing UTF8 as a mandatory mapfile
encoding), this solution is not proposed, as:</p>
<ul class="simple">
<li><p>this adds substantial complexity throughout the codebase</p></li>
<li><p>UTF8 is the widely recommended encoding to use nowadays</p></li>
</ul>
</section>
<section id="voting-history">
<h2>5. Voting History<a class="headerlink" href="#voting-history" title="Link to this heading">¶</a></h2>
<p>+1 from ThomasB, MikeS, DanielM, SteveW, PericlesN, SteveL, TamasS and StephanM</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p>
<a href="../../about.html" title="About">About</a><br>
<a href="../../products.html" title="Products">Products</a><br>
<a href="../../community/index.html" title="Community">Community</a><br>
<a href="../index.html" title="Development">Development</a><br>
<a href="../../download.html" title="Downloads">Downloads</a><br>
<a href="../../documentation.html" title="Documentation">Documentation</a><br>
<a href="../../faq.html" title="FAQ">FAQ</a><br>
<a href="../../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</h3>
  <ul>
<li><a class="reference internal" href="#">MS RFC 103: Layer Level Character Encoding Handling</a><ul>
<li><a class="reference internal" href="#the-current-situation">1. The Current Situation</a><ul>
<li><a class="reference internal" href="#related-issues">1.1 Related Issues</a></li>
</ul>
</li>
<li><a class="reference internal" href="#layer-level-encoding">2. Layer Level Encoding</a></li>
<li><a class="reference internal" href="#implications">2.1 Implications</a></li>
<li><a class="reference internal" href="#backwards-compatibility">2.2 Backwards Compatibility</a></li>
<li><a class="reference internal" href="#performance-implications">2.3 Performance Implications</a></li>
<li><a class="reference internal" href="#implementation-details">3. Implementation Details</a><ul>
<li><a class="reference internal" href="#affected-files">3.1 Affected files</a></li>
<li><a class="reference internal" href="#tracking-issue">3.2 Tracking Issue</a></li>
</ul>
</li>
<li><a class="reference internal" href="#discussion">4. Discussion</a></li>
<li><a class="reference internal" href="#voting-history">5. Voting History</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ms-rfc-104.html" title="MS RFC 104: Replace BITMAP labels with embedded Truetype font"
             >next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-102.html" title="MS RFC 102: Support of Styleitem JavaScript Plugin"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 103: Layer Level Character Encoding Handling</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; <a href="../../copyright.html">Copyright</a> 2023, Open Source Geospatial Foundation.
      Last updated on 2023-12-22.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.5.
    </div>
  </body>
</html>