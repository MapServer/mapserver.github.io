<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>MS RFC 102: Support of Styleitem JavaScript Plugin &#8212; MapServer 8.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx.css?v=6c7b17ac" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=dd298242" />
    <link rel="stylesheet" type="text/css" href="../../_static/ribbon.css?v=ea091bf4" />
    
    <script src="../../_static/documentation_options.js?v=521b6f53"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="icon" href="../../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="MS RFC 103: Layer Level Character Encoding Handling" href="ms-rfc-103.html" />
    <link rel="prev" title="MS RFC 101: Add Support for Content Dependent Legend Responses" href="ms-rfc-101.html" /> 
  </head><body>


<!-- for main branch only, do not backport this -->

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../../index.html" title="Home"><img src="../../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../../index.html" title="Home">Home</a> |
      <a href="../../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter" target="_blank">Twitter</a> |
      <a href="../../download.html" title="Download Source or Binaries">Download </a> |
      <a class="badge" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=KRJ2X44N3HA6U&source=url" target="_blank">
        <img src="https://img.shields.io/badge/donate-%E2%9D%A4%C2%A0-ff69b4.svg?style=flat" alt="Donate to MapServer">
      </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../../ar/development/rfc/ms-rfc-102.html"><img src="../../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../../de/development/rfc/ms-rfc-102.html"><img src="../../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../../el/development/rfc/ms-rfc-102.html"><img src="../../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../../es/development/rfc/ms-rfc-102.html"><img src="../../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../../fr/development/rfc/ms-rfc-102.html"><img src="../../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../../id/development/rfc/ms-rfc-102.html"><img src="../../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../../it/development/rfc/ms-rfc-102.html"><img src="../../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../../ja/development/rfc/ms-rfc-102.html"><img src="../../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../../nl_NL/development/rfc/ms-rfc-102.html"><img src="../../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../../pl/development/rfc/ms-rfc-102.html"><img src="../../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../../ru/development/rfc/ms-rfc-102.html"><img src="../../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../../sq/development/rfc/ms-rfc-102.html"><img src="../../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../../tr/development/rfc/ms-rfc-102.html"><img src="../../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ms-rfc-103.html" title="MS RFC 103: Layer Level Character Encoding Handling"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-101.html" title="MS RFC 101: Add Support for Content Dependent Legend Responses"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 102: Support of Styleitem JavaScript Plugin</a></li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="ms-rfc-102-support-of-styleitem-javascript-plugin">
<span id="rfc102"></span><h1>MS RFC 102: Support of Styleitem JavaScript Plugin<a class="headerlink" href="#ms-rfc-102-support-of-styleitem-javascript-plugin" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Date<span class="colon">:</span></dt>
<dd class="field-odd"><p>2013/08</p>
</dd>
<dt class="field-even">Author<span class="colon">:</span></dt>
<dd class="field-even"><p>Alan Boudreault</p>
</dd>
<dt class="field-odd">Contact<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="mailto:aboudreault&#37;&#52;&#48;mapgears&#46;com">aboudreault<span>&#64;</span>mapgears<span>&#46;</span>com</a></p>
</dd>
<dt class="field-even">Status<span class="colon">:</span></dt>
<dd class="field-even"><p>Adopted</p>
</dd>
<dt class="field-odd">Version<span class="colon">:</span></dt>
<dd class="field-odd"><p>MapServer 7.0</p>
</dd>
</dl>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>this feature is experimental and backwards compatibility may be broken in
the not-so-short term.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Refer to <a class="reference internal" href="../../mapfile/styleitem.html#styleitemjs"><span class="std std-ref">STYLEITEM Javascript</span></a> for the up-to-date documentation.</p>
</div>
<section id="overview">
<h2>1. Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p>Currently, we can style our features by using classes and styles in the
mapfile. We can do a lot of styling with the mapserver expressions. However, it
might end up with a hundred of mapfile lines for a styling layer depending of
the complexity of the data. It is also very hard to maintain. We can also
specify the a STYLEITEM option (AUTO or [attribute]) where mapserver get the
feature style, but this is very not flexible.</p>
</section>
<section id="proposed-solution">
<h2>2. Proposed solution<a class="headerlink" href="#proposed-solution" title="Link to this heading">¶</a></h2>
<p>This RFC proposes the addition of a STYLEITEM javascript plugin. The goal of
this plugin support is to be able to style our features programmatically. This
will be accomplished through javascript using the V8 Engine.</p>
</section>
<section id="implementation-details">
<h2>3. Implementation Details<a class="headerlink" href="#implementation-details" title="Link to this heading">¶</a></h2>
<p>MapServer will have a new addition: the V8 javascript engine integration. There
will be a generic implementation in mapserver with the necessary stuff for the v8
engine: compiling and executing javascript code. It will also allow the use of
javascript in some other parts of the mapserver code if needed.</p>
<section id="v8-basic-implementation">
<h3>3.1 V8 Basic Implementation<a class="headerlink" href="#v8-basic-implementation" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>Compilation of javascript code and files.</p></li>
<li><p>Execution of javascript code.</p></li>
<li><p>MapServer internal Javascript execution context: thread-safe and performance.</p></li>
<li><p>Exposing objects to V8 to be used in Javascript. (Only the shape object will be
available for now)</p></li>
<li><p>Integration of some handlers for MapServer: error, debugging and backtrace of
the javascript code.</p></li>
</ul>
</section>
<section id="styleitem-javascript">
<h3>3.2 Styleitem Javascript<a class="headerlink" href="#styleitem-javascript" title="Link to this heading">¶</a></h3>
<p>The STYLEITEM javascript plugin will be similar to current styleitem
options. Rather than writing classes in the layer definition, we will specify
the javascript file to be executed for the feature styles. The shape attributes
will be exposed to javascript. The javascript plugin will have to return one of
these two options:</p>
<ul class="simple">
<li><p>a STYLE definition (Plain String)</p></li>
<li><p>a CLASS definition with one or multiple styles (Plain String)</p></li>
</ul>
</section>
<section id="mapfile-and-javascript-examples">
<h3>3.3 Mapfile and JavaScript Examples<a class="headerlink" href="#mapfile-and-javascript-examples" title="Link to this heading">¶</a></h3>
<p>mapfile:</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">LAYER</span>
    <span class="k">NAME</span> <span class="s">&quot;my_vector_layer&quot;</span>
    <span class="k">TYPE</span> <span class="nb">POINT</span>
    <span class="k">STATUS</span> <span class="nb">ON</span>
    <span class="k">STYLEITEM</span> <span class="s">&quot;javascript:///path/to/my/file.js&quot;</span>
    <span class="k">CLASS</span>
    <span class="c"># empty class needed in current implementation of styleitem.</span>
    <span class="k">END</span>
<span class="k">END</span>
</pre></div>
</div>
<p>javascript:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./global_variables.js&#39;</span><span class="p">);</span><span class="w"> </span><span class="c1">// for symbols array</span>

<span class="c1">// random symbol</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">symbol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">symbols</span><span class="p">[</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="nx">symbols</span><span class="p">.</span><span class="nx">length</span><span class="p">)];</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">style</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">style</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;STYLE SIZE 12 SYMBOL &#39;&quot;</span><span class="o">+</span><span class="nx">symbol</span><span class="o">+</span><span class="s2">&quot;&#39;&quot;</span><span class="p">;</span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">shape</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">COULEUR</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s1">&#39;#000000&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">style</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s2">&quot;COLOR &#39;&quot;</span><span class="o">+</span><span class="nx">shape</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">COULEUR</span><span class="o">+</span><span class="s2">&quot;&#39; END&quot;</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// random color</span>
<span class="w">    </span><span class="nx">red</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="mf">255</span><span class="p">;</span>
<span class="w">    </span><span class="nx">green</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="mf">255</span><span class="p">;</span>
<span class="w">    </span><span class="nx">blue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="mf">255</span><span class="p">;</span>
<span class="w">    </span><span class="nx">style</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s2">&quot;COLOR &quot;</span><span class="o">+</span><span class="nx">red</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nx">green</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nx">blue</span><span class="o">+</span><span class="s2">&quot; END&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// return the style to MapServer</span>
<span class="nx">style</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="files-affected">
<h3>3.4 Files affected<a class="headerlink" href="#files-affected" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>mapv8.cpp: Generic implementation of the V8 support.</p></li>
<li><p>maplayer.c: STYLEITEM Support for JavaScript.</p></li>
</ul>
</section>
<section id="backwards-compatibility-issues">
<h3>3.5 Backwards Compatibility Issues<a class="headerlink" href="#backwards-compatibility-issues" title="Link to this heading">¶</a></h3>
<p>None expected, new functionality.</p>
</section>
<section id="mapscript-changes">
<h3>3.6 MapScript changes<a class="headerlink" href="#mapscript-changes" title="Link to this heading">¶</a></h3>
<p>None</p>
</section>
</section>
<section id="voting-history">
<h2>4. Voting history<a class="headerlink" href="#voting-history" title="Link to this heading">¶</a></h2>
<p>Passed with +1 from Thomas, Daniel, Mike, Tamas, Stephen, Perry and Stephan</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p>
<a href="../../about.html" title="About">About</a><br>
<a href="../../products.html" title="Products">Products</a><br>
<a href="../../community/index.html" title="Community">Community</a><br>
<a href="../index.html" title="Development">Development</a><br>
<a href="../../download.html" title="Downloads">Downloads</a><br>
<a href="../../documentation.html" title="Documentation">Documentation</a><br>
<a href="../../faq.html" title="FAQ">FAQ</a><br>
<a href="../../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</h3>
  <ul>
<li><a class="reference internal" href="#">MS RFC 102: Support of Styleitem JavaScript Plugin</a><ul>
<li><a class="reference internal" href="#overview">1. Overview</a></li>
<li><a class="reference internal" href="#proposed-solution">2. Proposed solution</a></li>
<li><a class="reference internal" href="#implementation-details">3. Implementation Details</a><ul>
<li><a class="reference internal" href="#v8-basic-implementation">3.1 V8 Basic Implementation</a></li>
<li><a class="reference internal" href="#styleitem-javascript">3.2 Styleitem Javascript</a></li>
<li><a class="reference internal" href="#mapfile-and-javascript-examples">3.3 Mapfile and JavaScript Examples</a></li>
<li><a class="reference internal" href="#files-affected">3.4 Files affected</a></li>
<li><a class="reference internal" href="#backwards-compatibility-issues">3.5 Backwards Compatibility Issues</a></li>
<li><a class="reference internal" href="#mapscript-changes">3.6 MapScript changes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#voting-history">4. Voting history</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ms-rfc-103.html" title="MS RFC 103: Layer Level Character Encoding Handling"
             >next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-101.html" title="MS RFC 101: Add Support for Content Dependent Legend Responses"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 102: Support of Styleitem JavaScript Plugin</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; <a href="../../copyright.html">Copyright</a> 2023, Open Source Geospatial Foundation.
      Last updated on 2023-12-22.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.5.
    </div>
  </body>
</html>