<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>MS RFC 102: Support of Styleitem JavaScript Plugin &mdash; MapServer 7.0.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '7.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="top" title="MapServer 7.0.0 documentation" href="../../index.html" />
    <link rel="up" title="Request for Comments" href="index.html" />
    <link rel="next" title="MS RFC 103: Layer Level Character Encoding Handling" href="ms-rfc-103.html" />
    <link rel="prev" title="MS RFC 101: Add Support for Content Dependent Legend Responses" href="ms-rfc-101.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../../index.html" title="Home"><img src="../../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../../index.html" title="Home">Home</a> |
      <a href="../../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../../faq.html" title="FAQ">FAQ</a> |
      <a href="../../download.html" title="Download">Download </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../../ar/development/rfc/ms-rfc-102.html"><img src="../../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../../de/development/rfc/ms-rfc-102.html"><img src="../../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../../el/development/rfc/ms-rfc-102.html"><img src="../../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../../es/development/rfc/ms-rfc-102.html"><img src="../../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../../fr/development/rfc/ms-rfc-102.html"><img src="../../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../../id/development/rfc/ms-rfc-102.html"><img src="../../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../../it/development/rfc/ms-rfc-102.html"><img src="../../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../../ja/development/rfc/ms-rfc-102.html"><img src="../../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../../nl_NL/development/rfc/ms-rfc-102.html"><img src="../../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../../pl/development/rfc/ms-rfc-102.html"><img src="../../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../../ru/development/rfc/ms-rfc-102.html"><img src="../../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../../sq/development/rfc/ms-rfc-102.html"><img src="../../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../../tr/development/rfc/ms-rfc-102.html"><img src="../../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        
        
          <a href="../../uk/development/rfc/ms-rfc-102.html"><img src="../../_static/flagicons/uk.png" alt="uk" title="uk" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ms-rfc-103.html" title="MS RFC 103: Layer Level Character Encoding Handling"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-101.html" title="MS RFC 101: Add Support for Content Dependent Legend Responses"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Request for Comments</a> &raquo;</li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="ms-rfc-102-support-of-styleitem-javascript-plugin">
<span id="rfc102"></span><h1>MS RFC 102: Support of Styleitem JavaScript Plugin<a class="headerlink" href="#ms-rfc-102-support-of-styleitem-javascript-plugin" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Date:</th><td class="field-body">2013/08</td>
</tr>
<tr class="field-even field"><th class="field-name">Author:</th><td class="field-body">Alan Boudreault</td>
</tr>
<tr class="field-odd field"><th class="field-name">Contact:</th><td class="field-body"><a class="reference external" href="mailto:aboudreault&#37;&#52;&#48;mapgears&#46;com">aboudreault<span>&#64;</span>mapgears<span>&#46;</span>com</a></td>
</tr>
<tr class="field-even field"><th class="field-name">Status:</th><td class="field-body">Adopted</td>
</tr>
<tr class="field-odd field"><th class="field-name">Version:</th><td class="field-body">MapServer 7.0</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">this feature is experimental and backwards compatibility may be broken in
the not-so-short term.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Refer to <a class="reference internal" href="../../mapfile/styleitem.html#styleitemjs"><span>STYLEITEM Javascript</span></a> for the up-to-date documentation.</p>
</div>
<div class="section" id="overview">
<h2>1. Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Currently, we can style our features by using classes and styles in the
mapfile. We can do a lot of styling with the mapserver expressions. However, it
might end up with a hundred of mapfile lines for a styling layer depending of
the complexity of the data. It is also very hard to maintain. We can also
specify the a STYLEITEM option (AUTO or [attribute]) where mapserver get the
feature style, but this is very not flexible.</p>
</div>
<div class="section" id="proposed-solution">
<h2>2. Proposed solution<a class="headerlink" href="#proposed-solution" title="Permalink to this headline">¶</a></h2>
<p>This RFC proposes the addition of a STYLEITEM javascript plugin. The goal of
this plugin support is to be able to style our features programmatically. This
will be accomplished through javascript using the V8 Engine.</p>
</div>
<div class="section" id="implementation-details">
<h2>3. Implementation Details<a class="headerlink" href="#implementation-details" title="Permalink to this headline">¶</a></h2>
<p>MapServer will have a new addition: the V8 javascript engine integration. There
will be a generic implementation in mapserver with the necessary stuff for the v8
engine: compiling and executing javascript code. It will also allow the use of
javascript in some other parts of the mapserver code if needed.</p>
<div class="section" id="v8-basic-implementation">
<h3>3.1 V8 Basic Implementation<a class="headerlink" href="#v8-basic-implementation" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Compilation of javascript code and files.</li>
<li>Execution of javascript code.</li>
<li>MapServer internal Javascript execution context: thread-safe and performance.</li>
<li>Exposing objects to V8 to be used in Javascript. (Only the shape object will be
available for now)</li>
<li>Integration of some handlers for MapServer: error, debugging and backtrace of
the javascript code.</li>
</ul>
</div>
<div class="section" id="styleitem-javascript">
<h3>3.2 Styleitem Javascript<a class="headerlink" href="#styleitem-javascript" title="Permalink to this headline">¶</a></h3>
<p>The STYLEITEM javascript plugin will be similar to current styleitem
options. Rather than writing classes in the layer definition, we will specify
the javascript file to be executed for the feature styles. The shape attributes
will be exposed to javascript. The javascript plugin will have to return one of
these two options:</p>
<ul class="simple">
<li>a STYLE definition (Plain String)</li>
<li>a CLASS definition with one or multiple styles (Plain String)</li>
</ul>
</div>
<div class="section" id="mapfile-and-javascript-examples">
<h3>3.3 Mapfile and JavaScript Examples<a class="headerlink" href="#mapfile-and-javascript-examples" title="Permalink to this headline">¶</a></h3>
<p>mapfile:</p>
<div class="highlight-mapfile"><div class="highlight"><pre><span></span><span class="k">LAYER</span>
    <span class="k">NAME</span> <span class="s">&quot;my_vector_layer&quot;</span>
    <span class="k">TYPE</span> <span class="nb">POINT</span>
    <span class="k">STATUS</span> <span class="nb">ON</span>
    <span class="k">STYLEITEM</span> <span class="s">&quot;javascript:///path/to/my/file.js&quot;</span>
    <span class="k">CLASS</span>
    <span class="c"># empty class needed in current implementation of styleitem.</span>
    <span class="k">END</span>
<span class="k">END</span>
</pre></div>
</div>
<p>javascript:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./global_variables.js&#39;</span><span class="p">);</span> <span class="c1">// for symbols array</span>

<span class="c1">// random symbol</span>
<span class="kd">var</span> <span class="nx">symbol</span> <span class="o">=</span> <span class="nx">symbols</span><span class="p">[</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="nx">symbols</span><span class="p">.</span><span class="nx">length</span><span class="p">)];</span>
<span class="kd">var</span> <span class="nx">style</span> <span class="o">=</span> <span class="nx">style</span> <span class="o">=</span> <span class="s2">&quot;STYLE SIZE 12 SYMBOL &#39;&quot;</span><span class="o">+</span><span class="nx">symbol</span><span class="o">+</span><span class="s2">&quot;&#39;&quot;</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">shape</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">COULEUR</span> <span class="o">!=</span> <span class="s1">&#39;#000000&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">style</span> <span class="o">+=</span> <span class="s2">&quot;COLOR &#39;&quot;</span><span class="o">+</span><span class="nx">shape</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">COULEUR</span><span class="o">+</span><span class="s2">&quot;&#39; END&quot;</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// random color</span>
    <span class="nx">red</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="mi">255</span><span class="p">;</span>
    <span class="nx">green</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="mi">255</span><span class="p">;</span>
    <span class="nx">blue</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="mi">255</span><span class="p">;</span>
    <span class="nx">style</span> <span class="o">+=</span> <span class="s2">&quot;COLOR &quot;</span><span class="o">+</span><span class="nx">red</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nx">green</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nx">blue</span><span class="o">+</span><span class="s2">&quot; END&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// return the style to MapServer</span>
<span class="nx">style</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="files-affected">
<h3>3.4 Files affected<a class="headerlink" href="#files-affected" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>mapv8.cpp: Generic implementation of the V8 support.</li>
<li>maplayer.c: STYLEITEM Support for JavaScript.</li>
</ul>
</div>
<div class="section" id="backwards-compatibility-issues">
<h3>3.5 Backwards Compatibility Issues<a class="headerlink" href="#backwards-compatibility-issues" title="Permalink to this headline">¶</a></h3>
<p>None expected, new functionality.</p>
</div>
<div class="section" id="mapscript-changes">
<h3>3.6 MapScript changes<a class="headerlink" href="#mapscript-changes" title="Permalink to this headline">¶</a></h3>
<p>None</p>
</div>
</div>
<div class="section" id="voting-history">
<h2>4. Voting history<a class="headerlink" href="#voting-history" title="Permalink to this headline">¶</a></h2>
<p>Passed with +1 from Thomas, Daniel, Mike, Tamas, Stephen, Perry and Stephan</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Navigation</h3>
<p>
<a href="../../about.html" title="About">About</a><br>
<a href="../../products.html" title="Products">Products</a><br>
<a href="../../community/index.html" title="Community">Community</a><br>
<a href="../index.html" title="Development">Development</a><br>
<a href="../../download.html" title="Downloads">Downloads</a><br>
<a href="../../documentation.html" title="Documentation">Documentation</a><br>
<a href="../../faq.html" title="FAQ">FAQ</a>
</p>
  <h3>Current Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">MS RFC 102: Support of Styleitem JavaScript Plugin</a><ul>
<li><a class="reference internal" href="#overview">1. Overview</a></li>
<li><a class="reference internal" href="#proposed-solution">2. Proposed solution</a></li>
<li><a class="reference internal" href="#implementation-details">3. Implementation Details</a><ul>
<li><a class="reference internal" href="#v8-basic-implementation">3.1 V8 Basic Implementation</a></li>
<li><a class="reference internal" href="#styleitem-javascript">3.2 Styleitem Javascript</a></li>
<li><a class="reference internal" href="#mapfile-and-javascript-examples">3.3 Mapfile and JavaScript Examples</a></li>
<li><a class="reference internal" href="#files-affected">3.4 Files affected</a></li>
<li><a class="reference internal" href="#backwards-compatibility-issues">3.5 Backwards Compatibility Issues</a></li>
<li><a class="reference internal" href="#mapscript-changes">3.6 MapScript changes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#voting-history">4. Voting history</a></li>
</ul>
</li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Open Source Geospatial Foundation.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.4</a>
      
    </div>

    

    
  </body>
</html>