<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>MS RFC 134: OGC API Support &#8212; MapServer 8.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx.css?v=6c7b17ac" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=dd298242" />
    <link rel="stylesheet" type="text/css" href="../../_static/ribbon.css?v=ea091bf4" />
    
    <script src="../../_static/documentation_options.js?v=521b6f53"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="icon" href="../../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="MS RFC 135: MapServer 8.0 Config file" href="ms-rfc-135.html" />
    <link rel="prev" title="MS RFC 133: Mapfile Syntax Cleanup" href="ms-rfc-133.html" /> 
  </head><body>


<!-- for main branch only, do not backport this -->

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../../index.html" title="Home"><img src="../../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../../index.html" title="Home">Home</a> |
      <a href="../../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter" target="_blank">Twitter</a> |
      <a href="../../download.html" title="Download Source or Binaries">Download </a> |
      <a class="badge" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=KRJ2X44N3HA6U&source=url" target="_blank">
        <img src="https://img.shields.io/badge/donate-%E2%9D%A4%C2%A0-ff69b4.svg?style=flat" alt="Donate to MapServer">
      </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../../ar/development/rfc/ms-rfc-134.html"><img src="../../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../../de/development/rfc/ms-rfc-134.html"><img src="../../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../../el/development/rfc/ms-rfc-134.html"><img src="../../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../../es/development/rfc/ms-rfc-134.html"><img src="../../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../../fr/development/rfc/ms-rfc-134.html"><img src="../../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../../id/development/rfc/ms-rfc-134.html"><img src="../../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../../it/development/rfc/ms-rfc-134.html"><img src="../../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../../ja/development/rfc/ms-rfc-134.html"><img src="../../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../../nl_NL/development/rfc/ms-rfc-134.html"><img src="../../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../../pl/development/rfc/ms-rfc-134.html"><img src="../../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../../ru/development/rfc/ms-rfc-134.html"><img src="../../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../../sq/development/rfc/ms-rfc-134.html"><img src="../../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../../tr/development/rfc/ms-rfc-134.html"><img src="../../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ms-rfc-135.html" title="MS RFC 135: MapServer 8.0 Config file"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-133.html" title="MS RFC 133: Mapfile Syntax Cleanup"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 134: OGC API Support</a></li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="ms-rfc-134-ogc-api-support">
<span id="rfc134"></span><h1>MS RFC 134: OGC API Support<a class="headerlink" href="#ms-rfc-134-ogc-api-support" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Author<span class="colon">:</span></dt>
<dd class="field-odd"><p>Steve Lime</p>
</dd>
<dt class="field-even">Contact<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference external" href="mailto:steve&#46;lime&#37;&#52;&#48;state&#46;mn&#46;us">steve<span>&#46;</span>lime<span>&#64;</span>state<span>&#46;</span>mn<span>&#46;</span>us</a></p>
</dd>
<dt class="field-odd">Author<span class="colon">:</span></dt>
<dd class="field-odd"><p>Tom Kralidis</p>
</dd>
<dt class="field-even">Contact<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference external" href="mailto:tomkralidis&#37;&#52;&#48;gmail&#46;com">tomkralidis<span>&#64;</span>gmail<span>&#46;</span>com</a></p>
</dd>
<dt class="field-odd">Author<span class="colon">:</span></dt>
<dd class="field-odd"><p>Jeff McKenna</p>
</dd>
<dt class="field-even">Contact<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference external" href="mailto:jmckenna&#37;&#52;&#48;gatewaygeomatics&#46;com">jmckenna<span>&#64;</span>gatewaygeomatics<span>&#46;</span>com</a></p>
</dd>
<dt class="field-odd">Status<span class="colon">:</span></dt>
<dd class="field-odd"><p>Adopted</p>
</dd>
<dt class="field-even">Last update<span class="colon">:</span></dt>
<dd class="field-even"><p>2021-06-30</p>
</dd>
<dt class="field-odd">Version<span class="colon">:</span></dt>
<dd class="field-odd"><p>MapServer 8.0</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This document is outdated, please follow the official document: <a class="reference internal" href="../../ogc/ogc_api.html#ogcapi"><span class="std std-ref">OGC API : Features</span></a></p>
</div>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p>OGC is undergoing a revolutionary effort around modernizing their API
specifications to align with current technology and design patterns:</p>
<blockquote>
<div><ul class="simple">
<li><p>REST</p></li>
<li><p>JSON</p></li>
<li><p>OpenAPI (and Swagger)</p></li>
</ul>
</div></blockquote>
<p>The <a class="reference external" href="https://ogcapi.ogc.org/">OGC API</a> efforts represent a clean break
from the first generation WxS specifications. This RFC is an attempt describe
MapServer support for (initially) the OGC API - Features server specifications.
The modular nature of OGC API will allow for reuse of shared functionality
(landing pages, conformance, collections, queryables, filtering, etc.) across
various OGC APIs implemented in MapServer.</p>
<p>OGC API request/response design patterns consist of HTTP operations with GET
(KVP) or POST (JSON) methods to specific query parameters.  HTTP methods
beyond GET/POST (PUT, DELETE, etc.) are envisioned as optional extensions
for transactional capability.</p>
<p>Below are mappings between WxS specifications implemented in the MapServer suite
and the relevant emerging OGC API standards.</p>
<table class="docutils align-left">
<thead>
<tr class="row-odd"><th class="head"><p>WxS</p></th>
<th class="head"><p>OGC API</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>OWS Common</p></td>
<td><p>OGC API - Common</p></td>
</tr>
<tr class="row-odd"><td><p>WMS</p></td>
<td><p>OGC API - Maps</p></td>
</tr>
<tr class="row-even"><td><p>WMTS</p></td>
<td><p>OGC API - Tiles</p></td>
</tr>
<tr class="row-odd"><td><p>WFS</p></td>
<td><p>OGC API - Features</p></td>
</tr>
<tr class="row-even"><td><p>WCS</p></td>
<td><p>OGC API - Coverages</p></td>
</tr>
<tr class="row-odd"><td><p>SLD</p></td>
<td><p>OGC API - Styles</p></td>
</tr>
</tbody>
</table>
</section>
<section id="proposed-approach">
<h2>Proposed Approach<a class="headerlink" href="#proposed-approach" title="Link to this heading">¶</a></h2>
<p>Much of the underlying functionality needed to support the OGC API
specifications already exists in MapServer and is exposed via WxS support.
WxS support is complex owing mostly to the various versions of the service
specifications that are supported. The code is full of conditionals so things
behave differently or expose new functionality depending on version. The WxS
specifications rely heavily on query strings (GET/POST) to configure requests
and XML for responses.</p>
<p>While there will most certainly be opportunities to leverage portions of the
existing OWS/WxS code, it doesn’t make sense to further complicate the main
WxS functions. We can also develop the new functionality using C++ and can take
advantage of modern C++ libraries such as nlohmann/json and Inja.  Working in
“clean break” mode also follows the OGC API approach to modernizing the APIs.</p>
<section id="cgi-fastcgi-integration">
<h3>CGI/FastCGI Integration<a class="headerlink" href="#cgi-fastcgi-integration" title="Link to this heading">¶</a></h3>
<p>In order to support a RESTful, resource/path-based approach to requests we
need to rely on additional CGI components beyond the query string or post-body:
specifically information stored in the <em>PATH_INFO</em> environment variable.
We also need a mapfile and some indication of what API specification is
being used. We propose the following approach:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">(</span><span class="n">s</span><span class="p">):</span><span class="o">//</span><span class="n">maps</span><span class="o">.</span><span class="n">dnr</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">mn</span><span class="o">.</span><span class="n">us</span><span class="o">/</span><span class="n">cgi</span><span class="o">-</span><span class="nb">bin</span><span class="o">/</span><span class="n">mapserv</span><span class="o">/</span><span class="n">mapfile</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">route</span>
</pre></div>
</div>
<p>Where:</p>
<ol class="arabic simple">
<li><p>/mapfile/api/route = PATH_INFO</p></li>
<li><p>mapfile = the environment variable referencing the full-path mapfile name</p></li>
<li><p>api = the API signature (e.g. ogcapi), allowing for support of multiple APIs</p></li>
<li><p>route = the API route (e.g. /collections/layer/id)</p></li>
</ol>
<p>The PATH_INFO variable is part of the CGI standard and (at least with Apache)
is already available to MapServer. In addition, MapServer already supports
environment variable-based mapfile definition. It turns out to be relatively
simple to check for the presence of PATH_INFO and redirect processing to a
API dispatcher if necessary. The standard workflow is largely unaffected by
this change so there should be no backwards compatibility issues.</p>
<p>This setup also allows for the query string to be utilized by APIs so you can
combine things like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>http(s)://maps.dnr.state.mn.us/cgi-bin/mapserv/mapfile/ogcapi/conformance?f=html
</pre></div>
</div>
</section>
<section id="configuration">
<h3>Configuration<a class="headerlink" href="#configuration" title="Link to this heading">¶</a></h3>
<p>Like the other OGC WxS services, OGC API support will be configured via WEB and
LAYER object metadata. A new namespace - <em>oga</em> (OGC Geospatial API) will be
recognized and wherever possible OGC API support will leverage existing
ows|wfs|wms|gml metadata. The oga namespace will take precedence in metadata
lookups.</p>
<p>Also like other OGC WxS services, OGC API support would need to be explicitly
enabled using the metadata “oga_enable_request” (or “ows_enable_request”)
value at the MAP and LAYER level. Currently all or nothing
(“oga_enable_request” “OGCAPI”).</p>
<p>Metadata element naming should mirror API specifications to spare a new
implementation from legacy naming conventions. However, WxS metadata should
also be referenced as a fallback in order to leverage existing configurations.
An example the API description where we would look for oga_description at
the MAP level and fallback to ows|wfs_abstract if not found.</p>
<p>New metadata keys (oga namespace):</p>
<table class="docutils align-left">
<thead>
<tr class="row-odd"><th class="head"><p>Key</p></th>
<th class="head"><p>Level</p></th>
<th class="head"><p>Meaning</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>onlineresource</p></td>
<td><p>Map</p></td>
<td><p>API root url, can’t reuse WxS values</p></td>
</tr>
<tr class="row-odd"><td><p>html_template_directory</p></td>
<td><p>Map</p></td>
<td><p>full path or relative (to mapfile) of html template directory</p></td>
</tr>
<tr class="row-even"><td><p>description</p></td>
<td><p>Map</p></td>
<td><p>service description, fall back to ows/wfs_abstract</p></td>
</tr>
<tr class="row-odd"><td><p>links</p></td>
<td><p>Map, Layer</p></td>
<td><p>comma delimited list of link keys - references to other metadata</p></td>
</tr>
<tr class="row-even"><td><p>link_{key}_title</p></td>
<td><p>Map, Layer</p></td>
<td><p>link title</p></td>
</tr>
<tr class="row-odd"><td><p>link_{key}_href</p></td>
<td><p>Map, Layer</p></td>
<td><p>link href (url)</p></td>
</tr>
<tr class="row-even"><td><p>html_tags</p></td>
<td><p>Map</p></td>
<td><p>comma delimited list of tag keys to expose to HTML templates - references to other metadata</p></td>
</tr>
<tr class="row-odd"><td><p>tag_{key}</p></td>
<td><p>Map</p></td>
<td><p>value associated with the tag, added to JSON data in template.tags object</p></td>
</tr>
<tr class="row-even"><td><p>keywords</p></td>
<td><p>Layer</p></td>
<td><p>comma delimited list of keywords, fall back to ows/wfs_keywordlist</p></td>
</tr>
<tr class="row-odd"><td><p>max_limit</p></td>
<td><p>Map, Layer</p></td>
<td><p>map or layer-level maximum limit value (integer)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="json-support">
<h3>JSON Support<a class="headerlink" href="#json-support" title="Link to this heading">¶</a></h3>
<p>OGC API specifications rely heavily on JSON. The excellent <a class="reference external" href="https://github.com/nlohmann/json/">nlohmann/json</a>
C++ library will be used to construct response objects for each request type.
The library is best-of-breed and widely used by other OSGeo projects such as PROJ.
More importantly, integration is simple: just include a single <em>.hpp</em> file.
I propose actually distributing the <em>nlohmann/json.hpp</em> file with MapServer
and then upgrading it as necessary. No complicated cmake configuration
is necessary in that case.</p>
<p>nlohmann/json has a MIT license.</p>
</section>
<section id="html-support">
<h3>HTML Support<a class="headerlink" href="#html-support" title="Link to this heading">¶</a></h3>
<p>While not required, HTML support is strongly encouraged. Instead of somehow
trying to store and output HTML from inside MapServer, I propose using a
series of templates to support HTML responses. This gives us (and users) a
great deal of flexibility to control the look and feel of API documentation.
Base OGC API templates would be shipped with MapServer and are constructed
using Bootstrap 4 by default. A second set of plain HTML templates will
also be provided and will provide a stable base for msautotest support.
The templates live in the MapServer distribution in a new <em>share</em> directory and
are organized by API signature (so <em>share/ogcapi/templates</em>). All a user needs
to do to configure HTML responses is to note the base path of the templates
as a metadata value (<em>oga_html_template_directory</em>) or environment variable
(<em>OGCAPI_HTML_TEMPLATE_DIRECTORY</em>).</p>
<p>The C++ <a class="reference external" href="https://github.com/pantor/inja">Inja templating library</a> is used
to process HTML responses. Inja depends on nlohman/json so API responses will
always be composed first in JSON and then rendered as HTML using Inja. Inja
is full-featured and supports expressions, conditionals, loops and includes,
amongst other things. Like nlohmann/json, Inja is easy to integrate using a
single <em>.hpp file</em>. Again I propose distributing Inja with MapServer.</p>
<p>Inja also has a MIT license.</p>
</section>
<section id="mapscript-support">
<h3>MapScript Support<a class="headerlink" href="#mapscript-support" title="Link to this heading">¶</a></h3>
<p><em>For consideration:</em> should the SWIG MapScript class <a class="reference external" href="https://mapserver.org/mapscript/mapscript.html#owsrequest">OWSRequest</a>
be enhanced to also allow to dynamically modify OGC API services?</p>
</section>
<section id="new-source-files">
<h3>New Source Files<a class="headerlink" href="#new-source-files" title="Link to this heading">¶</a></h3>
<ul>
<li><dl class="field-list simple">
<dt class="field-odd">mapogcapi.cpp/mapogcapi.h<span class="colon">:</span></dt>
<dd class="field-odd"><p>core implementation.</p>
</dd>
</dl>
</li>
<li><dl class="field-list simple">
<dt class="field-odd">third-party/include_nlohmann_json.hpp<span class="colon">:</span></dt>
<dd class="field-odd"><p>wrapper for nhlohmann/json library.</p>
</dd>
</dl>
</li>
<li><dl class="field-list simple">
<dt class="field-odd">third-party/include_pantor_inja.hpp<span class="colon">:</span></dt>
<dd class="field-odd"><p>wrapper for Inja library.</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>will need to edit to reference the local instance of nlohmann/json.</p>
</div>
</li>
</ul>
</section>
<section id="source-files-changed">
<h3>Source Files Changed<a class="headerlink" href="#source-files-changed" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><dl class="field-list simple">
<dt class="field-odd">mapserv.c/mapserv.h<span class="colon">:</span></dt>
<dd class="field-odd"><p>add call to msCGIIsAPIRequest() to main CGI workflow. Added function prototypes for msIsAPIRequest() and msCGIDispatchAPIRequest(). Added command-line hook to set PATH_INFO.</p>
</dd>
</dl>
</li>
<li><dl class="field-list simple">
<dt class="field-odd">mapservutil.c<span class="colon">:</span></dt>
<dd class="field-odd"><p>add msIsAPIRequest() and msCGIDispatchAPIRequest() functions. Update msCGILoadMap() to load a mapfile defined by API - basically the environment variable use case.</p>
</dd>
</dl>
</li>
<li><dl class="field-list simple">
<dt class="field-odd">cgiutil.c<span class="colon">:</span></dt>
<dd class="field-odd"><p>updated to use msSetError() rather than writing error messages directly. Extend cgiRequestObj init/free functions as appropriate.</p>
</dd>
</dl>
</li>
<li><dl class="field-list simple">
<dt class="field-odd">cgiutil.h<span class="colon">:</span></dt>
<dd class="field-odd"><p>add path_info, api_path and api_path_length attributes to cgiRequestObj.</p>
</dd>
</dl>
</li>
<li><dl class="field-list simple">
<dt class="field-odd">maperror.c/maperror.h<span class="colon">:</span></dt>
<dd class="field-odd"><p>added OGC API support to msGetVersion(). Added new API error code and error message. Note that specific OGC API error handling is handled locally within mapogcapi.cpp.</p>
</dd>
</dl>
</li>
</ul>
</section>
<section id="build-files-changed">
<h3>Build Files Changed<a class="headerlink" href="#build-files-changed" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><dl class="field-list simple">
<dt class="field-odd">CMakeLists.txt<span class="colon">:</span></dt>
<dd class="field-odd"><p>typical integration of new functionality.</p>
</dd>
</dl>
</li>
<li><dl class="field-list simple">
<dt class="field-odd">mapserver-config.h.in<span class="colon">:</span></dt>
<dd class="field-odd"><p>added USE_OGCAPI_SVR.</p>
</dd>
</dl>
</li>
</ul>
</section>
</section>
<section id="limitations-caveats">
<h2>Limitations/Caveats<a class="headerlink" href="#limitations-caveats" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Input/output SRS are EPSG:4326 only.</p></li>
<li><p>Feature properties support GML item and constant configuration.
Groups are not implemented.</p></li>
</ul>
</section>
<section id="backwards-compatibility-issues">
<h2>Backwards Compatibility Issues<a class="headerlink" href="#backwards-compatibility-issues" title="Link to this heading">¶</a></h2>
<p>None anticipated - new functionality.</p>
</section>
<section id="security-considerations">
<h2>Security Considerations<a class="headerlink" href="#security-considerations" title="Link to this heading">¶</a></h2>
<section id="api-route-handling">
<h3>API Route Handling<a class="headerlink" href="#api-route-handling" title="Link to this heading">¶</a></h3>
<p>Most complex route:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="p">{</span><span class="n">mapfile</span><span class="p">}</span><span class="o">/</span><span class="n">ogcapi</span><span class="o">/</span><span class="n">collection</span><span class="o">/</span><span class="p">{</span><span class="n">collectionId</span><span class="p">}</span><span class="o">/</span><span class="n">item</span><span class="o">/</span><span class="p">{</span><span class="n">itemId</span><span class="p">}</span>
</pre></div>
</div>
<p>Fixed API route elements must match precisely and are case sensitive.
Any deviation will result in error.</p>
<p>Variable API route elements are handled as follows:</p>
<ul class="simple">
<li><dl class="field-list simple">
<dt class="field-odd">{mapfile}<span class="colon">:</span></dt>
<dd class="field-odd"><p>references a mapfile defined in the environment. If the mapfile
is not found a standard CGI error message is returned.</p>
</dd>
</dl>
</li>
<li><dl class="field-list simple">
<dt class="field-odd">{collectionId}<span class="colon">:</span></dt>
<dd class="field-odd"><p>references layer name and must match exactly. If the layer
is not found or if the layer is not eligible (e.g. raster) a 404
error is thrown (as JSON).</p>
</dd>
</dl>
</li>
<li><dl class="field-list simple">
<dt class="field-odd">{itemId}<span class="colon">:</span></dt>
<dd class="field-odd"><p>references a feature ID as defined by <em>gml_featureid</em> metadata.
Optionally the value is validated using a regex supplied in the layer validation
block. If the validation fails a 404 error is thrown (as JSON). (the namepaces
oga, ows, and wfs are also checked, such as oga_featureid)</p>
</dd>
</dl>
</li>
</ul>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">METADATA</span>
  <span class="s">&quot;gml_featureid&quot;</span> <span class="s">&quot;myid&quot;</span>
  <span class="p">...</span>
<span class="k">END</span>
<span class="k">VALIDATION</span>
  <span class="s">&quot;myid&quot;</span> <span class="s">&quot;^[0-9]{2}$&quot;</span> <span class="c"># limit to 2-digit integers</span>
  <span class="p">...</span>
<span class="k">END</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We could consider extending validation like this to OGC services that
accept filters._</p>
</div>
</section>
<section id="parameter-handling">
<h3>Parameter Handling<a class="headerlink" href="#parameter-handling" title="Link to this heading">¶</a></h3>
<p>Relatively few parameters are supported in this initial implementation:</p>
<ul class="simple">
<li><dl class="field-list simple">
<dt class="field-odd">f<span class="colon">:</span></dt>
<dd class="field-odd"><p>format of the response, supported values are json and html. Error
is return with any other value. Default is html.</p>
</dd>
</dl>
</li>
<li><dl class="field-list simple">
<dt class="field-odd">bbox<span class="colon">:</span></dt>
<dd class="field-odd"><p>bounding box filter. Error is returned with malformed values,
more/less than 4 numbers, degenerate bounds or if values are not given in
lat/lon. Default is the map’s default extent is used.</p>
</dd>
</dl>
</li>
<li><dl class="field-list simple">
<dt class="field-odd">limit<span class="colon">:</span></dt>
<dd class="field-odd"><p>number of results to return. Error is returned with malformed
value. Other values are clipped to the range 1 to 10,000 (per spec).</p>
</dd>
</dl>
</li>
<li><dl class="field-list simple">
<dt class="field-odd">start<span class="colon">:</span></dt>
<dd class="field-odd"><p>page number. Error is returned with a malformed value.</p>
</dd>
</dl>
</li>
</ul>
</section>
<section id="template-handling">
<h3>Template Handling<a class="headerlink" href="#template-handling" title="Link to this heading">¶</a></h3>
<p>Templates contain <a class="reference external" href="https://github.com/pantor/inja">Inja template markup</a>.
The filenames are fixed in code (e.g. collection-items.html). The directory
containing the templates is given in webObj metadata or (optionally) via
environment variable. The directory specification is either absolute
(e.g. /opt/mapserver/ogcapi/templates) or relative to the location of the
mapfile. As present the implementation allows the use of the Inja <em>{{ include “file” }}</em>
tag. It’s really impractical to maintain templates with common elements
(e.g. header, footer, etc…) without that functionality. The current
Inja implementation allows any value for the file attribute which represents
a security risk if access to the templates is not limited. There are existing
enhancement requests for Inja to add this functionality, or we’ll need to update
the library to limit includes to the specified directory or sub-directories.</p>
</section>
<section id="large-dataset-handling">
<h3>Large Dataset Handling<a class="headerlink" href="#large-dataset-handling" title="Link to this heading">¶</a></h3>
<p>It is not clear how large of datasets can be handled via nlohmann/json and/or
Inja (see above). The default maximum limit value of 10,000 may not be
appropriate in many cases. It is possible to set a map and/or layer limit
using <em>oga_max_limit</em> metadata. The layer value takes precedence. Paging is
available for drivers the support it, leveraging the work done for WFS.</p>
</section>
</section>
<section id="performance-implications">
<h2>Performance Implications<a class="headerlink" href="#performance-implications" title="Link to this heading">¶</a></h2>
<p>There should be very little overall performance impact. A single function is
added to the <em>mapserv.c</em> workflow to detect an API request. The function
inspects the <em>PATH_INFO</em> environment variable to see if the value (if any)
matches the minimum pattern for an API call as described earlier. If so,
elements in the <em>cgiRequestObj</em> are set and the request is quickly pushed into
the OGC API processing workflow once a mapfile is loaded.</p>
</section>
<section id="ticket-id-and-references">
<h2>Ticket ID and References<a class="headerlink" href="#ticket-id-and-references" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/sdlime/mapserver/tree/ogcapi">Proof-of-concept branch</a></p></li>
<li><p><a class="reference external" href="https://github.com/mapserver/mapserver/wiki/OGC-API">OGC API Background</a></p></li>
<li><p><a class="reference external" href="https://github.com/mapserver/mapserver/wiki/OGC-API-implementation">OGC API Implementation Notes</a></p></li>
<li><p><a class="reference external" href="https://github.com/nlohmann/json">nlohmann/json</a></p></li>
<li><p><a class="reference external" href="https://github.com/pantor/inja">Inja C++ Templating Library</a></p></li>
</ul>
</section>
<section id="voting-history">
<h2>Voting history<a class="headerlink" href="#voting-history" title="Link to this heading">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="mi">1</span> <span class="kn">from</span> <span class="nn">SteveL</span><span class="p">,</span> <span class="n">JeffM</span><span class="p">,</span> <span class="n">TomK</span><span class="p">,</span> <span class="n">EvenR</span><span class="p">,</span> <span class="n">JukkaR</span><span class="p">,</span> <span class="n">JeromeB</span><span class="p">,</span> <span class="n">MikeS</span><span class="p">,</span> <span class="n">SethG</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="current-status">
<h2>Current Status<a class="headerlink" href="#current-status" title="Link to this heading">¶</a></h2>
<table class="docutils align-left">
<thead>
<tr class="row-odd"><th class="head"><p>Support</p></th>
<th class="head"><p>Status</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Features: Landing page</p></td>
<td><p><span class="raw-html">&#128679;</span></p></td>
</tr>
<tr class="row-odd"><td><p>Features: JSON &amp; HTML output</p></td>
<td><p><span class="raw-html">&#x2705;</span></p></td>
</tr>
<tr class="row-even"><td><p>Features: Collections (layer listing)</p></td>
<td><p><span class="raw-html">&#128679;</span></p></td>
</tr>
<tr class="row-odd"><td><p>Features: Collections (single layer: links (summary)</p></td>
<td><p><span class="raw-html">&#128679;</span></p></td>
</tr>
<tr class="row-even"><td><p>Features: Collections (single layer: query)</p></td>
<td><p><span class="raw-html">&#128679;</span></p></td>
</tr>
<tr class="row-odd"><td><p>Features: Collections (single layer: list queryable fields)</p></td>
<td><p><span class="raw-html">&#10060;</span></p></td>
</tr>
<tr class="row-even"><td><p>Features: Collections (single layer: map)</p></td>
<td><p><span class="raw-html">&#10060;</span></p></td>
</tr>
<tr class="row-odd"><td><p>Features: API docs</p></td>
<td><p><span class="raw-html">&#10060;</span></p></td>
</tr>
<tr class="row-even"><td><p>Features: msautotests</p></td>
<td><p><span class="raw-html">&#128679;</span></p></td>
</tr>
<tr class="row-odd"><td><p>Features: user docs on mapserver.org</p></td>
<td><p><span class="raw-html">&#10060;</span></p></td>
</tr>
</tbody>
</table>
</section>
<section id="issues-tasks-wishlist">
<h2>Issues / Tasks / Wishlist<a class="headerlink" href="#issues-tasks-wishlist" title="Link to this heading">¶</a></h2>
<ul>
<li><dl class="field-list simple">
<dt class="field-odd">issue<span class="colon">:</span></dt>
<dd class="field-odd"><p>cleaning the onlineresource of “?” or “/” ending characters, as it causes problems in HTML landing pages (double-slashes in links, or the “?” will actually break all links)</p>
</dd>
</dl>
</li>
<li><dl class="field-list simple">
<dt class="field-odd">issue<span class="colon">:</span></dt>
<dd class="field-odd"><p>compile fails without enabling <cite>-DUSE_WFS_SVR</cite> (as well as the obvious <cite>-DUSE_OGCAPI_SVR</cite>)</p>
</dd>
</dl>
</li>
<li><dl class="field-list simple">
<dt class="field-odd">task<span class="colon">:</span></dt>
<dd class="field-odd"><p>add ows_contact* information to the landing page (from the associated values set in the mapfile)</p>
</dd>
</dl>
</li>
<li><dl class="field-list">
<dt class="field-odd">wishlist<span class="colon">:</span></dt>
<dd class="field-odd"><p>besides the “/ogcapi” API signature (for features, maps..support), also allow “/features” (to allow developers to only request vector collections), for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0.0.1</span><span class="o">/</span><span class="n">cgi</span><span class="o">-</span><span class="nb">bin</span><span class="o">/</span><span class="n">mapserv</span><span class="o">.</span><span class="n">exe</span><span class="o">/</span><span class="n">demo</span><span class="o">-</span><span class="n">ogcapi</span><span class="o">/</span><span class="n">features</span>
</pre></div>
</div>
</dd>
</dl>
<p>(Note that is how the GeoServer implementation works)</p>
</li>
<li><dl class="field-list simple">
<dt class="field-odd">wishlist<span class="colon">:</span></dt>
<dd class="field-odd"><p>include MapServer logo on landing page</p>
</dd>
</dl>
</li>
<li><dl class="field-list simple">
<dt class="field-odd">wishlist<span class="colon">:</span></dt>
<dd class="field-odd"><p>set MapServer favicon for all HTML pages</p>
</dd>
</dl>
</li>
<li><dl class="field-list simple">
<dt class="field-odd">wishlist<span class="colon">:</span></dt>
<dd class="field-odd"><p>allow other link types for collection item (set through mimetype/outputformats in mapfile?)</p>
</dd>
</dl>
</li>
<li><dl class="field-list simple">
<dt class="field-odd">wishlist<span class="colon">:</span></dt>
<dd class="field-odd"><p>instead of text links, use a dropdown for types (JSON, HTML, KML, etc.)</p>
</dd>
</dl>
</li>
<li><dl class="field-list">
<dt class="field-odd">wishlist<span class="colon">:</span></dt>
<dd class="field-odd"><p>for the single layer map, include a dropdown to set the default number of features displayed in the map:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">10</span> <span class="p">[</span><span class="n">default</span><span class="p">]</span>
<span class="mi">100</span>
<span class="mi">1000</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl class="field-list simple">
<dt class="field-odd">wishlist<span class="colon">:</span></dt>
<dd class="field-odd"><p>for the single layer map, display the current MapServer scale value below the map (as user zooms in, update the scale with the CGI [scale] value)</p>
</dd>
</dl>
</li>
</ul>
</section>
<section id="initial-screencaptures">
<h2>Initial Screencaptures<a class="headerlink" href="#initial-screencaptures" title="Link to this heading">¶</a></h2>
<section id="landing-page">
<h3>Landing Page<a class="headerlink" href="#landing-page" title="Link to this heading">¶</a></h3>
<img alt="../../_images/ogcapi-draft-ms4w-landing.png" class="no-scaled-link" src="../../_images/ogcapi-draft-ms4w-landing.png" style="width: 600px;" />
</section>
<section id="collections">
<h3>Collections<a class="headerlink" href="#collections" title="Link to this heading">¶</a></h3>
<img alt="../../_images/ogcapi-draft-ms4w-collections.png" class="no-scaled-link" src="../../_images/ogcapi-draft-ms4w-collections.png" style="width: 600px;" />
</section>
<section id="collection">
<h3>Collection<a class="headerlink" href="#collection" title="Link to this heading">¶</a></h3>
<img alt="../../_images/ogcapi-draft-ms4w-collection.png" class="no-scaled-link" src="../../_images/ogcapi-draft-ms4w-collection.png" style="width: 600px;" />
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p>
<a href="../../about.html" title="About">About</a><br>
<a href="../../products.html" title="Products">Products</a><br>
<a href="../../community/index.html" title="Community">Community</a><br>
<a href="../index.html" title="Development">Development</a><br>
<a href="../../download.html" title="Downloads">Downloads</a><br>
<a href="../../documentation.html" title="Documentation">Documentation</a><br>
<a href="../../faq.html" title="FAQ">FAQ</a><br>
<a href="../../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</h3>
  <ul>
<li><a class="reference internal" href="#">MS RFC 134: OGC API Support</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#proposed-approach">Proposed Approach</a><ul>
<li><a class="reference internal" href="#cgi-fastcgi-integration">CGI/FastCGI Integration</a></li>
<li><a class="reference internal" href="#configuration">Configuration</a></li>
<li><a class="reference internal" href="#json-support">JSON Support</a></li>
<li><a class="reference internal" href="#html-support">HTML Support</a></li>
<li><a class="reference internal" href="#mapscript-support">MapScript Support</a></li>
<li><a class="reference internal" href="#new-source-files">New Source Files</a></li>
<li><a class="reference internal" href="#source-files-changed">Source Files Changed</a></li>
<li><a class="reference internal" href="#build-files-changed">Build Files Changed</a></li>
</ul>
</li>
<li><a class="reference internal" href="#limitations-caveats">Limitations/Caveats</a></li>
<li><a class="reference internal" href="#backwards-compatibility-issues">Backwards Compatibility Issues</a></li>
<li><a class="reference internal" href="#security-considerations">Security Considerations</a><ul>
<li><a class="reference internal" href="#api-route-handling">API Route Handling</a></li>
<li><a class="reference internal" href="#parameter-handling">Parameter Handling</a></li>
<li><a class="reference internal" href="#template-handling">Template Handling</a></li>
<li><a class="reference internal" href="#large-dataset-handling">Large Dataset Handling</a></li>
</ul>
</li>
<li><a class="reference internal" href="#performance-implications">Performance Implications</a></li>
<li><a class="reference internal" href="#ticket-id-and-references">Ticket ID and References</a></li>
<li><a class="reference internal" href="#voting-history">Voting history</a></li>
<li><a class="reference internal" href="#current-status">Current Status</a></li>
<li><a class="reference internal" href="#issues-tasks-wishlist">Issues / Tasks / Wishlist</a></li>
<li><a class="reference internal" href="#initial-screencaptures">Initial Screencaptures</a><ul>
<li><a class="reference internal" href="#landing-page">Landing Page</a></li>
<li><a class="reference internal" href="#collections">Collections</a></li>
<li><a class="reference internal" href="#collection">Collection</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ms-rfc-135.html" title="MS RFC 135: MapServer 8.0 Config file"
             >next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-133.html" title="MS RFC 133: Mapfile Syntax Cleanup"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 134: OGC API Support</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; <a href="../../copyright.html">Copyright</a> 2023, Open Source Geospatial Foundation.
      Last updated on 2023-12-22.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.5.
    </div>
  </body>
</html>