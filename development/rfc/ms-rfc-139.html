<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>MS RFC 139: Raster labeling (CONNECTIONTYPE RASTERLABEL) &#8212; MapServer 8.6.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx.css?v=48f05237" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=dd298242" />
    <link rel="stylesheet" type="text/css" href="../../_static/ribbon.css?v=ea091bf4" />
    
    <script src="../../_static/jquery.js?v=5d32c60e"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../../_static/documentation_options.js?v=09ed50dd"></script>
    <script src="../../_static/doctools.js?v=fd6eb6e6"></script>
    <script src="../../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    
    <link rel="icon" href="../../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="MS RFC 140: MapServer Index Page" href="ms-rfc-140.html" />
    <link rel="prev" title="MS RFC 138: Reference SLD files in Mapfiles" href="ms-rfc-138.html" /> 
  </head><body>


<!-- for main branch only, do not backport this -->

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../../index.html" title="Home"><img src="../../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../../index.html" title="Home">Home</a> |
      <a href="../../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://fosstodon.org/@mapserver" title="Mastodon" target="_blank">Mastodon</a> |
      <a href="../../download.html" title="Download Source or Binaries">Download </a> |
      <a class="badge" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=KRJ2X44N3HA6U&source=url" target="_blank">
        <img src="https://img.shields.io/badge/donate-%E2%9D%A4%C2%A0-ff69b4.svg?style=flat" alt="Donate to MapServer">
      </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../../ar/development/rfc/ms-rfc-139.html"><img src="../../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../../de/development/rfc/ms-rfc-139.html"><img src="../../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../../el/development/rfc/ms-rfc-139.html"><img src="../../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../../es/development/rfc/ms-rfc-139.html"><img src="../../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../../fr/development/rfc/ms-rfc-139.html"><img src="../../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../../id/development/rfc/ms-rfc-139.html"><img src="../../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../../it/development/rfc/ms-rfc-139.html"><img src="../../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../../ja/development/rfc/ms-rfc-139.html"><img src="../../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../../nl_NL/development/rfc/ms-rfc-139.html"><img src="../../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../../pl/development/rfc/ms-rfc-139.html"><img src="../../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../../ru/development/rfc/ms-rfc-139.html"><img src="../../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../../sq/development/rfc/ms-rfc-139.html"><img src="../../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../../tr/development/rfc/ms-rfc-139.html"><img src="../../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ms-rfc-140.html" title="MS RFC 140: MapServer Index Page"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-138.html" title="MS RFC 138: Reference SLD files in Mapfiles"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 139: Raster labeling (CONNECTIONTYPE RASTERLABEL)</a></li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="ms-rfc-139-raster-labeling-connectiontype-rasterlabel">
<span id="rfc139"></span><h1>MS RFC 139: Raster labeling (CONNECTIONTYPE RASTERLABEL)<a class="headerlink" href="#ms-rfc-139-raster-labeling-connectiontype-rasterlabel" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Date<span class="colon">:</span></dt>
<dd class="field-odd"><p>2024/08/14</p>
</dd>
<dt class="field-even">Author<span class="colon">:</span></dt>
<dd class="field-even"><p>Even Rouault</p>
</dd>
<dt class="field-odd">Contact<span class="colon">:</span></dt>
<dd class="field-odd"><p>even.rouault at spatialys.com</p>
</dd>
<dt class="field-even">Status<span class="colon">:</span></dt>
<dd class="field-even"><p>Adopted</p>
</dd>
<dt class="field-odd">Version<span class="colon">:</span></dt>
<dd class="field-odd"><p>MapServer 8.4</p>
</dd>
</dl>
<section id="overview">
<h2>1. Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p>This is a proposal to add the ability to render labels from raster pixel values,
as an alternative or complement to other typical raster rendering (grayscale,
classification, etc.). Typical applications are for temperature, wind, humidity,
slopes, altitude, noise, pollution, etc.</p>
<p>Visual example (rendered with MapServer):</p>
<blockquote>
<div><img alt="../../_images/rasterlabel.png" src="../../_images/rasterlabel.png" />
</div></blockquote>
</section>
<section id="the-proposed-solution">
<h2>2. The proposed solution<a class="headerlink" href="#the-proposed-solution" title="Link to this heading">¶</a></h2>
<p>This RFC proposes the addition of a new type of layer in MapServer:
CONNECTIONTYPE RASTERLABEL.
The code is strongly based on the UVRASTER capabilities, but will be kept separate
as some likely potential evolutions of UVRASTER (such as modifying u,v values
during reprojection operations) will make both implementation diverge.</p>
<p>The new type is a hybrid layer, which has a raster data source as input and
vector features as output. Only the point representation of those
vector features will be supported. Values at nodata will be ignored.</p>
<p>Since the data source is a raster, all raster processing options can be
used (e.g. RESAMPLE). A default value of RESAMPLE=AVERAGE will be used, if it
is not explicitly defined.</p>
<p>To render a vector field layer, we need to define a layer in the mapfile
with the following options:</p>
<blockquote>
<div><ul class="simple">
<li><p>Set the layer TYPE to POINT.</p></li>
<li><p>Set CONNECTIONTYPE to RASTERLABEL.</p></li>
<li><p>Set the DATA to the raster file.</p></li>
<li><p>If the raster file has more than one bands, add a PROCESSING “BANDS=&lt;num&gt;” option</p></li>
<li><p>Specify a CLASS with a LABEL object to label the points, using the [value]
attribute binding.</p></li>
</ul>
</div></blockquote>
<p>Optional “PROCESSING” settings:</p>
<blockquote>
<div><ul class="simple">
<li><p>BANDS=&lt;num&gt;: Specify the band to label. Not needed if there is a single band.</p></li>
<li><p>LABEL_SPACING=&lt;num&gt;: The spacing is simply the distance, in pixels, between points
to be displayed in the vector field. Default is 32.</p></li>
<li><p>RESAMPLE=NEAREST/AVERAGE/BILINEAR: Defaults to AVERAGE.</p></li>
<li><p>ALLOW_OVERSAMPLE=YES/NO: Whether it is allowed to oversample the raster at
a resolution higher than its nominal resolution. Default is NO, meaning that
when zooming in beyond the nominal resolution of the raster, at most one
point will be generated for each source pixel. This gives to the user a sense
of the resolution of the data it displays.</p></li>
</ul>
</div></blockquote>
<p>The UVRASTER layer has one attribute bindings that can be used in the layer
definition and/or class expressions:</p>
<blockquote>
<div><ul class="simple">
<li><p>[value]: the raw raster value</p></li>
</ul>
</div></blockquote>
<p>Example of a layer definition:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LAYER</span>
  <span class="n">NAME</span> <span class="s2">&quot;temperature&quot;</span>
  <span class="n">TYPE</span> <span class="n">POINT</span>
  <span class="n">CONNECTIONTYPE</span> <span class="n">RASTERLABEL</span>
  <span class="n">PROJECTION</span>
    <span class="s2">&quot;init=epsg:4326&quot;</span>
  <span class="n">END</span>
  <span class="n">DATA</span> <span class="n">data</span><span class="o">/</span><span class="n">temperature</span><span class="o">.</span><span class="n">tif</span>
  <span class="c1"># PROCESSING &quot;BANDS=1&quot;</span>
  <span class="c1"># PROCESSING &quot;LABEL_SPACING=32&quot;</span>
  <span class="c1"># PROCESSING &quot;RESAMPLE=AVERAGE&quot;</span>
  <span class="c1"># PROCESSING &quot;ALLOW_OVERSAMPLE=NO&quot;</span>
  <span class="n">CLASS</span>
      <span class="n">TEXT</span> <span class="p">(</span><span class="n">tostring</span><span class="p">([</span><span class="n">value</span><span class="p">],</span><span class="s2">&quot;</span><span class="si">%.1f</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;°&quot;</span><span class="p">)</span>
      <span class="n">LABEL</span>
        <span class="n">TYPE</span> <span class="n">TRUETYPE</span>
        <span class="n">SIZE</span> <span class="mi">7</span>
      <span class="n">END</span> <span class="c1"># label</span>
  <span class="n">END</span> <span class="c1"># class</span>
<span class="n">END</span>
</pre></div>
</div>
</section>
<section id="implementation-details">
<h2>3. Implementation Details<a class="headerlink" href="#implementation-details" title="Link to this heading">¶</a></h2>
<p>Internally, a RASTERLABEL layer will have its own renderer/driver code. It’s a
hybrid layer because it reads the raster source as a normal raster
layer does, but all other functions behave like a vector layer. The
layer can be drawn as a normal point layer using whichShape, GetShape
etc.</p>
<p>Basic internal draw process of a RASTERLABEL layer:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>whichShape() is called: the raster data source is read using the
internal GDAL functions, resample and all other raster options are applied
and the pixels result is stored in the internal layer structure.</p></li>
<li><p>getShape() is called: loop through the raster pixels and returns a
shapeObj (Point) created with the pixel location.</p></li>
<li><p>MapServer draws its point feature as any other vector layer.</p></li>
</ol>
</div></blockquote>
</section>
<section id="files-affected">
<h2>3.1 Files affected<a class="headerlink" href="#files-affected" title="Link to this heading">¶</a></h2>
<p>The following files will be modified/created by this RFC:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mapserver</span><span class="o">.</span><span class="n">h</span><span class="o">/</span><span class="n">mapfile</span><span class="o">.</span><span class="n">c</span> <span class="p">(</span><span class="n">Connection</span> <span class="nb">type</span> <span class="n">RASTERLABEL</span> <span class="n">support</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">mapfile</span><span class="p">)</span>
<span class="n">maprasterlabel</span><span class="o">.</span><span class="n">cpp</span> <span class="p">(</span><span class="n">new</span> <span class="n">file</span> <span class="k">for</span> <span class="n">the</span> <span class="n">RASTERLABEL</span> <span class="n">renderer</span><span class="p">)</span>
<span class="n">mapuvraster</span><span class="o">.</span><span class="n">cpp</span> <span class="p">(</span><span class="n">renamed</span> <span class="kn">from</span><span class="w"> </span><span class="nn">mapuvraster.c</span><span class="p">,</span> <span class="ow">not</span> <span class="n">strictly</span> <span class="n">correlated</span> <span class="k">with</span> <span class="n">this</span> <span class="n">development</span><span class="p">,</span> <span class="n">but</span> <span class="n">was</span> <span class="n">the</span> <span class="n">opportunity</span> <span class="n">to</span> <span class="n">make</span> <span class="n">an</span> <span class="n">optimization</span> <span class="n">to</span> <span class="n">make</span> <span class="n">getShape</span><span class="p">()</span> <span class="n">faster</span> <span class="n">when</span> <span class="n">requesting</span> <span class="n">increasing</span> <span class="n">feature</span> <span class="n">index</span><span class="p">,</span> <span class="n">that</span> <span class="ow">is</span> <span class="n">also</span> <span class="n">used</span> <span class="n">by</span> <span class="n">maprasterlabel</span><span class="o">.</span><span class="n">cpp</span><span class="p">)</span>
<span class="n">maplayer</span><span class="o">.</span><span class="n">c</span> <span class="p">(</span><span class="n">new</span> <span class="n">layer</span> <span class="nb">type</span> <span class="n">handling</span><span class="p">,</span> <span class="n">virtual</span> <span class="n">tables</span> <span class="n">init</span> <span class="n">etc</span><span class="o">.</span><span class="p">)</span>
<span class="n">maplexer</span><span class="o">.</span><span class="n">l</span> <span class="p">(</span><span class="n">add</span> <span class="n">additional</span> <span class="n">RASTERLABEL</span> <span class="n">keyword</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="mapscript">
<h2>3.2 MapScript<a class="headerlink" href="#mapscript" title="Link to this heading">¶</a></h2>
<p>No issue for any MapScript bindings. The RASTERLABEL layer is handled/rendered internally as
any other layer..</p>
</section>
<section id="backwards-compatibility-issues">
<h2>3.4 Backwards Compatibility Issues<a class="headerlink" href="#backwards-compatibility-issues" title="Link to this heading">¶</a></h2>
<p>This change provides a new functionality with no backwards compatibility issues being considered.</p>
</section>
<section id="candidate-implementation">
<h2>4. Candidate implementation<a class="headerlink" href="#candidate-implementation" title="Link to this heading">¶</a></h2>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference external" href="https://github.com/MapServer/MapServer/pull/7135">https://github.com/MapServer/MapServer/pull/7135</a></p></li>
</ul>
</div></blockquote>
</section>
<section id="voting-history">
<h2>5. Voting history<a class="headerlink" href="#voting-history" title="Link to this heading">¶</a></h2>
<p>+1 from PSC members EvenR, TomK, JukkaR, SethG, MikeS, DanielM, JeromeB, SteveL, JeffM</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p>
<a href="../../about.html" title="About">About</a><br>
<a href="../../products.html" title="Products">Products</a><br>
<a href="../../community/index.html" title="Community">Community</a><br>
<a href="../index.html" title="Development">Development</a><br>
<a href="../../download.html" title="Downloads">Downloads</a><br>
<a href="../../documentation.html" title="Documentation">Documentation</a><br>
<a href="../../faq.html" title="FAQ">FAQ</a><br>
<a href="../../psc.html" title="PSC">PSC</a><br>
<a href="https://fosstodon.org/@mapserver" title="Mastodon">Mastodon</a>
</p>
  <h3>Current Table Of Contents</h3>
  <ul>
<li><a class="reference internal" href="#">MS RFC 139: Raster labeling (CONNECTIONTYPE RASTERLABEL)</a><ul>
<li><a class="reference internal" href="#overview">1. Overview</a></li>
<li><a class="reference internal" href="#the-proposed-solution">2. The proposed solution</a></li>
<li><a class="reference internal" href="#implementation-details">3. Implementation Details</a></li>
<li><a class="reference internal" href="#files-affected">3.1 Files affected</a></li>
<li><a class="reference internal" href="#mapscript">3.2 MapScript</a></li>
<li><a class="reference internal" href="#backwards-compatibility-issues">3.4 Backwards Compatibility Issues</a></li>
<li><a class="reference internal" href="#candidate-implementation">4. Candidate implementation</a></li>
<li><a class="reference internal" href="#voting-history">5. Voting history</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ms-rfc-140.html" title="MS RFC 140: MapServer Index Page"
             >next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-138.html" title="MS RFC 138: Reference SLD files in Mapfiles"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 139: Raster labeling (CONNECTIONTYPE RASTERLABEL)</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; <a href="../../copyright.html">Copyright</a> 2025, Open Source Geospatial Foundation.
      Last updated on 2025-12-03.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 9.0.1.
    </div>
  </body>
</html>