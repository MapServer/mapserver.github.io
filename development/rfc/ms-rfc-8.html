<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>MS RFC 8: Pluggable External Feature Layer Providers &#8212; MapServer 8.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx.css?v=6c7b17ac" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=dd298242" />
    <link rel="stylesheet" type="text/css" href="../../_static/ribbon.css?v=ea091bf4" />
    
    <script src="../../_static/documentation_options.js?v=521b6f53"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="icon" href="../../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="MS RFC 9: Item tag for query templates" href="ms-rfc-9.html" />
    <link rel="prev" title="MS RFC 7.2: MapServer Git Push Management" href="ms-rfc-7.2.html" /> 
  </head><body>


<!-- for main branch only, do not backport this -->

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../../index.html" title="Home"><img src="../../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../../index.html" title="Home">Home</a> |
      <a href="../../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter" target="_blank">Twitter</a> |
      <a href="../../download.html" title="Download Source or Binaries">Download </a> |
      <a class="badge" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=KRJ2X44N3HA6U&source=url" target="_blank">
        <img src="https://img.shields.io/badge/donate-%E2%9D%A4%C2%A0-ff69b4.svg?style=flat" alt="Donate to MapServer">
      </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../../ar/development/rfc/ms-rfc-8.html"><img src="../../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../../de/development/rfc/ms-rfc-8.html"><img src="../../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../../el/development/rfc/ms-rfc-8.html"><img src="../../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../../es/development/rfc/ms-rfc-8.html"><img src="../../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../../fr/development/rfc/ms-rfc-8.html"><img src="../../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../../id/development/rfc/ms-rfc-8.html"><img src="../../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../../it/development/rfc/ms-rfc-8.html"><img src="../../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../../ja/development/rfc/ms-rfc-8.html"><img src="../../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../../nl_NL/development/rfc/ms-rfc-8.html"><img src="../../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../../pl/development/rfc/ms-rfc-8.html"><img src="../../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../../ru/development/rfc/ms-rfc-8.html"><img src="../../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../../sq/development/rfc/ms-rfc-8.html"><img src="../../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../../tr/development/rfc/ms-rfc-8.html"><img src="../../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ms-rfc-9.html" title="MS RFC 9: Item tag for query templates"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-7.2.html" title="MS RFC 7.2: MapServer Git Push Management"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 8: Pluggable External Feature Layer Providers</a></li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="ms-rfc-8-pluggable-external-feature-layer-providers">
<span id="rfc8"></span><h1>MS RFC 8: Pluggable External Feature Layer Providers<a class="headerlink" href="#ms-rfc-8-pluggable-external-feature-layer-providers" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Date<span class="colon">:</span></dt>
<dd class="field-odd"><p>2005/10/26</p>
</dd>
<dt class="field-even">Author<span class="colon">:</span></dt>
<dd class="field-even"><p>Jani Averbach</p>
</dd>
<dt class="field-odd">Contact<span class="colon">:</span></dt>
<dd class="field-odd"><p>javerbach at extendthereach.com</p>
</dd>
<dt class="field-even">Status<span class="colon">:</span></dt>
<dd class="field-even"><p>adopted</p>
</dd>
<dt class="field-odd">Version<span class="colon">:</span></dt>
<dd class="field-odd"><p>MapServer 4.8</p>
</dd>
</dl>
<section id="purpose">
<h2>Purpose<a class="headerlink" href="#purpose" title="Link to this heading">¶</a></h2>
<p>The purpose of this proposal is provide a way to user actually plug-in
external third party feature layer providers to the MapServer at run
time.</p>
</section>
<section id="abstract-solution">
<h2>Abstract Solution<a class="headerlink" href="#abstract-solution" title="Link to this heading">¶</a></h2>
<p>Provide a way to user to tell via map-file which library to load for
layer, then load this library on demand and cache it for later use and
bind it to the running MapServer by layer’s virtual table.</p>
</section>
<section id="technical-solution">
<h2>Technical Solution<a class="headerlink" href="#technical-solution" title="Link to this heading">¶</a></h2>
<ul>
<li><p>New <cite>CONFIG</cite> option <cite>MS_PLUGIN_DIR</cite> which, if set, tells the base
path for plugins</p></li>
<li><p>New MAP-file keyword <cite>PLUGIN</cite> with string argument.  This
keywords tells which library dynamically to load for this layer.</p>
<p>The plugins are loaded based on the following algorithm:</p>
<ul class="simple">
<li><p>If plugin string is missing <cite>.so</cite> or <cite>.dll</cite> extension, append
it to the plugin string</p></li>
<li><p>If <cite>MS_PLUGIN_DIR</cite> is set and plugin string is not an absolute
path, prefix plugin string with <cite>MS_PLUGIN_DIR</cite></p></li>
<li><p>otherwise use plugin string directly</p></li>
</ul>
<p>In general, the dynamic library loader will use system paths to seek
appropriate plugin to load, if the path is not absolute.</p>
</li>
<li><p>New connection type <cite>PLUGIN</cite></p></li>
<li><p>New field <cite>char* plugin_library</cite> in layerObj structure, this is
the name of library to load for this layer.</p></li>
<li><p>Function to get virtual table for requested layer. If the library
isn’t already loaded, it will be loaded  on demand.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">static</span> <span class="n">const</span> <span class="n">layerVTableObj</span> <span class="o">*</span>
<span class="n">getCustomLayerVirtualTable</span><span class="p">(</span><span class="n">layerObj</span> <span class="o">*</span><span class="n">layer</span><span class="p">)</span>
</pre></div>
</div>
<p>where <cite>layerVTableObj</cite> is the virtual table and layer is a custom
layer. In case of error, function will return <cite>NULL</cite>.</p>
</li>
<li><p>Function to get a function pointer from dynamic loaded library. This
function will also load the library.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">msGetDynamicLibrarySymbol</span><span class="p">(</span><span class="n">const</span> <span class="n">char</span> <span class="o">*</span><span class="n">Library</span><span class="p">,</span>
                          <span class="n">const</span> <span class="n">char</span> <span class="o">*</span><span class="n">SymbolName</span><span class="p">)</span>
</pre></div>
</div>
<p>This is implemented by GDAL project, and I have planned to use their
implementation of this (<cite>CPLGetSymbol</cite>).</p>
</li>
<li><p>Cache structure for already loaded libraries. This cache structure
will consist of a full name/path of the library (provided by user
via mapfile), and a function pointer to the virtual table
initialization function. The size of cache will be fixed and will be
same as the maximum amount of layers (200 at the moment).  This is
the maximum number of different custom layers for MapServer which
could be loaded at the same time.  This cache implementation is
internal, so if it has to be make dynamically allocated, it is
possible to do later without breaking interface.</p></li>
<li><p>New lock item (<cite>TLOCK_LAYER_VTABLE</cite>) to protect library cache structure.</p></li>
</ul>
</section>
<section id="files-and-objects-affected">
<h2>Files and objects affected<a class="headerlink" href="#files-and-objects-affected" title="Link to this heading">¶</a></h2>
<p>This proposal will affect at least following files and objects:</p>
<ul class="simple">
<li><p><cite>map.h</cite></p>
<ul>
<li><p><cite>layerObj</cite> will contain a new field, <cite>char *plugin_library</cite>.</p></li>
</ul>
</li>
<li><p>New lock token <cite>TLOCK_LAYER_VTABLE</cite></p></li>
<li><p>New files and objects for custom layer handling.</p></li>
</ul>
</section>
<section id="backwards-compatibility-issues">
<h2>Backwards compatibility issues<a class="headerlink" href="#backwards-compatibility-issues" title="Link to this heading">¶</a></h2>
<p>This change is binary incompatible, but mapfile backward
compatible.  It will add a new keyword which is unknown for old
MapServers.</p>
</section>
<section id="implementation-issues">
<h2>Implementation Issues<a class="headerlink" href="#implementation-issues" title="Link to this heading">¶</a></h2>
<p>None</p>
</section>
<section id="bug-id">
<h2>Bug ID<a class="headerlink" href="#bug-id" title="Link to this heading">¶</a></h2>
<p>Bug <a class="reference external" href="https://github.com/MapServer/MapServer/issues/1477">1477</a></p>
</section>
<section id="voting-history">
<h2>Voting history<a class="headerlink" href="#voting-history" title="Link to this heading">¶</a></h2>
<p>Vote proposed by Jani Averbach on 10/26/2005, the initial result
was +3 and after amending RFC, got +4 (3 non-voting members).</p>
<p>Voting +1: Frank Warmerdam, Steve Lime, Yewondwossen Assefa, Daniel Morissette</p>
<p>Proposal passed and will move forward.</p>
</section>
<section id="open-questions">
<h2>Open questions<a class="headerlink" href="#open-questions" title="Link to this heading">¶</a></h2>
<p>None</p>
</section>
<section id="working-notes">
<h2>Working Notes<a class="headerlink" href="#working-notes" title="Link to this heading">¶</a></h2>
<p>Plugin library has to implement function
<cite>PluginInitializeVirtualTable</cite></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="p">(</span><span class="o">*</span><span class="n">pfnPluginInitVTable</span><span class="p">)(</span><span class="n">layerVTableObj</span> <span class="o">*</span><span class="p">,</span>
                           <span class="n">layerObj</span> <span class="o">*</span><span class="p">);</span>
</pre></div>
</div>
<p>which is called during library loading.  This function is responsible
to populate <cite>layerVTableObj *</cite> virtual table.  If this function
leaves some function pointers to <cite>NULL</cite> in this virtual table, then
default actions are used for these missing functions.  The defaults
are visible in function <cite>maplayer.c: populateVirtualTable(…)</cite>.
The function must not populate directly <cite>layerObj-&gt;vtable</cite>, it have
to use <cite>layerVTableObj *</cite> argument for this.  The MapServer is
holding <cite>TLOCK_LAYER_VTABLE</cite> lock during this function call.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p>
<a href="../../about.html" title="About">About</a><br>
<a href="../../products.html" title="Products">Products</a><br>
<a href="../../community/index.html" title="Community">Community</a><br>
<a href="../index.html" title="Development">Development</a><br>
<a href="../../download.html" title="Downloads">Downloads</a><br>
<a href="../../documentation.html" title="Documentation">Documentation</a><br>
<a href="../../faq.html" title="FAQ">FAQ</a><br>
<a href="../../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</h3>
  <ul>
<li><a class="reference internal" href="#">MS RFC 8: Pluggable External Feature Layer Providers</a><ul>
<li><a class="reference internal" href="#purpose">Purpose</a></li>
<li><a class="reference internal" href="#abstract-solution">Abstract Solution</a></li>
<li><a class="reference internal" href="#technical-solution">Technical Solution</a></li>
<li><a class="reference internal" href="#files-and-objects-affected">Files and objects affected</a></li>
<li><a class="reference internal" href="#backwards-compatibility-issues">Backwards compatibility issues</a></li>
<li><a class="reference internal" href="#implementation-issues">Implementation Issues</a></li>
<li><a class="reference internal" href="#bug-id">Bug ID</a></li>
<li><a class="reference internal" href="#voting-history">Voting history</a></li>
<li><a class="reference internal" href="#open-questions">Open questions</a></li>
<li><a class="reference internal" href="#working-notes">Working Notes</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ms-rfc-9.html" title="MS RFC 9: Item tag for query templates"
             >next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-7.2.html" title="MS RFC 7.2: MapServer Git Push Management"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 8: Pluggable External Feature Layer Providers</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; <a href="../../copyright.html">Copyright</a> 2023, Open Source Geospatial Foundation.
      Last updated on 2023-12-22.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.5.
    </div>
  </body>
</html>