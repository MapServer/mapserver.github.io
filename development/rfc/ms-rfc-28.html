<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>MS RFC 28: Redesign of LOG/DEBUG output mechanisms &#8212; MapServer 8.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx.css?v=6c7b17ac" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=dd298242" />
    <link rel="stylesheet" type="text/css" href="../../_static/ribbon.css?v=ea091bf4" />
    
    <script src="../../_static/documentation_options.js?v=521b6f53"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="icon" href="../../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="MS RFC 29: Dynamic Charting Capability" href="ms-rfc-29.html" />
    <link rel="prev" title="MS RFC 27: Label Priority" href="ms-rfc-27.html" /> 
  </head><body>


<!-- for main branch only, do not backport this -->

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../../index.html" title="Home"><img src="../../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../../index.html" title="Home">Home</a> |
      <a href="../../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter" target="_blank">Twitter</a> |
      <a href="../../download.html" title="Download Source or Binaries">Download </a> |
      <a class="badge" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=KRJ2X44N3HA6U&source=url" target="_blank">
        <img src="https://img.shields.io/badge/donate-%E2%9D%A4%C2%A0-ff69b4.svg?style=flat" alt="Donate to MapServer">
      </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../../ar/development/rfc/ms-rfc-28.html"><img src="../../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../../de/development/rfc/ms-rfc-28.html"><img src="../../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../../el/development/rfc/ms-rfc-28.html"><img src="../../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../../es/development/rfc/ms-rfc-28.html"><img src="../../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../../fr/development/rfc/ms-rfc-28.html"><img src="../../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../../id/development/rfc/ms-rfc-28.html"><img src="../../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../../it/development/rfc/ms-rfc-28.html"><img src="../../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../../ja/development/rfc/ms-rfc-28.html"><img src="../../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../../nl_NL/development/rfc/ms-rfc-28.html"><img src="../../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../../pl/development/rfc/ms-rfc-28.html"><img src="../../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../../ru/development/rfc/ms-rfc-28.html"><img src="../../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../../sq/development/rfc/ms-rfc-28.html"><img src="../../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../../tr/development/rfc/ms-rfc-28.html"><img src="../../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ms-rfc-29.html" title="MS RFC 29: Dynamic Charting Capability"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-27.html" title="MS RFC 27: Label Priority"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 28: Redesign of LOG/DEBUG output mechanisms</a></li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="ms-rfc-28-redesign-of-log-debug-output-mechanisms">
<span id="rfc28"></span><h1>MS RFC 28: Redesign of LOG/DEBUG output mechanisms<a class="headerlink" href="#ms-rfc-28-redesign-of-log-debug-output-mechanisms" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Date<span class="colon">:</span></dt>
<dd class="field-odd"><p>2007-06-14</p>
</dd>
<dt class="field-even">Author<span class="colon">:</span></dt>
<dd class="field-even"><p>Daniel Morissette</p>
</dd>
<dt class="field-odd">Contact<span class="colon">:</span></dt>
<dd class="field-odd"><p>dmorissette at mapgears.com</p>
</dd>
<dt class="field-even">Last Edited<span class="colon">:</span></dt>
<dd class="field-even"><p>2007-08-24</p>
</dd>
<dt class="field-odd">Status<span class="colon">:</span></dt>
<dd class="field-odd"><p>Adopted (2007-06-29) - Implementation completed (2007/07/06)</p>
</dd>
<dt class="field-even">Version<span class="colon">:</span></dt>
<dd class="field-even"><p>MapServer 5.0</p>
</dd>
</dl>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p>MapServer 4.10 and older used to have multiple LOG/DEBUG output mechanisms
that did not play well together. In order to improve the usability of the
software this RFC proposes a new LOG/DEBUG output mechanism with more
control on the output location (logfile or stderr) and that works under
all supported web servers.</p>
</section>
<section id="inventory-of-existing-mechanisms">
<h2>Inventory of existing mechanisms<a class="headerlink" href="#inventory-of-existing-mechanisms" title="Link to this heading">¶</a></h2>
<p>MapServer 4.10 and older support the following LOG/DEBUG systems:</p>
<ul>
<li><p>LOG [filename] in the WEB object:</p>
<p>From the documentation: “File to log MapServer activity in. Must be writable
by the user the web server is running as.”</p>
<p>More specifically, the function writeLog() in mapserv.c logs information
about the mapserv CGI request results at the end of its execution.
This option has no effect with MapScript.</p>
</li>
<li><p>MS_ERRORFILE environment variable:</p>
<p>If set then all calls to msSetError() are logged to this file.</p>
</li>
<li><p>msDebug() with DEBUG ON/OFF at the MAP and LAYER level:</p>
<p>There are msDebug() calls in various areas of the code that generate
information that may be useful in tuning and troubleshooting apps.
The DEBUG ON/OFF statements in the MAP and LAYER objects are used to
enable/disable the msDebug() calls. The msDebug() mechanism is also disabled
by default and enabled only by the -DENABLE_STDERR_DEBUG compile-time option.
Users could benefit from easier access to this and more debug information.</p>
<p>The output of msDebug() is sent to stderr and cannot be redirected.
In addition to not being very flexible, this is a problem under IIS
where stderr output goes to stdout and the msDebug() output corrupt
MapServer’s output.</p>
</li>
</ul>
</section>
<section id="questions">
<h2>Questions<a class="headerlink" href="#questions" title="Link to this heading">¶</a></h2>
<ul>
<li><p>Q: Is the mapserv-specific LOG option really used by anyone? Do we need to
maintain it, should we get rid of it, or perhaps extend it? At a minimum
this option should be better documented to avoid confusion with the other
mechanisms described in this RFC.</p>
<p>A: The LOG option will be left untouched by this RFC.</p>
</li>
</ul>
</section>
<section id="technical-solution">
<h2>Technical Solution<a class="headerlink" href="#technical-solution" title="Link to this heading">¶</a></h2>
<p>We will essentially merge the MS_ERRORFILE and DEBUG/msDebug() mechanisms.
The variable MS_ERRORFILE will specify the location of the output, with
possible values being either a file path on disk, or one of “stderr” or
“stdout”.</p>
<p>The current DEBUG ON/OFF mechanism that controls msDebug() output will
also be extended to support multiple DEBUG levels.</p>
<p>In order to keep the implementation relatively simple and efficient, the
output file handle will be kept open with a reference to it in a global
variable in the context of the current request and will be closed only in
msCleanup(). This means that if two mapfiles are loaded
in the same request with different MS_ERRORFILE settings then errors/debug
statements for both will go to the same file (and the output file will change
when the second mapfile is read).</p>
<p>Note: the output file handle will be global in the context of the current
request only and not global across threads, this will be done using the same
mechanism currently used by msGetErrorObj() in maperror.c.</p>
</section>
<section id="setting-ms-errorfile">
<h2>Setting MS_ERRORFILE<a class="headerlink" href="#setting-ms-errorfile" title="Link to this heading">¶</a></h2>
<p>The variable MS_ERRORFILE will specify the location of the output, with
possible values being either a file path on disk, or one of the following
special values:</p>
<ul class="simple">
<li><p>“stderr” to send output to standard error. Under Apache stderr is the Apache
error_log file. Under IIS stderr goes to stdout so its use is discouraged.
With IIS it is recommended to direct output to a file on disk instead.</p></li>
<li><p>“stdout” to send output to standard output, combined with the rest of
MapServer’s output</p></li>
<li><p>“windowsdebug” to send output to the Windows OutputDebugString API, allowing
the use of external programs like SysInternals debugview to display the
debug output.</p></li>
</ul>
<p>It will be possible to specify MS_ERRORFILE either as an environment variable
or via a CONFIG directive inside a mapfile:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CONFIG</span>  <span class="s2">&quot;MS_ERRORFILE&quot;</span> <span class="s2">&quot;/tmp/mapserver.log&quot;</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CONFIG</span>  <span class="s2">&quot;MS_ERRORFILE&quot;</span> <span class="s2">&quot;stderr&quot;</span>
</pre></div>
</div>
<p>If both the MS_ERRORFILE environment variable is set and a CONFIG MS_ERRORFILE
is also set, then the CONFIG directive takes precedence.</p>
<p>If MS_ERRORFILE is not set then error/debug logging is disabled. During
parsing of a mapfile, error/debug logging may become available only <em>after</em>
the MS_ERRORFILE directive has been parsed.</p>
</section>
<section id="debug-levels">
<h2>DEBUG levels<a class="headerlink" href="#debug-levels" title="Link to this heading">¶</a></h2>
<p>The current DEBUG ON/OFF mechanism, at the layer and map level will be
extended to support multiple debug levels as follows. The default is
DEBUG OFF (Level 0):</p>
<ul>
<li><p>Level 0: Errors only (DEBUG OFF, or DEBUG 0)</p>
<p>In level 0, only msSetError() calls are logged to
MS_ERORFILE. No msDebug() output at all. This is the default and
corresponds to the original behavior of MS_ERRORFILE in MapServer 4.x</p>
</li>
<li><p>Level 1: Errors and Notices (DEBUG ON, or DEBUG 1)</p>
<p>Level 1 includes all output from Level 0 plus msDebug() warnings
about common pitfalls, failed assertions or non-fatal error situations
(e.g. missing or invalid values for some parameters, missing shapefiles
in tileindex, timeout error from remote WMS/WFS servers, etc.)</p>
</li>
<li><p>Level 2: Map Tuning (DEBUG 2)</p>
<p>Level 2 includes all output from Level 1 plus notices and timing information
useful for tuning mapfiles and applications</p>
</li>
<li><p>Level 3: Verbose Debug (DEBUG 3)</p>
<p>All of Level 2 plus some debug output useful in troubleshooting problems
such as WMS connection URLs being called, database connection calls, etc.</p>
</li>
<li><p>Level 4: Very Verbose Debug (DEBUG 4)</p>
<p>Level 3 plus even more details…</p>
</li>
<li><p>Level 5: Very Very Verbose Debug (DEBUG 5)</p>
<p>Level 4 plus any msDebug() output that might be more useful to
the developers than to the users.</p>
</li>
</ul>
</section>
<section id="the-ms-debuglevel-environment-variable">
<h2>The MS_DEBUGLEVEL environment variable<a class="headerlink" href="#the-ms-debuglevel-environment-variable" title="Link to this heading">¶</a></h2>
<p>Debug level can also be set using the (optional) MS_DEBUGLEVEL environment
variable.</p>
<p>When set, this value is used as the default debug level value for all map and
layer objects as they are loaded by the mapfile parser. This option also sets
the debug level for any msDebug() call located outside of the context of a map
or layer object, for instance for debug statements relating to initialization
before a map is loaded.  If a DEBUG value is also specified in the mapfile in
some map or layer objects then the local value (in the mapfile) takes
precedence over the value of the environment variable.</p>
<p>This option is mostly useful when tuning applications by enabling timing/debug
output before the map is loaded, to capture the full process initialization
and map loading time, for instance.</p>
</section>
<section id="mapscript-implications">
<h2>MapScript Implications<a class="headerlink" href="#mapscript-implications" title="Link to this heading">¶</a></h2>
<p>No direct implication. Setting MS_ERRORFILE will enable debug output in
MapScript as well.</p>
<p>Note that output to stderr or stdout may not work as expected in some
scripting environments and we do not plan to make any special efforts to
support those special cases as part of this RFC. However, logging to a file
on disk will work with all MapScript flavours.</p>
</section>
<section id="files-affected">
<h2>Files affected<a class="headerlink" href="#files-affected" title="Link to this heading">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">map</span><span class="o">.</span><span class="n">h</span>
<span class="n">mapfile</span><span class="o">.</span><span class="n">c</span>
<span class="n">maperror</span><span class="o">.</span><span class="n">c</span>
</pre></div>
</div>
<p>Several source files with msDebug() calls in them may also need to be
edited to adjust the debug level at which the various msDebug() calls kick in.</p>
</section>
<section id="backwards-compatibility-issues">
<h2>Backwards compatibility issues<a class="headerlink" href="#backwards-compatibility-issues" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>The MapServer 4.x and older MS_ERRORFILE continues to work as before by
default</p></li>
<li><p>The DEBUG ON/OFF mechanism continues to work as before. However some
msDebug() output from previous versions of MapServer may require a higher
debug level in order to be enabled.</p></li>
</ul>
</section>
<section id="bug-id">
<h2>Bug ID<a class="headerlink" href="#bug-id" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>709: <a class="reference external" href="https://github.com/MapServer/MapServer/issues/709">https://github.com/MapServer/MapServer/issues/709</a></p></li>
<li><p>1333: <a class="reference external" href="https://github.com/MapServer/MapServer/issues/1333">https://github.com/MapServer/MapServer/issues/1333</a></p></li>
<li><p>1783: <a class="reference external" href="https://github.com/MapServer/MapServer/issues/1783">https://github.com/MapServer/MapServer/issues/1783</a></p></li>
<li><p>2124: <a class="reference external" href="https://github.com/MapServer/MapServer/issues/2124">https://github.com/MapServer/MapServer/issues/2124</a></p></li>
</ul>
</section>
<section id="voting-history">
<h2>Voting history<a class="headerlink" href="#voting-history" title="Link to this heading">¶</a></h2>
<p>Vote completed on 2007-06-29:</p>
<p>+1 from DanielM, TomK, FrankW, TamasS, JeffM, SteveL and AssefaY.</p>
</section>
<section id="questions-comments-from-the-review-period">
<h2>Questions/Comments from the review period<a class="headerlink" href="#questions-comments-from-the-review-period" title="Link to this heading">¶</a></h2>
<ul>
<li><p>Q: Can we catch the output of OGR/GDAL’s CPLDebug calls, perhaps when
the map-level debug level is &gt;= 3?</p>
<p>A: Frank suggests that we keep this for a later phase.</p>
</li>
</ul>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p>
<a href="../../about.html" title="About">About</a><br>
<a href="../../products.html" title="Products">Products</a><br>
<a href="../../community/index.html" title="Community">Community</a><br>
<a href="../index.html" title="Development">Development</a><br>
<a href="../../download.html" title="Downloads">Downloads</a><br>
<a href="../../documentation.html" title="Documentation">Documentation</a><br>
<a href="../../faq.html" title="FAQ">FAQ</a><br>
<a href="../../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</h3>
  <ul>
<li><a class="reference internal" href="#">MS RFC 28: Redesign of LOG/DEBUG output mechanisms</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#inventory-of-existing-mechanisms">Inventory of existing mechanisms</a></li>
<li><a class="reference internal" href="#questions">Questions</a></li>
<li><a class="reference internal" href="#technical-solution">Technical Solution</a></li>
<li><a class="reference internal" href="#setting-ms-errorfile">Setting MS_ERRORFILE</a></li>
<li><a class="reference internal" href="#debug-levels">DEBUG levels</a></li>
<li><a class="reference internal" href="#the-ms-debuglevel-environment-variable">The MS_DEBUGLEVEL environment variable</a></li>
<li><a class="reference internal" href="#mapscript-implications">MapScript Implications</a></li>
<li><a class="reference internal" href="#files-affected">Files affected</a></li>
<li><a class="reference internal" href="#backwards-compatibility-issues">Backwards compatibility issues</a></li>
<li><a class="reference internal" href="#bug-id">Bug ID</a></li>
<li><a class="reference internal" href="#voting-history">Voting history</a></li>
<li><a class="reference internal" href="#questions-comments-from-the-review-period">Questions/Comments from the review period</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ms-rfc-29.html" title="MS RFC 29: Dynamic Charting Capability"
             >next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-27.html" title="MS RFC 27: Label Priority"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 28: Redesign of LOG/DEBUG output mechanisms</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; <a href="../../copyright.html">Copyright</a> 2023, Open Source Geospatial Foundation.
      Last updated on 2023-12-22.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.5.
    </div>
  </body>
</html>