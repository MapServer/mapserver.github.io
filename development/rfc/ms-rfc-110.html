<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>MS RFC 110: MapCache REST Cache Backends &#8212; MapServer 8.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx.css?v=6c7b17ac" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=dd298242" />
    <link rel="stylesheet" type="text/css" href="../../_static/ribbon.css?v=ea091bf4" />
    
    <script src="../../_static/documentation_options.js?v=521b6f53"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="icon" href="../../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="MS RFC 111: MapCache Support for animated time series" href="ms-rfc-111.html" />
    <link rel="prev" title="MS RFC 109: Optimizing Runtime Substitutions" href="ms-rfc-109.html" /> 
  </head><body>


<!-- for main branch only, do not backport this -->

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../../index.html" title="Home"><img src="../../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../../index.html" title="Home">Home</a> |
      <a href="../../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter" target="_blank">Twitter</a> |
      <a href="../../download.html" title="Download Source or Binaries">Download </a> |
      <a class="badge" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=KRJ2X44N3HA6U&source=url" target="_blank">
        <img src="https://img.shields.io/badge/donate-%E2%9D%A4%C2%A0-ff69b4.svg?style=flat" alt="Donate to MapServer">
      </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../../ar/development/rfc/ms-rfc-110.html"><img src="../../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../../de/development/rfc/ms-rfc-110.html"><img src="../../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../../el/development/rfc/ms-rfc-110.html"><img src="../../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../../es/development/rfc/ms-rfc-110.html"><img src="../../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../../fr/development/rfc/ms-rfc-110.html"><img src="../../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../../id/development/rfc/ms-rfc-110.html"><img src="../../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../../it/development/rfc/ms-rfc-110.html"><img src="../../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../../ja/development/rfc/ms-rfc-110.html"><img src="../../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../../nl_NL/development/rfc/ms-rfc-110.html"><img src="../../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../../pl/development/rfc/ms-rfc-110.html"><img src="../../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../../ru/development/rfc/ms-rfc-110.html"><img src="../../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../../sq/development/rfc/ms-rfc-110.html"><img src="../../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../../tr/development/rfc/ms-rfc-110.html"><img src="../../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ms-rfc-111.html" title="MS RFC 111: MapCache Support for animated time series"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-109.html" title="MS RFC 109: Optimizing Runtime Substitutions"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 110: MapCache REST Cache Backends</a></li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="ms-rfc-110-mapcache-rest-cache-backends">
<span id="rfc110"></span><h1>MS RFC 110: MapCache REST Cache Backends<a class="headerlink" href="#ms-rfc-110-mapcache-rest-cache-backends" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Date<span class="colon">:</span></dt>
<dd class="field-odd"><p>2014/04</p>
</dd>
<dt class="field-even">Author<span class="colon">:</span></dt>
<dd class="field-even"><p>Thomas Bonfort</p>
</dd>
<dt class="field-odd">Contact<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="mailto:tbonfort&#37;&#52;&#48;terriscope&#46;fr">tbonfort<span>&#64;</span>terriscope<span>&#46;</span>fr</a></p>
</dd>
<dt class="field-even">Status<span class="colon">:</span></dt>
<dd class="field-even"><p>Draft</p>
</dd>
<dt class="field-odd">Version<span class="colon">:</span></dt>
<dd class="field-odd"><p>MapServer 7.0</p>
</dd>
<dt class="field-even">Last Updated<span class="colon">:</span></dt>
<dd class="field-even"><p>2014/04/17</p>
</dd>
</dl>
<section id="motivation">
<h2>1. Motivation<a class="headerlink" href="#motivation" title="Link to this heading">¶</a></h2>
<p>In addition to the supported cache backends, it is desirable for mapcache to
be able to store and retrieve tiles through a HTTP REST interface, using the
GET, PUT and DELETE verbs. While any webdav enabled server could be used, the
final aim for this improvement is to be able to store tiles to well known cloud
storage providers (initially: S3, Azure and Google).</p>
</section>
<section id="implementation-details">
<h2>2. Implementation details<a class="headerlink" href="#implementation-details" title="Link to this heading">¶</a></h2>
<section id="generic-rest-backends">
<h3>2.2 Generic REST backends<a class="headerlink" href="#generic-rest-backends" title="Link to this heading">¶</a></h3>
<p>Adding a cache backend has no architectural impacts, as it implies only adding
the cache specific vtable functions. The REST caches themselves are rather
specific, as there’s usually an authentication/authorization step that is
specific to each provider, and usually consists in signing the given payload
with a secret key attached to an account.</p>
<p>A rest cache is configured with an xml block:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">cache</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;myrestcache&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;rest&quot;</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">url</span><span class="o">&gt;</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">myserver</span><span class="o">/</span><span class="n">webdav</span><span class="o">/</span><span class="p">{</span><span class="n">tileset</span><span class="p">}</span><span class="o">/</span><span class="p">{</span><span class="n">grid</span><span class="p">}</span><span class="o">/</span><span class="p">{</span><span class="n">z</span><span class="p">}</span><span class="o">/</span><span class="p">{</span><span class="n">x</span><span class="p">}</span><span class="o">/</span><span class="p">{</span><span class="n">y</span><span class="p">}</span><span class="o">.</span><span class="p">{</span><span class="n">ext</span><span class="p">}</span><span class="o">&lt;/</span><span class="n">url</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">headers</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">Host</span><span class="o">&gt;</span><span class="n">my</span><span class="o">-</span><span class="n">virtualhost</span><span class="o">-</span><span class="n">alias</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">com</span><span class="o">&lt;/</span><span class="n">Host</span><span class="o">&gt;</span>
   <span class="o">&lt;/</span><span class="n">headers</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">operation</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;put&quot;</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">headers</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="n">X</span><span class="o">-</span><span class="n">my</span><span class="o">-</span><span class="n">specific</span><span class="o">-</span><span class="n">put</span><span class="o">-</span><span class="n">header</span><span class="o">&gt;</span><span class="n">foo</span><span class="o">&lt;/</span><span class="n">X</span><span class="o">-</span><span class="n">my</span><span class="o">-</span><span class="n">specific</span><span class="o">-</span><span class="n">put</span><span class="o">-</span><span class="n">header</span><span class="o">&gt;</span>
     <span class="o">&lt;/</span><span class="n">headers</span><span class="o">&gt;</span>
   <span class="o">&lt;/</span><span class="n">operation</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">operation</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;get&quot;</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">headers</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="n">X</span><span class="o">-</span><span class="n">my</span><span class="o">-</span><span class="n">specific</span><span class="o">-</span><span class="n">get</span><span class="o">-</span><span class="n">header</span><span class="o">&gt;</span><span class="n">foo</span><span class="o">&lt;/</span><span class="n">X</span><span class="o">-</span><span class="n">my</span><span class="o">-</span><span class="n">specific</span><span class="o">-</span><span class="n">get</span><span class="o">-</span><span class="n">header</span><span class="o">&gt;</span>
     <span class="o">&lt;/</span><span class="n">headers</span><span class="o">&gt;</span>
   <span class="o">&lt;/</span><span class="n">operation</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">operation</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;head&quot;</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">headers</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="n">X</span><span class="o">-</span><span class="n">my</span><span class="o">-</span><span class="n">specific</span><span class="o">-</span><span class="n">head</span><span class="o">-</span><span class="n">header</span><span class="o">&gt;</span><span class="n">foo</span><span class="o">&lt;/</span><span class="n">X</span><span class="o">-</span><span class="n">my</span><span class="o">-</span><span class="n">specific</span><span class="o">-</span><span class="n">head</span><span class="o">-</span><span class="n">header</span><span class="o">&gt;</span>
     <span class="o">&lt;/</span><span class="n">headers</span><span class="o">&gt;</span>
   <span class="o">&lt;/</span><span class="n">operation</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">operation</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;delete&quot;</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">headers</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="n">X</span><span class="o">-</span><span class="n">my</span><span class="o">-</span><span class="n">specific</span><span class="o">-</span><span class="n">delete</span><span class="o">-</span><span class="n">header</span><span class="o">&gt;</span><span class="n">foo</span><span class="o">&lt;/</span><span class="n">X</span><span class="o">-</span><span class="n">my</span><span class="o">-</span><span class="n">specific</span><span class="o">-</span><span class="n">delete</span><span class="o">-</span><span class="n">header</span><span class="o">&gt;</span>
     <span class="o">&lt;/</span><span class="n">headers</span><span class="o">&gt;</span>
   <span class="o">&lt;/</span><span class="n">operation</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">cache</span><span class="o">&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>The &lt;url&gt; block configures the template URL to use when addressing a specific tile,
and follows the same syntax used when defining a templated based disk backend.</p></li>
<li><p>The initial &lt;header&gt; block contains a list of HTTP headers that will be added to any
HTTP request going to the third party server</p></li>
<li><p>Each &lt;operation&gt; block can also contain a &lt;header&gt; list of specific headers to be added
to the request for a particular operation, specified by it’s “type” attribute:</p>
<ul>
<li><p>“get” is used when requesting a tile from the server</p></li>
<li><p>“head” is used when querying the server for the existence of a tile (only used by the
seeder).</p></li>
<li><p>“put” is used when uploading a newly created tile</p></li>
<li><p>“delete” is used when deleting a tile from the server</p></li>
</ul>
</li>
</ul>
</section>
<section id="adding-support-for-well-known-cloud-services">
<h3>2.2 Adding Support for Well Known Cloud Services<a class="headerlink" href="#adding-support-for-well-known-cloud-services" title="Link to this heading">¶</a></h3>
<p>The REST cache backends become really useful once associated with a third party
cloud storage provider, to be able to store tiles in the cloud. Architecturally,
each vendor specific implementation in mapcache provides a hook that can add
specific headers to the HTTP request to allow for signing/authenticating the
request. To allow signing, specific code for calculating SHAs of a payload will
be added to mapcache.</p>
<section id="amazon-s3">
<h4>2.2.1 Amazon S3<a class="headerlink" href="#amazon-s3" title="Link to this heading">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">cache</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;s3&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;s3&quot;</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">url</span><span class="o">&gt;</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">mybucket</span><span class="o">.</span><span class="n">s3</span><span class="o">.</span><span class="n">amazonaws</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">tiles</span><span class="o">/</span><span class="p">{</span><span class="n">tileset</span><span class="p">}</span><span class="o">/</span><span class="p">{</span><span class="n">grid</span><span class="p">}</span><span class="o">/</span><span class="p">{</span><span class="n">z</span><span class="p">}</span><span class="o">/</span><span class="p">{</span><span class="n">x</span><span class="p">}</span><span class="o">/</span><span class="p">{</span><span class="n">y</span><span class="p">}</span><span class="o">.</span><span class="p">{</span><span class="n">ext</span><span class="p">}</span><span class="o">&lt;/</span><span class="n">url</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">headers</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">Host</span><span class="o">&gt;</span><span class="n">mybucket</span><span class="o">.</span><span class="n">s3</span><span class="o">.</span><span class="n">amazonaws</span><span class="o">.</span><span class="n">com</span><span class="o">&lt;/</span><span class="n">Host</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">headers</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nb">id</span><span class="o">&gt;</span><span class="n">XXXXXXXXXXXXXXX</span><span class="o">&lt;/</span><span class="nb">id</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">secret</span><span class="o">&gt;</span><span class="n">foobaregrwq1235234532</span><span class="o">/</span><span class="mi">3245234</span><span class="n">sadgfwevsd</span><span class="o">&lt;/</span><span class="n">secret</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">region</span><span class="o">&gt;</span><span class="n">eu</span><span class="o">-</span><span class="n">west</span><span class="o">-</span><span class="mi">1</span><span class="o">&lt;/</span><span class="n">region</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">operation</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;put&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">headers</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">x</span><span class="o">-</span><span class="n">amz</span><span class="o">-</span><span class="n">storage</span><span class="o">-</span><span class="n">class</span><span class="o">&gt;</span><span class="n">REDUCED_REDUNDANCY</span><span class="o">&lt;/</span><span class="n">x</span><span class="o">-</span><span class="n">amz</span><span class="o">-</span><span class="n">storage</span><span class="o">-</span><span class="n">class</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">x</span><span class="o">-</span><span class="n">amz</span><span class="o">-</span><span class="n">acl</span><span class="o">&gt;</span><span class="n">public</span><span class="o">-</span><span class="n">read</span><span class="o">&lt;/</span><span class="n">x</span><span class="o">-</span><span class="n">amz</span><span class="o">-</span><span class="n">acl</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">headers</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">operation</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">cache</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>This cache uses 3 mandatory configuration options: &lt;id&gt;,&lt;secret&gt;, and &lt;region&gt;. Values for
each are self-explanatory and can be found on the S3 documentation. In the previous example,
we add S3 specific headers to “put” requests, specifying we want publicly readable tiles, stored
in a less expensive backend. Other x-amz-* headers can be added once looked up from the S3 documentation
site.</p>
</section>
<section id="microsoft-azure">
<h4>2.2.2 Microsoft Azure<a class="headerlink" href="#microsoft-azure" title="Link to this heading">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">cache</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;azure&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;azure&quot;</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">url</span><span class="o">&gt;</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">mytiles</span><span class="o">.</span><span class="n">blob</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">net</span><span class="o">/</span><span class="n">tilestore</span><span class="o">/</span><span class="p">{</span><span class="n">tileset</span><span class="p">}</span><span class="o">/</span><span class="p">{</span><span class="n">grid</span><span class="p">}</span><span class="o">/</span><span class="p">{</span><span class="n">z</span><span class="p">}</span><span class="o">/</span><span class="p">{</span><span class="n">x</span><span class="p">}</span><span class="o">/</span><span class="p">{</span><span class="n">y</span><span class="p">}</span><span class="o">.</span><span class="p">{</span><span class="n">ext</span><span class="p">}</span><span class="o">&lt;/</span><span class="n">url</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">headers</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">Host</span><span class="o">&gt;</span><span class="n">mytiles</span><span class="o">.</span><span class="n">blob</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">net</span><span class="o">&lt;/</span><span class="n">Host</span><span class="o">&gt;</span>
   <span class="o">&lt;/</span><span class="n">headers</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="nb">id</span><span class="o">&gt;</span><span class="n">mytiles</span><span class="o">&lt;/</span><span class="nb">id</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">secret</span><span class="o">&gt;</span><span class="n">base64encodedsecretkey</span><span class="o">==&lt;/</span><span class="n">secret</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">container</span><span class="o">&gt;</span><span class="n">tilestore</span><span class="o">&lt;/</span><span class="n">container</span><span class="o">&gt;</span>
 <span class="o">&lt;/</span><span class="n">cache</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>This cache again has 3 configuration options: &lt;id&gt;, &lt;secret&gt; and &lt;container&gt;. There are no Azure
specific headers added to the previous example, as the redundancy and access rights are configured
for the container not each individual file in Azure.</p>
</section>
<section id="google-cloud-storage">
<h4>2.2.3 Google Cloud Storage<a class="headerlink" href="#google-cloud-storage" title="Link to this heading">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">cache</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;google&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;google&quot;</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">url</span><span class="o">&gt;</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">storage</span><span class="o">.</span><span class="n">googleapis</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">mytiles</span><span class="o">-</span><span class="n">mapcache</span><span class="o">/</span><span class="p">{</span><span class="n">tileset</span><span class="p">}</span><span class="o">/</span><span class="p">{</span><span class="n">grid</span><span class="p">}</span><span class="o">/</span><span class="p">{</span><span class="n">z</span><span class="p">}</span><span class="o">/</span><span class="p">{</span><span class="n">x</span><span class="p">}</span><span class="o">/</span><span class="p">{</span><span class="n">y</span><span class="p">}</span><span class="o">.</span><span class="p">{</span><span class="n">ext</span><span class="p">}</span><span class="o">&lt;/</span><span class="n">url</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">access</span><span class="o">&gt;</span><span class="n">GOOGPGDWFDG345SDFGSD</span><span class="o">&lt;/</span><span class="n">access</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">secret</span><span class="o">&gt;</span><span class="n">sdfgsdSDFwedfwefr2345324dfsGdsfgs</span><span class="o">&lt;/</span><span class="n">secret</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">operation</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;put&quot;</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">headers</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="n">x</span><span class="o">-</span><span class="n">amz</span><span class="o">-</span><span class="n">acl</span><span class="o">&gt;</span><span class="n">public</span><span class="o">-</span><span class="n">read</span><span class="o">&lt;/</span><span class="n">x</span><span class="o">-</span><span class="n">amz</span><span class="o">-</span><span class="n">acl</span><span class="o">&gt;</span>
     <span class="o">&lt;/</span><span class="n">headers</span><span class="o">&gt;</span>
   <span class="o">&lt;/</span><span class="n">operation</span><span class="o">&gt;</span>
 <span class="o">&lt;/</span><span class="n">cache</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The google implementation uses google’s S3 compatibility layer (which in practice is different
than mapcache’s S3 implementation, as it uses a previous version of the authentication/signing
payloads). x-amz-* headers are therefore used to configure options for a given tile file.</p>
</section>
</section>
</section>
<section id="miscellaneous">
<h2>3. Miscellaneous<a class="headerlink" href="#miscellaneous" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>A rest &lt;cache&gt; entry can contain a &lt;use_redirects&gt;true&lt;/use_redirects&gt; entry to inform
mapcache that single tile requests can be returned as a HTTP 302 redirect directly to
the cloud url of the tile rather than being returned by mapcache. This would only typically
be used for fully-seeded caches, as in that case mapcache does not query the cache to know
if the tile is actually present or not.</p></li>
<li><p>MapCache opens an HTTP connection to the cloud storage per request. In practice this has
shown to be potentially slow with some providers, the bottleneck being the DNS lookup. To
mitigate this, you can either use an IP address directly in the &lt;url&gt; member, or install a
local DNS caching server (dnsmasq comes to mind). Further developments (awaiting funding) could
implement reusing HTTP connections across requests.</p></li>
</ul>
<section id="backwards-incompatibilities">
<h3>3.1 Backwards Incompatibilities<a class="headerlink" href="#backwards-incompatibilities" title="Link to this heading">¶</a></h3>
<p>none expected, new functionality</p>
</section>
<section id="issue-tracking-id">
<h3>3.2 Issue Tracking ID<a class="headerlink" href="#issue-tracking-id" title="Link to this heading">¶</a></h3>
<p><a class="reference external" href="https://github.com/MapServer/mapcache/pull/98">https://github.com/MapServer/mapcache/pull/98</a></p>
</section>
<section id="files-changed">
<h3>3.4 Files Changed<a class="headerlink" href="#files-changed" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>include/mapcache.h</p></li>
<li><p>lib/cache_rest.c (added)</p></li>
<li><p>lib/hmac-sha.c (added) - used to sign payloads for cloud providers</p></li>
<li><p>minor modifications to support “redirect” mode</p></li>
</ul>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p>
<a href="../../about.html" title="About">About</a><br>
<a href="../../products.html" title="Products">Products</a><br>
<a href="../../community/index.html" title="Community">Community</a><br>
<a href="../index.html" title="Development">Development</a><br>
<a href="../../download.html" title="Downloads">Downloads</a><br>
<a href="../../documentation.html" title="Documentation">Documentation</a><br>
<a href="../../faq.html" title="FAQ">FAQ</a><br>
<a href="../../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</h3>
  <ul>
<li><a class="reference internal" href="#">MS RFC 110: MapCache REST Cache Backends</a><ul>
<li><a class="reference internal" href="#motivation">1. Motivation</a></li>
<li><a class="reference internal" href="#implementation-details">2. Implementation details</a><ul>
<li><a class="reference internal" href="#generic-rest-backends">2.2 Generic REST backends</a></li>
<li><a class="reference internal" href="#adding-support-for-well-known-cloud-services">2.2 Adding Support for Well Known Cloud Services</a><ul>
<li><a class="reference internal" href="#amazon-s3">2.2.1 Amazon S3</a></li>
<li><a class="reference internal" href="#microsoft-azure">2.2.2 Microsoft Azure</a></li>
<li><a class="reference internal" href="#google-cloud-storage">2.2.3 Google Cloud Storage</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#miscellaneous">3. Miscellaneous</a><ul>
<li><a class="reference internal" href="#backwards-incompatibilities">3.1 Backwards Incompatibilities</a></li>
<li><a class="reference internal" href="#issue-tracking-id">3.2 Issue Tracking ID</a></li>
<li><a class="reference internal" href="#files-changed">3.4 Files Changed</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ms-rfc-111.html" title="MS RFC 111: MapCache Support for animated time series"
             >next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-109.html" title="MS RFC 109: Optimizing Runtime Substitutions"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 110: MapCache REST Cache Backends</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; <a href="../../copyright.html">Copyright</a> 2023, Open Source Geospatial Foundation.
      Last updated on 2023-12-22.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.5.
    </div>
  </body>
</html>