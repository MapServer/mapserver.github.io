<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>MS RFC 71: Integration of Mod-Geocache in the MapServer project &#8212; MapServer 8.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx.css?v=6c7b17ac" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=dd298242" />
    <link rel="stylesheet" type="text/css" href="../../_static/ribbon.css?v=ea091bf4" />
    
    <script src="../../_static/documentation_options.js?v=521b6f53"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="icon" href="../../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="MS RFC 72: Layer and Label-Level Geomtransforms" href="ms-rfc-72.html" />
    <link rel="prev" title="MS RFC 70: Integration of TinyOWS in MapServer project" href="ms-rfc-70.html" /> 
  </head><body>


<!-- for main branch only, do not backport this -->

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../../index.html" title="Home"><img src="../../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../../index.html" title="Home">Home</a> |
      <a href="../../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter" target="_blank">Twitter</a> |
      <a href="../../download.html" title="Download Source or Binaries">Download </a> |
      <a class="badge" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=KRJ2X44N3HA6U&source=url" target="_blank">
        <img src="https://img.shields.io/badge/donate-%E2%9D%A4%C2%A0-ff69b4.svg?style=flat" alt="Donate to MapServer">
      </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../../ar/development/rfc/ms-rfc-71.html"><img src="../../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../../de/development/rfc/ms-rfc-71.html"><img src="../../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../../el/development/rfc/ms-rfc-71.html"><img src="../../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../../es/development/rfc/ms-rfc-71.html"><img src="../../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../../fr/development/rfc/ms-rfc-71.html"><img src="../../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../../id/development/rfc/ms-rfc-71.html"><img src="../../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../../it/development/rfc/ms-rfc-71.html"><img src="../../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../../ja/development/rfc/ms-rfc-71.html"><img src="../../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../../nl_NL/development/rfc/ms-rfc-71.html"><img src="../../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../../pl/development/rfc/ms-rfc-71.html"><img src="../../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../../ru/development/rfc/ms-rfc-71.html"><img src="../../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../../sq/development/rfc/ms-rfc-71.html"><img src="../../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../../tr/development/rfc/ms-rfc-71.html"><img src="../../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ms-rfc-72.html" title="MS RFC 72: Layer and Label-Level Geomtransforms"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-70.html" title="MS RFC 70: Integration of TinyOWS in MapServer project"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 71: Integration of Mod-Geocache in the MapServer project</a></li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="ms-rfc-71-integration-of-mod-geocache-in-the-mapserver-project">
<span id="rfc71"></span><h1>MS RFC 71: Integration of Mod-Geocache in the MapServer project<a class="headerlink" href="#ms-rfc-71-integration-of-mod-geocache-in-the-mapserver-project" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Date<span class="colon">:</span></dt>
<dd class="field-odd"><p>2011/05/20</p>
</dd>
<dt class="field-even">Author<span class="colon">:</span></dt>
<dd class="field-even"><p>Thomas Bonfort</p>
</dd>
<dt class="field-odd">Contact<span class="colon">:</span></dt>
<dd class="field-odd"><p>tbonfort at terriscope dot fr</p>
</dd>
<dt class="field-even">Status<span class="colon">:</span></dt>
<dd class="field-even"><p>Adopted</p>
</dd>
<dt class="field-odd">Version<span class="colon">:</span></dt>
<dd class="field-odd"><p>MapServer 7.0</p>
</dd>
</dl>
<p>Description: This RFC proposes the integration of <a class="reference external" href="http://code.google.com/p/mod-geocache/">mod-geocache</a>
in the MapServer project.</p>
<section id="overview">
<h2>1. Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p><a class="reference external" href="http://code.google.com/p/mod-geocache/">Mod-Geocache</a> is a recent tile caching solution that
runs in front of a WMS server either as an apache module or as a fastCGI executable. It can
connect to any WMS compliant server, but given its source code language and the roots of its
core developpers, it would make sense to integrate it tightly with the mapserver project,
to ease configuration for end-users, and provide higher QA through a larger development team.</p>
</section>
<section id="the-need-for-a-tile-caching-solution">
<h2>1.1 The need for a tile caching solution<a class="headerlink" href="#the-need-for-a-tile-caching-solution" title="Link to this heading">¶</a></h2>
<p>The usage patterns of web mapping have evolved in the past years and is more and more based around
the pre-generation of image tiles rather than the direct creation of images from the source data.</p>
<p>Current solutions for serving map tiles include TileCache, MapProxy, and GeoWebCache, all of which
accomplish the task successfully but in a manner that does not integrate ideally with the MapServer
project:</p>
<blockquote>
<div><ul class="simple">
<li><p>They do not run native code, which incurs a minor performance overhead, and can be an inconvenience
in the context of high performance data dissemination</p></li>
<li><p>They do not share their configuration with the server they are proxying, as such requiring users
to duplicate configuration variables and metadata.</p></li>
<li><p>In the case of the python servers, they require an additional component to function (mod-python,
mod-wsgi, or fastcgi wrapper) that is cumbersome to configure on non-mainstream platforms. The GIL
is also a bottleneck for multi-threaded servers for the requests that require an access to native
code (notably related to image format encoding and decoding).</p></li>
<li><p>NIH ;) and as it can be written in C, why not use that directly?</p></li>
</ul>
</div></blockquote>
</section>
<section id="the-mod-geocache-project">
<h2>1.2 The mod-geocache project<a class="headerlink" href="#the-mod-geocache-project" title="Link to this heading">¶</a></h2>
<p>Mod-geocache is a recent project (oct 2010), distributed under an apache license. It is written in
plain C using a semi object-oriented architecture (heavy use of structure inheritance and function
pointers). Being primarily aimed at being run as an apache module, it is very fast as it runs as native
code inside the process treating the http requests (there is no overhead in cgi process creation or
fastcgi ipc).</p>
<p>Its list of features include:</p>
<blockquote>
<div><ul class="simple">
<li><p>services WMS, WMTS, TMS, VirtualEarth/Bing and GoogleMaps requests</p></li>
<li><p>ability to respond to untiled WMS requests by merging tiles from the cache or forwarding
them to the wms source</p></li>
<li><p>responds to WMS/WMTS GetFeatureInfo requests (forwarded to source service)</p></li>
<li><p>KML superoverlay generation</p></li>
<li><p>data provided by WMS backends (GDAL supported sources planned)</p></li>
<li><p>experimental memcached cache</p></li>
<li><p>configurable metatiling, with inter-process/inter-thread locking and synchronization
to avoid overloading the source wms when the tiles are not seeded yet.</p></li>
<li><p>on-the-fly tile merging for combining multiple tiles into a single image</p></li>
<li><p>image post-processing (recompression and quantization) when arriving from a backend</p></li>
<li><p>interprets and produces cache control headers: Last-Modified, If-Modified-Since, Expires</p></li>
<li><p>multithreaded seeding utility</p></li>
<li><p>ability to add a custom watermark on stored tiles</p></li>
<li><p>can produce a fastCGI executable for using with other webservers than apache</p></li>
<li><p>configurable symbolic linking of blank tiles to gain disk storage</p></li>
<li><p>configurable error reporting: plain http error code, textual message, or empty (blank) image</p></li>
<li><p>ability to specify vendor params or dimensions to be forwarded to the WMS backend
(and build a cache that takes these parameters into account)</p></li>
<li><p>rule-based proxying of non-tile requests to (an)other server(s), e.g. for WFS, WFS-T, etc…</p></li>
</ul>
</div></blockquote>
</section>
<section id="integration-overview">
<h2>1.3 Integration Overview<a class="headerlink" href="#integration-overview" title="Link to this heading">¶</a></h2>
<p>Mod-geocache will be modified to read its configuration from a supplied mapfile rather than its own
xml file as is now. When used in conjunction with mapserver and tinyOWS, it will act as a proxy to
these servers: if an incoming request corresponds to soemthing that can be served from cache it will
act as a classic tile server, if not it will proxy the request to mapserver or tinyows (or any other
OGC compliant server).</p>
</section>
<section id="governance">
<h2>2. Governance<a class="headerlink" href="#governance" title="Link to this heading">¶</a></h2>
</section>
<section id="finding-a-name">
<h2>2.1 Finding a Name<a class="headerlink" href="#finding-a-name" title="Link to this heading">¶</a></h2>
<p>“Mod-Geocache” as a name is a poor choice, and should be changed during the integration with MapServer.
The author has no predefined idea as to what the solution should be named, ideas will be greatly
appreciated.</p>
</section>
<section id="release-cycles">
<h2>2.2 Release Cycles<a class="headerlink" href="#release-cycles" title="Link to this heading">¶</a></h2>
<p>Mod-geocache being a recent project, it is undergoing development at a pace that is incompatible
with the MapServer release cycle. As such, the release cycle of mod-geocache will be at first
decoupled from the mapserver one: mod-geocache releases will be produced any time there is a mapserver
release, but also at a faster rate if needed.</p>
</section>
<section id="source-code-location">
<h2>2.3 Source Code Location<a class="headerlink" href="#source-code-location" title="Link to this heading">¶</a></h2>
<p>The mod-geocache code will be located in a subdirectory of the mapserver repository, e.g.
trunk/mapserver/mod-geocache</p>
</section>
<section id="rfcs-and-decision-process">
<h2>2.4 RFCs and Decision Process<a class="headerlink" href="#rfcs-and-decision-process" title="Link to this heading">¶</a></h2>
<p>In the early steps of the integration, development surrounding the core of mod-geocache unrelated to
the MapServer project will be undertaken in a relaxed manner compared to the RFC based decision taking
that prevails for MapServer.</p>
<p>All non trivial changes to the mod-geocache core will be announced for discussion on the mapserver-dev
mailing list, but will not undergo the rfc voting process unless there is a direct interaction with the
actual mapserver functionality.</p>
<p>Once the transitionning phase of the integration has been completed, the development on mod-geocache
will follow the traditional RFC based decision taking.</p>
</section>
<section id="licence">
<h2>2.5 Licence<a class="headerlink" href="#licence" title="Link to this heading">¶</a></h2>
<p>The apache licence of mod-geocache will be switched to the same licence as MapServer.</p>
</section>
<section id="tickets">
<h2>2.6 Tickets<a class="headerlink" href="#tickets" title="Link to this heading">¶</a></h2>
<p>Mod-geocache is hosted on google-code and uses its integrated  issue tracking system. The MapServer
trac instance will be used, once a dedicated component for mod-geocache has been created.</p>
<p>There are currently no open bugs to transition to the MapServer trac. The open feature enhancements
will be manually migrated to the MapServer trac instance.</p>
</section>
<section id="svn-import">
<h2>2.7 SVN Import<a class="headerlink" href="#svn-import" title="Link to this heading">¶</a></h2>
<p>Mod-geocache trunk will be imported in MapServer SVN.</p>
<p>Previous commit history will be kept on the old google-code SVN, for a while.</p>
</section>
<section id="a-common-mapfile-as-config-file">
<h2>3 A common MapFile as config file<a class="headerlink" href="#a-common-mapfile-as-config-file" title="Link to this heading">¶</a></h2>
</section>
<section id="libmapfile-api">
<h2>3.1 LibMapfile API<a class="headerlink" href="#libmapfile-api" title="Link to this heading">¶</a></h2>
<p>A LibMapFile API will be created out of the mapserver source tree, and will require some refactoring
of header and source files. The MapServer API itself should not be changed as the refactoring will mostly
concern moving some functions and declarations out into separate files.</p>
</section>
<section id="configuration-directives">
<h2>3.2 Configuration Directives<a class="headerlink" href="#configuration-directives" title="Link to this heading">¶</a></h2>
<p>New keywords and/or metadata will have to be added to the mapserver parser. The exact syntax and the
extent of the configuration keywords must be discussed as part of the commenting period of this RFC.</p>
<p>The configuration directives being rather extensive, a tradeoff will have to be found between ease of
syntax and similarity to actual mapserver keywords.</p>
</section>
<section id="documentation">
<h2>3.3 Documentation<a class="headerlink" href="#documentation" title="Link to this heading">¶</a></h2>
<p>The mod-geocache documentation is rather sparse, and consists essentially of a commented configuration
file. There will have to be an effort to add documentation to the main mapserver doc site, and to
migrate the few wiki pages from the google-code hosting.</p>
</section>
<section id="code-review">
<h2>4.  Code Review<a class="headerlink" href="#code-review" title="Link to this heading">¶</a></h2>
</section>
<section id="code-origin">
<h2>4.1 Code Origin<a class="headerlink" href="#code-origin" title="Link to this heading">¶</a></h2>
<p>All C code was written from scratch by myself and Steve Woodbridge, so should not be a
real problem. Image io functions based on libpng/libjpeg have been vastly inspired by
the same functions in mapserver, and could be merged together in a second phase.</p>
</section>
<section id="code-quality">
<h2>4.2 Code Quality<a class="headerlink" href="#code-quality" title="Link to this heading">¶</a></h2>
<p>Similar to MapServer.</p>
</section>
<section id="security-audit">
<h2>4.3 Security Audit<a class="headerlink" href="#security-audit" title="Link to this heading">¶</a></h2>
<p>No external security audit has been performed on the code.
Being run as an apache module that potentially receives untrusted data, security has always been a
concern when writing the code, but I’m no security expert.</p>
</section>
<section id="external-dependencies">
<h2>4.4 External Dependencies<a class="headerlink" href="#external-dependencies" title="Link to this heading">¶</a></h2>
<blockquote>
<div><ul class="simple">
<li><p>libcurl (required)</p></li>
<li><p>apr(required) / apr-util(optional)</p></li>
<li><p>libpng (required)</p></li>
<li><p>libjpeg (required)</p></li>
<li><p>pcre (optional)</p></li>
<li><p>OGR (for the seeder, optional)</p></li>
<li><p>libcairo (optional, required for servicing GetMap requests built from cached tiles)</p></li>
<li><p>FastCGI (optional)</p></li>
</ul>
</div></blockquote>
</section>
<section id="build-system">
<h2>4.5 Build system<a class="headerlink" href="#build-system" title="Link to this heading">¶</a></h2>
<p>mod-geocache like MapServer uses autoconf (without automake) and Makefiles to build stuff.</p>
</section>
<section id="ip-and-patent-overview">
<h2>4.6 IP and Patent overview<a class="headerlink" href="#ip-and-patent-overview" title="Link to this heading">¶</a></h2>
<p>Patent review is left as an exercise for users coming from countries with a broken patent system ;)</p>
</section>
<section id="voting-history">
<h2>5. Voting history<a class="headerlink" href="#voting-history" title="Link to this heading">¶</a></h2>
<p>Passed with +1’s from Steve L., Steve W., Tamas, Dan, Howard, Assefa, Thomas and Tom on 8/19/2011.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p>
<a href="../../about.html" title="About">About</a><br>
<a href="../../products.html" title="Products">Products</a><br>
<a href="../../community/index.html" title="Community">Community</a><br>
<a href="../index.html" title="Development">Development</a><br>
<a href="../../download.html" title="Downloads">Downloads</a><br>
<a href="../../documentation.html" title="Documentation">Documentation</a><br>
<a href="../../faq.html" title="FAQ">FAQ</a><br>
<a href="../../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</h3>
  <ul>
<li><a class="reference internal" href="#">MS RFC 71: Integration of Mod-Geocache in the MapServer project</a><ul>
<li><a class="reference internal" href="#overview">1. Overview</a></li>
<li><a class="reference internal" href="#the-need-for-a-tile-caching-solution">1.1 The need for a tile caching solution</a></li>
<li><a class="reference internal" href="#the-mod-geocache-project">1.2 The mod-geocache project</a></li>
<li><a class="reference internal" href="#integration-overview">1.3 Integration Overview</a></li>
<li><a class="reference internal" href="#governance">2. Governance</a></li>
<li><a class="reference internal" href="#finding-a-name">2.1 Finding a Name</a></li>
<li><a class="reference internal" href="#release-cycles">2.2 Release Cycles</a></li>
<li><a class="reference internal" href="#source-code-location">2.3 Source Code Location</a></li>
<li><a class="reference internal" href="#rfcs-and-decision-process">2.4 RFCs and Decision Process</a></li>
<li><a class="reference internal" href="#licence">2.5 Licence</a></li>
<li><a class="reference internal" href="#tickets">2.6 Tickets</a></li>
<li><a class="reference internal" href="#svn-import">2.7 SVN Import</a></li>
<li><a class="reference internal" href="#a-common-mapfile-as-config-file">3 A common MapFile as config file</a></li>
<li><a class="reference internal" href="#libmapfile-api">3.1 LibMapfile API</a></li>
<li><a class="reference internal" href="#configuration-directives">3.2 Configuration Directives</a></li>
<li><a class="reference internal" href="#documentation">3.3 Documentation</a></li>
<li><a class="reference internal" href="#code-review">4.  Code Review</a></li>
<li><a class="reference internal" href="#code-origin">4.1 Code Origin</a></li>
<li><a class="reference internal" href="#code-quality">4.2 Code Quality</a></li>
<li><a class="reference internal" href="#security-audit">4.3 Security Audit</a></li>
<li><a class="reference internal" href="#external-dependencies">4.4 External Dependencies</a></li>
<li><a class="reference internal" href="#build-system">4.5 Build system</a></li>
<li><a class="reference internal" href="#ip-and-patent-overview">4.6 IP and Patent overview</a></li>
<li><a class="reference internal" href="#voting-history">5. Voting history</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ms-rfc-72.html" title="MS RFC 72: Layer and Label-Level Geomtransforms"
             >next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-70.html" title="MS RFC 70: Integration of TinyOWS in MapServer project"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 71: Integration of Mod-Geocache in the MapServer project</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; <a href="../../copyright.html">Copyright</a> 2023, Open Source Geospatial Foundation.
      Last updated on 2023-12-22.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.5.
    </div>
  </body>
</html>