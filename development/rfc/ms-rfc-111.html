<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>MS RFC 111: MapCache Support for animated time series &#8212; MapServer 8.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx.css?v=6c7b17ac" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=dd298242" />
    <link rel="stylesheet" type="text/css" href="../../_static/ribbon.css?v=ea091bf4" />
    
    <script src="../../_static/documentation_options.js?v=521b6f53"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="icon" href="../../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="MS RFC 112: Retry “Follow” label positioning after maxoverlapangle colision" href="ms-rfc-112.html" />
    <link rel="prev" title="MS RFC 110: MapCache REST Cache Backends" href="ms-rfc-110.html" /> 
  </head><body>


<!-- for main branch only, do not backport this -->

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../../index.html" title="Home"><img src="../../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../../index.html" title="Home">Home</a> |
      <a href="../../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter" target="_blank">Twitter</a> |
      <a href="../../download.html" title="Download Source or Binaries">Download </a> |
      <a class="badge" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=KRJ2X44N3HA6U&source=url" target="_blank">
        <img src="https://img.shields.io/badge/donate-%E2%9D%A4%C2%A0-ff69b4.svg?style=flat" alt="Donate to MapServer">
      </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../../ar/development/rfc/ms-rfc-111.html"><img src="../../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../../de/development/rfc/ms-rfc-111.html"><img src="../../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../../el/development/rfc/ms-rfc-111.html"><img src="../../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../../es/development/rfc/ms-rfc-111.html"><img src="../../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../../fr/development/rfc/ms-rfc-111.html"><img src="../../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../../id/development/rfc/ms-rfc-111.html"><img src="../../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../../it/development/rfc/ms-rfc-111.html"><img src="../../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../../ja/development/rfc/ms-rfc-111.html"><img src="../../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../../nl_NL/development/rfc/ms-rfc-111.html"><img src="../../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../../pl/development/rfc/ms-rfc-111.html"><img src="../../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../../ru/development/rfc/ms-rfc-111.html"><img src="../../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../../sq/development/rfc/ms-rfc-111.html"><img src="../../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../../tr/development/rfc/ms-rfc-111.html"><img src="../../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ms-rfc-112.html" title="MS RFC 112: Retry “Follow” label positioning after maxoverlapangle colision"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-110.html" title="MS RFC 110: MapCache REST Cache Backends"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 111: MapCache Support for animated time series</a></li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="ms-rfc-111-mapcache-support-for-animated-time-series">
<span id="rfc111"></span><h1>MS RFC 111: MapCache Support for animated time series<a class="headerlink" href="#ms-rfc-111-mapcache-support-for-animated-time-series" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Date<span class="colon">:</span></dt>
<dd class="field-odd"><p>2014/05</p>
</dd>
<dt class="field-even">Author<span class="colon">:</span></dt>
<dd class="field-even"><p>Jerome Villeneuve-Larouche</p>
</dd>
<dt class="field-odd">Contact<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="mailto:jlarouche&#37;&#52;&#48;mapgears&#46;com">jlarouche<span>&#64;</span>mapgears<span>&#46;</span>com</a></p>
</dd>
<dt class="field-even">Status<span class="colon">:</span></dt>
<dd class="field-even"><p>Draft</p>
</dd>
<dt class="field-odd">Version<span class="colon">:</span></dt>
<dd class="field-odd"><p>MapCache 1.4</p>
</dd>
<dt class="field-even">Last Updated<span class="colon">:</span></dt>
<dd class="field-even"><p>2014/05/14</p>
</dd>
</dl>
<section id="motivation">
<h2>1. Motivation<a class="headerlink" href="#motivation" title="Link to this heading">¶</a></h2>
<p>Currently if you specify a time frame in a request on a tileset with a
timedimension, mapcache simply stacks all the frames onto each other. Another
way to show time series is to produce an animated image of the different frames.
This implementation will use the Gif format to create an animated version of
the time series.</p>
</section>
<section id="implementation-details">
<h2>2. Implementation details<a class="headerlink" href="#implementation-details" title="Link to this heading">¶</a></h2>
<p>This implementation only work for single tile request, like a single tile map
in OpenLayers, because there is no way to synchronize the animation of
multiple Gif tiles on one mapview, seeding multiple tile wouldn’t produce a
good result.</p>
<section id="gif-encoding">
<h3>2.1 Gif Encoding<a class="headerlink" href="#gif-encoding" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>New Gif format output using GifLib</p></li>
<li><p>New format write_frames function in MapCache to write an animated Gif</p></li>
</ul>
</section>
<section id="animation-configuration">
<h3>2.2 Animation configuration<a class="headerlink" href="#animation-configuration" title="Link to this heading">¶</a></h3>
<p>Adding animation to a time dimension requires two new attributes to it and using
the Gif output format.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="o">&lt;</span><span class="n">timedimension</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;sqlite&quot;</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;2012-01-01&quot;</span> <span class="n">animate</span><span class="o">=</span><span class="s2">&quot;true&quot;</span> <span class="n">delay</span><span class="o">=</span><span class="s2">&quot;150&quot;</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">dbfile</span><span class="o">&gt;</span><span class="n">mapcache</span><span class="o">-</span><span class="n">time</span><span class="o">.</span><span class="n">sqlite</span><span class="o">&lt;/</span><span class="n">dbfile</span><span class="o">&gt;</span>
         <span class="o">&lt;</span><span class="n">query</span><span class="o">&gt;</span>
         <span class="n">select</span>
             <span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">start_time</span><span class="p">)</span>
             <span class="kn">from</span>
             <span class="nn">time</span>
         <span class="n">where</span>
             <span class="n">source_id</span><span class="o">=</span><span class="p">:</span><span class="n">tileset</span>
         <span class="ow">and</span>
             <span class="n">start_time</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">=</span><span class="n">datetime</span><span class="p">(:</span><span class="n">start_timestamp</span><span class="p">,</span><span class="s1">&#39;unixepoch&#39;</span><span class="p">)</span>
         <span class="ow">and</span>
             <span class="n">start_time</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="o">=</span><span class="n">datetime</span><span class="p">(:</span><span class="n">end_timestamp</span><span class="p">,</span><span class="s1">&#39;unixepoch&#39;</span><span class="p">)</span>
         <span class="n">order</span> <span class="n">by</span>
             <span class="n">end_time</span>
     <span class="o">&lt;/</span><span class="n">query</span><span class="o">&gt;</span>
 <span class="o">&lt;/</span><span class="n">timedimension</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">service</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;wms&quot;</span> <span class="n">enabled</span><span class="o">=</span><span class="s2">&quot;true&quot;</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">full_wms</span><span class="o">&gt;</span><span class="n">assemble</span><span class="o">&lt;/</span><span class="n">full_wms</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">resample_mode</span><span class="o">&gt;</span><span class="n">bilinear</span><span class="o">&lt;/</span><span class="n">resample_mode</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="nb">format</span><span class="o">&gt;</span><span class="n">GIF</span><span class="o">&lt;/</span><span class="nb">format</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">maxsize</span><span class="o">&gt;</span><span class="mi">4096</span><span class="o">&lt;/</span><span class="n">maxsize</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">service</span><span class="o">&gt;</span>
</pre></div>
</div>
<ul>
<li><p>The “animate” attribute specifies if we want to animate our timedimension.
If it is not present or set to false, we don’t animate.</p></li>
<li><p>The “delay” attribute specifies the delay between two frames in
hundreth of a second. If it is not present, it defaults to 100,
if it is present but the “animate” attribute isn’t, it will simply
be ignored. It also has to be bigger than zero.</p>
<p>You also have to set the output format, for example in the service, to Gif.
If you ask for an animated tileset without the Gif format, MapCache will
generate an error message.</p>
</li>
</ul>
</section>
</section>
<section id="miscellaneous">
<h2>3. Miscellaneous<a class="headerlink" href="#miscellaneous" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>The animation could also be controlled by the service format instead of
adding attributes to the timedimension. I think it would make more sense to
implement it that way in the code since the core and encoding
functions don’t normally use the tileset but the map request and
the format.</p></li>
</ul>
<section id="backwards-incompatibilities">
<h3>3.1 Backwards Incompatibilities<a class="headerlink" href="#backwards-incompatibilities" title="Link to this heading">¶</a></h3>
<p>none expected</p>
</section>
<section id="issue-tracking-id">
<h3>3.2 Issue Tracking ID<a class="headerlink" href="#issue-tracking-id" title="Link to this heading">¶</a></h3>
</section>
<section id="files-changed">
<h3>3.4 Files Changed<a class="headerlink" href="#files-changed" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>include/mapacache.h</p></li>
<li><p>lib/configuration.c</p></li>
<li><p>lib/configuration_xml.c</p></li>
<li><p>lib/core.c</p></li>
<li><p>lib/dimension.c</p></li>
<li><p>lib/imageio_gif.c (new)</p></li>
</ul>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p>
<a href="../../about.html" title="About">About</a><br>
<a href="../../products.html" title="Products">Products</a><br>
<a href="../../community/index.html" title="Community">Community</a><br>
<a href="../index.html" title="Development">Development</a><br>
<a href="../../download.html" title="Downloads">Downloads</a><br>
<a href="../../documentation.html" title="Documentation">Documentation</a><br>
<a href="../../faq.html" title="FAQ">FAQ</a><br>
<a href="../../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</h3>
  <ul>
<li><a class="reference internal" href="#">MS RFC 111: MapCache Support for animated time series</a><ul>
<li><a class="reference internal" href="#motivation">1. Motivation</a></li>
<li><a class="reference internal" href="#implementation-details">2. Implementation details</a><ul>
<li><a class="reference internal" href="#gif-encoding">2.1 Gif Encoding</a></li>
<li><a class="reference internal" href="#animation-configuration">2.2 Animation configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#miscellaneous">3. Miscellaneous</a><ul>
<li><a class="reference internal" href="#backwards-incompatibilities">3.1 Backwards Incompatibilities</a></li>
<li><a class="reference internal" href="#issue-tracking-id">3.2 Issue Tracking ID</a></li>
<li><a class="reference internal" href="#files-changed">3.4 Files Changed</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ms-rfc-112.html" title="MS RFC 112: Retry “Follow” label positioning after maxoverlapangle colision"
             >next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-110.html" title="MS RFC 110: MapCache REST Cache Backends"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 111: MapCache Support for animated time series</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; <a href="../../copyright.html">Copyright</a> 2023, Open Source Geospatial Foundation.
      Last updated on 2023-12-22.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.5.
    </div>
  </body>
</html>