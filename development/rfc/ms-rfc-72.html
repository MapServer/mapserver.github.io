<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>MS RFC 72: Layer and Label-Level Geomtransforms &#8212; MapServer 8.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx.css?v=6c7b17ac" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=dd298242" />
    <link rel="stylesheet" type="text/css" href="../../_static/ribbon.css?v=ea091bf4" />
    
    <script src="../../_static/documentation_options.js?v=521b6f53"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="icon" href="../../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="MS RFC 73: Improved SVG symbols support" href="ms-rfc-73.html" />
    <link rel="prev" title="MS RFC 71: Integration of Mod-Geocache in the MapServer project" href="ms-rfc-71.html" /> 
  </head><body>


<!-- for main branch only, do not backport this -->

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../../index.html" title="Home"><img src="../../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../../index.html" title="Home">Home</a> |
      <a href="../../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter" target="_blank">Twitter</a> |
      <a href="../../download.html" title="Download Source or Binaries">Download </a> |
      <a class="badge" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=KRJ2X44N3HA6U&source=url" target="_blank">
        <img src="https://img.shields.io/badge/donate-%E2%9D%A4%C2%A0-ff69b4.svg?style=flat" alt="Donate to MapServer">
      </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../../ar/development/rfc/ms-rfc-72.html"><img src="../../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../../de/development/rfc/ms-rfc-72.html"><img src="../../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../../el/development/rfc/ms-rfc-72.html"><img src="../../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../../es/development/rfc/ms-rfc-72.html"><img src="../../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../../fr/development/rfc/ms-rfc-72.html"><img src="../../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../../id/development/rfc/ms-rfc-72.html"><img src="../../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../../it/development/rfc/ms-rfc-72.html"><img src="../../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../../ja/development/rfc/ms-rfc-72.html"><img src="../../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../../nl_NL/development/rfc/ms-rfc-72.html"><img src="../../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../../pl/development/rfc/ms-rfc-72.html"><img src="../../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../../ru/development/rfc/ms-rfc-72.html"><img src="../../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../../sq/development/rfc/ms-rfc-72.html"><img src="../../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../../tr/development/rfc/ms-rfc-72.html"><img src="../../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ms-rfc-73.html" title="MS RFC 73: Improved SVG symbols support"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-71.html" title="MS RFC 71: Integration of Mod-Geocache in the MapServer project"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 72: Layer and Label-Level Geomtransforms</a></li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="ms-rfc-72-layer-and-label-level-geomtransforms">
<span id="rfc72"></span><h1>MS RFC 72: Layer and Label-Level Geomtransforms<a class="headerlink" href="#ms-rfc-72-layer-and-label-level-geomtransforms" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Date<span class="colon">:</span></dt>
<dd class="field-odd"><p>2011/06/27</p>
</dd>
<dt class="field-even">Author<span class="colon">:</span></dt>
<dd class="field-even"><p>Steve Lime</p>
</dd>
<dt class="field-odd">Contact<span class="colon">:</span></dt>
<dd class="field-odd"><p>sdlime at comcast.net</p>
</dd>
<dt class="field-even">Status<span class="colon">:</span></dt>
<dd class="field-even"><p>Draft</p>
</dd>
<dt class="field-odd">Version<span class="colon">:</span></dt>
<dd class="field-odd"><p>TBD</p>
</dd>
</dl>
<section id="overview">
<h2>1. Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p>MapServer 6.0 introduced the concept of geometry expressions within a styleObj-geomtransform. For
example, one could write:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">STYLE</span>
  <span class="n">GEOMTRANSFORM</span> <span class="p">(</span><span class="n">buffer</span><span class="p">([</span><span class="n">shape</span><span class="p">],</span> <span class="o">-</span><span class="mi">5</span><span class="p">)</span>
  <span class="o">...</span>
<span class="n">END</span>
</pre></div>
</div>
<p>This would cause a buffer operation to be run on the shape before being rendered with a given style.</p>
<p>This is useful for certain cartographic effects but is limited in a couple of ways:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>it operates in pixel space (e.g. once a feature is converted from map to image coordinates)</p></li>
<li><p>the resulting shape can only be used with a single style so it is not efficient to, say, create a complex rendering of a buffered feature</p></li>
<li><p>it is not possible to query transformed features</p></li>
<li><p>the resulting shape cannot be used in any labeling operations</p></li>
</ol>
</div></blockquote>
</section>
<section id="the-proposed-solution">
<h2>2. The proposed solution<a class="headerlink" href="#the-proposed-solution" title="Link to this heading">¶</a></h2>
<p>This RFC proposes to extend GEOMTRANSFORMS to both the layer and label contexts. Basically the same
keyword and syntax would become valid in other objects.</p>
<p>For a layer the transformation would be applied to geometries as they are read from a datasource
and before any drawing or query operations. As a result it would be much more efficient to perform
complex rendering of a transformed shape. In addition the resulting shape would also be queryable
in a consistent manner since the transformation would be independent of the map being drawn (e.g.
scale, bounding box, etc…).</p>
<p>For a label the transformation would be applied ahead label point computation, in pixel coordinates
much like the current style implementation. This will allow for effects like labeling the inside edge
of a polygon or perhaps creating a curved labels within a polygon.</p>
<p>These operations are computationaly intensive so users would need to understand the performance
impact but as tiling becomes the norm this is less an issue.</p>
</section>
<section id="implementation-details">
<h2>3. Implementation Details<a class="headerlink" href="#implementation-details" title="Link to this heading">¶</a></h2>
<p>For layers I propose adding a check to the functions msLayerGetShape() and msLayerNextShape() to
conditionally apply the GEOMSTRANFORM before returning the shape. The resulting shape would contain
all the attributes of the parent. (Note: one potential issue is that certain operations might affect
the bounding box used to select candidate shapes via msLayerWhichShapes()).</p>
<p>For labels the check and transformation would be applied within the msLayerDrawShape() function.</p>
<p>Small changes to the logical expression grammar (mapparser.y) and expression tokenizer would need
to be made.</p>
</section>
<section id="files-affected">
<h2>3.1 Files affected<a class="headerlink" href="#files-affected" title="Link to this heading">¶</a></h2>
<p>The following files will be modified/created by this RFC:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mapfile</span><span class="o">.</span><span class="n">c</span> <span class="p">(</span><span class="n">layer</span><span class="o">/</span><span class="n">label</span> <span class="n">read</span><span class="o">/</span><span class="n">write</span><span class="p">)</span>
<span class="n">mapdraw</span><span class="o">.</span><span class="n">c</span> <span class="p">(</span><span class="n">update</span> <span class="n">msDrawShape</span><span class="p">())</span>
<span class="n">maplayer</span><span class="o">.</span><span class="n">c</span> <span class="p">(</span><span class="n">update</span> <span class="n">msLayerGetShape</span><span class="p">(),</span> <span class="n">msLayerNextShape</span><span class="p">(),</span> <span class="n">msLayerWhichItems</span><span class="p">()</span> <span class="ow">and</span> <span class="n">msLayerGetTokens</span><span class="p">())</span>
<span class="n">maplexer</span><span class="o">.</span><span class="n">l</span> <span class="p">(</span><span class="n">add</span> <span class="n">additional</span> <span class="n">GEOS</span> <span class="n">operators</span><span class="p">,</span> <span class="ow">in</span> <span class="n">trunk</span> <span class="n">only</span> <span class="n">buffer</span> <span class="ow">and</span> <span class="n">difference</span> <span class="n">are</span> <span class="n">currently</span> <span class="n">implemented</span><span class="p">)</span>
<span class="n">mapparser</span><span class="o">.</span><span class="n">y</span> <span class="p">(</span><span class="n">extend</span> <span class="n">the</span> <span class="n">grammar</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="mapscript-issues">
<h2>3.2 MapScript Issues<a class="headerlink" href="#mapscript-issues" title="Link to this heading">¶</a></h2>
<p>These are just expressionObj’s so functions to get/set them already exist.</p>
</section>
<section id="security-issues">
<h2>3.3 Security Issues<a class="headerlink" href="#security-issues" title="Link to this heading">¶</a></h2>
<p>Care must be take to avoid memory leaks associated with the production of the transformed shapes. It
would make sense to allow runtime substitution like is done with layer filters and class expressions.
Similarly, validation patterns would be required.</p>
</section>
<section id="backwards-compatibility-issues">
<h2>3.4 Backwards Compatibility Issues<a class="headerlink" href="#backwards-compatibility-issues" title="Link to this heading">¶</a></h2>
<p>This change provides a new functionality with no backwards compatibility issues being considered.</p>
</section>
<section id="bug-id">
<h2>4. Bug ID<a class="headerlink" href="#bug-id" title="Link to this heading">¶</a></h2>
<p>None assigned. See related ticket #3871.</p>
</section>
<section id="voting-history">
<h2>5. Voting history<a class="headerlink" href="#voting-history" title="Link to this heading">¶</a></h2>
<p>None</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p>
<a href="../../about.html" title="About">About</a><br>
<a href="../../products.html" title="Products">Products</a><br>
<a href="../../community/index.html" title="Community">Community</a><br>
<a href="../index.html" title="Development">Development</a><br>
<a href="../../download.html" title="Downloads">Downloads</a><br>
<a href="../../documentation.html" title="Documentation">Documentation</a><br>
<a href="../../faq.html" title="FAQ">FAQ</a><br>
<a href="../../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</h3>
  <ul>
<li><a class="reference internal" href="#">MS RFC 72: Layer and Label-Level Geomtransforms</a><ul>
<li><a class="reference internal" href="#overview">1. Overview</a></li>
<li><a class="reference internal" href="#the-proposed-solution">2. The proposed solution</a></li>
<li><a class="reference internal" href="#implementation-details">3. Implementation Details</a></li>
<li><a class="reference internal" href="#files-affected">3.1 Files affected</a></li>
<li><a class="reference internal" href="#mapscript-issues">3.2 MapScript Issues</a></li>
<li><a class="reference internal" href="#security-issues">3.3 Security Issues</a></li>
<li><a class="reference internal" href="#backwards-compatibility-issues">3.4 Backwards Compatibility Issues</a></li>
<li><a class="reference internal" href="#bug-id">4. Bug ID</a></li>
<li><a class="reference internal" href="#voting-history">5. Voting history</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ms-rfc-73.html" title="MS RFC 73: Improved SVG symbols support"
             >next</a> |</li>
        <li class="right" >
          <a href="ms-rfc-71.html" title="MS RFC 71: Integration of Mod-Geocache in the MapServer project"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Request for Comments</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MS RFC 72: Layer and Label-Level Geomtransforms</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; <a href="../../copyright.html">Copyright</a> 2023, Open Source Geospatial Foundation.
      Last updated on 2023-12-22.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.5.
    </div>
  </body>
</html>