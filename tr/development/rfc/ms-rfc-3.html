<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="tr">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>MS RFC 3: Feature Layer Plug-in Architecture &#8212; MapServer 7.2.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '7.2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/translations.js"></script>
    <link rel="shortcut icon" href="../../_static/mapserver.ico"/>
    <link rel="author" title="Bu belgeler hakkında" href="../../about.html" />
    <link rel="index" title="Dizin" href="../../genindex.html" />
    <link rel="search" title="Ara" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="top" title="MapServer 7.2.0 documentation" href="../../index.html" />
    <link rel="up" title="Request for Comments" href="index.html" />
    <link rel="next" title="MS RFC 4: MapServer Raster Resampling" href="ms-rfc-4.html" />
    <link rel="prev" title="MS RFC 2: Creating line features and/or shapes using WKT" href="ms-rfc-2.html" /> 
  </head>
  <body role="document">

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../../index.html" title="Home"><img src="../../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../../index.html" title="Home">Home</a> |
      <a href="../../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a> |
      <a href="../../download.html" title="Download Source or Binaries">Download </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        
          
            <a href="../../../development/rfc/ms-rfc-3.html"><img src="../../_static/flagicons/en.png" alt="en" title="en" border="0" /></a>
          
        
        
          
            <a href="../../../ar/development/rfc/ms-rfc-3.html"><img src="../../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
          
        
        
          
            <a href="../../../de/development/rfc/ms-rfc-3.html"><img src="../../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
          
        
        
          
            <a href="../../../el/development/rfc/ms-rfc-3.html"><img src="../../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
          
        
        
          
            <a href="../../../es/development/rfc/ms-rfc-3.html"><img src="../../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
          
        
        
          
            <a href="../../../fr/development/rfc/ms-rfc-3.html"><img src="../../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
          
        
        
          
            <a href="../../../id/development/rfc/ms-rfc-3.html"><img src="../../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
          
        
        
          
            <a href="../../../it/development/rfc/ms-rfc-3.html"><img src="../../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
          
        
        
          
            <a href="../../../ja/development/rfc/ms-rfc-3.html"><img src="../../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
          
        
        
          
            <a href="../../../nl_NL/development/rfc/ms-rfc-3.html"><img src="../../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
          
        
        
          
            <a href="../../../pl/development/rfc/ms-rfc-3.html"><img src="../../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
          
        
        
          
            <a href="../../../ru/development/rfc/ms-rfc-3.html"><img src="../../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
          
        
        
          
            <a href="../../../sq/development/rfc/ms-rfc-3.html"><img src="../../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
          
        
        <img src="../../_static/flagicons/tr.png" alt="tr" title="tr" border="0" width="18px" height="13px"/>

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Gezinti</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Genel Dizin"
             accesskey="I">dizin</a></li>
        <li class="right" >
          <a href="ms-rfc-4.html" title="MS RFC 4: MapServer Raster Resampling"
             accesskey="N">sonraki</a> |</li>
        <li class="right" >
          <a href="ms-rfc-2.html" title="MS RFC 2: Creating line features and/or shapes using WKT"
             accesskey="P">önceki</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Request for Comments</a> &#187;</li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="ms-rfc-3-feature-layer-plug-in-architecture">
<span id="rfc3"></span><h1>MS RFC 3: Feature Layer Plug-in Architecture<a class="headerlink" href="#ms-rfc-3-feature-layer-plug-in-architecture" title="Bu başlığın kalıcı bağlantısı">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Date:</th><td class="field-body">2005/08/22</td>
</tr>
<tr class="field-even field"><th class="field-name">Author:</th><td class="field-body">Jani Averbach</td>
</tr>
<tr class="field-odd field"><th class="field-name">Contact:</th><td class="field-body">javerbach at extendthereach.com</td>
</tr>
<tr class="field-even field"><th class="field-name">Status:</th><td class="field-body">Adopted</td>
</tr>
<tr class="field-odd field"><th class="field-name">Version:</th><td class="field-body">MapServer 4.8</td>
</tr>
</tbody>
</table>
<div class="section" id="abstract-solution">
<h2>Abstract Solution<a class="headerlink" href="#abstract-solution" title="Bu başlığın kalıcı bağlantısı">¶</a></h2>
<p>Implement a virtual table structure for <code class="docutils literal"><span class="pre">layerObj</span></code>. This structure
will contain function pointers for all layer specific operations.
This structure will be populated when the layer is opened or first
time accessed.  After that all back-end format specific layer
operations will happen through this vtable which is cached in the
<code class="docutils literal"><span class="pre">layerObj</span></code> struct.</p>
</div>
<div class="section" id="technical-solution">
<h2>Technical Solution<a class="headerlink" href="#technical-solution" title="Bu başlığın kalıcı bağlantısı">¶</a></h2>
<p>All file names and numbers are against released MapServer 4.6.0 source
code.</p>
<ol class="arabic">
<li><p class="first">Add new field to the <code class="docutils literal"><span class="pre">layerObj</span></code>. It will be pointer to the vtable,
which will contain function pointers for this layer.</p>
</li>
<li><p class="first">Add the virtual table architecture</p>
<p>The vtable will be initialized when the layer is accessed at the
first time.
The vtable will be populated with dummies when it is created and
these dummies will implement feasible default actions if there is
any (e.g. do nothing) or return error by default.</p>
<p>2.1. Standard functions which are found currently from <code class="docutils literal"><span class="pre">maplayer.c</span></code></p>
<blockquote>
<div><p>2.1.1. InitItemInfo</p>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="p">(</span><span class="o">*</span><span class="n">LayerInitItemInfo</span><span class="p">)(</span><span class="n">layerObj</span> <span class="o">*</span><span class="n">layer</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<p>2.1.2. FreeItemInfo</p>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="p">(</span><span class="o">*</span><span class="n">LayerFreeItemInfo</span><span class="p">)(</span><span class="n">layerObj</span> <span class="o">*</span><span class="n">layer</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<p>2.1.3. Open</p>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="p">(</span><span class="o">*</span><span class="n">LayerOpen</span><span class="p">)(</span><span class="n">layerObj</span> <span class="o">*</span><span class="n">layer</span><span class="p">);</span>
</pre></div>
</div>
<p>Currently there are two layers which accept more than
the generic layer arg for LayerOpen function:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">msOGRLayerOpen</span><span class="p">(</span><span class="n">layerObj</span> <span class="o">*</span><span class="n">layer</span><span class="p">,</span>
                   <span class="n">const</span> <span class="n">char</span> <span class="o">*</span><span class="n">pszOverrideConnection</span><span class="p">);</span>
<span class="nb">int</span> <span class="n">msWFSLayerOpen</span><span class="p">(</span><span class="n">layerObj</span> <span class="o">*</span><span class="n">lp</span><span class="p">,</span>
                   <span class="n">const</span> <span class="n">char</span> <span class="o">*</span><span class="n">pszGMLFilename</span><span class="p">,</span>
                   <span class="n">rectObj</span> <span class="o">*</span><span class="n">defaultBBOX</span><span class="p">);</span>
</pre></div>
</div>
<p>However, these are called from <code class="docutils literal"><span class="pre">msLayerOpen</span></code> with
<code class="docutils literal"><span class="pre">NULL</span></code> args, so I think that proposed interface for
this virtual table function should be fine.</p>
</div></blockquote>
<p>2.1.4. IsOpen</p>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="p">(</span><span class="o">*</span><span class="n">LayerIsOpen</span><span class="p">)(</span><span class="n">layerObj</span> <span class="o">*</span><span class="n">layer</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<p>2.1.5. WhichShapes</p>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="p">(</span><span class="o">*</span><span class="n">LayerWhichShapes</span><span class="p">)(</span><span class="n">layerObj</span> <span class="o">*</span><span class="n">layer</span><span class="p">,</span>
                        <span class="n">rectObj</span> <span class="n">rect</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<p>2.1.6. NextShape</p>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="p">(</span><span class="o">*</span><span class="n">LayerNextShape</span><span class="p">)(</span><span class="n">layerObj</span> <span class="o">*</span><span class="n">layer</span><span class="p">,</span> <span class="n">shapeObj</span> <span class="o">*</span><span class="n">shape</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<p>2.1.7. GetShape</p>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="p">(</span><span class="o">*</span><span class="n">LayerGetShape</span><span class="p">)(</span><span class="n">layerObj</span> <span class="o">*</span><span class="n">layer</span><span class="p">,</span> <span class="n">shapeObj</span> <span class="o">*</span><span class="n">shape</span><span class="p">,</span>
                     <span class="nb">int</span> <span class="n">tile</span><span class="p">,</span> <span class="n">long</span> <span class="n">record</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<p>2.1.8. LayerClose</p>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="p">(</span><span class="o">*</span><span class="n">LayerClose</span><span class="p">)(</span><span class="n">layerObj</span> <span class="o">*</span><span class="n">layer</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<p>2.1.9. LayerGetItems</p>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="p">(</span><span class="o">*</span><span class="n">LayerGetItems</span><span class="p">)(</span><span class="n">layerObj</span> <span class="o">*</span><span class="n">layer</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<p>2.1.10. GetExtent</p>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="p">(</span><span class="o">*</span><span class="n">LayerGetExtent</span><span class="p">)(</span><span class="n">layerObj</span> <span class="o">*</span><span class="n">layer</span><span class="p">,</span>
                      <span class="n">rectObj</span> <span class="o">*</span><span class="n">extent</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<p>2.1.11. GetAutoStyle</p>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="p">(</span><span class="o">*</span><span class="n">LayerGetAutoStyle</span><span class="p">)(</span><span class="n">mapObj</span> <span class="o">*</span><span class="nb">map</span><span class="p">,</span> <span class="n">layerObj</span> <span class="o">*</span><span class="n">layer</span><span class="p">,</span>
                         <span class="n">classObj</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="nb">int</span> <span class="n">tile</span><span class="p">,</span>
                         <span class="n">long</span> <span class="n">record</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
<p>2.2.  New functions and/or fields for vtable</p>
<blockquote>
<div><p>2.2.1. CloseConnection</p>
<blockquote>
<div><p>This function is used to actually close the
connection, in case that layer implements some kind of
connection pooling by its own.  If layer doesn&#8217;t use
any connection pooling, this function should be
implemented as no-op. Caller should first call layer&#8217;s
&#8220;close&#8221; function, and finally at the very end
<code class="docutils literal"><span class="pre">CloseConnection</span></code>.</p>
<p>The signature of function is</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="p">(</span><span class="o">*</span><span class="n">LayerCloseConnection</span><span class="p">)(</span><span class="n">layerObj</span> <span class="o">*</span><span class="n">layer</span><span class="p">);</span>
</pre></div>
</div>
<p>And the main place where this function will be called,
is <code class="docutils literal"><span class="pre">mapfile.c:</span> <span class="pre">4822</span></code></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">msCloseConnections</span><span class="p">(</span><span class="n">mapObj</span> <span class="o">*</span><span class="nb">map</span><span class="p">)</span>
</pre></div>
</div>
<p>This function is needed because e.g. <code class="docutils literal"><span class="pre">POSTGIS</span></code> is
implementing this usage pattern at the moment
<code class="docutils literal"><span class="pre">maplayer.c:599</span></code></p>
<div class="highlight-default"><div class="highlight"><pre><span></span> <span class="n">void</span> <span class="n">msLayerClose</span><span class="p">(</span><span class="n">layerObj</span> <span class="o">*</span><span class="n">layer</span><span class="p">)</span>
 <span class="o">...</span>
<span class="o">/*</span>
 <span class="o">*</span> <span class="n">Due</span> <span class="n">to</span> <span class="n">connection</span> <span class="n">sharing</span><span class="p">,</span> <span class="n">we</span> <span class="n">need</span> <span class="n">to</span> <span class="n">close</span> <span class="n">the</span> <span class="n">results</span>
 <span class="o">*</span> <span class="ow">and</span> <span class="n">free</span> <span class="n">the</span> <span class="n">cursor</span><span class="p">,</span> <span class="n">but</span> <span class="ow">not</span> <span class="n">close</span> <span class="n">the</span> <span class="n">connection</span><span class="o">.</span>
 <span class="o">*/</span>
 <span class="n">msPOSTGISLayerResultClose</span><span class="p">(</span><span class="n">layer</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<p>2.2.2. SetTimeFilter</p>
<blockquote>
<div><p>This function is used to create a time filter for
layer. At the moment we have three special cases
(<code class="docutils literal"><span class="pre">maplayer.c:</span> <span class="pre">1635</span></code>):</p>
<ol class="arabic simple">
<li><code class="docutils literal"><span class="pre">POSTGIS</span></code> with it&#8217;s own function</li>
<li>Layers with backticks delimited expressions</li>
<li>Layers without backticks</li>
</ol>
<p>The idea is provide a generic helper function,</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">makeTimeFilter</span><span class="p">(</span><span class="n">layerObj</span> <span class="o">*</span><span class="n">lp</span><span class="p">,</span>
                   <span class="n">const</span> <span class="n">char</span> <span class="o">*</span><span class="n">timestring</span><span class="p">,</span>
                   <span class="n">const</span> <span class="n">char</span> <span class="o">*</span><span class="n">timefield</span><span class="p">,</span>
                   <span class="n">const</span> <span class="nb">bool</span> <span class="n">bBackTicks</span><span class="p">)</span>
</pre></div>
</div>
<p>And the actual layer&#8217;s <code class="docutils literal"><span class="pre">SetTimeFilter</span></code> could use the
above, or implement something totally different as
<code class="docutils literal"><span class="pre">POSTGIS</span></code> is doing at the moment.</p>
<p>The signature for layer&#8217;s vtable function is</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="p">(</span><span class="o">*</span><span class="n">LayerSetTimeFilter</span><span class="p">)(</span><span class="n">layerObj</span> <span class="o">*</span><span class="n">lp</span><span class="p">,</span>
                          <span class="n">const</span> <span class="n">char</span> <span class="o">*</span><span class="n">timestring</span><span class="p">,</span>
                          <span class="n">const</span> <span class="n">char</span> <span class="o">*</span><span class="n">timefield</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
<p>2.3. Extra functions to add to the vtable</p>
<blockquote>
<div><p>2.3.1. FLTApplyFilterToLayer (<code class="docutils literal"><span class="pre">mapogcfilter.c:</span> <span class="pre">1084</span></code>)</p>
<blockquote>
<div><p>This is the main filter interface for layers.  We will
provide two helper functions, one for &#8220;SQL&#8221; case and
the another for &#8220;non-SQL&#8221; case, and set all layers,
except <code class="docutils literal"><span class="pre">POSTGIS</span></code>, <code class="docutils literal"><span class="pre">ORACLESPATIAL</span></code> and <code class="docutils literal"><span class="pre">OGR</span></code> to
call directly this &#8220;non-SQL&#8221; version of this helper
function (else-branch of if).</p>
<p><code class="docutils literal"><span class="pre">ORACLESPATIAL</span></code>, <code class="docutils literal"><span class="pre">POSTGIS</span></code> and <code class="docutils literal"><span class="pre">OGR</span></code> could use
&#8220;SQL&#8221; version of the helper function (actual if-branch)
if the conditions for this are met, otherwise they will
use Non-SQL version of the function.</p>
</div></blockquote>
<p>2.3.2. layerObj-&gt;items allocation</p>
<blockquote>
<div><p>There will be vtable function for allocation <code class="docutils literal"><span class="pre">items</span></code> and
initialization for <code class="docutils literal"><span class="pre">numitems</span></code>. If layer has some
special needs for these objects it can override default
function.</p>
<p>The signature for function will be:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="p">(</span><span class="o">*</span><span class="n">CreateItems</span><span class="p">)(</span><span class="n">layerObj</span> <span class="o">*</span><span class="p">)</span>
</pre></div>
</div>
<p>which does the allocation and set numitems to correct
value.</p>
</div></blockquote>
<p>2.3.3. msCheckConnection (<code class="docutils literal"><span class="pre">mapfile.c:</span> <span class="pre">4779</span></code>)</p>
<blockquote>
<div><p>This API is deprecated. It is called only from
<code class="docutils literal"><span class="pre">msMYGISLayerOpen</span></code>.  We will not provide this
functionality through vtable.</p>
</div></blockquote>
</div></blockquote>
<p>2.4. Interface functions for internal layers</p>
<blockquote>
<div><p>We have to add some new interface functions to access layers.</p>
<p>2.4.1 Function interface to initialize internal layer type</p>
<blockquote>
<div><p>We need a per layer type a function which will be called
when the layer&#8217;s vtable has to be initialized. These
functions will be</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">msXXXInitializeLayerVirtualTable</span><span class="p">(</span><span class="n">layerObj</span> <span class="o">*</span><span class="p">)</span>
</pre></div>
</div>
<p>where XXX will be name of the layer. This function is
called anytime when the vtable isn&#8217;t initialized and the
layer is accessed at the first time.</p>
</div></blockquote>
<p>2.4.2 Function interface to change the connectiontype of layer</p>
<blockquote>
<div><p>To change the connection type of layer, it has to be
done by function interface. Accessing directly
<code class="docutils literal"><span class="pre">connectiontype</span></code> field is not supported anymore.</p>
<p>To change the connectiontype and to connect to the new
layer, there will be following interface function</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">msConnectLayer</span><span class="p">(</span><span class="nb">int</span> <span class="n">connectiontype</span><span class="p">,</span>
                   <span class="n">const</span> <span class="n">char</span> <span class="o">*</span><span class="n">library_str</span><span class="p">)</span>
</pre></div>
</div>
<p>where <code class="docutils literal"><span class="pre">connectiontype</span></code> is the type of new layer, and
<code class="docutils literal"><span class="pre">library_str</span></code> is the name of library which will
prodive functionality for this new layer.  For internal
layer types this second argument is ignored.</p>
</div></blockquote>
</div></blockquote>
</li>
<li><p class="first">Remove unwanted interfaces</p>
<p>Frank Warmerdam proposed <a class="reference internal" href="#fw1" id="id1">[FW1]</a> that we remove all layer specific
interface functions from <code class="docutils literal"><span class="pre">map.h</span></code>.</p>
<blockquote>
<div><p>I see each &#8220;built-in&#8221; module such as mapsde.c providing a
registration function such as &#8220;msSDEInitializeLayerVirtualTable&#8221;
so that none of the layer type specific definitions need to
appear in map.h any more.</p>
</div></blockquote>
<table class="docutils citation" frame="void" id="fw1" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[FW1]</a></td><td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">Frank</span> <span class="pre">Warmerdam</span> <span class="pre">on</span> <span class="pre">the</span> <span class="pre">mapserver-dev:</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">Message-Id:</span> <span class="pre">&lt;smtpd.490f.4303f2ee.d8246.1&#64;mtaout-c.tc.umn.edu&gt;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">Date:</span>&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">Wed,</span> <span class="pre">17</span> <span class="pre">Aug</span> <span class="pre">2005</span> <span class="pre">22:31:09</span> <span class="pre">-0400</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">Subject:</span>&#160;&#160;&#160; <span class="pre">Re:</span> <span class="pre">MapServer</span>&#160; <span class="pre">Plug-in</span> <span class="pre">Infastructure:</span> <span class="pre">RFC</span> <span class="pre">and</span> <span class="pre">PATCH</span></code></div>
</div>
</td></tr>
</tbody>
</table>
</li>
</ol>
</div>
<div class="section" id="files-and-objects-affected">
<h2>Files and objects affected<a class="headerlink" href="#files-and-objects-affected" title="Bu başlığın kalıcı bağlantısı">¶</a></h2>
<p>This proposal will affect at least following files and objects:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">map.h</span></code><ul>
<li><code class="docutils literal"><span class="pre">layerObj</span></code> will contain new fields. There will be a new
object <code class="docutils literal"><span class="pre">vtableObj</span></code> in the <code class="docutils literal"><span class="pre">map.h</span></code>.</li>
</ul>
</li>
<li><code class="docutils literal"><span class="pre">maplayer.c</span></code><ul>
<li>Various changes, layer specific <code class="docutils literal"><span class="pre">switch</span></code>-statements will go
away, vtable handling and layers vtable initialization will be
added.</li>
</ul>
</li>
<li><code class="docutils literal"><span class="pre">mapfile.c</span></code><ul>
<li>Cleaning of  <code class="docutils literal"><span class="pre">msCheckConnection</span></code></li>
<li>Vtable for <code class="docutils literal"><span class="pre">msCloseConnection</span></code></li>
</ul>
</li>
<li><code class="docutils literal"><span class="pre">mapogcfilter.c</span></code><ul>
<li>Remove layer-logic from <code class="docutils literal"><span class="pre">FLTApplyFilterToLayer</span></code></li>
</ul>
</li>
<li><code class="docutils literal"><span class="pre">mapXXX.c</span></code>, where <code class="docutils literal"><span class="pre">XXX</span></code> is the name of layer.<ul>
<li>Add new initialization function</li>
<li>Add all new interface functions</li>
<li>Fix existing interface functions, if needed / add wrappers for
<code class="docutils literal"><span class="pre">msOGRLayerOpen</span></code> and <code class="docutils literal"><span class="pre">msWFSLayerOpen</span></code>.</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="backwards-compatibility-issues">
<h2>Backwards compatibility issues<a class="headerlink" href="#backwards-compatibility-issues" title="Bu başlığın kalıcı bağlantısı">¶</a></h2>
<p>This is binary and source code level backward incompatible change. The
proposal will remove some previously public functions, and add new
field(s) to the <code class="docutils literal"><span class="pre">layerObj</span></code> struct.</p>
<p>This proposal is not MapScript backward compatible, it will break
scripts which change directly <code class="docutils literal"><span class="pre">connectiontype</span></code> field in
<code class="docutils literal"><span class="pre">layerObj</span></code>.</p>
<p>The proposal is MAP-file backward compatible.</p>
</div>
<div class="section" id="implementation-issues">
<h2>Implementation Issues<a class="headerlink" href="#implementation-issues" title="Bu başlığın kalıcı bağlantısı">¶</a></h2>
<ul class="simple">
<li>Biggest problem is probably that the author has ignored or missed
something by oversight which will show up during implementation.
However, there is a prototype implementation of external plug-in
architecture which works at the moment and is based on ideas
presented in this proposal.  So there is some real life experience
that this architecture change is feasible thing to do.</li>
<li>I also like to note that this proposal won&#8217;t remove all layer
specific code from MapServer e.g. <code class="docutils literal"><span class="pre">WMF</span></code>, <code class="docutils literal"><span class="pre">WMS</span></code> and <code class="docutils literal"><span class="pre">GRATICULE</span></code>
are used as special cases from place to place.</li>
</ul>
</div>
<div class="section" id="bug-id">
<h2>Bug ID<a class="headerlink" href="#bug-id" title="Bu başlığın kalıcı bağlantısı">¶</a></h2>
<p>Bug <a class="reference external" href="https://github.com/mapserver/mapserver/issues/1477">1477</a></p>
</div>
<div class="section" id="voting-history">
<h2>Voting history<a class="headerlink" href="#voting-history" title="Bu başlığın kalıcı bağlantısı">¶</a></h2>
<p>Vote proposed by Jani Averbach on 9/19/2005, result was +4
(3 non-voting members).</p>
<p>Voting +1: Howard Butler, Frank Warmerdam, Yewondwossen Assefa, Daniel Morissette</p>
<p>Proposal passes and will move forward.</p>
</div>
<div class="section" id="open-questions">
<h2>Open questions<a class="headerlink" href="#open-questions" title="Bu başlığın kalıcı bağlantısı">¶</a></h2>
<ul>
<li><p class="first">How do we like to expose layer&#8217;s virtual table to the layers. We
have at least two different routes to go:</p>
<ul class="simple">
<li>expose it as a struct, layers will fill vtable pointers by
accessing directly struct&#8217;s field.</li>
<li>expose it as a complete opaque type, vtable pointers will be set
by accessing functions <code class="docutils literal"><span class="pre">setLayerOpenFP</span></code>, <code class="docutils literal"><span class="pre">setLayerCloseFP</span></code> and
so on.</li>
</ul>
<p>The advance of second option is that this way we could easily add
new functions to the struct if we refactor code more or found some
logic which is ignored by oversight in this proposal.</p>
</li>
<li><p class="first">Are there any special issues with the raster query layer support
which is handled via the layer API?</p>
</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Hızlı Arama</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Git" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><h3>Navigation</h3>
<p>
<a href="../../about.html" title="About">About</a><br>
<a href="../../products.html" title="Products">Products</a><br>
<a href="../../community/index.html" title="Community">Community</a><br>
<a href="../index.html" title="Development">Development</a><br>
<a href="../../download.html" title="Downloads">Downloads</a><br>
<a href="../../documentation.html" title="Documentation">Documentation</a><br>
<a href="../../faq.html" title="FAQ">FAQ</a><br>
<a href="../../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">MS RFC 3: Feature Layer Plug-in Architecture</a><ul>
<li><a class="reference internal" href="#abstract-solution">Abstract Solution</a></li>
<li><a class="reference internal" href="#technical-solution">Technical Solution</a></li>
<li><a class="reference internal" href="#files-and-objects-affected">Files and objects affected</a></li>
<li><a class="reference internal" href="#backwards-compatibility-issues">Backwards compatibility issues</a></li>
<li><a class="reference internal" href="#implementation-issues">Implementation Issues</a></li>
<li><a class="reference internal" href="#bug-id">Bug ID</a></li>
<li><a class="reference internal" href="#voting-history">Voting history</a></li>
<li><a class="reference internal" href="#open-questions">Open questions</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Gezinti</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Genel Dizin"
             >dizin</a></li>
        <li class="right" >
          <a href="ms-rfc-4.html" title="MS RFC 4: MapServer Raster Resampling"
             >sonraki</a> |</li>
        <li class="right" >
          <a href="ms-rfc-2.html" title="MS RFC 2: Creating line features and/or shapes using WKT"
             >önceki</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Request for Comments</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; <a href="../../copyright.html">Copyright</a> 2018, Open Source Geospatial Foundation.
      Son güncelleme: 2018-07-27.
      <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.9 ile oluşturulmuştur.
    </div>
  </body>
</html>