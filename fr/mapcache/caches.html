
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="fr">
  <head>
    <meta charset="utf-8" />
    <title>Types de cache &#8212; MapServer 7.4.0 documentation</title>
    <link rel="stylesheet" href="../_static/sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    
    <link rel="shortcut icon" href="../_static/mapserver.ico"/>
    <link rel="author" title="À propos de ces documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="next" title="Formats d’image" href="formats.html" />
    <link rel="prev" title="Alimentation du cache" href="seed.html" /> 
  </head><body>

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../index.html" title="Home"><img src="../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../index.html" title="Home">Home</a> |
      <a href="../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a> |
      <a href="../download.html" title="Download Source or Binaries">Download </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        
          
            <a href="../../mapcache/caches.html"><img src="../_static/flagicons/en.png" alt="en" title="en" border="0" /></a>
          
        
        
          
            <a href="../../ar/mapcache/caches.html"><img src="../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
          
        
        
          
            <a href="../../de/mapcache/caches.html"><img src="../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
          
        
        
          
            <a href="../../el/mapcache/caches.html"><img src="../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
          
        
        
          
            <a href="../../es/mapcache/caches.html"><img src="../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
          
        
        <img src="../_static/flagicons/fr.png" alt="fr" title="fr" border="0" width="18px" height="13px"/>
        
          
            <a href="../../id/mapcache/caches.html"><img src="../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
          
        
        
          
            <a href="../../it/mapcache/caches.html"><img src="../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
          
        
        
          
            <a href="../../ja/mapcache/caches.html"><img src="../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
          
        
        
          
            <a href="../../nl_NL/mapcache/caches.html"><img src="../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
          
        
        
          
            <a href="../../pl/mapcache/caches.html"><img src="../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
          
        
        
          
            <a href="../../ru/mapcache/caches.html"><img src="../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
          
        
        
          
            <a href="../../sq/mapcache/caches.html"><img src="../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
          
        
        
          
            <a href="../../tr/mapcache/caches.html"><img src="../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
          
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Index général"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="formats.html" title="Formats d’image"
             accesskey="N">suivant</a> |</li>
        <li class="right" >
          <a href="seed.html" title="Alimentation du cache"
             accesskey="P">précédent</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../documentation.html" >MapServer 7.4.0 Documentation</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">MapCache 1.6.1</a> &#187;</li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="cache-types">
<span id="mapcache-caches"></span><h1>Types de cache<a class="headerlink" href="#cache-types" title="Lien permanent vers ce titre">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Author</dt>
<dd class="field-odd"><p>Thomas Bonfort</p>
</dd>
<dt class="field-even">Contact</dt>
<dd class="field-even"><p>tbonfort at terriscope.fr</p>
</dd>
</dl>
<p>Ce document détaille les différents backends pour le cache qui peuvent être utilisés pour stocker des tuiles.</p>
<div class="section" id="disk-caches">
<span id="mapcache-cache-disk"></span><h2>Caches disque<a class="headerlink" href="#disk-caches" title="Lien permanent vers ce titre">¶</a></h2>
<p>Le cache basé sur le stockage disque est le plus simple à configurer parmi les types de cache, et celui avec l’accès le plus rapide aux tuiles existantes. Il est idéal pour les petits dépôts de tuiles, mais peut souvent causer des problèmes pour les sites qui hébergent des millions de tuiles, comme le nombre de fichiers ou répertoire est susceptible de dépasser les capacités du système de fichier sous-jacent. En plus, la taille des blocs de fichiers choisis pour le système de fichiers doit correspondre le plus possible à la taille moyenne d’une tuile stockée: idéalement, n’importe quelle tuile devrait juste contenir dans un bloc de système de fichiers, afin de ne pas gaspiller de l’espace de stockage dans chaque bloc et ne pas utiliser plusieurs blocs par tuile.</p>
<p>L’emplacement des répertoires/fichiers doit être en lecture/écriture pour l’utilisateur qui fait fonctionner le serveur de tuiles.</p>
<div class="section" id="common-configuration">
<h3>Configuration commune<a class="headerlink" href="#common-configuration" title="Lien permanent vers ce titre">¶</a></h3>
<p>Les caches disques sont ajoutés via</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;disk_cache&quot;</span> <span class="na">type=</span><span class="s">&quot;disk&quot;</span> <span class="na">layout=</span><span class="s">&quot;...&quot;</span><span class="nt">&gt;</span>
  ...
  <span class="nt">&lt;symlink_blank/&gt;</span>
  <span class="nt">&lt;creation_retry&gt;</span>3<span class="nt">&lt;/creation_retry&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
<p>Tous les caches sauf le « template » supportent l’option &lt;symlink_blank/&gt; qui (selon sa disponibilité sur la plateforme) détecte les tuiles monochromes et crée un lien symbolique vers une tuile unique de la même couleur au lieu de stocker les données monochromes dans le fichier de tuile.</p>
<p>Tous les caches supportent l’option &lt;creation_retry&gt;, qui spécifie combien de fois MapCache doit réessayer de créer un fichier de tuile ou un lien symbolique lorsque la première tentative échoue. Par défaut MapCache abandonne immédiatement: Une valeur supérieure à 0 peut être judicieuse lorsqu’un système de fichiers réseau est utilisé et que les erreurs temporaires sont fréquentes.</p>
</div>
<div class="section" id="default-structure">
<h3>Structure par défaut<a class="headerlink" href="#default-structure" title="Lien permanent vers ce titre">¶</a></h3>
<p>Le système de stockage de tuiles par défaut stocke les tuiles dans une structure pratiquement identique à la hiérarchie de fichiers/répertoires utilisée par TileCache (une solution plus ancienne de mise en cache). Le seul changement est que la structure de répertoire de niveau le plus élevé correspondant au nom de la grille est ajouté (comme MapCache supporte de multiples grilles par jeux de tuiles)</p>
<p>Ce cache est capable de détecter les tuiles « blanches » (c’est à dire avec une couleur uniforme) et d’utiliser un lien symbolique vers une seule tuile « blanche »pour gagner de l’espace disque.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;disk&quot;</span> <span class="na">type=</span><span class="s">&quot;disk&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;base&gt;</span>/tmp<span class="nt">&lt;/base&gt;</span>
   <span class="nt">&lt;symlink_blank/&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
<p>Les deux seules clés dans la configuration sont le répertoire racine où les tuiles seront stockées, et la clé pour activer la mise en lien symbolique des tuiles vides.</p>
</div>
<div class="section" id="arcgis-compatible-structure">
<h3>Structure compatible Arcgis<a class="headerlink" href="#arcgis-compatible-structure" title="Lien permanent vers ce titre">¶</a></h3>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;arcgis&quot;</span> <span class="na">type=</span><span class="s">&quot;disk&quot;</span> <span class="na">layout=</span><span class="s">&quot;arcgis&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;base&gt;</span>/tmp<span class="nt">&lt;/base&gt;</span>
   <span class="nt">&lt;symlink_blank/&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
<p>Cette disposition crée une structure de tuiles compatible avec un cache arcgis éclaté. Les tuiles sont stockées dans des fichiers dont le chemin suit le schéma <cite>/tmp/{tileset}/{grid}/{dimension}/L{z}/R{y}/C{x}.{ext}</cite></p>
</div>
<div class="section" id="worldwind-compatible-structure">
<h3>Structure compatible Worldwind<a class="headerlink" href="#worldwind-compatible-structure" title="Lien permanent vers ce titre">¶</a></h3>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;worldwind&quot;</span> <span class="na">type=</span><span class="s">&quot;disk&quot;</span> <span class="na">layout=</span><span class="s">&quot;worldwind&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;base&gt;</span>/tmp<span class="nt">&lt;/base&gt;</span>
   <span class="nt">&lt;symlink_blank/&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
<p>Cette disposition crée une structure de tuiles compatible avec un cache Worldwind. Les tuiles sont stockées dans des fichiers dont le chemin suit le schéma <cite>/tmp/{tileset}/{grid}/{dimension}/{z}/{y}/{y}_{x}.ext</cite></p>
</div>
<div class="section" id="template-structure">
<h3>Structure de « template »<a class="headerlink" href="#template-structure" title="Lien permanent vers ce titre">¶</a></h3>
<p>Le modèle basé sur le cache disque vous permet de créer (ou réutiliser) une structure de tuiles (existante) que vous avez défini à l’avance. Le paramètre &lt;template&gt; prend une chaîne en argument où les différentes entrées du modèle seront remplacées à l’exécution par la valeur correcte pour chacune des tuiles à stocker.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;tmpl&quot;</span> <span class="na">type=</span><span class="s">&quot;disk&quot;</span> <span class="na">layout=</span><span class="s">&quot;template&quot;</span><span class="nt">&gt;</span>
   <span class="c">&lt;!-- template</span>

<span class="c">       string template that will be used to map a tile (by tileset, grid name, dimension,</span>
<span class="c">       format, x, y, and z) to a filename on the filesystem</span>
<span class="c">       the following replacements are performed:</span>
<span class="c">       - {tileset} : the tileset name</span>
<span class="c">       - {grid} : the grid name</span>
<span class="c">       - {dim} : a string that concatenates the tile&#39;s dimension</span>
<span class="c">       - {ext} : the filename extension for the tile&#39;s image format</span>
<span class="c">       - {x},{y},{z} : the tile x,y,z values</span>
<span class="c">       - {inv_x}, {inv_y}, {inv_z} : inverted x,y,z values (inv_x = level-&gt;maxx - x - 1). This</span>
<span class="c">            is mainly used to support grids where one axis is inverted (e.g. the google schema)</span>
<span class="c">            and you want to create on offline cache.</span>

<span class="c">      * Note that this type of cache does not support blank-tile detection and symlinking.</span>

<span class="c">      * Warning: It is up to you to make sure that the template you chose creates a unique</span>
<span class="c">        filename for your given tilesets. e.g. do not omit the {grid} parameter if your</span>
<span class="c">        tilesets reference multiple grids. Failure to do so will result in filename</span>
<span class="c">        collisions !</span>

<span class="c">   --&gt;</span>
   <span class="nt">&lt;template&gt;</span>/tmp/template-test/{tileset}#{grid}#{dim}/{z}/{x}/{y}.{ext}<span class="nt">&lt;/template&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="berkeley-db-caches">
<span id="mapcache-cache-bdb"></span><h2>Caches Berkeley DB<a class="headerlink" href="#berkeley-db-caches" title="Lien permanent vers ce titre">¶</a></h2>
<p>Le cache du backend Berkeley DB stocke les tuiles dans une base de données clé-valeur à plat et donc n’a pas les désavantages des caches disques au regard du nombre de fichiers de tuiles stockées sur le système de fichiers. Comme les « blobs » d’images sont stockés de manière contiguë, la taille du bloc choisi pour le système de fichiers n’a pas d’influence sur la capacité de stockage du volume.</p>
<p>Notez que pour un cache Berkeley DB donné, seul un seul fichier de base de données est créé, qui stockera les tuiles des jeux de tuiles associés (c’est à dire qu’il n’y a pas de fichier de base de données créé par jeu de tuiles, grilles, et/ou dimensions). Si vous avez besoin de stocker différents jeux de donnés dans différents fichiers, alors utilisez de multiples entrées dans le cache Berkeley DB. Il n’est pas possible d’utiliser de multiples fichiers de base de données pour des grilles de jeux de tuiles ou des dimensions.</p>
<p>Les caches basés sur Berkeley DB sont un peu plus rapides que les caches basés sur le stockage disque mais sont un peu plus lents pour les écritures concurrentes si de nombreux threads essayent tous d’insérer des tuiles de manière concurrente.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;bdb&quot;</span> <span class="na">type=</span><span class="s">&quot;bdb&quot;</span><span class="nt">&gt;</span>
   <span class="c">&lt;!-- base (required)</span>
<span class="c">      absolute filesystem path where the Berkeley DB database file is to be stored.</span>
<span class="c">      this directory must exist, and be writable</span>
<span class="c">   --&gt;</span>
   <span class="nt">&lt;base&gt;</span>/tmp/foo/<span class="nt">&lt;/base&gt;</span>

   <span class="c">&lt;!-- key_template (optional)</span>
<span class="c">      string template used to create the key for a tile entry in the database.</span>
<span class="c">      defaults to the value below. you should include {tileset}, {grid} and {dim} here</span>
<span class="c">      unless you know what you are doing, or you will end up with mixed tiles</span>
<span class="c">   &lt;key_template&gt;{tileset}-{grid}-{dim}-{z}-{y}-{x}.{ext}&lt;/key_template&gt;</span>
<span class="c">   --&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="sqlite-caches">
<span id="mapcache-cache-sqlite"></span><h2>Caches SQLite<a class="headerlink" href="#sqlite-caches" title="Lien permanent vers ce titre">¶</a></h2>
<p>Il y a deux caches SQLite différents qui varient par le schéma de la base de données qu’ils créent et interrogent. Les caches SQLite ont l’avantage de stocker les tuiles dans des « blobs » dans un seul fichier de base de données et donc ils n’ont pas les désavantages des caches disques au regard du nombre de fichiers de tuiles stockées. Comme les « blobs » d’images sont stockés de manière contiguë, la taille du bloc choisi pour le système de fichiers n’a pas d’influence sur la capacité de stockage du volume.</p>
<p>Les caches SQLite sont un peu plus lents que les caches disques, et peuvent avoir des problèmes de blocage en écriture au moment du remplissage si un nombre élevé de threads essaient tous d’insérer de nouvelles tuiles en même temps.</p>
<div class="section" id="default-schema">
<h3>Schéma par défaut<a class="headerlink" href="#default-schema" title="Lien permanent vers ce titre">¶</a></h3>
<p>Les tuiles sont stockées dans le fichier SQLite configuré créé par MapCache avec</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">create</span> <span class="k">table</span> <span class="k">if</span> <span class="k">not</span> <span class="k">exists</span> <span class="n">tiles</span><span class="p">(</span>
   <span class="n">tileset</span> <span class="nb">text</span><span class="p">,</span>
   <span class="n">grid</span> <span class="nb">text</span><span class="p">,</span>
   <span class="n">x</span> <span class="nb">integer</span><span class="p">,</span>
   <span class="n">y</span> <span class="nb">integer</span><span class="p">,</span>
   <span class="n">z</span> <span class="nb">integer</span><span class="p">,</span>
   <span class="k">data</span> <span class="nb">blob</span><span class="p">,</span>
   <span class="n">dim</span> <span class="nb">text</span><span class="p">,</span>
   <span class="n">ctime</span> <span class="n">datetime</span><span class="p">,</span>
   <span class="k">primary</span> <span class="k">key</span><span class="p">(</span><span class="n">tileset</span><span class="p">,</span><span class="n">grid</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">dim</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;sqlite&quot;</span> <span class="na">type=</span><span class="s">&quot;sqlite3&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;dbfile&gt;</span>/path/to/dbfile.sqlite3<span class="nt">&lt;/dbfile&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
<p>Vous pouvez également ajouter des commandes pragmas SQLite personnalisées qui seront exécutées lors de la première connexion à la base de données, de façon à modifier les réglages SQlite par défaut</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;sqlite&quot;</span> <span class="na">type=</span><span class="s">&quot;sqlite3&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;dbfile&gt;</span>/tmp/sqlitefile.db<span class="nt">&lt;/dbfile&gt;</span>
   <span class="nt">&lt;pragma</span> <span class="na">name=</span><span class="s">&quot;max_page_count&quot;</span><span class="nt">&gt;</span>10000000<span class="nt">&lt;/pragma&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
<p>Les entrées &lt;pragma&gt; résulteront en un appel à</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">PRAGMA</span> <span class="n">max_page_count</span> <span class="o">=</span> <span class="mi">1000000</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="custom-schema">
<h3>Schéma personnalisé<a class="headerlink" href="#custom-schema" title="Lien permanent vers ce titre">¶</a></h3>
<p>Ce cache peut utiliser n’importe quel schéma de base de données. C’est à vous de fournir le SQL qui sera utilisé pour sélectionner ou insérer une nouvelle tuile.</p>
<p>Afin d’utiliser cette fonctionnalité, vous devez fournir les requêtes SQL que MapCache utilisera sur votre schéma personnalisé. Il est de votre responsabilité de vous assurer que les requêtes sont correctes et renvoient les bonnes données pour un jeu de tuiles, une dimension une grille et des coordonnées x, y et z donnés.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;sqlitecustom&quot;</span> <span class="na">type=</span><span class="s">&quot;sqlite3&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;dbfile&gt;</span>/tmp/sqlitefile.db<span class="nt">&lt;/dbfile&gt;</span>
   <span class="nt">&lt;queries&gt;</span>
     <span class="nt">&lt;create&gt;</span>create table if not exists tiles(tileset text, grid text, x integer, y integer, z integer, data blob, dim text, ctime datetime, primary key(tileset,grid,x,y,z,dim))<span class="nt">&lt;/create&gt;</span>
     <span class="nt">&lt;exists&gt;</span>select 1 from tiles where x=:x and y=:y and z=:z and dim=:dim and tileset=:tileset and grid=:grid<span class="nt">&lt;/exists&gt;</span>
     <span class="nt">&lt;get&gt;</span>select data,strftime(&quot;%s&quot;,ctime) from tiles where tileset=:tileset and grid=:grid and x=:x and y=:y and z=:z and dim=:dim<span class="nt">&lt;/get&gt;</span>
     <span class="nt">&lt;set&gt;</span>insert or replace into tiles(tileset,grid,x,y,z,data,dim,ctime) values (:tileset,:grid,:x,:y,:z,:data,:dim,datetime(&#39;now&#39;))<span class="nt">&lt;/set&gt;</span>
     <span class="nt">&lt;delete&gt;</span>delete from tiles where x=:x and y=:y and z=:z and dim=:dim and tileset=:tileset and grid=:grid<span class="nt">&lt;/delete&gt;</span>
   <span class="nt">&lt;/queries&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
<p>Il est important de noter que dans le cas de la requête &lt;get&gt; qui renvoie les données relatives à une tuile, le premier argument renvoyé est le « blob » d’image et le deuxième argument, optionnel, est la date de création de la tuile.</p>
</div>
<div class="section" id="blank-tile-detection">
<h3>Détection de tuile vide<a class="headerlink" href="#blank-tile-detection" title="Lien permanent vers ce titre">¶</a></h3>
<p>Les caches SQLites de MapCache supportent la détection et le stockage des tuiles vides (c’est-à-dire monochromes), et stockent dans le « blob » d’image les quatre octets de la composante RGBA de la couleur. Sur requête d’un client, ces quatre octets sont alors convertis à la volée en une image d’un pixel au format PNG à couleurs indexées.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;sqliteblank&quot;</span> <span class="na">type=</span><span class="s">&quot;sqlite3&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;dbfile&gt;</span>/tmp/sqlitefile.db<span class="nt">&lt;/dbfile&gt;</span>
   <span class="nt">&lt;detect_blank/&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Les fichiers SQLite créés avec cette option ne pourront être pleinenemt exploités que par MapCache, puisque les « blobs » images des tuiles sont susceptibles de contenir un quadruplet #RGBA au lieu de données PNG ou JPEG.</p>
</div>
</div>
<div class="section" id="using-multiple-sqlite-database-files">
<span id="mapcache-cache-multisqlite"></span><h3>Utilisation de fichiers SQLite multiples<a class="headerlink" href="#using-multiple-sqlite-database-files" title="Lien permanent vers ce titre">¶</a></h3>
<p>Il est possible de découper un cache SQLite en plusieurs fichiers, pour des besoins d’organisation ou pour conserver des fichiers de taille raisonnable lorsque de gros volumes de données sont à cacher.</p>
<p>Pour ce faire, il est possible d’utiliser un schéma de nommage pour déterminer quel fichier utiliser pour une tuile donnée:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;sqlite&quot;</span> <span class="na">type=</span><span class="s">&quot;sqlite3&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;dbfile&gt;</span>/path/to/{grid}/{dim}/{tileset}.sqlite3<span class="nt">&lt;/dbfile&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
<p>Il est également possible de limiter le nombre de tuiles en x et en y à stocker dans un fichier SQLite:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;sqlite&quot;</span> <span class="na">type=</span><span class="s">&quot;sqlite3&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;dbfile&gt;</span>/path/to/{grid}/{dim}/{tileset}/{z}/{x}-{y}.sqlite3<span class="nt">&lt;/dbfile&gt;</span>
   <span class="nt">&lt;xcount&gt;</span>1000<span class="nt">&lt;/xcount&gt;</span>
   <span class="nt">&lt;ycount&gt;</span>1000<span class="nt">&lt;/ycount&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
<p>Dans ce cas, vous <strong>devez</strong> inclure les variables de remplacement {x}, {y} et {z} dans le schéma de nommage qui détermine le fichier à utiliser. Dans l’exemple précédent, la tuile (z,x,y)=(15,3024,1534) est stockée dans un fichier nommé /path/to/g/mytileset/15/3000-1000.sqlite3 et la tuile (5,2,8) est stockée dans un fichier nommé /path/to/g/mytileset/5/0-0.sqlite3</p>
<p>Les paramètres suivants sont disponibles pour manipuler les x,y et z d’une tuile donnée:</p>
<ul class="simple">
<li><p><cite>{z}</cite> est remplacé par le niveau de zoom.</p></li>
<li><p><cite>{x}</cite> est remplacé par l’abscisse de la tuile la plus à gauche dans le fichier SQLite qui contient la tuile demandée.</p></li>
<li><p><cite>{inv_x}</cite> est remplacé par l’abscisse de la tuile la plus à droite.</p></li>
<li><p><cite>{y}</cite> est remplacé par l’ordonnée de la tuile la plus en bas.</p></li>
<li><p><cite>{inv_y}</cite> est remplacé par l’ordonnée de la tuile la plus en haut.</p></li>
<li><p><cite>{div_x}</cite> est remplacé par l’indice du fichier SQLite en partant de la gauche de la grille (càd. <cite>{div_x} = {x}/&lt;xcount&gt;</cite>).</p></li>
<li><p><cite>{inv_div_x}</cite> est semblable à <cite>{div_x}</cite> mais en partant de la droite.</p></li>
<li><p><cite>{div_y}</cite> est remplacé par l’indice du fichier SQLite en partant du bas de la grille (càd. <cite>{div_y} = {y}/&lt;ycount&gt;</cite>).</p></li>
<li><p><cite>{inv_div_y}</cite> est semblable à <cite>{div_y}</cite> mais en partant du haut.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><cite>{inv_x}</cite> et <cite>{inv_div_x}</cite> seront probablement rarement utilisés, tandis que <cite>{inv_y}</cite> et <cite>{inv_div_y}</cite> peuvent trouver une utilité pour les personnes qui préfèrent numéroter leurs fichiers SQLite de haut en bas plutôt que de bas en haut.</p>
</div>
<p>Dans certains cas il peut être souhaitable de maîtriser précisément le nom du fichier à utiliser pour une recherche d’une tuile x,y,z, par exemple un fichier nommé <cite>Z03-R00003-C000009.sqlite3</cite> plutôt que simplement <cite>Z3-R3-C9.sqlite3</cite>. l’élément &lt;dbfile&gt; supporte des attributs de format dont la syntaxe est calquée sur le <code class="docutils literal notranslate"><span class="pre">printf()</span></code> Unix (voir: <a class="reference external" href="http://linux.die.net/man/3/printf">http://linux.die.net/man/3/printf</a> ). Ces attributs sont nommés d’après la variable de substitution correspondante en ajoutant le suffixe « _fmt », par exemple:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;mysqlite&quot;</span> <span class="na">type=</span><span class="s">&quot;sqlite3&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;dbfile</span>
      <span class="na">x_fmt=</span><span class="s">&quot;%08d&quot;</span>
      <span class="na">inv_y_fmt=</span><span class="s">&quot;%08d&quot;</span>
   <span class="nt">&gt;</span>/data/{tileset}/{grid}/L{z}/R{inv_y}/C{x}.sqlite<span class="nt">&lt;/template&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Sans indication, le fonctionnement par défaut utilise « %d » pour le formatage.</p>
</div>
</div>
</div>
<div class="section" id="mbtiles-caches">
<span id="mapcache-cache-mbtiles"></span><h2>Caches MBTiles<a class="headerlink" href="#mbtiles-caches" title="Lien permanent vers ce titre">¶</a></h2>
<p>Ce type de cache est un raccourci du schéma de cache SQLite personnalisée ci-dessus, avec des requêtes SQL pré-remplies correspondant aux spécifications MBTiles.</p>
<p>Bien que le schéma MBTiles par défaut soit très simple, MapCache utilise le même schéma multi-tables que l’on retrouve dans la plupart des fichiers MBTiles téléchargeables, principalement afin de permettre le stockage des tuiles vides (monochromes) sans avoir à dupliquer les données (de la même manière que le cache disque utilise des liens symboliques vers un fichier unique).</p>
<p>Le schéma MBTiles est créé avec:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">create</span> <span class="k">table</span> <span class="k">if</span> <span class="k">not</span> <span class="k">exists</span> <span class="n">images</span><span class="p">(</span>
  <span class="n">tile_id</span> <span class="nb">text</span><span class="p">,</span>
  <span class="n">tile_data</span> <span class="nb">blob</span><span class="p">,</span>
  <span class="k">primary</span> <span class="k">key</span><span class="p">(</span><span class="n">tile_id</span><span class="p">));</span>
<span class="k">create</span> <span class="k">table</span> <span class="k">if</span> <span class="k">not</span> <span class="k">exists</span> <span class="k">map</span> <span class="p">(</span>
  <span class="n">zoom_level</span> <span class="nb">integer</span><span class="p">,</span>
  <span class="n">tile_column</span> <span class="nb">integer</span><span class="p">,</span>
  <span class="n">tile_row</span> <span class="nb">integer</span><span class="p">,</span>
  <span class="n">tile_id</span> <span class="nb">text</span><span class="p">,</span>
  <span class="k">foreign</span> <span class="k">key</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span> <span class="k">references</span> <span class="n">images</span><span class="p">(</span><span class="n">tile_id</span><span class="p">),</span>
  <span class="k">primary</span> <span class="k">key</span><span class="p">(</span><span class="n">tile_row</span><span class="p">,</span><span class="n">tile_column</span><span class="p">,</span><span class="n">zoom_level</span><span class="p">));</span>
<span class="k">create</span> <span class="k">table</span> <span class="k">if</span> <span class="k">not</span> <span class="k">exists</span> <span class="n">metadata</span><span class="p">(</span>
  <span class="n">name</span> <span class="nb">text</span><span class="p">,</span>
  <span class="n">value</span> <span class="nb">text</span><span class="p">);</span> <span class="c1">-- not used or populated yet</span>
<span class="k">create</span> <span class="k">view</span> <span class="k">if</span> <span class="k">not</span> <span class="k">exists</span> <span class="n">tiles</span>
  <span class="k">as</span> <span class="k">select</span>
     <span class="k">map</span><span class="p">.</span><span class="n">zoom_level</span> <span class="k">as</span> <span class="n">zoom_level</span><span class="p">,</span>
     <span class="k">map</span><span class="p">.</span><span class="n">tile_column</span> <span class="k">as</span> <span class="n">tile_column</span><span class="p">,</span>
     <span class="k">map</span><span class="p">.</span><span class="n">tile_row</span> <span class="k">as</span> <span class="n">tile_row</span><span class="p">,</span>
     <span class="n">images</span><span class="p">.</span><span class="n">tile_data</span> <span class="k">as</span> <span class="n">tile_data</span>
  <span class="k">from</span> <span class="k">map</span>
     <span class="k">join</span> <span class="n">images</span> <span class="k">on</span> <span class="n">images</span><span class="p">.</span><span class="n">tile_id</span> <span class="o">=</span> <span class="k">map</span><span class="p">.</span><span class="n">tile_id</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;mbtiles&quot;</span> <span class="na">type=</span><span class="s">&quot;mbtiles&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;dbfile&gt;</span>/Users/XXX/Documents/MapBox/tiles/natural-earth-1.mbtiles<span class="nt">&lt;/dbfile&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Contrairement au schéma standard SQLite de MapCache, le fichier MBTiles n’accepte qu’un jeu de tuiles par cache. Le comportement si plusieurs jeux de tuiles sont associées au même cache n’est pas défini, et produira certainement des résultats incorrects.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Avertissement</p>
<p>Lorsqu’on travaille avec plusieurs processus (option -p) et caches SQLites, des erreurs sont susceptibles d’apparaître en situation de forte concurrence lors d’écritures dans la base SQLite (erreur: SQL logic error or missing database (1)). Une mise à niveau de SQLite en version supérieure ou égale à 3.7.15 semble résoudre le problème.</p>
</div>
</div>
<div class="section" id="memcache-caches">
<span id="mapcache-cache-memcache"></span><h2>Caches Memcache<a class="headerlink" href="#memcache-caches" title="Lien permanent vers ce titre">¶</a></h2>
<p>Ce type de cache stocke les tuiles au sein d’un serveur memcached externe, fonctionnant soit sur la machine elle-même soit accessible via le réseau. Ce type de cache a l’avantage de bien gérer l’expiration des tuiles, de sorte que la taille du cache ne dépassera jamais ce qui a été configuré dans l’instance memcache.</p>
<p>L’utilisation de Memcache nécessite une version plutôt récente de la librairie apr-util. Veuillez noter que sous de très fortes charges (généralement uniquement atteignable via des outils de benchmarking en localhost), l’implémentation memcache d’apr-util peut tomber et se mettre à abandonner les connexions pendant quelques intervalles de temps avant de revenir à la normale.</p>
<p>Vous pouvez ajouter de multiple entrées &lt;server&gt;.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;memcache&quot;</span> <span class="na">type=</span><span class="s">&quot;memcache&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;server&gt;</span>
      <span class="nt">&lt;host&gt;</span>localhost<span class="nt">&lt;/host&gt;</span>
      <span class="nt">&lt;port&gt;</span>11211<span class="nt">&lt;/port&gt;</span>
   <span class="nt">&lt;/server&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Les tuiles stockées au travers de memcache sont configurées pour expirer au bout d’une journée par défaut. Ce réglage peut être modifié au niveau du jeu de données en utilisant le mot-clé &lt;auto_expire&gt;.</p>
</div>
<p>Afin de réduire la mémoire utilisée par les tuiles vide dans l’instance memcache, vous pouvez activer la détection des tuiles vides, auquel cas un quadruplet <cite>#RGBA</cite> est stocké dans le cache en lieu et place des véritables données d’image. Sur requête d’un client, ces quatre octets sont alors convertis à la volée en une image d’un pixel au format PNG à couleurs indexées.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;memcache&quot;</span> <span class="na">type=</span><span class="s">&quot;memcache&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;detect_blank/&gt;</span>
   ...
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="geo-tiff-caches">
<span id="mapcache-cache-tiff"></span><h2>Caches (Geo)TIFF<a class="headerlink" href="#geo-tiff-caches" title="Lien permanent vers ce titre">¶</a></h2>
<p>Les caches TIFF sont le plus récent ajout à la famille des caches. Ils utilisent la structure interne tuilée de la spécification TIFF pour accéder aux données tuilées. Les tuiles ne peuvent être stockées qu’en JPEG (TIFF n’implémente pas le format PNG).</p>
<p>Comme un fichier TIFF unique peut contenir beaucoup de tuiles, il y a une réduction drastique du nombre de fichiers qui doivent être stockés sur le système de fichiers, ce qui résoud les principaux défauts des caches disques. Un autre avantage est que les mêmes fichiers TIFF peuvent être utilisés par des logiciels ou des serveurs WMS qui n’accèdent qu’à des formats SIG raster courants tout en étant utilisés pour un accès tuilé hautes performances.</p>
<p>Le cache TIFF doit être considéré comme étant en lecture-seule pour le moment. L’accès en écriture est déjà possible mais doit être considéré comme expérimental en cela qu’il peut y avoir des problèmes de corruption de fichier, surtout dans le contexte de montages réseaux du système de fichiers. Veuillez noter que jusqu’à ce que toutes les tuiles d’un fichier TIFF donné aient été générées, le fichier TIFF est réputé « clairsemé » au sens qu’il manque des tuiles. La plupart des logiciels autres que GDAL auront des difficultés à ouvrir ces fichiers incomplets.</p>
<p>Veuillez noter que la structure des tuiles TIFF doit respecter exactement la structure de la grille devant être utilisée par le jeu de tuile, et les noms des fichiers TIFF doivent respecter de strictes conventions de nommage.</p>
<div class="section" id="defining-the-tiff-file-sizes">
<h3>Définition des tailles de fichiers TIFF<a class="headerlink" href="#defining-the-tiff-file-sizes" title="Lien permanent vers ce titre">¶</a></h3>
<p>Le nombre de tuiles stockées dans chacune des directions horizontales et verticales doit être défini:</p>
<ul class="simple">
<li><p>&lt;xcount&gt; le nombre de tuiles stocké le long de la direction x (horizontal) du fichier TIFF</p></li>
<li><p>&lt;ycount&gt; le nombre de tuiles stocké le long de la direction y (horizontal) du fichier TIFF</p></li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;tiff&quot;</span> <span class="na">type=</span><span class="s">&quot;tiff&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;xcount&gt;</span>64<span class="nt">&lt;/xcount&gt;</span>
   <span class="nt">&lt;ycount&gt;</span>64<span class="nt">&lt;/ycount&gt;</span>
   ...
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="setting-up-the-file-naming-convention">
<h3>Configuration de la convention de nommage des fichiers<a class="headerlink" href="#setting-up-the-file-naming-convention" title="Lien permanent vers ce titre">¶</a></h3>
<p>Le tag &lt;template&gt; détermine le modèle à utiliser lors de la recherche d’un fichier TIFF en fonction des x,y,z de la tuile demandée</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;tiff&quot;</span> <span class="na">type=</span><span class="s">&quot;tiff&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;template&gt;</span>/data/tiffs/{tileset}/{grid}/L{z}/R{inv_y}/C{x}.tif<span class="nt">&lt;/template&gt;</span>
   ...
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
<p>Les paramètres suivants sont disponibles pour manipuler les x,y et z d’une tuile donnée:</p>
<ul class="simple">
<li><p>{x} est remplacé par la valeur x de la tuile la plus à gauche dans le fichier TIFF contenant la tuile demandée.</p></li>
<li><p>{inv_x} est remplacé par la valeur x de la tuile la plus à droite</p></li>
<li><p>{y} est remplacé par la valeur y de la tuile la plus en bas</p></li>
<li><p>{inv_y} est remplacé par la valeur y de la tuile la plus en haut</p></li>
<li><p>{div_x} est remplacé par l’index du fichier TIFF commençant à gauche de la grille (i.e. {div_x} = {x}/&lt;xcount&gt;)</p></li>
<li><p>{inv_div_x} comme {div_x} mais en commençant à droite.</p></li>
<li><p>{div_y} est remplacé par l’index du fichier TIFF commençant au bas de la grille (i.e. {div_y} = {y}/&lt;ycount&gt;)</p></li>
<li><p>{inv_div_y} est similaire {div_y} mais en commençant par le haut.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>{inv_x} et {inv_div_x} seront probablement rarement utilisés, tandis que {inv_y} et {inv_div_y} trouveront un usage approprié pour les personnes préférant indexer leurs fichiers TIFF de haut en bas plutôt que de bas en haut.</p>
</div>
</div>
<div class="section" id="customizing-the-template-keys">
<h3>Personnalisation des clés du « template »<a class="headerlink" href="#customizing-the-template-keys" title="Lien permanent vers ce titre">¶</a></h3>
<p>Dans certains cas, il peut être souhaitable d’avoir un contrôle précis sur le nom du fichier à utiliser pour une tuile x,y,z particulière, par exemple pour retrouver un fichier nommé « Z03-R00003-C000009.tif » plutôt que « Z3-R3-C9.tif ». Le paramètre &lt;template&gt; permet d’utiliser des éléments de formatage pour peu qu’ils suivent la syntaxe unix printf ( c.f.: <a class="reference external" href="http://linux.die.net/man/3/printf">http://linux.die.net/man/3/printf</a> ), en suffixant chacun des éléments &lt;template&gt; avec « _fmt » comme par exemple :</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;tiff&quot;</span> <span class="na">type=</span><span class="s">&quot;tiff&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;template</span>
      <span class="na">x_fmt=</span><span class="s">&quot;%08d&quot;</span>
      <span class="na">inv_y_fmt=</span><span class="s">&quot;%08d&quot;</span>
   <span class="nt">&gt;</span>/data/tiffs/{tileset}/{grid}/L{z}/R{inv_y}/C{x}.tif<span class="nt">&lt;/template&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Sans indication, le fonctionnement par défaut utilise « %d » pour le formatage.</p>
</div>
</div>
<div class="section" id="setting-jpeg-compression-options">
<h3>Définition des options de compression JPEG<a class="headerlink" href="#setting-jpeg-compression-options" title="Lien permanent vers ce titre">¶</a></h3>
<p>Un paramètre optionnel complémentaire définit la compression JPEG à appliquer aux tuiles quand elles sont enregistrées dans le fichier TIFF:</p>
<ul class="simple">
<li><p>&lt;format&gt; le nom du format (JPEG) à utiliser</p></li>
</ul>
<div class="admonition seealso">
<p class="admonition-title">Voir aussi</p>
<p><a class="reference internal" href="formats.html#mapcache-jpeg-format"><span class="std std-ref">Format JPEG</span></a></p>
</div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;tiff&quot;</span> <span class="na">type=</span><span class="s">&quot;tiff&quot;</span><span class="nt">&gt;</span>
   ...
   <span class="nt">&lt;format&gt;</span>myjpeg<span class="nt">&lt;/format&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
<p>Dans cet exemple, en utilisant une grille de 256x256 tuiles, les fichiers qui sont lus pour charger les tuiles sont des TIFFs tuilés avec une compression JPEG, dont la taille est de 16384x16384. Le nombre de fichiers à stocker sur le disque est ainsi réduit 4096 fois comparativement à un cache disque standard.</p>
</div>
<div class="section" id="using-a-specific-locker">
<h3>Utilisation d’un verrou spécifique<a class="headerlink" href="#using-a-specific-locker" title="Lien permanent vers ce titre">¶</a></h3>
<p>MapCache a besoin de créer un <a class="reference internal" href="locks.html#mapcache-locks"><span class="std std-ref">verrou</span></a> pour écrire dans un fichier TIFF afin d’éviter que deux instances ne modifient le même fichier simultanément. Par défaut le verrou global de MapCache est utilisé. Toutefois, il est possible de configurer un mécanisme ou un comportement de verrouillage différent en le configurant à l’intérieur du cache TIFF proprement dit.</p>
<div class="admonition seealso">
<p class="admonition-title">Voir aussi</p>
<p><a class="reference internal" href="locks.html#mapcache-locks"><span class="std std-ref">Locking Mechanisms</span></a></p>
</div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;tiff&quot;</span> <span class="na">type=</span><span class="s">&quot;tiff&quot;</span><span class="nt">&gt;</span>
   ...
   <span class="nt">&lt;locker&gt;</span> .... <span class="nt">&lt;/locker&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="geotiff-support">
<h3>Support GeoTIFF<a class="headerlink" href="#geotiff-support" title="Lien permanent vers ce titre">¶</a></h3>
<p>S’il est compilé avec le support GeoTIFF en écriture, MapCache ajoutera les informations de référencement aux fichiers TIFF qu’il créé, de sorte que les fichiers TIFF puissent être utilisés par n’importe quel logiciel utilisant du GeoTIFF. Le support en écriture ne produit pas des GeoTIFFs complets avec la définition de la projection utilisée, mais uniquement l’échelle du pixel et les points de calage, ce qu’on trouve généralement dans les fichiers .tfw.</p>
<p>Pour référence, voici la sortie produite par gdalinfo sur une fichier TIFF créé par MapCache quand il est compilé avec le support GeoTIFF:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LOCAL_CS</span><span class="p">[</span><span class="s2">&quot;unnamed&quot;</span><span class="p">,</span>
    <span class="n">UNIT</span><span class="p">[</span><span class="s2">&quot;metre&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">AUTHORITY</span><span class="p">[</span><span class="s2">&quot;EPSG&quot;</span><span class="p">,</span><span class="s2">&quot;9001&quot;</span><span class="p">]]]</span>
<span class="n">Origin</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">20037508.342789247632027</span><span class="p">,</span><span class="mf">20037508.342789247632027</span><span class="p">)</span>
<span class="n">Pixel</span> <span class="n">Size</span> <span class="o">=</span> <span class="p">(</span><span class="mf">156543.033928040997125</span><span class="p">,</span><span class="o">-</span><span class="mf">156543.033928040997125</span><span class="p">)</span>
<span class="n">Metadata</span><span class="p">:</span>
  <span class="n">AREA_OR_POINT</span><span class="o">=</span><span class="n">Area</span>
<span class="n">Image</span> <span class="n">Structure</span> <span class="n">Metadata</span><span class="p">:</span>
  <span class="n">COMPRESSION</span><span class="o">=</span><span class="n">YCbCr</span> <span class="n">JPEG</span>
  <span class="n">INTERLEAVE</span><span class="o">=</span><span class="n">PIXEL</span>
  <span class="n">SOURCE_COLOR_SPACE</span><span class="o">=</span><span class="n">YCbCr</span>
<span class="n">Corner</span> <span class="n">Coordinates</span><span class="p">:</span>
<span class="n">Upper</span> <span class="n">Left</span>  <span class="p">(</span><span class="o">-</span><span class="mf">20037508.343</span><span class="p">,</span><span class="mf">20037508.343</span><span class="p">)</span>
<span class="n">Lower</span> <span class="n">Left</span>  <span class="p">(</span><span class="o">-</span><span class="mf">20037508.343</span><span class="p">,</span><span class="o">-</span><span class="mf">20037508.343</span><span class="p">)</span>
<span class="n">Upper</span> <span class="n">Right</span> <span class="p">(</span><span class="mf">20037508.343</span><span class="p">,</span><span class="mf">20037508.343</span><span class="p">)</span>
<span class="n">Lower</span> <span class="n">Right</span> <span class="p">(</span><span class="mf">20037508.343</span><span class="p">,</span><span class="o">-</span><span class="mf">20037508.343</span><span class="p">)</span>
<span class="n">Center</span>      <span class="p">(</span>   <span class="mf">0.0000000</span><span class="p">,</span>   <span class="mf">0.0000000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="rest-caches">
<span id="mapcache-cache-rest"></span><h2>Caches REST<a class="headerlink" href="#rest-caches" title="Lien permanent vers ce titre">¶</a></h2>
<p>Les types de caches suivants stockent et récupèrent les tuiles via des opérations HTTP standard GET et PUT. Ils peuvent être utilisés pour stocker les tuiles chez des fournisseurs populaires de stockage « cloud ».</p>
<div class="section" id="pure-rest-cache">
<h3>Cache REST pur<a class="headerlink" href="#pure-rest-cache" title="Lien permanent vers ce titre">¶</a></h3>
<p>Ce type de cache peut être utilisé pour stocker des tuiles sur un serveur WebDAV. Il est nécessaire de fournir un schéma d’URL à utiliser pour accéder à une tuile selon ses paramètres x,y,z, etc.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;myrestcache&quot;</span> <span class="na">type=</span><span class="s">&quot;rest&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;url&gt;</span>https://myserver/webdav/{tileset}/{grid}/{z}/{x}/{y}.{ext}<span class="nt">&lt;/url&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="specifying-http-headers">
<h3>Spécification des en-têtes HTTP<a class="headerlink" href="#specifying-http-headers" title="Lien permanent vers ce titre">¶</a></h3>
<p>Il est possible de personnaliser les en-têtes HTTP à ajouter à une requête HTTP, soit de manière globale, soit spécifiquement pour chaque type de requête (envoyer, récupérer ou supprimer une tuile):</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;myrestcache&quot;</span> <span class="na">type=</span><span class="s">&quot;rest&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;url&gt;</span>https://myserver/webdav/{tileset}/{grid}/{z}/{x}/{y}.{ext}<span class="nt">&lt;/url&gt;</span>
  <span class="nt">&lt;headers&gt;</span>
    <span class="nt">&lt;Host&gt;</span>my-virtualhost-alias.domain.com<span class="nt">&lt;/Host&gt;</span>
  <span class="nt">&lt;/headers&gt;</span>
  <span class="nt">&lt;operation</span> <span class="na">type=</span><span class="s">&quot;put&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;headers&gt;</span>
      <span class="nt">&lt;X-my-specific-put-header&gt;</span>foo<span class="nt">&lt;/X-my-specific-put-header&gt;</span>
    <span class="nt">&lt;/headers&gt;</span>
  <span class="nt">&lt;/operation&gt;</span>
  <span class="nt">&lt;operation</span> <span class="na">type=</span><span class="s">&quot;get&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;headers&gt;</span>
      <span class="nt">&lt;X-my-specific-get-header&gt;</span>foo<span class="nt">&lt;/X-my-specific-get-header&gt;</span>
    <span class="nt">&lt;/headers&gt;</span>
  <span class="nt">&lt;/operation&gt;</span>
  <span class="nt">&lt;operation</span> <span class="na">type=</span><span class="s">&quot;head&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;headers&gt;</span>
      <span class="nt">&lt;X-my-specific-head-header&gt;</span>foo<span class="nt">&lt;/X-my-specific-head-header&gt;</span>
    <span class="nt">&lt;/headers&gt;</span>
  <span class="nt">&lt;/operation&gt;</span>
  <span class="nt">&lt;operation</span> <span class="na">type=</span><span class="s">&quot;delete&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;headers&gt;</span>
      <span class="nt">&lt;X-my-specific-delete-header&gt;</span>foo<span class="nt">&lt;/X-my-specific-delete-header&gt;</span>
    <span class="nt">&lt;/headers&gt;</span>
  <span class="nt">&lt;/operation&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="amazon-s3-rest-caches">
<span id="mapcache-cache-rest-s3"></span><h3>Caches REST Amazon S3<a class="headerlink" href="#amazon-s3-rest-caches" title="Lien permanent vers ce titre">¶</a></h3>
<p>Le cache REST a été spécialisé pour permettre l’accès à Amazon S3, afin d’ajouter la couche d’authentification et autorisation nécessaire à cette plateforme.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;s3&quot;</span> <span class="na">type=</span><span class="s">&quot;s3&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;url&gt;</span>https://foo.s3.amazonaws.com/tiles/{tileset}/{grid}/{z}/{x}/{y}/{ext}<span class="nt">&lt;/url&gt;</span>
  <span class="nt">&lt;headers&gt;</span>
    <span class="nt">&lt;Host&gt;</span>foo.s3.amazonaws.com<span class="nt">&lt;/Host&gt;</span>
  <span class="nt">&lt;/headers&gt;</span>
  <span class="nt">&lt;id&gt;</span>AKIE3SDEIT6TUG8DXEQI<span class="nt">&lt;/id&gt;</span>
  <span class="nt">&lt;secret&gt;</span>5F+dGsTfsdfkjdsfSDdasf4555d/sSff56sd/RDS<span class="nt">&lt;/secret&gt;</span>
  <span class="nt">&lt;region&gt;</span>eu-west-1<span class="nt">&lt;/region&gt;</span>
  <span class="nt">&lt;operation</span> <span class="na">type=</span><span class="s">&quot;put&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;headers&gt;</span>
      <span class="nt">&lt;x-amz-storage-class&gt;</span>REDUCED_REDUNDANCY<span class="nt">&lt;/x-amz-storage-class&gt;</span>
      <span class="nt">&lt;x-amz-acl&gt;</span>public-read<span class="nt">&lt;/x-amz-acl&gt;</span>
    <span class="nt">&lt;/headers&gt;</span>
  <span class="nt">&lt;/operation&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
<p>Les éléments &lt;id&gt;, &lt;secret&gt; et &lt;region&gt; sont requis. Ils sont obtenus via votre console de gestion Amazon. Vous devez lire la documentation pour déterminer quels en-têtes sont nécessaires selon votre profil d’utilisation (l’exemple fourni héberge des tuiles dans un espace meilleur marché, et permet de les rendre publiquement accessibles).</p>
</div>
<div class="section" id="microsoft-azure-rest-caches">
<span id="mapcache-cache-rest-azure"></span><h3>Caches REST Microsoft Azure<a class="headerlink" href="#microsoft-azure-rest-caches" title="Lien permanent vers ce titre">¶</a></h3>
<p>Le cache REST a été spécialisé pour permettre l’accès à Azure, afin d’ajouter la couche d’authentification et autorisation nécessaire à cette plateforme.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;azure&quot;</span> <span class="na">type=</span><span class="s">&quot;azure&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;url&gt;</span>https://foo.blob.core.windows.net/tiles/{tileset}/{grid}/{z}/{x}/{y}/{ext}<span class="nt">&lt;/url&gt;</span>
  <span class="nt">&lt;headers&gt;</span>
    <span class="nt">&lt;Host&gt;</span>foo.blob.core.windows.net<span class="nt">&lt;/Host&gt;</span>
  <span class="nt">&lt;/headers&gt;</span>
  <span class="nt">&lt;id&gt;</span>foo<span class="nt">&lt;/id&gt;</span>
  <span class="nt">&lt;secret&gt;</span>foobarcccccccccccccccccccccyA==<span class="nt">&lt;/secret&gt;</span>
  <span class="nt">&lt;container&gt;</span>tiles<span class="nt">&lt;/container&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
<p>Les éléments &lt;id&gt;, &lt;secret&gt; et &lt;container&gt; sont requis. Ils sont obtenus via votre console de gestion. Vous devez lire la documentation pour déterminer quels en-têtes sont nécessaires selon votre profil d’utilisation.</p>
</div>
<div class="section" id="google-cloud-storage-rest-caches">
<span id="mapcache-cache-rest-google"></span><h3>Google Cloud Storage REST Caches<a class="headerlink" href="#google-cloud-storage-rest-caches" title="Lien permanent vers ce titre">¶</a></h3>
<p>Le cache REST a été spécialisé pour permettre l’accès à Google Cloud Storage, afin d’ajouter la couche d’authentification et autorisation nécessaire à cette plateforme.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;google&quot;</span> <span class="na">type=</span><span class="s">&quot;google&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;url&gt;</span>https://storage.googleapis.com/mytiles-mapcache/{tileset}/{grid}/{z}/{x}/{y}.{ext}<span class="nt">&lt;/url&gt;</span>
  <span class="nt">&lt;access&gt;</span>GOOGPGDWFDG345SDFGSD<span class="nt">&lt;/access&gt;</span>
  <span class="nt">&lt;secret&gt;</span>sdfgsdSDFwedfwefr2345324dfsGdsfgs<span class="nt">&lt;/secret&gt;</span>
  <span class="nt">&lt;operation</span> <span class="na">type=</span><span class="s">&quot;put&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;headers&gt;</span>
      <span class="nt">&lt;x-amz-acl&gt;</span>public-read<span class="nt">&lt;/x-amz-acl&gt;</span>
    <span class="nt">&lt;/headers&gt;</span>
  <span class="nt">&lt;/operation&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
<p>Les éléments &lt;acces&gt; et &lt;secret&gt; sont requis. Ils sont obtenus via votre console de gestion. Vous devez lire la documentation pour déterminer quels en-têtes sont nécessaires selon votre profil d’utilisation. Il est important de noter que le support de Google Cloud Storage passe par sa couche de compatibilité avec Amazon.</p>
</div>
</div>
<div class="section" id="meta-caches">
<span id="mapcache-cache-meta"></span><h2>Méta-caches<a class="headerlink" href="#meta-caches" title="Lien permanent vers ce titre">¶</a></h2>
<p>Ces types de caches ne stockent pas de tuiles mais délèguent cette fonctionnalité à un certain nombre de caches sous-jacents selon un ensemble de règles ou de comportements. Ces caches sont principalement utiles pour des déploiements de MapCache impliquant de multiples instances, avec des back-ends de caches partagés (par exemple serveurs memcache dédiés et systèmes de fichiers en réseau).</p>
<div class="section" id="composite-caches">
<span id="mapcache-cache-composite"></span><h3>Caches composites<a class="headerlink" href="#composite-caches" title="Lien permanent vers ce titre">¶</a></h3>
<p>Ce cache utilise différents caches sous-jacents selon le niveau de zoom des tuiles, et peut par exemple être utilisé pour stocker les tuiles des faibles niveaux de zoom dans un stockage permanent et les tuiles des niveaux de zoom plus forts dans un cache temporaire (memcache).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">cache</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;mydisk&quot;</span> <span class="o">...&gt;</span> <span class="o">...</span> <span class="o">&lt;/</span><span class="n">cache</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">cache</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;mymemcache&quot;</span> <span class="o">...&gt;</span> <span class="o">...</span> <span class="o">&lt;/</span><span class="n">cache</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">cache</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;composite&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;composite&quot;</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">cache</span> <span class="n">grids</span><span class="o">=</span><span class="s2">&quot;mygrid,g&quot;</span><span class="o">&gt;</span><span class="n">mycache</span><span class="o">&lt;/</span><span class="n">cache</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">cache</span> <span class="nb">min</span><span class="o">-</span><span class="n">zoom</span><span class="o">=</span><span class="s2">&quot;0&quot;</span> <span class="nb">max</span><span class="o">-</span><span class="n">zoom</span><span class="o">=</span><span class="s2">&quot;8&quot;</span><span class="o">&gt;</span><span class="n">mydisk</span><span class="o">&lt;/</span><span class="n">cache</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">cache</span> <span class="nb">min</span><span class="o">-</span><span class="n">zoom</span><span class="o">=</span><span class="s2">&quot;9&quot;</span><span class="o">&gt;</span><span class="n">mymemcache</span><span class="o">&lt;/</span><span class="n">cache</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">cache</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">tileset</span> <span class="o">...&gt;</span>
   <span class="o">&lt;</span><span class="n">cache</span><span class="o">&gt;</span><span class="n">composite</span><span class="o">&lt;/</span><span class="n">cache</span><span class="o">&gt;</span>
   <span class="o">...</span>
<span class="o">&lt;/</span><span class="n">tileset</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Pour chaque tuile, les caches sont examinés dans leur ordre de définition dans le fichier de configuration, et le premier à satisfaire les contraintes de zoom et de grille est utilisé. À charge pour l’utilisateur de s’assurer que la succession de valeurs de zoom et de grille est pertinente, par exemple:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;composite&quot;</span> <span class="na">type=</span><span class="s">&quot;composite&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;cache</span> <span class="na">min-zoom=</span><span class="s">&quot;0&quot;</span><span class="nt">&gt;</span>cache1<span class="nt">&lt;/cache&gt;</span>
   <span class="nt">&lt;cache</span> <span class="na">min-zoom=</span><span class="s">&quot;9&quot;</span><span class="nt">&gt;</span>this_cache_will_never_be_used<span class="nt">&lt;/cache&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="fallback-caches">
<span id="mapcache-cache-fallback"></span><h3>Caches de repli<a class="headerlink" href="#fallback-caches" title="Lien permanent vers ce titre">¶</a></h3>
<p>Ces types de caches renvoient les tuiles depuis le premier sous-cache qui ne retourne pas une erreur. Ils peuvent être utilisés lorsqu’un des caches rencontre des conditions d’erreurs (par exemple des caches REST distants, un memcache).</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;fallback&quot;</span> <span class="na">type=</span><span class="s">&quot;fallback&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;cache&gt;</span>mymemcache<span class="nt">&lt;/cache&gt;</span>
   <span class="nt">&lt;cache&gt;</span>mysqlitecache<span class="nt">&lt;/cache&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
<p>Une écriture dans un tel cache provoque une écriture dans l’ensemble des sous-caches.</p>
</div>
<div class="section" id="multitier-caches">
<span id="mapcache-cache-multitier"></span><h3>Caches à plusieurs niveaux<a class="headerlink" href="#multitier-caches" title="Lien permanent vers ce titre">¶</a></h3>
<p>Ces types de caches peuvent être utilisés pour combiner des caches rapides mais coûteux avec des caches bon marché mais lents.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;multitier&quot;</span> <span class="na">type=</span><span class="s">&quot;multitier&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;cache&gt;</span>fast<span class="nt">&lt;/cache&gt;</span>
   <span class="nt">&lt;cache&gt;</span>cheap<span class="nt">&lt;/cache&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
<p>Si une tuile donnée est absente du premier sous-cache, elle sera lue depuis le deuxième sous-cache <strong>et</strong> copiée dans le premier pour les accès ultérieurs. Ce type de cache est prévu pour être utilisé lorsque le premier cache supprime automatiquement les tuiles les plus anciennes (par exemple un memcache).</p>
<p>Une écriture dans un tel cache provoque une écriture dans le dernier sous-cache.</p>
</div>
<div class="section" id="cache-combinations">
<h3>Combinaisons de caches<a class="headerlink" href="#cache-combinations" title="Lien permanent vers ce titre">¶</a></h3>
<p>Tous ces méta-caches peuvent être combinés pour régler finement la disponibilité et les performances selon les coûts de stockage, le temps de recréation des tuiles manquantes, etc.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;slow_and_permanent&quot;</span> <span class="na">type=</span><span class="s">&quot;sqlite&quot;</span><span class="nt">&gt;</span>...<span class="nt">&lt;/cache&gt;</span>
<span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;fast_and_transient&quot;</span> <span class="na">type=</span><span class="s">&quot;memcache&quot;</span><span class="nt">&gt;</span>...<span class="nt">&lt;/cache&gt;</span>
<span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;low_zooms&quot;</span> <span class="na">type=</span><span class="s">&quot;multitier&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;cache&gt;</span>fast_and_transient<span class="nt">&lt;/cache&gt;</span>
   <span class="nt">&lt;cache&gt;</span>slow_and_permanent<span class="nt">&lt;/cache&gt;</span>
<span class="nt">&lt;cache&gt;</span>
<span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;mycache&quot;</span> <span class="na">type=</span><span class="s">&quot;composite&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;cache</span> <span class="na">maxzoom=</span><span class="s">&quot;12&quot;</span><span class="nt">&gt;</span>low_zooms<span class="nt">&lt;/cache&gt;</span>
   <span class="nt">&lt;cache&gt;</span>fast_and_transient<span class="nt">&lt;/cache&gt;</span>
<span class="nt">&lt;cache&gt;</span>
<span class="nt">&lt;tileset&gt;</span>
   <span class="nt">&lt;cache&gt;</span>mycache<span class="nt">&lt;/cache&gt;</span>
   ...
<span class="nt">&lt;/tileset&gt;</span>
</pre></div>
</div>
<p>Dans l’exemple précédent, toutes les tuiles sont récupérées en premier lieu d’une instance memcache, néanmoins, les tuiles de niveaux de zoom inférieurs sont conservées dans un cache SQLite permanent qui est utilisé pour peupler le cache memcache rapide, par exemple lors d’un redémarrage.</p>
</div>
</div>
<div class="section" id="riak-caches">
<span id="mapcache-cache-riak"></span><h2>Caches Riak<a class="headerlink" href="#riak-caches" title="Lien permanent vers ce titre">¶</a></h2>
<p>Nécéssite <a class="reference external" href="https://github.com/trifork/riack">https://github.com/trifork/riack</a></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;myriak&quot;</span> <span class="na">type=</span><span class="s">&quot;riak&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;server&gt;</span>
    <span class="nt">&lt;host&gt;</span>riakhost<span class="nt">&lt;/host&gt;</span>
    <span class="nt">&lt;port&gt;</span>12345<span class="nt">&lt;/port&gt;</span>
    <span class="nt">&lt;bucket&gt;</span>mytiles<span class="nt">&lt;/bucket&gt;</span>
  <span class="nt">&lt;/server&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Recherche rapide</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><h3>Navigation</h3>
<p>
<a href="../about.html" title="About">About</a><br>
<a href="../products.html" title="Products">Products</a><br>
<a href="../community/index.html" title="Community">Community</a><br>
<a href="../development/index.html" title="Development">Development</a><br>
<a href="../download.html" title="Downloads">Downloads</a><br>
<a href="../documentation.html" title="Documentation">Documentation</a><br>
<a href="../faq.html" title="FAQ">FAQ</a><br>
<a href="../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</h3>
  <ul>
<li><a class="reference internal" href="#">Types de cache</a><ul>
<li><a class="reference internal" href="#disk-caches">Caches disque</a><ul>
<li><a class="reference internal" href="#common-configuration">Configuration commune</a></li>
<li><a class="reference internal" href="#default-structure">Structure par défaut</a></li>
<li><a class="reference internal" href="#arcgis-compatible-structure">Structure compatible Arcgis</a></li>
<li><a class="reference internal" href="#worldwind-compatible-structure">Structure compatible Worldwind</a></li>
<li><a class="reference internal" href="#template-structure">Structure de « template »</a></li>
</ul>
</li>
<li><a class="reference internal" href="#berkeley-db-caches">Caches Berkeley DB</a></li>
<li><a class="reference internal" href="#sqlite-caches">Caches SQLite</a><ul>
<li><a class="reference internal" href="#default-schema">Schéma par défaut</a></li>
<li><a class="reference internal" href="#custom-schema">Schéma personnalisé</a></li>
<li><a class="reference internal" href="#blank-tile-detection">Détection de tuile vide</a></li>
<li><a class="reference internal" href="#using-multiple-sqlite-database-files">Utilisation de fichiers SQLite multiples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mbtiles-caches">Caches MBTiles</a></li>
<li><a class="reference internal" href="#memcache-caches">Caches Memcache</a></li>
<li><a class="reference internal" href="#geo-tiff-caches">Caches (Geo)TIFF</a><ul>
<li><a class="reference internal" href="#defining-the-tiff-file-sizes">Définition des tailles de fichiers TIFF</a></li>
<li><a class="reference internal" href="#setting-up-the-file-naming-convention">Configuration de la convention de nommage des fichiers</a></li>
<li><a class="reference internal" href="#customizing-the-template-keys">Personnalisation des clés du « template »</a></li>
<li><a class="reference internal" href="#setting-jpeg-compression-options">Définition des options de compression JPEG</a></li>
<li><a class="reference internal" href="#using-a-specific-locker">Utilisation d’un verrou spécifique</a></li>
<li><a class="reference internal" href="#geotiff-support">Support GeoTIFF</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rest-caches">Caches REST</a><ul>
<li><a class="reference internal" href="#pure-rest-cache">Cache REST pur</a></li>
<li><a class="reference internal" href="#specifying-http-headers">Spécification des en-têtes HTTP</a></li>
<li><a class="reference internal" href="#amazon-s3-rest-caches">Caches REST Amazon S3</a></li>
<li><a class="reference internal" href="#microsoft-azure-rest-caches">Caches REST Microsoft Azure</a></li>
<li><a class="reference internal" href="#google-cloud-storage-rest-caches">Google Cloud Storage REST Caches</a></li>
</ul>
</li>
<li><a class="reference internal" href="#meta-caches">Méta-caches</a><ul>
<li><a class="reference internal" href="#composite-caches">Caches composites</a></li>
<li><a class="reference internal" href="#fallback-caches">Caches de repli</a></li>
<li><a class="reference internal" href="#multitier-caches">Caches à plusieurs niveaux</a></li>
<li><a class="reference internal" href="#cache-combinations">Combinaisons de caches</a></li>
</ul>
</li>
<li><a class="reference internal" href="#riak-caches">Caches Riak</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Index général"
             >index</a></li>
        <li class="right" >
          <a href="formats.html" title="Formats d’image"
             >suivant</a> |</li>
        <li class="right" >
          <a href="seed.html" title="Alimentation du cache"
             >précédent</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../documentation.html" >MapServer 7.4.0 Documentation</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >MapCache 1.6.1</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; <a href="../copyright.html">Copyright</a> 2019, Open Source Geospatial Foundation.
      Mis à jour le 2019-07-17.
      Créé avec <a href="http://sphinx-doc.org/">Sphinx</a> 2.1.2.
    </div>
  </body>
</html>