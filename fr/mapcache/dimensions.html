
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="fr">
  <head>
    <meta charset="utf-8" />
    <title>Dimensions d’un jeu de tuiles &#8212; MapServer 7.4.0 documentation</title>
    <link rel="stylesheet" href="../_static/sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    
    <link rel="shortcut icon" href="../_static/mapserver.ico"/>
    <link rel="author" title="À propos de ces documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="next" title="HTTP Requests" href="http.html" />
    <link rel="prev" title="Formats d’image" href="formats.html" /> 
  </head><body>

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../index.html" title="Home"><img src="../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../index.html" title="Home">Home</a> |
      <a href="../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a> |
      <a href="../download.html" title="Download Source or Binaries">Download </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        
          
            <a href="../../mapcache/dimensions.html"><img src="../_static/flagicons/en.png" alt="en" title="en" border="0" /></a>
          
        
        
          
            <a href="../../ar/mapcache/dimensions.html"><img src="../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
          
        
        
          
            <a href="../../de/mapcache/dimensions.html"><img src="../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
          
        
        
          
            <a href="../../el/mapcache/dimensions.html"><img src="../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
          
        
        
          
            <a href="../../es/mapcache/dimensions.html"><img src="../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
          
        
        <img src="../_static/flagicons/fr.png" alt="fr" title="fr" border="0" width="18px" height="13px"/>
        
          
            <a href="../../id/mapcache/dimensions.html"><img src="../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
          
        
        
          
            <a href="../../it/mapcache/dimensions.html"><img src="../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
          
        
        
          
            <a href="../../ja/mapcache/dimensions.html"><img src="../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
          
        
        
          
            <a href="../../nl_NL/mapcache/dimensions.html"><img src="../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
          
        
        
          
            <a href="../../pl/mapcache/dimensions.html"><img src="../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
          
        
        
          
            <a href="../../ru/mapcache/dimensions.html"><img src="../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
          
        
        
          
            <a href="../../sq/mapcache/dimensions.html"><img src="../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
          
        
        
          
            <a href="../../tr/mapcache/dimensions.html"><img src="../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
          
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Index général"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="http.html" title="HTTP Requests"
             accesskey="N">suivant</a> |</li>
        <li class="right" >
          <a href="formats.html" title="Formats d’image"
             accesskey="P">précédent</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../documentation.html" >MapServer 7.4.0 Documentation</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">MapCache 1.6.1</a> &#187;</li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="tileset-dimensions">
<span id="mapcache-dimensions"></span><h1>Dimensions d’un jeu de tuiles<a class="headerlink" href="#tileset-dimensions" title="Lien permanent vers ce titre">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Author</dt>
<dd class="field-odd"><p>Thomas Bonfort</p>
</dd>
<dt class="field-even">Contact</dt>
<dd class="field-even"><p>tbonfort at terriscope.fr</p>
</dd>
<dt class="field-odd">Author</dt>
<dd class="field-odd"><p>Seth Girvin</p>
</dd>
<dt class="field-even">Contact</dt>
<dd class="field-even"><p>sgirvin at compass.ie</p>
</dd>
<dt class="field-odd">Author</dt>
<dd class="field-odd"><p>Jerome Boue</p>
</dd>
<dt class="field-even">Last Updated</dt>
<dd class="field-even"><p>2018/06/29</p>
</dd>
<dt class="field-odd">Version</dt>
<dd class="field-odd"><p>1.8</p>
</dd>
</dl>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Lien permanent vers ce titre">¶</a></h2>
<p>Les couches WMS dans MapServer peuvent supporter les dimensions, voir <a class="reference internal" href="../ogc/wms_dimension.html#wms-dimension"><span class="std std-ref">WMS Dimension</span></a> pour les détails. MapCache supporte également les dimensions pour les jeux de tuiles.</p>
<p>Stocker des caches de tuiles distincts pour différentes dimensions est utile dans un certain nombre de situations comme créer des caches pour différentes limites spatiales, altitudes ou périodes de temps. Cela fournit aussi un mécanisme pour changer de Mapfile selon une valeur de dimension donnée.</p>
<p>MapCache utilise les dimensions pour:</p>
<blockquote>
<div><ul class="simple">
<li><p>créer la structure de dossiers des caches disque et SQLite qui utilisent la variable de substitution <code class="docutils literal notranslate"><span class="pre">{dim}</span></code> dans le <em>template</em> de leur configuration, voir <em>Template Structure</em> dans <a class="reference internal" href="caches.html#mapcache-cache-disk"><span class="std std-ref">Caches disque</span></a> et <em>Using Multiple SQLite Database Files</em> dans <a class="reference internal" href="caches.html#mapcache-cache-sqlite"><span class="std std-ref">Caches SQLite</span></a>.</p></li>
<li><p>créer le schéma de données des caches SQLite qui utilisent la variable de substitution <code class="docutils literal notranslate"><span class="pre">:dim</span></code>, voir <em>Custom Schema</em> dans <a class="reference internal" href="caches.html#mapcache-cache-sqlite"><span class="std std-ref">Caches SQLite</span></a>.</p></li>
<li><p>construire les requêtes à destination des sources WMS: toute dimension spécifiée pour un jeu de tuile est transmise à sa source WMS lorsqu’un défaut de cache survient.</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="enabling-dimension-support-in-mapcache">
<h2>Activation des dimensions dans MapCache<a class="headerlink" href="#enabling-dimension-support-in-mapcache" title="Lien permanent vers ce titre">¶</a></h2>
<p>Les dimensions sont activées dans le fichier de configuration au niveau du <a class="reference internal" href="config.html#mapcache-config-tileset"><span class="std std-ref">Jeu de tuiles</span></a>. Chaque jeu de tuile peut définir ses propres dimensions à l’aide d’une section <code class="docutils literal notranslate"><span class="pre">&lt;dimensions&gt;</span></code> qui inclut un ou plusieurs éléments <code class="docutils literal notranslate"><span class="pre">&lt;dimension&gt;</span></code>.</p>
<div class="section" id="dimension-attributes">
<h3>Attributs de dimension<a class="headerlink" href="#dimension-attributes" title="Lien permanent vers ce titre">¶</a></h3>
<p>Plusieurs attributs sont définis pour l’élément <code class="docutils literal notranslate"><span class="pre">&lt;dimension&gt;</span></code>.</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code> (required): The name by which the dimension is referred to in a WMS
request (minus the <code class="docutils literal notranslate"><span class="pre">dim_</span></code> prefix as specified in
<a class="reference external" href="http://portal.opengeospatial.org/files/?artifact_id=1081&amp;version=1&amp;format=pdf">WMS 1.1.1 Specification</a>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">default</span></code> (requis): La valeur par défaut de la dimension lorsqu’aucune valeur n’est fournie explicitement dans la requête WMS.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">type</span></code> (required): MapCache defines several ways for specifying a
dimension: <code class="docutils literal notranslate"><span class="pre">values</span></code>, <code class="docutils literal notranslate"><span class="pre">regex</span></code>, <code class="docutils literal notranslate"><span class="pre">sqlite</span></code>, <code class="docutils literal notranslate"><span class="pre">postgresql</span></code>,
<code class="docutils literal notranslate"><span class="pre">elasticsearch</span></code> and <code class="docutils literal notranslate"><span class="pre">time</span></code>. They are described in the following
sections.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">unit</span></code> (optionnel): unité physique de la dimension. Cette information n’est utilisée que dans la réponse à une requête GetCapabilities.</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="dimension-types">
<h3>Types de dimensions<a class="headerlink" href="#dimension-types" title="Lien permanent vers ce titre">¶</a></h3>
<p>Several types of dimensions are supported by MapCache: Values, Regex, SQLite,
PostgreSQL, ElasticSearch and Time. They can be classified into two groups
depending on how dimension values are defined:</p>
<blockquote>
<div><ul class="simple">
<li><p>Dimensions de premier niveau: <code class="docutils literal notranslate"><span class="pre">values</span></code> et <code class="docutils literal notranslate"><span class="pre">regex</span></code>. Les valeurs de la dimension sont spécifiées statiquement dans le fichier de configuration.</p></li>
<li><p>Second level dimensions types: SQLite, PostgreSQL, ElasticSearch and Time.
Dimensions values are stored in a dynamic backend (SQLite file, PostgreSQL
database or ElasticSearch index) so that an update in the dimension values
does not involve a server restart.</p></li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="first-level-dimensions">
<h2>Dimensions de premier niveau<a class="headerlink" href="#first-level-dimensions" title="Lien permanent vers ce titre">¶</a></h2>
<p>Les dimensions de premier niveau définissent leurs valeurs dans le fichier de configuration.</p>
<div class="section" id="values-dimensions">
<h3>Dimensions de type <code class="docutils literal notranslate"><span class="pre">values</span></code><a class="headerlink" href="#values-dimensions" title="Lien permanent vers ce titre">¶</a></h3>
<p>Une dimension de type <code class="docutils literal notranslate"><span class="pre">values</span></code> donne la liste de toutes ses valeurs possibles. Le nom de la dimension est utilisée comme clé dans une requête WMS ou WMTS, par exemple <code class="docutils literal notranslate"><span class="pre">&amp;DIM1=foobarbaz</span></code>.</p>
<p>Lorsqu’un client ne fournit pas de valeur explicite pour la dimension, alors la valeur par défaut est prise en compte (c’est-à-dire <code class="docutils literal notranslate"><span class="pre">foobar</span></code> dans cet exemple).</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;tileset</span> <span class="na">name=</span><span class="s">&quot;LayerName&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;source&gt;</span>LayerSource<span class="nt">&lt;/source&gt;</span>
    <span class="nt">&lt;cache&gt;</span>sqlite<span class="nt">&lt;/cache&gt;</span>
    <span class="nt">&lt;grid&gt;</span>GoogleMapsCompatible<span class="nt">&lt;/grid&gt;</span>
    <span class="nt">&lt;format&gt;</span>PNG<span class="nt">&lt;/format&gt;</span>
    <span class="nt">&lt;metatile&gt;</span>5 5<span class="nt">&lt;/metatile&gt;</span>
    <span class="nt">&lt;metabuffer&gt;</span>10<span class="nt">&lt;/metabuffer&gt;</span>
    <span class="nt">&lt;dimensions&gt;</span>
        <span class="nt">&lt;dimension</span> <span class="na">type=</span><span class="s">&quot;values&quot;</span> <span class="na">name=</span><span class="s">&quot;DIM1&quot;</span> <span class="na">default=</span><span class="s">&quot;foobar&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;value&gt;</span>foobar<span class="nt">&lt;/value&gt;</span>
            <span class="nt">&lt;value&gt;</span>foobarbaz<span class="nt">&lt;/value&gt;</span>
            <span class="nt">&lt;value&gt;</span>foo<span class="nt">&lt;/value&gt;</span>
            <span class="nt">&lt;value&gt;</span>bar<span class="nt">&lt;/value&gt;</span>
        <span class="nt">&lt;/dimension&gt;</span>
    <span class="nt">&lt;/dimensions&gt;</span>
<span class="nt">&lt;/tileset&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="regex-dimensions">
<h3>Dimensions de type <code class="docutils literal notranslate"><span class="pre">regex</span></code><a class="headerlink" href="#regex-dimensions" title="Lien permanent vers ce titre">¶</a></h3>
<p>Une alternative à une liste de valeurs en dur, est l’utilisation d’expressions régulières.</p>
<p>L’exemple suivant crée une dimension MAPFILE, afin d’utiliser le même jeu de tuiles MapCache avec différents Mapfiles MapServer. MapCache n’a pas besoin de connaître les noms des Mapfiles, qui peuvent alors être créés après le démarrage de MapCache.</p>
<p>Lorsqu’un utilisateur passe <code class="docutils literal notranslate"><span class="pre">MAPFILE=/path/to/mapfile</span></code>, MapCache vérifie que la chaîne <code class="docutils literal notranslate"><span class="pre">/path/to/mapfile</span></code> répond à l’expression régulière (PCRE) définie dans le fichier de configuration. Dans cet exemple, l’expression régulière valide un nom composé de caractères alphanumériques séparés par des barres obliques (/) et se terminant par « .map » ( [a-zA-Z0-9./]*.map$ ), mais échoue en présence de deux points consécutifs (..) afin d’empêcher toute traversée du système de fichiers.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;dimension</span> <span class="na">type=</span><span class="s">&quot;regex&quot;</span> <span class="na">name=</span><span class="s">&quot;MAPFILE&quot;</span> <span class="na">default=</span><span class="s">&quot;/path/to/mapfile.map&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;regex&gt;</span>^(?!.*\.\.)[a-zA-Z0-9\./]*\.map$<span class="nt">&lt;/regex&gt;</span>
<span class="nt">&lt;/dimension&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="second-level-dimensions">
<h2>Dimensions de deuxième niveau<a class="headerlink" href="#second-level-dimensions" title="Lien permanent vers ce titre">¶</a></h2>
<p>Second level dimensions store values in a dynamic back-end, a SQLite file, a
PostgreSQL database or an ElasticSearch index. This allows for adding new
dimension values without modifying MapCache configuration file, which otherwise
would need to restart the server.</p>
<div class="section" id="sqlite-dimensions">
<h3>Dimensions de type <code class="docutils literal notranslate"><span class="pre">sqlite</span></code><a class="headerlink" href="#sqlite-dimensions" title="Lien permanent vers ce titre">¶</a></h3>
<p>Dans une dimension de type <code class="docutils literal notranslate"><span class="pre">sqlite</span></code> les valeurs de dimension sont stockées dans un fichier SQLite. De plus, chaque valeur référence une liste de valeurs internes, dites de sous-dimension, qui sont utilisées pour formuler les requêtes au cache.</p>
<p>Par exemple, soit une dimension « sensor » dont les valeurs possibles représentent divers satellites d’observation de la Terre. Une requête WMS avec cette dimension peut contenir: <code class="docutils literal notranslate"><span class="pre">...&amp;dim_sensor=spot&amp;...</span></code> Dans cet exemple, chaque capteur référence plusieurs types de données selon une sous-dimension interne nommée « product ». Un exemple du contenu de la dimension « sensor » est représenté sur la table suivante:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 43%" />
<col style="width: 57%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Dimension « sensor »</p></th>
<th class="head"><p>Sous-dimension « product »</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>spot</p></td>
<td><p>spot-img1</p></td>
</tr>
<tr class="row-odd"><td><p>spot</p></td>
<td><p>spot-img2</p></td>
</tr>
<tr class="row-even"><td><p>phr</p></td>
<td><p>phr-img1</p></td>
</tr>
<tr class="row-odd"><td><p>phr</p></td>
<td><p>phr-img2</p></td>
</tr>
<tr class="row-even"><td><p>phr</p></td>
<td><p>phr-img3</p></td>
</tr>
</tbody>
</table>
<p>La requête WMS se passe au niveau de la dimension « sensor ». La requête sur le cache a lieu au niveau de la sous-dimension « product ». Dans le cas d’un défaut de cache, les valeurs de la sous-dimension « product » sont utilisées pour formuler une requête à la source de données.</p>
<p>Une requête à une dimension de type <code class="docutils literal notranslate"><span class="pre">sqlite</span></code> peut alors renvoyer plusieurs valeurs de sous-dimensions, chacune faisant référence à des tuiles distinctes. Assembler ces tuiles est décrit dans la section <a class="reference internal" href="#tile-assembly-policies">Tile Assembly Policies</a> plus loin.</p>
<p>A SQLite dimension is configured by specifying three elements:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;dbfile&gt;</span></code>: Location of the SQLite file implementing the dimension</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;list_query&gt;</span></code>: SQL query returning all sub-dimension values for the
dimension, e.g. <strong>spot-img1</strong>, <strong>spot-img2</strong>, <strong>phr-img1</strong>, <strong>phr-img2</strong>
and  <strong>phr-img3</strong> in the « sensor » dimension example.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;validate_query&gt;</span></code>: SQL query returning the list of sub-dimension values
for a given dimension value, e.g. <strong>spot-img1</strong> and <strong>spot-img2</strong> for the
<strong>spot</strong> dimension value in the « sensor » dimension example.</p></li>
</ul>
</div></blockquote>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="c">&lt;!-- &quot;sqlite&quot; dimension</span>

<span class="c">     This example defines a &quot;sensor&quot; dimension whose possible values are</span>
<span class="c">     stored in the /data/sensor.sqlite SQLite file. The default value is</span>
<span class="c">     &quot;phr&quot;.</span>

<span class="c">     A WMS request with that dimension may contain, e.g.</span>
<span class="c">     &quot;... &amp;dim_sensor=spot&amp; ...&quot;</span>
<span class="c">--&gt;</span>
<span class="nt">&lt;dimension</span> <span class="na">type=</span><span class="s">&quot;sqlite&quot;</span> <span class="na">name=</span><span class="s">&quot;sensor&quot;</span> <span class="na">default=</span><span class="s">&quot;phr&quot;</span><span class="nt">&gt;</span>

   <span class="c">&lt;!-- Access Point --&gt;</span>
   <span class="nt">&lt;dbfile&gt;</span>/data/sensor.sqlite<span class="nt">&lt;/dbfile&gt;</span>

   <span class="c">&lt;!-- All-values Query --&gt;</span>
   <span class="nt">&lt;list_query&gt;</span>
      SELECT distinct(product) FROM dim
   <span class="nt">&lt;/list_query&gt;</span>

   <span class="c">&lt;!-- Selected-values Query --&gt;</span>
   <span class="nt">&lt;validate_query&gt;</span>
      SELECT product FROM dim
       WHERE sensor=:dim
   <span class="nt">&lt;/validate_query&gt;</span>

<span class="nt">&lt;/dimension&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="postgresql-dimensions">
<h3>PostgreSQL Dimensions<a class="headerlink" href="#postgresql-dimensions" title="Lien permanent vers ce titre">¶</a></h3>
<p>PostgreSQL dimensions are very similar to SQLite dimensions. In particular, the
sub-dimension feature described in the section above is also available with
PostgreSQL dimensions. They differ only in the back-end implementation which is
a PostgreSQL database, and in the way they are configured. A PostgreSQL
dimension is configured by specifying three elements:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;connection&gt;</span></code>: Connection information of the PostgreSQL database
implementing the dimension, as expected by the <a class="reference external" href="https://www.postgresql.org/docs/current/static/libpq-connect.html#id-1.7.3.8.2.12.2.1.2">PQconnectdb()</a>
function of the libpq - C library.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;list_query&gt;</span></code>: SQL query returning all sub-dimension values for the
dimension, e.g. <strong>spot-img1</strong>, <strong>spot-img2</strong>, <strong>phr-img1</strong>, <strong>phr-img2</strong>
and  <strong>phr-img3</strong> in the « sensor » dimension example.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;validate_query&gt;</span></code>: SQL query returning the list of sub-dimension values
for a given dimension value, e.g. <strong>spot-img1</strong> and <strong>spot-img2</strong> for the
<strong>spot</strong> dimension value in the « sensor » dimension example.</p></li>
</ul>
</div></blockquote>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="c">&lt;!-- &quot;postgresql&quot; dimension</span>

<span class="c">     This example defines a &quot;sensor&quot; dimension whose possible values are</span>
<span class="c">     stored in the postgresql://mapcache:mapcache@localhost:5433/mapcache</span>
<span class="c">     PostgreSQL database. The default value is &quot;phr&quot;.</span>

<span class="c">     A WMS request with that dimension may contain, e.g.</span>
<span class="c">     &quot;... &amp;dim_sensor=spot&amp; ...&quot;</span>
<span class="c">--&gt;</span>
<span class="nt">&lt;dimension</span> <span class="na">type=</span><span class="s">&quot;postgresql&quot;</span> <span class="na">name=</span><span class="s">&quot;sensor&quot;</span> <span class="na">default=</span><span class="s">&quot;phr&quot;</span><span class="nt">&gt;</span>

   <span class="c">&lt;!-- Access Point --&gt;</span>
  <span class="nt">&lt;connection&gt;</span>
    host=localhost user=mapcache password=mapcache dbname=mapcache port=5433
  <span class="nt">&lt;/connection&gt;</span>

   <span class="c">&lt;!-- All-values Query --&gt;</span>
  <span class="nt">&lt;list_query&gt;</span>SELECT distinct(product) FROM dim<span class="nt">&lt;/list_query&gt;</span>

   <span class="c">&lt;!-- Selected-values Query --&gt;</span>
  <span class="nt">&lt;validate_query&gt;</span>SELECT product FROM dim WHERE sensor=:dim<span class="nt">&lt;/validate_query&gt;</span>

<span class="nt">&lt;/dimension&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="elasticsearch-dimensions">
<h3>ElasticSearch Dimensions<a class="headerlink" href="#elasticsearch-dimensions" title="Lien permanent vers ce titre">¶</a></h3>
<p>ElasticSearch dimensions are similar to SQLite or PostgreSQL dimensions. In
particular, the sub-dimension feature described in the section above is also
available with ElasticSearch dimensions. ElasticSearch main difference with
SQLite and PostgreSQL is its query language, Query-DSL, based on JSON instead
of SQL. Therefore, <code class="docutils literal notranslate"><span class="pre">&lt;list_query&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;validate_query&gt;</span></code> elements shall
contain queries expressed in that language. Inserting JSON data in XML
configuration may need to encapsulate it in a <code class="docutils literal notranslate"><span class="pre">&lt;![CDATA[</span> <span class="pre">...</span> <span class="pre">]]&gt;</span></code> element.</p>
<p>In addition, the complex structure of ElasticSearch responses, also expressed
in JSON, raises the need for extraction instructions to get sub-dimension
values from query responses.</p>
<p>For example, let’s assume that this ElasticSearch query:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>   <span class="nt">&quot;size&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nt">&quot;aggs&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="nt">&quot;distinct_product&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="nt">&quot;terms&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="nt">&quot;field&quot;</span><span class="p">:</span> <span class="s2">&quot;product/keyword&quot;</span> <span class="p">}</span> <span class="p">}</span> <span class="p">},</span>
    <span class="nt">&quot;query&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="nt">&quot;term&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="nt">&quot;sensor&quot;</span><span class="p">:</span> <span class="s2">&quot;phr&quot;</span> <span class="p">}</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>returns this response:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>   <span class="nt">&quot;took&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nt">&quot;timed_out&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nt">&quot;_shards&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="nt">&quot;total&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="nt">&quot;successful&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="nt">&quot;skipped&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nt">&quot;failed&quot;</span><span class="p">:</span> <span class="mi">0</span> <span class="p">},</span>
    <span class="nt">&quot;hits&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="nt">&quot;total&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="nt">&quot;max_score&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nt">&quot;hits&quot;</span><span class="p">:</span> <span class="p">[]</span> <span class="p">},</span>
    <span class="nt">&quot;aggregations&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;distinct_product&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;doc_count_error_upper_bound&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="nt">&quot;sum_other_doc_count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="nt">&quot;buckets&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span> <span class="nt">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;phr_img1&quot;</span><span class="p">,</span> <span class="nt">&quot;doc_count&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="p">},</span>
                <span class="p">{</span> <span class="nt">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;phr_img2&quot;</span><span class="p">,</span> <span class="nt">&quot;doc_count&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="p">},</span>
                <span class="p">{</span> <span class="nt">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;phr_img3&quot;</span><span class="p">,</span> <span class="nt">&quot;doc_count&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The expected sub-dimension values are then:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">[</span> <span class="s2">&quot;phr_img1&quot;</span><span class="p">,</span> <span class="s2">&quot;phr_img2&quot;</span><span class="p">,</span> <span class="s2">&quot;phr_img3&quot;</span> <span class="p">]</span>
</pre></div>
</div>
<p>This list is obtained by extracting the <code class="docutils literal notranslate"><span class="pre">aggregations</span></code> item from the outer
dictionary, then <code class="docutils literal notranslate"><span class="pre">distinct_product</span></code> , then <code class="docutils literal notranslate"><span class="pre">buckets</span></code>. Finally the <code class="docutils literal notranslate"><span class="pre">key</span></code>
item is to be extracted from each dictionary of the <code class="docutils literal notranslate"><span class="pre">bucket</span></code> list. The
extraction instructions take the form of a path-like list of keywords to be
used to extract sub-dimension values from JSON response provided by
ElasticSearch:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">[</span> <span class="s2">&quot;aggregations&quot;</span><span class="p">,</span> <span class="s2">&quot;distinct_product&quot;</span><span class="p">,</span> <span class="s2">&quot;buckets&quot;</span><span class="p">,</span> <span class="s2">&quot;key&quot;</span> <span class="p">]</span>
</pre></div>
</div>
<p>This is specified in the MapCache configuration file by way of new XML
elements, namely  <code class="docutils literal notranslate"><span class="pre">&lt;list_response&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;validate_response&gt;</span></code>, containing
extraction instructions respectively for <code class="docutils literal notranslate"><span class="pre">&lt;list_query&gt;</span></code> and
<code class="docutils literal notranslate"><span class="pre">&lt;validate_query&gt;</span></code> queries.</p>
<p>An ElasticSearch dimensions is defined by specifying five elements:</p>
<blockquote>
<div><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;http&gt;</span></code>: Connection information of the ElasticSearch index implementing
the dimension. This element contains two sub-elements:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;url&gt;</span></code>: Search URL of the ElasticSearch index</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;headers&gt;</span></code>: HTTP headers needed to access the ElasticSearch index.
It must contain the tag:
<code class="docutils literal notranslate"><span class="pre">&lt;Content-Type&gt;application/json&lt;/Content-Type&gt;</span></code>.</p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;list_query&gt;</span></code>: <a class="reference external" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl.html">Query DSL</a> query for getting all sub-dimension values
for the dimension. This query is expressed in JSON format and may need to
be escaped in a <code class="docutils literal notranslate"><span class="pre">&lt;![CDATA[</span> <span class="pre">...</span> <span class="pre">]]&gt;</span></code> tag.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;validate_query&gt;</span></code>: <a class="reference external" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl.html">Query DSL</a> query for getting the list of
sub-dimension values for a given dimension value. This query is expressed
in JSON format and may need to be escaped in a <code class="docutils literal notranslate"><span class="pre">&lt;![CDATA[</span> <span class="pre">...</span> <span class="pre">]]&gt;</span></code> tag.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;list_response&gt;</span></code>: List of successive keywords needed to extract actual
sub-dimension values from the raw ElasticSearch response to the
<code class="docutils literal notranslate"><span class="pre">&lt;list_query&gt;</span></code> query.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;validate_response&gt;</span></code>: List of successive keywords needed to extract
actual sub-dimension values from the raw ElasticSearch response to the
<code class="docutils literal notranslate"><span class="pre">&lt;validate_query&gt;</span></code> query.</p></li>
</ul>
</div></blockquote>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="c">&lt;!-- &quot;elasticsearch&quot; dimension</span>

<span class="c">     This example defines a &quot;sensor&quot; dimension whose possible values are</span>
<span class="c">     stored in the http://localhost:9200/sensor ElasticSearch index. The</span>
<span class="c">     default value is &quot;phr&quot;.</span>

<span class="c">     A WMS request with that dimension may contain, e.g.</span>
<span class="c">     &quot;... &amp;dim_sensor=spot&amp; ...&quot;</span>
<span class="c">--&gt;</span>
<span class="nt">&lt;dimension</span> <span class="na">type=</span><span class="s">&quot;elasticsearch&quot;</span> <span class="na">name=</span><span class="s">&quot;sensor&quot;</span> <span class="na">default=</span><span class="s">&quot;phr&quot;</span><span class="nt">&gt;</span>

  <span class="c">&lt;!-- Access Point --&gt;</span>
  <span class="nt">&lt;http&gt;</span>
    <span class="nt">&lt;url&gt;</span>http://localhost:9200/sensor/_search<span class="nt">&lt;/url&gt;</span>
    <span class="nt">&lt;headers&gt;</span>
      <span class="nt">&lt;Content-Type&gt;</span>application/json<span class="nt">&lt;/Content-Type&gt;</span>
    <span class="nt">&lt;/headers&gt;</span>
  <span class="nt">&lt;/http&gt;</span>

  <span class="c">&lt;!-- Selected-values Query --&gt;</span>
  <span class="nt">&lt;validate_query&gt;</span><span class="cp">&lt;![CDATA[</span>
<span class="cp">    { &quot;size&quot;: 0,</span>
<span class="cp">      &quot;aggs&quot;: {</span>
<span class="cp">        &quot;products&quot;: { &quot;terms&quot;: { &quot;field&quot;: &quot;product.keyword&quot; } }</span>
<span class="cp">      },</span>
<span class="cp">      &quot;query&quot;: { &quot;term&quot;: { &quot;sensor&quot;: &quot;:dim&quot; } }</span>
<span class="cp">    }</span>
<span class="cp">  ]]&gt;</span><span class="nt">&lt;/validate_query&gt;</span>

  <span class="c">&lt;!-- Selected-values Response Extration Instructions --&gt;</span>
  <span class="nt">&lt;validate_response&gt;</span><span class="cp">&lt;![CDATA[</span>
<span class="cp">    [ &quot;aggregations&quot;, &quot;products&quot;, &quot;buckets&quot;, &quot;key&quot; ]</span>
<span class="cp">  ]]&gt;</span><span class="nt">&lt;/validate_response&gt;</span>

  <span class="c">&lt;!-- All-values Query --&gt;</span>
  <span class="nt">&lt;list_query&gt;</span><span class="cp">&lt;![CDATA[</span>
<span class="cp">    { &quot;size&quot;: 0,</span>
<span class="cp">      &quot;aggs&quot;: {</span>
<span class="cp">        &quot;products&quot;: { &quot;terms&quot;: { &quot;field&quot;: &quot;product.keyword&quot; } }</span>
<span class="cp">      }</span>
<span class="cp">    }</span>
<span class="cp">  ]]&gt;</span><span class="nt">&lt;/list_query&gt;</span>

  <span class="c">&lt;!-- All-values Response Extration Instructions --&gt;</span>
  <span class="nt">&lt;list_response&gt;</span><span class="cp">&lt;![CDATA[</span>
<span class="cp">    [ &quot;aggregations&quot;, &quot;products&quot;, &quot;buckets&quot;, &quot;key&quot; ]</span>
<span class="cp">  ]]&gt;</span><span class="nt">&lt;/list_response&gt;</span>
<span class="nt">&lt;/dimension&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="time-dimensions">
<h3>Dimensions de type <code class="docutils literal notranslate"><span class="pre">time</span></code><a class="headerlink" href="#time-dimensions" title="Lien permanent vers ce titre">¶</a></h3>
<p>MapCache supports WMTS and WMS requests that include a TIME parameter, for both
timestamps and time intervals.  See <a class="reference internal" href="../development/rfc/ms-rfc-96.html#rfc96"><span class="std std-ref">MS RFC 96: Time Dimension Support in
MapCache Tilesets</span></a> initial proposal for further details.</p>
<p>Up to Mapcache 1.6.1, defining a Time dimension involves a SQLite back-end. Two
elements must be provided:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;dbfile&gt;</span></code>: Emplacement du fichier SQLite qui sert de support à la dimension de type <code class="docutils literal notranslate"><span class="pre">time</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;query&gt;</span></code>: Requête SQL qui renvoie la liste des valeurs de dates disponibles dans un intervalle de temps donné. Dans cette requête, la date de début et la date de fin sont représentées par les variables de substitution <code class="docutils literal notranslate"><span class="pre">:start_timestamp</span></code> et <code class="docutils literal notranslate"><span class="pre">:end_time_stamp</span></code>. Les valeurs renvoyées doivent être au format de date <code class="docutils literal notranslate"><span class="pre">yyyy-mm-ddThh:mm:ssZ</span></code>, tel que spécifié dans la <a class="reference external" href="https://tools.ietf.org/html/rfc3339">RFC 3339</a> mais restreint à l’UTC.</p></li>
</ul>
</div></blockquote>
<p>From MapCache 1.8 on, dynamic back-ends for Time dimensions can be PostgreSQL
databases or ElasticSearch indices in addition to SQLite files. Configuring a
Time dimension with a specific back-end is made by setting a <code class="docutils literal notranslate"><span class="pre">time=&quot;true&quot;</span></code>
attribute within a SQLite, PostgreSQL or ElasticSearch dimension configuration.</p>
<p>Still, MapCache keeps an (almost) backward compatible configuration of Time
dimension with an implicit SQLite back-end. Example in the following section
highlights differences.</p>
<p>Time values in the dynamic back-end are expressed in Unix time, i.e. the number
of seconds that have elapsed since January 1, 1970 (midnight UTC).</p>
<p>Une requête temporelle avec un intervalle peut renvoyer plusieurs valeurs de dates, chacune faisant référence à des tuiles distinctes. Assembler ces tuiles est décrit dans la section <a class="reference internal" href="#tile-assembly-policies">Tile Assembly Policies</a> plus loin.</p>
<div class="section" id="configuring-a-time-dimension-using-a-default-sqlite-back-end">
<h4>Configuring a Time Dimension using a default SQLite back-end<a class="headerlink" href="#configuring-a-time-dimension-using-a-default-sqlite-back-end" title="Lien permanent vers ce titre">¶</a></h4>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="c">&lt;!-- &quot;time&quot; dimension</span>

<span class="c">     This example defines a &quot;time&quot; dimension whose possible values</span>
<span class="c">     are stored in the /path/to/mapcache-time.sqlite SQLite file. The</span>
<span class="c">     default value is &quot;2010&quot;.</span>

<span class="c">     A WMS request with that dimension may contain, e.g.  &quot;...</span>
<span class="c">     &amp;time=1999-08-11T11:03:07Z/2001-09-21T08:17:56Z&amp; ...&quot;</span>
<span class="c">--&gt;</span>
<span class="nt">&lt;dimension</span> <span class="na">type=</span><span class="s">&quot;time&quot;</span> <span class="na">name=</span><span class="s">&quot;time&quot;</span> <span class="na">default=</span><span class="s">&quot;2010&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;dbfile&gt;</span>/path/to/mapcache-time.sqlite<span class="nt">&lt;/dbfile&gt;</span>
<span class="hll">    <span class="nt">&lt;query&gt;</span>
</span>         SELECT strftime(&quot;%Y-%m-%dT%H:%M:%SZ&quot;,ts) FROM time
          WHERE ts <span class="ni">&amp;gt;</span>= datetime(:start_timestamp,&quot;unixepoch&quot;)
            AND ts <span class="ni">&amp;lt;</span>= datetime(:end_timestamp,&quot;unixepoch&quot;)
       ORDER BY ts DESC
<span class="hll">    <span class="nt">&lt;/query&gt;</span>
</span>
<span class="nt">&lt;/dimension&gt;</span>
</pre></div>
</div>
</td>
<td><div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="c">&lt;!-- &quot;time&quot; dimension</span>

<span class="c">     This example defines a &quot;time&quot; dimension whose possible values</span>
<span class="c">     are stored in the /path/to/mapcache-time.sqlite SQLite file. The</span>
<span class="c">     default value is &quot;2010&quot;.</span>

<span class="c">     A WMS request with that dimension may contain, e.g.  &quot;...</span>
<span class="c">     &amp;time=1999-08-11T11:03:07Z/2001-09-21T08:17:56Z&amp; ...&quot;</span>
<span class="c">--&gt;</span>
<span class="nt">&lt;dimension</span> <span class="na">type=</span><span class="s">&quot;time&quot;</span> <span class="na">name=</span><span class="s">&quot;time&quot;</span> <span class="na">default=</span><span class="s">&quot;2010&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;dbfile&gt;</span>/path/to/mapcache-time.sqlite<span class="nt">&lt;/dbfile&gt;</span>
<span class="hll">    <span class="nt">&lt;validate_query&gt;</span>
</span>         SELECT strftime(&quot;%Y-%m-%dT%H:%M:%SZ&quot;,ts) FROM time
          WHERE ts <span class="ni">&amp;gt;</span>= datetime(:start_timestamp,&quot;unixepoch&quot;)
            AND ts <span class="ni">&amp;lt;</span>= datetime(:end_timestamp,&quot;unixepoch&quot;)
       ORDER BY ts DESC
<span class="hll">    <span class="nt">&lt;/validate_query&gt;</span>
</span><span class="hll">    <span class="nt">&lt;list_query&gt;</span>SELECT ts FROM time<span class="nt">&lt;/list_query&gt;</span>
</span><span class="nt">&lt;/dimension&gt;</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>Up to MapCache 1.6.1</p></td>
<td><p>From MapCache 1.8 on</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="configuring-a-time-dimension-using-an-explicit-back-end">
<h4>Configuring a Time dimension using an explicit back-end<a class="headerlink" href="#configuring-a-time-dimension-using-an-explicit-back-end" title="Lien permanent vers ce titre">¶</a></h4>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span> <span class="c">&lt;!-- &quot;time&quot; dimension, &quot;new-style&quot; definition using a SQLite back-end</span>

<span class="c">      This example defines a &quot;time&quot; dimension whose possible values are</span>
<span class="c">      stored in the /data/times.sqlite SQLite file. The default value is</span>
<span class="c">      &quot;d1&quot;.</span>

<span class="c">      A WMS request with that dimension may contain, e.g.</span>
<span class="c">      &quot;... &amp;time=1999-08-11T11:03:07Z/2001-09-21T08:17:56Z&amp; ...&quot;</span>
<span class="c"> --&gt;</span>
<span class="hll"> <span class="nt">&lt;dimension</span> <span class="na">type=</span><span class="s">&quot;sqlite&quot;</span> <span class="na">name=</span><span class="s">&quot;time&quot;</span> <span class="na">default=</span><span class="s">&quot;d1&quot;</span> <span class="na">time=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
</span>   <span class="nt">&lt;dbfile&gt;</span>/data/times.sqlite<span class="nt">&lt;/dbfile&gt;</span>
   <span class="nt">&lt;list_query&gt;</span>SELECT ts FROM timedim<span class="nt">&lt;/list_query&gt;</span>
   <span class="nt">&lt;validate_query&gt;</span>
        SELECT strftime(&quot;%Y-%m-%dT%H:%M:%SZ&quot;,ts) FROM timedim
         WHERE ts <span class="ni">&amp;gt;</span>= datetime(:start_timestamp,&quot;unixepoch&quot;)
           AND ts <span class="ni">&amp;lt;</span>= datetime(:end_timestamp,&quot;unixepoch&quot;)
      ORDER BY ts DESC
   <span class="nt">&lt;/validate_query&gt;</span>
 <span class="nt">&lt;/dimension&gt;</span>
</pre></div>
</div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span> <span class="c">&lt;!-- &quot;time&quot; dimension, &quot;new-style&quot; definition using a PostgreSQL back-end</span>

<span class="c">      This example defines a &quot;time&quot; dimension whose possible values are</span>
<span class="c">      stored in the postgresql://mapcache:mapcache@localhost:5433/time</span>
<span class="c">      PostgreSQL database. The default value is &quot;d1&quot;.</span>

<span class="c">      A WMS request with that dimension may contain, e.g.</span>
<span class="c">      &quot;... &amp;time=1999-08-11T11:03:07Z/2001-09-21T08:17:56Z&amp; ...&quot;</span>
<span class="c"> --&gt;</span>
<span class="hll"> <span class="nt">&lt;dimension</span> <span class="na">type=</span><span class="s">&quot;postgresql&quot;</span> <span class="na">name=</span><span class="s">&quot;time&quot;</span> <span class="na">default=</span><span class="s">&quot;d1&quot;</span> <span class="na">time=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
</span>   <span class="nt">&lt;connection&gt;</span>
     host=localhost user=mapcache password=mapcache dbname=times port=5433
   <span class="nt">&lt;/connection&gt;</span>
   <span class="nt">&lt;list_query&gt;</span>SELECT ts FROM timedim<span class="nt">&lt;/list_query&gt;</span>
   <span class="nt">&lt;validate_query&gt;</span>
        SELECT to_char(ts,&#39;YYYY-MM-DD&quot;T&quot;HH24:MI:SS&quot;Z&quot;&#39;) FROM timedim
         WHERE ts <span class="ni">&amp;gt;</span>= to_timestamp(:start_timestamp)
           AND ts <span class="ni">&amp;lt;</span>= to_timestamp(:end_timestamp)
      ORDER BY ts DESC
   <span class="nt">&lt;/validate_query&gt;</span>
 <span class="nt">&lt;/dimension&gt;</span>
</pre></div>
</div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span> <span class="c">&lt;!-- &quot;time&quot; dimension, &quot;new-style&quot; definition using an ElasticSearch back-end</span>

<span class="c">      This example defines a &quot;time&quot; dimension whose possible values are</span>
<span class="c">      stored in the http://localhost:9200/times ElasticSearch index. The</span>
<span class="c">      default value is &quot;d1&quot;.</span>

<span class="c">      A WMS request with that dimension may contain, e.g.</span>
<span class="c">      &quot;... &amp;time=1999-08-11T11:03:07Z/2001-09-21T08:17:56Z&amp; ...&quot;</span>
<span class="c"> --&gt;</span>
<span class="hll"> <span class="nt">&lt;dimension</span> <span class="na">type=</span><span class="s">&quot;elasticsearch&quot;</span> <span class="na">name=</span><span class="s">&quot;time&quot;</span> <span class="na">default=</span><span class="s">&quot;d1&quot;</span> <span class="na">time=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
</span>   <span class="nt">&lt;http&gt;</span>
     <span class="nt">&lt;url&gt;</span>http://localhost:9200/times/_search<span class="nt">&lt;/url&gt;</span>
     <span class="nt">&lt;headers&gt;</span>
       <span class="nt">&lt;Content-Type&gt;</span>application/json<span class="nt">&lt;/Content-Type&gt;</span>
     <span class="nt">&lt;/headers&gt;</span>
   <span class="nt">&lt;/http&gt;</span>

   <span class="nt">&lt;list_query&gt;</span><span class="cp">&lt;![CDATA[</span>
<span class="cp">     { &quot;query&quot;: { &quot;match_all&quot;: { } } }</span>
<span class="cp">   ]]&gt;</span><span class="nt">&lt;/list_query&gt;</span>
   <span class="nt">&lt;list_response&gt;</span><span class="cp">&lt;![CDATA[</span>
<span class="cp">     [ &quot;hits&quot;, &quot;hits&quot;, &quot;_source&quot;, &quot;ts&quot; ]</span>
<span class="cp">   ]]&gt;</span><span class="nt">&lt;/list_response&gt;</span>

   <span class="nt">&lt;validate_query&gt;</span><span class="cp">&lt;![CDATA[</span>
<span class="cp">     { &quot;query&quot;: {</span>
<span class="cp">         &quot;range&quot;: {</span>
<span class="cp">           &quot;ts&quot;: { &quot;gte&quot;: :start_timestamp, &quot;lte&quot;: :end_timestamp }</span>
<span class="cp">         }</span>
<span class="cp">       },</span>
<span class="cp">       &quot;sort&quot;: { &quot;ts&quot;: { &quot;order&quot;: &quot;desc&quot; } },</span>
<span class="cp">       &quot;script_fields&quot;: {</span>
<span class="cp">         &quot;iso_ts&quot;: {</span>
<span class="cp">           &quot;lang&quot;: &quot;painless&quot;,</span>
<span class="cp">           &quot;source&quot;: &quot;SimpleDateFormat f=new SimpleDateFormat(params.fmt); f.setTimeZone(params.tz); return (f.format(doc.ts.value.getMillis()))&quot;,</span>
<span class="cp">           &quot;params&quot;: {</span>
<span class="cp">             &quot;fmt&quot;: &quot;yyyy-MM-dd&#39;T&#39;HH:mm:ss&#39;Z&#39;&quot;,</span>
<span class="cp">             &quot;tz: &quot;UTC&quot;</span>
<span class="cp">           }</span>
<span class="cp">         }</span>
<span class="cp">       }</span>
<span class="cp">     }</span>
<span class="cp">   ]]&gt;</span><span class="nt">&lt;/validate_query&gt;</span>
   <span class="nt">&lt;validate_response&gt;</span><span class="cp">&lt;![CDATA[</span>
<span class="cp">     [ &quot;hits&quot;, &quot;hits&quot;, &quot;fields&quot;, &quot;iso_ts&quot;, 0 ]</span>
<span class="cp">   ]]&gt;</span><span class="nt">&lt;/validate_response&gt;</span>

 <span class="nt">&lt;/dimension&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="tile-assembly-policies">
<h3>Politiques d’assemblage des tuiles<a class="headerlink" href="#tile-assembly-policies" title="Lien permanent vers ce titre">¶</a></h3>
<p>Lorsque plusieurs valeurs de temps ou de sous-dimensions sont renvoyées suite à une requête à une dimension de deuxième niveau, la tuile résultante est un assemblage de toutes les tuiles simples associées à chaque valeur. La façon dont ces tuiles sont assemblées est définie avec l’élément <code class="docutils literal notranslate"><span class="pre">&lt;assembly_type&gt;</span></code> de la section <code class="docutils literal notranslate"><span class="pre">&lt;dimensions&gt;</span></code>. Seulement deux valeurs sont prises en charge par MapCache:</p>
<blockquote>
<div><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">none</span></code>: Aucun assemblage n’est réalisé, la tuile résultante est la première tuile récupérée du cache. C’est la valeur par défaut.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stack</span></code>: Chaque pixel de la tuile résultante est rempli avec le premier pixel opaque trouvé dans toutes les tuiles dans leur ordre de récupération, par exemple:</p>
<table class="docutils align-default" id="type-d-assemblage-stack">
<caption><span class="caption-text">Type d’assemblage: <code class="docutils literal notranslate"><span class="pre">stack</span></code></span><a class="headerlink" href="#type-d-assemblage-stack" title="Lien permanent vers ce tableau">¶</a></caption>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><a class="reference internal image-reference" href="../_images/mapcache-assembly-stack-1.png"><img alt="../_images/mapcache-assembly-stack-1.png" src="../_images/mapcache-assembly-stack-1.png" style="width: 148.5px; height: 125.0px;" /></a>
</td>
<td><a class="reference internal image-reference" href="../_images/mapcache-assembly-stack-2.png"><img alt="../_images/mapcache-assembly-stack-2.png" src="../_images/mapcache-assembly-stack-2.png" style="width: 148.5px; height: 125.0px;" /></a>
</td>
<td><a class="reference internal image-reference" href="../_images/mapcache-assembly-stack-3.png"><img alt="../_images/mapcache-assembly-stack-3.png" src="../_images/mapcache-assembly-stack-3.png" style="width: 149.0px; height: 125.0px;" /></a>
</td>
</tr>
<tr class="row-even"><td><p>Produit 1</p></td>
<td><p>Produit 2</p></td>
<td><p>Assemblage <code class="docutils literal notranslate"><span class="pre">stack</span></code> des produits 1 et 2</p></td>
</tr>
</tbody>
</table>
</li>
</ul>
</div></blockquote>
<p>Il est possible de choisir si la tuile résultante doit être stockée dans le cache ou non, via l’élément <code class="docutils literal notranslate"><span class="pre">&lt;store_assemblies&gt;</span></code> de la section <code class="docutils literal notranslate"><span class="pre">&lt;dimensions&gt;</span></code>. Les deux valeurs possibles sont <code class="docutils literal notranslate"><span class="pre">true</span></code> et <code class="docutils literal notranslate"><span class="pre">false</span></code>. La valeur par défaut est <code class="docutils literal notranslate"><span class="pre">true</span></code>.</p>
<p>L’élément <code class="docutils literal notranslate"><span class="pre">&lt;subdimensions_read_only&gt;</span></code> de la section <code class="docutils literal notranslate"><span class="pre">&lt;dimensions&gt;</span></code> indique si la source de données doit être interrogée en cas de défaut de cache. Les deux valeurs possibles sont <code class="docutils literal notranslate"><span class="pre">true</span></code> et <code class="docutils literal notranslate"><span class="pre">false</span></code>. La valeur par défaut est <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;dimensions&gt;</span>
    <span class="nt">&lt;assembly_type&gt;</span>stack<span class="nt">&lt;/assembly_type&gt;</span>
    <span class="nt">&lt;store_assemblies&gt;</span>true<span class="nt">&lt;/store_assemblies&gt;</span>
    <span class="nt">&lt;subdimensions_read_only&gt;</span>false<span class="nt">&lt;/subdimensions_read_only&gt;</span>
    <span class="nt">&lt;dimension</span> <span class="nt">&gt;</span>...<span class="nt">&lt;/dimension&gt;</span>
<span class="nt">&lt;/dimensions&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="storing-dimensions">
<h2>Stockage des dimensions<a class="headerlink" href="#storing-dimensions" title="Lien permanent vers ce titre">¶</a></h2>
<p>Dans un cache de type disque, les tuiles sont stockées dans une structure de dossier ressemblant à <code class="docutils literal notranslate"><span class="pre">base/gridname/DIM1/value/xx/xx/xx/xx/xx/xx.png</span></code> (où DIM1 est la valeur de dimension).</p>
<p>L’ordre des éléments <code class="docutils literal notranslate"><span class="pre">&lt;dimension&gt;</span></code> à l’intérieur de la section <code class="docutils literal notranslate"><span class="pre">&lt;dimensions&gt;</span></code> est important car il est utilisé pour créer la structure de répertoires pour le cache de type disque. Si l’ordre est modifié, toutes les tuiles qui ont été déjà stockées dans le cache sont invalidées (elles deviennent inaccessibles à MapCache mais ne sont pas détruites).</p>
<p>Les « templates » peuvent être utilisés pour adapter la structure des dossiers, par exemple:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;tmpl&quot;</span> <span class="na">type=</span><span class="s">&quot;disk&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;template&gt;</span>/tmp/template-test/{tileset}#{grid}#{dim}/{z}/{x}/{y}.{ext}<span class="nt">&lt;/template&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
<p>Les « templates » peuvent aussi être utilisés pour adapter le nom d’un fichier SQLite, par exemple:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="c">&lt;!-- the following will create databases named TilesetName-#DimensionValue.db --&gt;</span>
<span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;sqlite&quot;</span> <span class="na">type=</span><span class="s">&quot;sqlite3&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;dbfile&gt;</span>{tileset}-{dim}.db<span class="nt">&lt;/dbfile&gt;</span>
   <span class="nt">&lt;detect_blank</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="accessing-tile-caches-with-dimensions">
<h2>Accès à un cache de tuiles à l’aide des dimensions<a class="headerlink" href="#accessing-tile-caches-with-dimensions" title="Lien permanent vers ce titre">¶</a></h2>
<p>Pour obtenir une tuile avec une dimension spécifique, il suffit d’ajouter le nom de la dimension et sa valeur à la requête, par exemple: <code class="docutils literal notranslate"><span class="pre">&amp;DIM1=value</span></code></p>
<p>Seuls les clients WMS et WMTS supportent le passage des dimensions à MapCache. Les autres services de tuiles, tels que gmaps (GoogleMaps), tms et KML ne supportent pas les dimensions. Toutefois, WMTS permet l’accès à une tuile selon un schéma d’adressage x,y,z, ce qui ouvre la possibilité à des clients de tuiles (par exemple une couche OpenLayers <code class="docutils literal notranslate"><span class="pre">ol.source.XYZ</span></code>) d’accéder à un jeu de tuiles avec dimensions grâce à une réécriture d’URL sur le serveur web.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># a URL such as the following</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">servername</span><span class="o">/</span><span class="n">tiles</span><span class="o">/</span><span class="mi">13</span><span class="o">/</span><span class="mi">3914</span><span class="o">/</span><span class="mf">2687.</span><span class="n">png</span>
<span class="c1"># can be rewritten into a WMTS request - note WMTS uses {z}/{y}/{x} rather than {z}/{x}/{y}</span>
<span class="c1"># so these values need to be swapped</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">servername</span><span class="o">/</span><span class="n">mapcache</span><span class="o">/</span><span class="n">wmts</span><span class="o">/</span><span class="mf">1.0</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">layername</span><span class="o">/</span><span class="n">default</span><span class="o">/</span><span class="n">dimension</span><span class="o">/</span><span class="n">GoogleMapsCompatible</span><span class="o">/</span><span class="mi">13</span><span class="o">/</span><span class="mi">2687</span><span class="o">/</span><span class="mf">3914.</span><span class="n">png</span>
</pre></div>
</div>
</div>
<div class="section" id="seeding-tile-caches-with-dimensions">
<h2>Alimenter un cache de tuiles à l’aide des dimensions<a class="headerlink" href="#seeding-tile-caches-with-dimensions" title="Lien permanent vers ce titre">¶</a></h2>
<p><a class="reference internal" href="seed.html#mapcache-seed"><span class="std std-ref">L’outil d’alimentation de MapCache</span></a> autorise d’alimenter des dimensions spécifiques avec la syntaxe suivante:</p>
<div class="highlight-bat notranslate"><div class="highlight"><pre><span></span>mapcache_seed -c mapcache_config.xml -t tileset1 -e -1187000,6695000,-605000,7450000 -z 7,10 --dimension DIMENSION_NAME=DIMENSION_VALUE
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Recherche rapide</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><h3>Navigation</h3>
<p>
<a href="../about.html" title="About">About</a><br>
<a href="../products.html" title="Products">Products</a><br>
<a href="../community/index.html" title="Community">Community</a><br>
<a href="../development/index.html" title="Development">Development</a><br>
<a href="../download.html" title="Downloads">Downloads</a><br>
<a href="../documentation.html" title="Documentation">Documentation</a><br>
<a href="../faq.html" title="FAQ">FAQ</a><br>
<a href="../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</h3>
  <ul>
<li><a class="reference internal" href="#">Dimensions d’un jeu de tuiles</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#enabling-dimension-support-in-mapcache">Activation des dimensions dans MapCache</a><ul>
<li><a class="reference internal" href="#dimension-attributes">Attributs de dimension</a></li>
<li><a class="reference internal" href="#dimension-types">Types de dimensions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#first-level-dimensions">Dimensions de premier niveau</a><ul>
<li><a class="reference internal" href="#values-dimensions">Dimensions de type <code class="docutils literal notranslate"><span class="pre">values</span></code></a></li>
<li><a class="reference internal" href="#regex-dimensions">Dimensions de type <code class="docutils literal notranslate"><span class="pre">regex</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#second-level-dimensions">Dimensions de deuxième niveau</a><ul>
<li><a class="reference internal" href="#sqlite-dimensions">Dimensions de type <code class="docutils literal notranslate"><span class="pre">sqlite</span></code></a></li>
<li><a class="reference internal" href="#postgresql-dimensions">PostgreSQL Dimensions</a></li>
<li><a class="reference internal" href="#elasticsearch-dimensions">ElasticSearch Dimensions</a></li>
<li><a class="reference internal" href="#time-dimensions">Dimensions de type <code class="docutils literal notranslate"><span class="pre">time</span></code></a><ul>
<li><a class="reference internal" href="#configuring-a-time-dimension-using-a-default-sqlite-back-end">Configuring a Time Dimension using a default SQLite back-end</a></li>
<li><a class="reference internal" href="#configuring-a-time-dimension-using-an-explicit-back-end">Configuring a Time dimension using an explicit back-end</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tile-assembly-policies">Politiques d’assemblage des tuiles</a></li>
</ul>
</li>
<li><a class="reference internal" href="#storing-dimensions">Stockage des dimensions</a></li>
<li><a class="reference internal" href="#accessing-tile-caches-with-dimensions">Accès à un cache de tuiles à l’aide des dimensions</a></li>
<li><a class="reference internal" href="#seeding-tile-caches-with-dimensions">Alimenter un cache de tuiles à l’aide des dimensions</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Index général"
             >index</a></li>
        <li class="right" >
          <a href="http.html" title="HTTP Requests"
             >suivant</a> |</li>
        <li class="right" >
          <a href="formats.html" title="Formats d’image"
             >précédent</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../documentation.html" >MapServer 7.4.0 Documentation</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >MapCache 1.6.1</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; <a href="../copyright.html">Copyright</a> 2019, Open Source Geospatial Foundation.
      Mis à jour le 2019-07-12.
      Créé avec <a href="http://sphinx-doc.org/">Sphinx</a> 2.1.2.
    </div>
  </body>
</html>