<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="fr">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Alimentation du cache &#8212; MapServer 7.0.2 documentation</title>
    
    <link rel="stylesheet" href="../_static/sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '7.0.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <link rel="shortcut icon" href="../_static/mapserver.ico"/>
    <link rel="author" title="À propos de ces documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="top" title="MapServer 7.0.2 documentation" href="../index.html" />
    <link rel="up" title="MapCache 1.4" href="index.html" />
    <link rel="next" title="Types de cache" href="caches.html" />
    <link rel="prev" title="Services de tuilage supportés" href="services.html" /> 
  </head>
  <body role="document">

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../index.html" title="Home"><img src="../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../index.html" title="Home">Home</a> |
      <a href="../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="../download.html" title="Download Source or Binaries">Download </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        
          
            <a href="../../mapcache/seed.html"><img src="../_static/flagicons/en.png" alt="en" title="en" border="0" /></a>
          
        
        
          
            <a href="../../ar/mapcache/seed.html"><img src="../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
          
        
        
          
            <a href="../../de/mapcache/seed.html"><img src="../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
          
        
        
          
            <a href="../../el/mapcache/seed.html"><img src="../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
          
        
        
          
            <a href="../../es/mapcache/seed.html"><img src="../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
          
        
        <img src="../_static/flagicons/fr.png" alt="fr" title="fr" border="0" width="18px" height="13px"/>
        
          
            <a href="../../id/mapcache/seed.html"><img src="../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
          
        
        
          
            <a href="../../it/mapcache/seed.html"><img src="../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
          
        
        
          
            <a href="../../ja/mapcache/seed.html"><img src="../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
          
        
        
          
            <a href="../../nl_NL/mapcache/seed.html"><img src="../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
          
        
        
          
            <a href="../../pl/mapcache/seed.html"><img src="../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
          
        
        
          
            <a href="../../ru/mapcache/seed.html"><img src="../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
          
        
        
          
            <a href="../../sq/mapcache/seed.html"><img src="../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
          
        
        
          
            <a href="../../tr/mapcache/seed.html"><img src="../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
          
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Index général"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="caches.html" title="Types de cache"
             accesskey="N">suivant</a> |</li>
        <li class="right" >
          <a href="services.html" title="Services de tuilage supportés"
             accesskey="P">précédent</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../documentation.html" >Documentation de MapServer 7.0.2</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">MapCache 1.4</a> &#187;</li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="seeder">
<span id="mapcache-seed"></span><h1>Alimentation du cache<a class="headerlink" href="#seeder" title="Lien permanent vers ce titre">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Author:</th><td class="field-body">Thomas Bonfort</td>
</tr>
<tr class="field-even field"><th class="field-name">Contact:</th><td class="field-body">tbonfort at terriscope.fr</td>
</tr>
<tr class="field-odd field"><th class="field-name">Author:</th><td class="field-body">Mathieu Coudert</td>
</tr>
<tr class="field-even field"><th class="field-name">Contact:</th><td class="field-body">mathieu.coudert at gmail.com</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>Mod-mapcache ships with an advanced seeding tool, whose main features are:</dt>
<dd><ul class="first last simple">
<li>configurable number of seeding threads, to speed up the rendering</li>
<li><p class="first">capacité à régénérer certaines tuiles plus âgées qu&#8217;une date particulière</p>
</li>
<li>ability to seed tiles given a shapefile/OGR datasource</li>
</ul>
</dd>
</dl>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Lien permanent vers ce titre">¶</a></h2>
<p>L&#8217;utilitaire de génération de tuile est nommé mapcache_seed et est situé sous le répertoire d&#8217;installation (/usr/local/bin par défaut).</p>
<div class="section" id="commandline-options">
<h3>Commandline Options<a class="headerlink" href="#commandline-options" title="Lien permanent vers ce titre">¶</a></h3>
<p>Options are available in short and long versions (e.g. -c or &#8211;config).</p>
<p><strong>-c | &#8211;config [file]</strong> : chemin vers le fichier de configuration mapcache.xml qui contient les tilesets qui nécessitent d&#8217;être générés.</p>
<p><strong>-D | &#8211;dimension &#8220;DIMENSION=VALEUR&#8221;</strong>: utilisé pour définir quelle dimension utiliser si le tileset gère les dimensions. Peut être utilisé plusieurs fois pour définir plusieurs dimensions, e.g. -D &#8220;DIM1=VAL1&#8221; -D &#8220;DIM2=VAL2&#8221;.</p>
<p><strong>-e | &#8211;extent minx,miny,maxx,maxy</strong>: boîte englobante de la surface à générer.</p>
<p><strong>-f | &#8211;force</strong>: force recreation of existing tiles.</p>
<p><strong>-g | &#8211;grid [grid]</strong>: nom de la grille qui doit être remplie (le tileset sélectionné doit référencer la grille donnée).</p>
<p><strong>-h | &#8211;help</strong>: affiche l&#8217;aide</p>
<p><strong>-i | &#8211;iteration-mode</strong>: soit &#8220;<em>drill-down</em>&#8221; ou &#8220;<em>level-by-level</em>&#8221;. drill-down est la valeur par défaut pour les grilles g, WGS84 et GoogleMapsCompatible, et level-by-level pour les autres. Utilisez cette option pour imposer votre valeur.</p>
<p><strong>-m | &#8211;mode</strong>: the mode to use the seeder: &#8220;<em>seed</em>&#8221;, &#8220;<em>delete</em>&#8221; or &#8220;<em>transfer</em>&#8221;.
Default is seed (<em>mode: seed</em>).</p>
<p><strong>-M | &#8211;metasize</strong>: override metatile size while seeding, e.g. 8,8.</p>
<p><strong>-n | &#8211;nthreads</strong>: number of parallel threads that should be used to request
tiles from the WMS source. The default is 1, but can be set higher if the WMS
server can withstand parallel requests. (As a rule of thumb, the value chosen
here should never be much higher than the number of CPUs on the WMS server.)</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This option is imcompatible with the <strong>-p | &#8211;nprocesses</strong> option.</p>
</div>
<p><strong>-o | &#8211;older [timestamp|now]</strong>: only seed tiles that are older than the given
value. The value can either be the string &#8220;<em>now</em>&#8221;, or a date formatted like
year/month/day hour:minute, e.g. &#8220;2011/01/31 20:45&#8221;.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A full timestamp should be quoted.</p>
</div>
<p><strong>-p | &#8211;nprocesses</strong>: number of parallel processes that should be used to
request tiles from the WMS source.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This option is imcompatible with the <strong>-n | &#8211;nthreads</strong> option.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Avertissement</p>
<p class="last">When working with multiple processes (-p switch) and SQLite cache
backends, some errors may appear under high concurrency when writing to the
SQLite database (error: SQL logic error or missing database (1)).
Upgrading to SQLite &gt;= 3.7.15 seems to resolve this issue.</p>
</div>
<p><strong>-q | &#8211;quiet</strong> : n&#8217;affiche pas les messages de progression vers la sortie standard.</p>
<p><strong>-t | &#8211;tileset [tileset]</strong>: nom du tileset qui doit rempli.</p>
<p><strong>-v | &#8211;verbose</strong>: affiche des informations de débugage verbeux (si compilé).</p>
<p><strong>-x | &#8211;transfer</strong>: the tileset to transfer when seeder is run in transfer mode.</p>
<p><strong>-z | &#8211;zoom minzoom,maxzoom</strong>: niveaux de zoom de départ et de fin qui doit être rempli.</p>
</div>
<div class="section" id="optional-commandline-options-when-using-ogr-geos">
<h3>Optional Commandline Options When Using OGR/GEOS<a class="headerlink" href="#optional-commandline-options-when-using-ogr-geos" title="Lien permanent vers ce titre">¶</a></h3>
<p>At compile time, if OGR and GEOS are found on the system, the seeder tool will
support additional options to seed only the tiles that cover an arbitrary
geographical area. <em>Important:</em> Note that, for the time being, the OGR
datasource should be in the same projection as the grid you are seeding, as
there is no automatic reprojection from the datasource projection to the grid
projection.</p>
<p><strong>-d | &#8211;ogr-datasource [ogr_datasource]</strong>: OGR connection to the spatial source.
Consult the OGR documentation for all that is supported. In the simplest case
(e.g. a Shapefile), this is just the full filename of the shapefile.</p>
<p><strong>-l | &#8211;ogr-layer [ogr_layer]</strong>: for datasources that contain multiple layers
(e.g. PostGIS, with multiple tables), determines which layer will be used.</p>
<p><strong>-s | &#8211;ogr-sql [ogr_sql]</strong>: OGR SQL expression that can be applied (see <a class="reference external" href="http://www.gdal.org/ogr/ogr_sql.html">OGR SQL</a>).</p>
<p><strong>-w | &#8211;ogr-where [ogr_where]</strong>: SQL &#8220;where&#8221; expression to filter out returned values.
This would typically be used to select only the geometry of a given country if the
datasource contains all the world contours.</p>
</div>
<div class="section" id="important-note">
<h3>Note importante<a class="headerlink" href="#important-note" title="Lien permanent vers ce titre">¶</a></h3>
<p>L&#8217;utilitaire d&#8217;alimentation doit être lancé avec le même compte utilisateur que celui qui fait tourner le serveur web. Cela est nécessaire pour que les permissions sur les tuiles et répertoires créés lors de la pré-génération soit ensuite accessible par le serveur web, et que réciproquement l&#8217;utilitaire d&#8217;alimentation puisse écrire dans les répertoires créés initialement par le serveur web.</p>
<p>Un session de pré-génération peut ressembler à ceci</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>[user@host]$ sudo www-data
[www-data@host]$ /path/to/mapcache/src/mapcache_seed -c /path/to/www/conf/mapcache.xml [[options]]
[www-data@host]$ logout
[user@host]$
</pre></div>
</div>
</div>
<div class="section" id="examples">
<h3>Exemples<a class="headerlink" href="#examples" title="Lien permanent vers ce titre">¶</a></h3>
<p>Seed the &#8220;osm&#8221; tileset with the &#8220;g&#8221; (Google / Web Mercator) grid:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">src</span><span class="o">/</span><span class="n">mapcache_seed</span> <span class="o">-</span><span class="n">c</span> <span class="n">mapcache</span><span class="o">.</span><span class="n">xml</span> <span class="o">-</span><span class="n">t</span> <span class="n">osm</span> <span class="o">-</span><span class="n">g</span> <span class="n">g</span>
</pre></div>
</div>
<p>Niveaux de pré-génération de 0 à 12:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">src</span><span class="o">/</span><span class="n">mapcache_seed</span> <span class="o">-</span><span class="n">c</span> <span class="n">mapcache</span><span class="o">.</span><span class="n">xml</span> <span class="o">-</span><span class="n">t</span> <span class="n">osm</span> <span class="o">-</span><span class="n">g</span> <span class="n">g</span> <span class="o">-</span><span class="n">z</span> <span class="mi">0</span><span class="p">,</span><span class="mi">12</span>
</pre></div>
</div>
<p>Given a shapefile that contains the world country countours, seed only the
areas that are covered by land (i.e. skip the oceans). Also, use 4 request
threads in parallel:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">src</span><span class="o">/</span><span class="n">mapcache_seed</span> <span class="o">-</span><span class="n">c</span> <span class="n">mapcache</span><span class="o">.</span><span class="n">xml</span> <span class="o">-</span><span class="n">t</span> <span class="n">osm</span> <span class="o">-</span><span class="n">g</span> <span class="n">g</span> <span class="o">-</span><span class="n">z</span> <span class="mi">0</span><span class="p">,</span><span class="mi">12</span> <span class="o">-</span><span class="n">n</span> <span class="mi">4</span> <span class="o">-</span><span class="n">d</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">seed</span><span class="o">.</span><span class="n">shp</span>
</pre></div>
</div>
<p>Same as beforehand, but only seed the USA (notice the quote usage, required to
create valid SQL with a single-quoted &#8216;US&#8217;:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">src</span><span class="o">/</span><span class="n">mapcache_seed</span> <span class="o">-</span><span class="n">c</span> <span class="n">mapcache</span><span class="o">.</span><span class="n">xml</span> <span class="o">-</span><span class="n">t</span> <span class="n">osm</span> <span class="o">-</span><span class="n">g</span> <span class="n">g</span> <span class="o">-</span><span class="n">z</span> <span class="mi">0</span><span class="p">,</span><span class="mi">12</span> <span class="o">-</span><span class="n">n</span> <span class="mi">4</span> <span class="o">-</span><span class="n">d</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">seed</span><span class="o">.</span><span class="n">shp</span> <span class="o">-</span><span class="n">w</span> <span class="s2">&quot;FIPS_A2=&#39;US&#39;&quot;</span>
</pre></div>
</div>
<p>Reseed levels 0 to 12 (this could also be done by deleting the cache for levels
0 to 12 and doing a classic seed, but doing so this way does not slow down
access from web clients):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">src</span><span class="o">/</span><span class="n">mapcache_seed</span> <span class="o">-</span><span class="n">c</span> <span class="n">mapcache</span><span class="o">.</span><span class="n">xml</span> <span class="o">-</span><span class="n">t</span> <span class="n">osm</span> <span class="o">-</span><span class="n">g</span> <span class="n">g</span> <span class="o">-</span><span class="n">z</span> <span class="mi">0</span><span class="p">,</span><span class="mi">12</span> <span class="o">-</span><span class="n">o</span> <span class="n">now</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Recherche rapide</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><h3>Navigation</h3>
<p>
<a href="../about.html" title="About">About</a><br>
<a href="../products.html" title="Products">Products</a><br>
<a href="../community/index.html" title="Community">Community</a><br>
<a href="../development/index.html" title="Development">Development</a><br>
<a href="../download.html" title="Downloads">Downloads</a><br>
<a href="../documentation.html" title="Documentation">Documentation</a><br>
<a href="../faq.html" title="FAQ">FAQ</a><br>
<a href="../psc.html" title="PSC">PSC</a>
</p>
  <h3>Current Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Alimentation du cache</a><ul>
<li><a class="reference internal" href="#usage">Usage</a><ul>
<li><a class="reference internal" href="#commandline-options">Commandline Options</a></li>
<li><a class="reference internal" href="#optional-commandline-options-when-using-ogr-geos">Optional Commandline Options When Using OGR/GEOS</a></li>
<li><a class="reference internal" href="#important-note">Note importante</a></li>
<li><a class="reference internal" href="#examples">Exemples</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Index général"
             >index</a></li>
        <li class="right" >
          <a href="caches.html" title="Types de cache"
             >suivant</a> |</li>
        <li class="right" >
          <a href="services.html" title="Services de tuilage supportés"
             >précédent</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../documentation.html" >Documentation de MapServer 7.0.2</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >MapCache 1.4</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; <a href="../copyright.html">Copyright</a> 2016, Open Source Geospatial Foundation.
      Créé avec <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.8.
    </div>
  </body>
</html>