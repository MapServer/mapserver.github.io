

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Installation d’Oracle &mdash; MapServer 6.4.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '6.4.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <link rel="shortcut icon" href="../_static/mapserver.ico"/>
    <link rel="author" title="À propos de ces documents" href="../about.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="top" title="MapServer 6.4.1 documentation" href="../index.html" />
    <link rel="up" title="Installation" href="index.html" />
    <link rel="next" title="Mapfile" href="../mapfile/index.html" />
    <link rel="prev" title="Paramétrage de IIS pour MapServer" href="iis.html" /> 
  </head>
  <body>

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../index.html" title="Home"><img src="../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../index.html" title="Home">Home</a> |
      <a href="../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../faq.html" title="FAQ">FAQ</a> |
      <a href="../download.html" title="Download">Download </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        
          
            <a href="../../installation/oracle.html"><img src="../_static/flagicons/en.png" alt="en" title="en" border="0" /></a>
          
        
        
          
            <a href="../../it/installation/oracle.html"><img src="../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
          
        
        
          
            <a href="../../es/installation/oracle.html"><img src="../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
          
        
        
          
            <a href="../../zh_cn/installation/oracle.html"><img src="../_static/flagicons/zh_cn.png" alt="zh_cn" title="zh_cn" border="0" /></a>
          
        
        
          
            <a href="../../de/installation/oracle.html"><img src="../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
          
        
        
          
            <a href="../../el/installation/oracle.html"><img src="../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
          
        
        <img src="../_static/flagicons/fr.png" alt="fr" title="fr" border="0" width="18px" height="13px"/>
        
          
            <a href="../../id/installation/oracle.html"><img src="../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
          
        
        
          
            <a href="../../sq/installation/oracle.html"><img src="../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
          
        
        
          
            <a href="../../tr/installation/oracle.html"><img src="../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
          
        

    </td>
  </tr>
</table>


    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Index général"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../mapfile/index.html" title="Mapfile"
             accesskey="N">suivant</a> |</li>
        <li class="right" >
          <a href="iis.html" title="Paramétrage de IIS pour MapServer"
             accesskey="P">précédent</a> |</li>
        <li><a href="../index.html">Home</a> &raquo;</li>
          <li><a href="../documentation.html" >Documentation de MapServer 6.4.1</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Installation</a> &raquo;</li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="oracle-installation">
<span id="oci-install"></span><span id="index-0"></span><h1><a class="toc-backref" href="#table-of-contents">Installation d&#8217;Oracle</a><a class="headerlink" href="#oracle-installation" title="Lien permanent vers ce titre">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Author:</th><td class="field-body">Till Adams</td>
</tr>
<tr class="field-even field"><th class="field-name">Last Updated:</th><td class="field-body">2007/02/16</td>
</tr>
</tbody>
</table>
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#oracle-installation" id="id1">Installation d&#8217;Oracle</a><ul>
<li><a class="reference internal" href="#preface" id="id2">Préface</a></li>
<li><a class="reference internal" href="#system-assumptions" id="id3">Suppositions système</a></li>
<li><a class="reference internal" href="#compile-mapserver" id="id4">Compiler Mapserver</a></li>
<li><a class="reference internal" href="#set-environment-variables" id="id5">Définir les variables d&#8217;environnement</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="preface">
<h2><a class="toc-backref" href="#table-of-contents">Préface</a><a class="headerlink" href="#preface" title="Lien permanent vers ce titre">¶</a></h2>
<p>Ce document explique la configuration complète nécessaire pour avoir la connexion entre le <a class="reference internal" href="../cgi/index.html#cgi"><em>CGI</em></a> MapServer et un serveur de base de données Oracle sous une machine linux (Ubuntu). Le but de ce document est juste de compiler une connaissance &#8220;google&#8221; à UN seul endroit. En espérant qu&#8217;il permettra à de nombreuses personnes de passer autant de tant que nous pour cela.</p>
<p>Ce manuel a été écrit, parce que j&#8217;ai perdu plusieurs jours sur Google pour permettre à mon Mapserver d&#8217;accéder à une base de données Oracle. Je ne suis PAS un expert Oracle, donc le but du document est juste de concentrer à UN seul endroit cette connaissance éparpillée. En espérant, que cela évitera à d&#8217;autres utilisateurs de perdre autant de temps sur ce problème que moi! (Ou si vous avez le choix, essayez <a class="reference internal" href="../input/vector/postgis.html#input-postgis"><em>PostGIS</em></a> ;-))</p>
<p>Avant que nous commencions, quelques connaissances basiques que nous ignorions avant:</p>
<ul class="simple">
<li>MapServer peut accéder à de la donnée dans n&#8217;importe quelle installation de Oracle Spatial ou de Oracle Locator! Oracle locator est fournit avec chaque instance de Oracle, il n&#8217;y a pas de licence supplémentaire pour cela.</li>
<li>Il n&#8217;y a pas besoin de faire l&#8217;installation d&#8217;autres paquets à part oracle/oracle OCI</li>
</ul>
</div>
<div class="section" id="system-assumptions">
<h2><a class="toc-backref" href="#table-of-contents">Suppositions système</a><a class="headerlink" href="#system-assumptions" title="Lien permanent vers ce titre">¶</a></h2>
<p>Nous assumons que Oracle est déjà installé, qu&#8217;il y a une base de données et qu&#8217;elle contient des données géospatiales. Les chemins suivants doivent être connus par le lecteur:</p>
<ul class="simple">
<li>ORACLE_HOME</li>
<li>ORACLE_SID</li>
<li>ORACLE_BASE</li>
<li>LD_LIBRARY_PATH</li>
</ul>
<p>Nous supposons aussi que vous avez installé <strong>apache2</strong> (notre version était la 2.0.49) et vous êtes habitués à travailler avec des systèmes Linux/UNIX. Nous présupposons égelement que vous êtes capables d&#8217;utiliser l&#8217;éditeur <a class="reference internal" href="../development/editing/vim.html#vim"><em>vi/vim</em></a>.</p>
<p>Nous nous assurons que l&#8217;utilisateur Oracle qui a accédé plus tôt à la base de données a les droits d&#8217;écriture au répertoire oracle_home.</p>
<p>Bous assumon aussi que vous avez déjà configuré le fichier tnsnames.ora. Il devrait ressembler à ceci:</p>
<div class="highlight-python"><pre>MY_ORACLE =
    (DESCRIPTION =
        (ADDRESS = (PROTOCOL = TCP)(HOST = host)(PORT = 1521))
        (CONNECT_DATA =
            (SERVICE_NAME = your_name)
        )
    )</pre>
</div>
<p>Il est important que vous connaissiez le NOM de votre source de données, dans cet exemple, c&#8217;est &#8220;MY_ORACLE&#8221; et ile sera utilisé plus loin. Après avoir fait cela, vous pouvez définir <tt class="docutils literal"><span class="pre">User/Password&#64;MY_ORACLE</span></tt> dans votre mapfile pour vous connecter à la base de données Oracle. Mai avant, nous avons encore des choses à faire.</p>
</div>
<div class="section" id="compile-mapserver">
<h2><a class="toc-backref" href="#table-of-contents">Compiler Mapserver</a><a class="headerlink" href="#compile-mapserver" title="Lien permanent vers ce titre">¶</a></h2>
<p>Compiler comme une compilation normale et définir ce drapeau:</p>
<div class="highlight-python"><pre>--with-oraclespatial=/path/to/oracle/home/&lt;/p&gt;</pre>
</div>
<p>Si le &#8220;configure&#8221; et le make de MapServer se passent bien, essayez</p>
<div class="highlight-python"><pre>./mapserv -v</pre>
</div>
<p>Cela devrait au minimum vous renvoyer cette sortie:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">INPUT</span><span class="o">=</span><span class="n">ORACLESPATIAL</span>
</pre></div>
</div>
<p>Si vous avez ça, vous êtes bons du point de vue de Mapserver</p>
</div>
<div class="section" id="set-environment-variables">
<h2><a class="toc-backref" href="#table-of-contents">Définir les variables d&#8217;environnement</a><a class="headerlink" href="#set-environment-variables" title="Lien permanent vers ce titre">¶</a></h2>
<p>Il est important de régler correctement toutes les variables d&#8217;environnement. ceraines sont pour la configuration complète du système et d&#8217;autres sont utilisées pour le répertoire cgi dans votre configuration Apache.</p>
<div class="section" id="system-variables">
<h3>Variables système<a class="headerlink" href="#system-variables" title="Lien permanent vers ce titre">¶</a></h3>
<p>Sur Ubuntu (et de nombreux autres systèmes), il y a un fichier &#8220;/etc/profile&#8221; qui définit les variables d&#8217;environnement pour tous les utilisateurs du système (vous voudrez peut être des variables d&#8217;environnement spécifiques en éditant le fichier des utilisateurs &#8221;.profile&#8221; dans leur répertoire home, mais habituellement les utilisateurs de la base de données Oracle ne sont pas des utilisateurs du système avec leur propre home)</p>
<p>Définir les variables suivantes</p>
<div class="highlight-python"><pre>$ cd /etc


$ echo export ORACLE_HOME=/path/to/oracle/home &gt;&gt; /etc/profile

# **(e.g. ORACLE_HOME=/app/oracle/ora10g)

$ echo export ORACLE_BASE=path/to/oracle &gt;&gt; /etc/profile

# **(e.g. ORACLE_HOME=/app/oracle)

$ echo export ORACLE_SID=MY_ORACLE &gt;&gt; /etc/profile

$ echo export LD_LIBRARY_PATH=path/to/oracle/home/lib &gt;&gt; /etc/profile

# **(e.g. ORACLE_HOME=/app/oracle/ora10g/lib)</pre>
</div>
<p>La commande est silencieuse, donc il n&#8217;y a pas de sortie système si vous n&#8217;avez pas fait d&#8217;erreur de frappe!</p>
</div>
<div class="section" id="setting-the-apache-environment">
<h3>Paraméter l&#8217;environnement Apache<a class="headerlink" href="#setting-the-apache-environment" title="Lien permanent vers ce titre">¶</a></h3>
<p>Parfois, il est difficile de savoir OÙ définir QUOI dans les fichiers découpés apache2.conf-<a href="#id1"><span class="problematic" id="id2">*</span></a>. Dans le dossier &#8220;/etc/apache2/sites_available&#8221; vous trouverez votre fichier de sites. Si vous n&#8217;avez rien fait de spécial c&#8217;est à dire installer des hôtes virtuels, le fichier se nomme &#8220;default&#8221;. Dans ce fichier, le répertoire cgi de Apache est défini. Votre fichier devrait ressembler à quelque chose comme cela:</p>
<div class="highlight-python"><pre>ScriptAlias /cgi-bin/ /var/www/cgi-bin/
&lt;Directory "/var/www/cgi-bin"&gt;
       AllowOverride None
       Options ExecCGI -MultiViews +SymLinksIfOwnerMatch
       Order allow,deny
       Allow from all
&lt;/Directory&gt;&lt;/p&gt;</pre>
</div>
<p>Dans ce fichier, les variables d&#8217;environnement locales doivent être définies. Nous avons fait cela dans un bloc &#8220;location&#8221; ressemblant à ceci:</p>
<div class="highlight-python"><pre>&lt;Location "/cgi-bin/"&gt;
    SetEnv ORACLE_HOME "/path/to/oracle/home"
&lt;/Location&gt;&lt;/p&gt;</pre>
</div>
<p>Où /cgi-bin/ dans le bloc &#8220;location block&#8221; se réfère au script alias /cgi-bin/ et le répertoire TNS_ADMIN pointe vers l&#8217;emplacement du fichier tnsnames.ora.</p>
<p>Ensuite, redémarrer apache:</p>
<div class="highlight-python"><pre>$ /etc/init.d/apache2 force-reload</pre>
</div>
</div>
<div class="section" id="create-mapfile">
<h3>Créer un mapfile<a class="headerlink" href="#create-mapfile" title="Lien permanent vers ce titre">¶</a></h3>
<p>Avant de commencer à créer votre mapfile, assurez-vous d&#8217;avoir un accès à la base de données (Utilisateur/Mot de passe) et que vous connaissiez le SRID Oracle, qui peut être différent du code <a class="reference internal" href="../glossary.html#term-epsg"><em class="xref std std-term">EPSG</em></a> de PROJ!</p>
<p>Les paramètres d&#8217;accès aux données</p>
<ul class="simple">
<li>CONNECTIONTYPE oraclespatial</li>
<li>CONNECTION <a class="reference external" href="mailto:'user/password&#37;&#52;&#48;MY_ORACLE">'user/password<span>&#64;</span>MY_ORACLE</a>&#8216;</li>
<li>DATA &#8216;GEOM FROM MY_LAYER USING SRID 82032&#8217;</li>
</ul>
<p>[...]</p>
<p>Où:</p>
<ul class="simple">
<li>GEOM est le nom de colonne géométrique</li>
<li>MY_LAYER le nom de la table</li>
<li>82032 est l&#8217;équivalent au code EPSG 31468 (système de projection de l&#8217;Allemagne)</li>
</ul>
</div>
<div class="section" id="testing-error-handling">
<h3>Tests et gestion dees erreurs<a class="headerlink" href="#testing-error-handling" title="Lien permanent vers ce titre">¶</a></h3>
<p>Donc, c&#8217;est bien maintenant. Charger le mapfile dans votre application et l&#8217;essayer. Si tout se passe bien, Super; sinon, un message d&#8217;erreur peut avoir lieu (celui-ci vient d&#8217;une requête GetMap interrogeant Mapserver via l&#8217;interface WMS):</p>
<div class="highlight-python"><pre>&lt;ServiceExceptionReport version="1.0.1"&gt;
    &lt;ServiceException&gt;
        msDrawMap(): Image handling error. Failed to draw layer named 'test1'.
        msOracleSpatialLayerOpen(): OracleSpatial error. Cannot create OCI Handlers.
        Connection failure. Check the connection string. Error: .
    &lt;/ServiceException&gt;
&lt;/ServiceExceptionReport&gt;</pre>
</div>
<p>Cela nous renvoie qu&#8217;il y a peut être un problème avec la connexion à la base de données. Avant tout, vérifions si le mapfile est bon. Poir cela, nous utilisons le programme utilitaire Mapserver <a class="reference internal" href="../utilities/shp2img.html#shp2img"><em>shp2img</em></a>.</p>
<p>Assumons que vous êtes dans le répertoire où vous avez compilé Mapserver et lancez shp2img :</p>
<div class="highlight-python"><pre>$ cd /var/src/mapserver_version/

$ shp2img -m /path/to/mapfile/mapfile.map -i png -o /path/to/output/output.png</pre>
</div>
<p>La sortie de la commande devrait ressembler à cela</p>
<div class="highlight-python"><pre>[Fri Feb  2 14:32:17 2007].522395 msDrawMap(): Layer 0 (test1), 0.074s
[Fri Feb  2 14:32:17 2007].522578 msDrawMap(): Drawing Label Cache, 0.000s
[Fri Feb  2 14:32:17 2007].522635 msDrawMap() total time: 0.075s</pre>
</div>
<p>Si ce n&#8217;est pas le cas, cela vous guidera vers n&#8217;importe quelle erreur de votre mapfile ou une manière d&#8217;accéder à la donnée directement. Dans ce cas, regardez <a class="reference internal" href="../input/vector/oracle.html#oci"><em>Oracle Spatial</em></a>. S&#8217;il y a un problème avec votre connexion à Oracle, le même message que ci-dessus (MsDrawMap() ...) devrait être renvoyé. Vérifiez la syntaxe de votre mapfile et/ou la configuration de l&#8217;environnement pour Oracle.</p>
<p>Pour Debian/Ubuntu, ça vaut aussi le coup de vérifier le fichier &#8220;/etc/environment&#8221; et de tester judicieusement l&#8217;ajout de variables système comparables à <a class="reference internal" href="#system-variables">System Variables</a></p>
<p>Si votre sortie est OK, vous devriez regarder aussi l&#8217;image générée (output.png). Ensuite, votre problème se réduit aux accès de apache au répertoire home de oracle. Vérifiez avec attention votre configuration apache. Merci de noter que le fichier de configuration de apache diffère selon les distributions linux. Pour ce document, nous parlons de Ubuntu, qui devrait être similaire à celui de Debian.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper"><h3>Navigation</h3>
<p>
<a href="../about.html" title="About">About</a><br>
<a href="../products.html" title="Products">Products</a><br>
<a href="../community/index.html" title="Community">Community</a><br>
<a href="../development/index.html" title="Development">Development</a><br>
<a href="../download.html" title="Downloads">Downloads</a><br>
<a href="../documentation.html" title="Documentation">Documentation</a><br>
<a href="../faq.html" title="FAQ">FAQ</a>
</p>
  <h3>Current Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Installation d&#8217;Oracle</a><ul>
<li><a class="reference internal" href="#preface">Préface</a></li>
<li><a class="reference internal" href="#system-assumptions">Suppositions système</a></li>
<li><a class="reference internal" href="#compile-mapserver">Compiler Mapserver</a></li>
<li><a class="reference internal" href="#set-environment-variables">Définir les variables d&#8217;environnement</a><ul>
<li><a class="reference internal" href="#system-variables">Variables système</a></li>
<li><a class="reference internal" href="#setting-the-apache-environment">Paraméter l&#8217;environnement Apache</a></li>
<li><a class="reference internal" href="#create-mapfile">Créer un mapfile</a></li>
<li><a class="reference internal" href="#testing-error-handling">Tests et gestion dees erreurs</a></li>
</ul>
</li>
</ul>
</li>
</ul>

<div id="searchbox" style="display: none">
  <h3>Recherche rapide</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Saisissez un mot clef ou un nom de module, classe ou fonction.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Index général"
             >index</a></li>
        <li class="right" >
          <a href="../mapfile/index.html" title="Mapfile"
             >suivant</a> |</li>
        <li class="right" >
          <a href="iis.html" title="Paramétrage de IIS pour MapServer"
             >précédent</a> |</li>
        <li><a href="../index.html">Home</a> &raquo;</li>
          <li><a href="../documentation.html" >Documentation de MapServer 6.4.1</a> &raquo;</li>
          <li><a href="index.html" >Installation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; <a href="../copyright.html">Copyright</a> 2014, Regents of the University of Minnesota.
      Créé avec <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>