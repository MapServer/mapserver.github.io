<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Run-time Substitution &#8212; MapServer 8.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx.css?v=6c7b17ac" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=dd298242" />
    <link rel="stylesheet" type="text/css" href="../_static/ribbon.css?v=ea091bf4" />
    
    <script src="../_static/documentation_options.js?v=521b6f53"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="icon" href="../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="next" title="A Simple CGI Wrapper Script" href="wrapper.html" />
    <link rel="prev" title="MapServer CGI Controls" href="controls.html" /> 
  </head><body>


<!-- for main branch only, do not backport this -->

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../index.html" title="Home"><img src="../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../index.html" title="Home">Home</a> |
      <a href="../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter" target="_blank">Twitter</a> |
      <a href="../download.html" title="Download Source or Binaries">Download </a> |
      <a class="badge" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=KRJ2X44N3HA6U&source=url" target="_blank">
        <img src="https://img.shields.io/badge/donate-%E2%9D%A4%C2%A0-ff69b4.svg?style=flat" alt="Donate to MapServer">
      </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../ar/cgi/runsub.html"><img src="../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../de/cgi/runsub.html"><img src="../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../el/cgi/runsub.html"><img src="../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../es/cgi/runsub.html"><img src="../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../fr/cgi/runsub.html"><img src="../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../id/cgi/runsub.html"><img src="../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../it/cgi/runsub.html"><img src="../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../ja/cgi/runsub.html"><img src="../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../nl_NL/cgi/runsub.html"><img src="../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../pl/cgi/runsub.html"><img src="../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../ru/cgi/runsub.html"><img src="../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../sq/cgi/runsub.html"><img src="../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../tr/cgi/runsub.html"><img src="../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="wrapper.html" title="A Simple CGI Wrapper Script"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="controls.html" title="MapServer CGI Controls"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../documentation.html" >MapServer 8.0.1 Documentation</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">CGI</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Run-time Substitution</a></li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="run-time-substitution">
<span id="runsub"></span><span id="index-0"></span><h1><a class="toc-backref" href="#table-of-contents" role="doc-backlink">Run-time Substitution</a><a class="headerlink" href="#run-time-substitution" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Author<span class="colon">:</span></dt>
<dd class="field-odd"><p>Steve Lime</p>
</dd>
<dt class="field-even">Contact<span class="colon">:</span></dt>
<dd class="field-even"><p>sdlime at gmail.com</p>
</dd>
<dt class="field-odd">Last Updated<span class="colon">:</span></dt>
<dd class="field-odd"><p>2023-04-19</p>
</dd>
</dl>
<nav class="contents" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#run-time-substitution" id="id1">Run-time Substitution</a></p>
<ul>
<li><p><a class="reference internal" href="#introduction" id="id2">Introduction</a></p></li>
<li><p><a class="reference internal" href="#basic-example" id="id3">Basic Example</a></p></li>
<li><p><a class="reference internal" href="#parameters-supported" id="id4">Parameters Supported</a></p></li>
<li><p><a class="reference internal" href="#default-values-if-not-provided-in-the-url" id="id5">Default values if not provided in the URL</a></p></li>
<li><p><a class="reference internal" href="#validation" id="id6">VALIDATION</a></p></li>
<li><p><a class="reference internal" href="#magic-values" id="id7">Magic values</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="introduction">
<h2><a class="toc-backref" href="#table-of-contents" role="doc-backlink">Introduction</a><a class="headerlink" href="#introduction" title="Link to this heading">¶</a></h2>
<p>Run-time substitution for the MapServer CGI has been around since version 4.0
and it’s use has continued to expand. In short, it allows you to alter portions
of a mapfile based on data passed via a CGI request.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This functionality is only available via the <a class="reference internal" href="mapserv.html#mapserv"><span class="std std-ref">mapserv</span></a> CGI application.
Within MapScript this is easy to do by yourself since the developer has
complete control over how input is handled.</p>
</div>
<section id="case-sensitivity">
<h3>Case sensitivity<a class="headerlink" href="#case-sensitivity" title="Link to this heading">¶</a></h3>
<p>Since version 6.4, CGI parameter names are not case sensitive.
CGI parameter values are case sensitive.</p>
</section>
</section>
<section id="basic-example">
<h2><a class="toc-backref" href="#table-of-contents" role="doc-backlink">Basic Example</a><a class="headerlink" href="#basic-example" title="Link to this heading">¶</a></h2>
<p>Let’s say you’d like the user to dynamically set a portion of an expression so
they could highlight a certain land cover class, and you have a form element
(called ctype) that allows them to choose between: forest, water, wetland and
developed.</p>
<p>A request should look like (assuming “marsh” is a valid land cover class):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>http://...mapserv?map=....&amp;ctype=marsh
</pre></div>
</div>
<p>You could then set up a layer like so:</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">LAYER</span>
    <span class="k">NAME</span> <span class="s">&#39;covertypes&#39;</span>
    <span class="p">...</span>
    <span class="k">VALIDATION</span>
        <span class="s">&quot;ctype&quot;</span> <span class="s">&quot;^[a-z]{5,10}$&quot;</span>
    <span class="k">END</span>
    <span class="k">CLASSITEM</span> <span class="s">&#39;type&#39;</span>
    <span class="k">CLASS</span> <span class="c"># highlighted presentation</span>
        <span class="k">EXPRESSION</span> <span class="s">&#39;</span><span class="si">%c</span><span class="s">type%&#39;</span>
        <span class="p">...</span>
    <span class="k">END</span>
    <span class="k">CLASS</span> <span class="c"># default presentation</span>
        <span class="p">...</span>
    <span class="k">END</span>
<span class="k">END</span>
</pre></div>
</div>
<p>Values for the ctype parameter are limited to lower-case characters a to z and
the value can be from 5 to 10 characters long. The regex start (^) and end ($)
anchors are important in limiting values - <strong>always use them</strong>.</p>
<p>When a request is processed, the value for ctype is substituted for the string
%ctype% and the mapfile is processed as normal. If no ctype is passed in, the
EXPRESSION will never be true so it doesn’t really hurt anything except for a
slight performance hit. Often you would set a default class to draw features
that don’t match, but that is not required.</p>
</section>
<section id="parameters-supported">
<span id="index-1"></span><h2><a class="toc-backref" href="#table-of-contents" role="doc-backlink">Parameters Supported</a><a class="headerlink" href="#parameters-supported" title="Link to this heading">¶</a></h2>
<p>Not every mapfile parameter supports run-time substitution and care has been
taken to try and support those that make the most sense.
All parameters <cite>must</cite> be validated.
Remember, you also can do run-time configuration using the
map_object_property type syntax detailed in
<a class="reference internal" href="controls.html#cgi-mapfile-change-parameters"><span class="std std-ref">Changing mapfile parameters via a form or a URL</span></a>.
Below is a list of properties that do allow run-time substitution:</p>
<ul class="simple">
<li><p>CLASS: EXPRESSION</p></li>
<li><p>CLASS: TEXT</p></li>
<li><p>CLASS: TITLE</p></li>
<li><p>LAYER: BINDVALS</p></li>
<li><p>LAYER: CONNECTION</p></li>
<li><p>LAYER: DATA</p></li>
<li><p>LAYER: FILTER</p></li>
<li><p>LAYER: MASK</p></li>
<li><p>LAYER: TILEINDEX</p></li>
</ul>
<div class="versionadded">
<p><span class="versionmodified added">New in version 7.0.</span></p>
</div>
<ul class="simple">
<li><p>LAYER: METADATA (values only, not keys)</p></li>
</ul>
<div class="versionadded">
<p><span class="versionmodified added">New in version 7.0.</span></p>
</div>
<ul class="simple">
<li><p>LAYER: PROCESSING</p></li>
</ul>
<div class="versionadded">
<p><span class="versionmodified added">New in version 6.2.</span></p>
</div>
<ul class="simple">
<li><p>OUTPUTFORMAT: all FORMATOPTIONs</p></li>
</ul>
<div class="versionadded">
<p><span class="versionmodified added">New in version 7.0.</span></p>
</div>
<ul class="simple">
<li><p>OUTPUTFORMAT: all FORMATOPTIONs</p></li>
</ul>
<div class="versionadded">
<p><span class="versionmodified added">New in version 7.0.</span></p>
</div>
<ul class="simple">
<li><p>MAP-&gt;WEB: METADATA (values only, not keys)</p></li>
</ul>
<div class="versionadded">
<p><span class="versionmodified added">New in version 8.0.1.</span></p>
</div>
<ul class="simple">
<li><p>MAP-&gt;WEB: TEMPLATE</p></li>
</ul>
<section id="filters">
<span id="index-2"></span><h3>FILTERs<a class="headerlink" href="#filters" title="Link to this heading">¶</a></h3>
<p>You can use runtime substitutions to change values within a FILTER as you go.
For example your FILTER could be written like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FILTER</span> <span class="p">(</span><span class="n">multimedia</span><span class="o">=</span><span class="s1">&#39;%multimedia%&#39;</span> <span class="ow">and</span> <span class="n">seats</span> <span class="o">&gt;=</span> <span class="s1">&#39;%nseats%&#39;</span> <span class="ow">and</span> <span class="n">Sound</span><span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">ound%&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Then (assuming you’re using the CGI interface) you could pass in variables
named multimedia, nseats and sound with values defined by the user in an HTML
form.</p>
<p>You should also define <a class="reference internal" href="../mapfile/validation.html#validation"><span class="std std-ref">VALIDATION</span></a> expressions on these variables to
guard against unintentional SQL being submitted to postgis (since
version 6.0, validation is mandatory).  Within the layer you’d do the
following:</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">VALIDATION</span>
    <span class="s">&#39;multimedia&#39;</span> <span class="s">&#39;^yes|no$&#39;</span>
    <span class="s">&#39;sound&#39;</span> <span class="s">&#39;^yes|no$&#39;</span>
    <span class="s">&#39;nseats&#39;</span> <span class="s">&#39;^[0-9]{1,2}$&#39;</span>
<span class="k">END</span>
</pre></div>
</div>
<p>The validation strings are regular expressions that are applied against the
appropriate variable value before being added to the FILTER. The first two
limit the value of multimedia and sound to yes or no. The third limits the
value for nseats to a 2 digit integer.</p>
</section>
</section>
<section id="default-values-if-not-provided-in-the-url">
<span id="index-3"></span><h2><a class="toc-backref" href="#table-of-contents" role="doc-backlink">Default values if not provided in the URL</a><a class="headerlink" href="#default-values-if-not-provided-in-the-url" title="Link to this heading">¶</a></h2>
<p>The runtime substitution mechanism will usually create syntactically incorrect,
and almost always semantically incorrect mapfiles if the substitution parameter
was not provided in the calling URL.</p>
<p>Since version 5.6, you can provide a default value for any substitution
parameter, that will be applied if the parameter was not found in the url. You
do this by providing special entries inside <a class="reference internal" href="../mapfile/class.html#class"><span class="std std-ref">CLASS</span></a>, <a class="reference internal" href="../mapfile/layer.html#layer"><span class="std std-ref">LAYER</span></a> or
<a class="reference internal" href="../mapfile/web.html#web"><span class="std std-ref">WEB</span></a> validation blocks:</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">VALIDATION</span>
    <span class="s">&#39;default_sound&#39;</span> <span class="s">&#39;yes&#39;</span>
    <span class="s">&#39;default_nseats&#39;</span> <span class="s">&#39;5&#39;</span>
    <span class="s">&#39;default_multimedia&#39;</span> <span class="s">&#39;yes&#39;</span>
<span class="k">END</span>
</pre></div>
</div>
<p>In this example, the mapfile will be created as if the url contained
“&amp;sound=yes&amp;nseats=5&amp;multimedia=yes”.</p>
<p>Providing a default value for a substitution parameter in the <cite>WEB</cite> section of the <cite>MAP</cite> wasn’t implemented until version 7.0.7.</p>
<p>If identical default keys appear in more than one validation block then keys in
more specialised blocks override those in more generalised blocks. i.e. <cite>CLASS</cite>
overrides <cite>LAYER</cite> which overrides <cite>WEB</cite>.
The same functionality is available using <cite>METADATA</cite> blocks instead of
<cite>VALIDATION</cite> but this is deprecated as of MapServer 5.4.0.
This behavior is also accessible in the map2img utility, allowing you to test
runtime substitution mapfiles without using a webserver.</p>
</section>
<section id="validation">
<span id="index-5"></span><span id="index-4"></span><h2><a class="toc-backref" href="#table-of-contents" role="doc-backlink">VALIDATION</a><a class="headerlink" href="#validation" title="Link to this heading">¶</a></h2>
<p>Because runtime substitution affects potentially sensitive areas of
your mapfile, such as database columns and filenames, it is
mandatory that you use pattern validation (since version 6.0)</p>
<p>Pattern validation uses regular expressions, which are strings that
describe how to compare strings to patterns. The exact functionality
of your systems’ regular expressions may vary, but you can find a lot
of general information by a Google search for “regular expression
tutorial”.</p>
<p>As of MapServer 5.4.0 the preferred mechanism is a <a class="reference internal" href="../mapfile/validation.html#validation"><span class="std std-ref">VALIDATION</span></a>
block in the <cite>LAYER</cite> definition. This is only slightly different from
the older <cite>METADATA</cite> mechanism.  <a class="reference internal" href="../mapfile/validation.html#validation"><span class="std std-ref">VALIDATION</span></a> blocks can be used
with <a class="reference internal" href="../mapfile/class.html#class"><span class="std std-ref">CLASS</span></a>, <a class="reference internal" href="../mapfile/layer.html#layer"><span class="std std-ref">LAYER</span></a> and <a class="reference internal" href="../mapfile/web.html#web"><span class="std std-ref">WEB</span></a>.</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">VALIDATION</span>
  <span class="c"># %firstname% substitutions can only have letters and hyphens</span>
  <span class="s">&#39;firstname&#39;</span>     <span class="s">&#39;^[a-zA-Z\-]+$&#39;</span>

  <span class="c"># %parcelid% must be numeric and between 5 and 8 characters</span>
  <span class="s">&#39;parcelid&#39;</span>      <span class="s">&#39;^[0-9]{5,8}$&#39;</span>

  <span class="c"># %taxid% must be two capital letters and six digits</span>
  <span class="s">&#39;taxid&#39;</span>         <span class="s">&#39;^[A-Z]{2}[0-9]{6}$&#39;</span>
<span class="k">END</span>
</pre></div>
</div>
<p>If identical keys appear in more than one validation block then keys in more
specialised blocks override those in more generalised blocks. i.e. <cite>CLASS</cite>
overrides <cite>LAYER</cite> which overrides <cite>WEB</cite>.</p>
</section>
<section id="magic-values">
<h2><a class="toc-backref" href="#table-of-contents" role="doc-backlink">Magic values</a><a class="headerlink" href="#magic-values" title="Link to this heading">¶</a></h2>
<p>Some runtime substitutions have special caveats.</p>
<dl class="simple">
<dt>ID</dt><dd><p>In addition to any defined <cite>METADATA</cite> or <cite>VALIDATION</cite>, the ‘id’
parameter will be subjected to a special check. It must be
alphanumeric and cannot be longer than 63 characters.</p>
</dd>
</dl>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p>
<a href="../about.html" title="About">About</a><br>
<a href="../products.html" title="Products">Products</a><br>
<a href="../community/index.html" title="Community">Community</a><br>
<a href="../development/index.html" title="Development">Development</a><br>
<a href="../download.html" title="Downloads">Downloads</a><br>
<a href="../documentation.html" title="Documentation">Documentation</a><br>
<a href="../faq.html" title="FAQ">FAQ</a><br>
<a href="../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</h3>
  <ul>
<li><a class="reference internal" href="#">Run-time Substitution</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a><ul>
<li><a class="reference internal" href="#case-sensitivity">Case sensitivity</a></li>
</ul>
</li>
<li><a class="reference internal" href="#basic-example">Basic Example</a></li>
<li><a class="reference internal" href="#parameters-supported">Parameters Supported</a><ul>
<li><a class="reference internal" href="#filters">FILTERs</a></li>
</ul>
</li>
<li><a class="reference internal" href="#default-values-if-not-provided-in-the-url">Default values if not provided in the URL</a></li>
<li><a class="reference internal" href="#validation">VALIDATION</a></li>
<li><a class="reference internal" href="#magic-values">Magic values</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="wrapper.html" title="A Simple CGI Wrapper Script"
             >next</a> |</li>
        <li class="right" >
          <a href="controls.html" title="MapServer CGI Controls"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../documentation.html" >MapServer 8.0.1 Documentation</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >CGI</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Run-time Substitution</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; <a href="../copyright.html">Copyright</a> 2023, Open Source Geospatial Foundation.
      Last updated on 2023-12-22.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.5.
    </div>
  </body>
</html>