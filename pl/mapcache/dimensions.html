
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="pl">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Tileset Dimensions &#8212; MapServer 7.2.2 documentation</title>
    <link rel="stylesheet" href="../_static/sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <link rel="shortcut icon" href="../_static/mapserver.ico"/>
    <link rel="author" title="O tych dokumentach" href="../about.html" />
    <link rel="index" title="Indeks" href="../genindex.html" />
    <link rel="search" title="Szukaj" href="../search.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="next" title="HTTP Requests" href="http.html" />
    <link rel="prev" title="Image Formats" href="formats.html" /> 
  </head><body>

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../index.html" title="Home"><img src="../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../index.html" title="Home">Home</a> |
      <a href="../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a> |
      <a href="../download.html" title="Download Source or Binaries">Download </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        
          
            <a href="../../mapcache/dimensions.html"><img src="../_static/flagicons/en.png" alt="en" title="en" border="0" /></a>
          
        
        
          
            <a href="../../ar/mapcache/dimensions.html"><img src="../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
          
        
        
          
            <a href="../../de/mapcache/dimensions.html"><img src="../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
          
        
        
          
            <a href="../../el/mapcache/dimensions.html"><img src="../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
          
        
        
          
            <a href="../../es/mapcache/dimensions.html"><img src="../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
          
        
        
          
            <a href="../../fr/mapcache/dimensions.html"><img src="../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
          
        
        
          
            <a href="../../id/mapcache/dimensions.html"><img src="../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
          
        
        
          
            <a href="../../it/mapcache/dimensions.html"><img src="../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
          
        
        
          
            <a href="../../ja/mapcache/dimensions.html"><img src="../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
          
        
        
          
            <a href="../../nl_NL/mapcache/dimensions.html"><img src="../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
          
        
        <img src="../_static/flagicons/pl.png" alt="pl" title="pl" border="0" width="18px" height="13px"/>
        
          
            <a href="../../ru/mapcache/dimensions.html"><img src="../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
          
        
        
          
            <a href="../../sq/mapcache/dimensions.html"><img src="../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
          
        
        
          
            <a href="../../tr/mapcache/dimensions.html"><img src="../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
          
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Nawigacja</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Indeks ogólny"
             accesskey="I">indeks</a></li>
        <li class="right" >
          <a href="http.html" title="HTTP Requests"
             accesskey="N">dalej</a> |</li>
        <li class="right" >
          <a href="formats.html" title="Image Formats"
             accesskey="P">wstecz</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../documentation.html" >MapServer 7.2.2 Documentation</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">MapCache 1.6.1</a> &#187;</li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="tileset-dimensions">
<span id="mapcache-dimensions"></span><h1>Tileset Dimensions<a class="headerlink" href="#tileset-dimensions" title="Stały odnośnik do tego nagłówka">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Author:</th><td class="field-body">Thomas Bonfort</td>
</tr>
<tr class="field-even field"><th class="field-name">Contact:</th><td class="field-body">tbonfort at terriscope.fr</td>
</tr>
<tr class="field-odd field"><th class="field-name">Author:</th><td class="field-body">Seth Girvin</td>
</tr>
<tr class="field-even field"><th class="field-name">Contact:</th><td class="field-body">sgirvin at compass.ie</td>
</tr>
<tr class="field-odd field"><th class="field-name">Author:</th><td class="field-body">Jerome Boue</td>
</tr>
<tr class="field-even field"><th class="field-name">Last Updated:</th><td class="field-body">2018/06/29</td>
</tr>
<tr class="field-odd field"><th class="field-name">Version:</th><td class="field-body">1.8</td>
</tr>
</tbody>
</table>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Stały odnośnik do tego nagłówka">¶</a></h2>
<p>WMS layers in MapServer can support dimensions, see <a class="reference internal" href="../ogc/wms_dimension.html#wms-dimension"><span class="std std-ref">WMS Dimension</span></a> for details.
MapCache also supports dimensions for tilesets.</p>
<p>Storing separate tile caches for different dimensions has several practical use cases such as creating caches for different
spatial boundaries, elevations, or time periods. It also provides a mechanism for dynamically switching Mapfiles based on a dimension value.</p>
<p>MapCache uses Dimensions to:</p>
<blockquote>
<div><ul class="simple">
<li>create the directory structure of disk and SQLite caches, using the
template structure with <code class="docutils literal notranslate"><span class="pre">{dim}</span></code> replacement entry, see
<em>Template Structure</em> in <a class="reference internal" href="caches.html#mapcache-cache-disk"><span class="std std-ref">Disk Caches</span></a> and
<em>Using Multiple SQLite Database Files</em> in <a class="reference internal" href="caches.html#mapcache-cache-sqlite"><span class="std std-ref">SQLite Caches</span></a>.</li>
<li>create the database structure of SQLite caches, using custom schema with
<code class="docutils literal notranslate"><span class="pre">:dim</span></code> replacement entry, see <em>Custom Schema</em> in
<a class="reference internal" href="caches.html#mapcache-cache-sqlite"><span class="std std-ref">SQLite Caches</span></a>.</li>
<li>build requests to WMS sources: any dimensions specified for a tileset will
be forwarded on to their WMS source whenever a cache miss occurs.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="enabling-dimension-support-in-mapcache">
<h2>Enabling Dimension Support in MapCache<a class="headerlink" href="#enabling-dimension-support-in-mapcache" title="Stały odnośnik do tego nagłówka">¶</a></h2>
<p>Dimensions are enabled in the configuration file at the
<a class="reference internal" href="config.html#mapcache-config-tileset"><span class="std std-ref">Tileset</span></a> level. Each tileset may define its own
dimensions with a <code class="docutils literal notranslate"><span class="pre">&lt;dimensions&gt;</span></code> section which includes one or several
<code class="docutils literal notranslate"><span class="pre">&lt;dimension&gt;</span></code> elements.</p>
<div class="section" id="dimension-attributes">
<h3>Dimension Attributes<a class="headerlink" href="#dimension-attributes" title="Stały odnośnik do tego nagłówka">¶</a></h3>
<p>Several attributes are defined for the <code class="docutils literal notranslate"><span class="pre">&lt;dimension&gt;</span></code> element.</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">name</span></code> (required): The name by which the dimension is refered to in a WMS
request (minus the <code class="docutils literal notranslate"><span class="pre">dim_</span></code> prefix as specified in
<a class="reference external" href="http://portal.opengeospatial.org/files/?artifact_id=1081&amp;version=1&amp;format=pdf">WMS 1.1.1 Specification</a>).</li>
<li><code class="docutils literal notranslate"><span class="pre">default</span></code> (required): The default value for the dimension if none is
explicitly provided in the WMS request.</li>
<li><code class="docutils literal notranslate"><span class="pre">type</span></code> (required): MapCache defines several ways for specifying a
dimension: <code class="docutils literal notranslate"><span class="pre">values</span></code>, <code class="docutils literal notranslate"><span class="pre">regex</span></code>, <code class="docutils literal notranslate"><span class="pre">sqlite</span></code>, <code class="docutils literal notranslate"><span class="pre">postgresql</span></code>,
<code class="docutils literal notranslate"><span class="pre">elasticsearch</span></code> and <code class="docutils literal notranslate"><span class="pre">time</span></code>. They are described in the following
sections.</li>
<li><code class="docutils literal notranslate"><span class="pre">unit</span></code> (optional): dimension unit. This information is used only in the
GetCapabilities response.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="dimension-types">
<h3>Dimension Types<a class="headerlink" href="#dimension-types" title="Stały odnośnik do tego nagłówka">¶</a></h3>
<p>Several types of dimensions are supported by MapCache: Values, Regex, SQLite,
PostgreSQL, ElasticSearch and Time. They can be classified into two groups
depending on how dimension values are defined:</p>
<blockquote>
<div><ul class="simple">
<li>First level dimension types: Values and Regex. Dimensions values are
statically specified in the configuration file.</li>
<li>Second level dimensions types: SQLite, PostgreSQL, ElasticSearch and Time.
Dimensions values are stored in a dynamic backend (SQLite file, PostgreSQL
database or ElasticSearch index) so that an update in the dimension values
does not involve a server restart.</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="first-level-dimensions">
<h2>First Level Dimensions<a class="headerlink" href="#first-level-dimensions" title="Stały odnośnik do tego nagłówka">¶</a></h2>
<p>First level dimensions define values in the configuration file.</p>
<div class="section" id="values-dimensions">
<h3>Values Dimensions<a class="headerlink" href="#values-dimensions" title="Stały odnośnik do tego nagłówka">¶</a></h3>
<p>A Values type dimension lists all possible dimension values. The name of the dimension is used as the key in a query string when accessing
through a WMS or WMTS service, for example <code class="docutils literal notranslate"><span class="pre">&amp;DIM1=foobarbaz</span></code>.</p>
<p>If a client does not provide the dimension as a key value pair the default will be used (in this example <code class="docutils literal notranslate"><span class="pre">foobar</span></code>).</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;tileset</span> <span class="na">name=</span><span class="s">&quot;LayerName&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;source&gt;</span>LayerSource<span class="nt">&lt;/source&gt;</span>
    <span class="nt">&lt;cache&gt;</span>sqlite<span class="nt">&lt;/cache&gt;</span>
    <span class="nt">&lt;grid&gt;</span>GoogleMapsCompatible<span class="nt">&lt;/grid&gt;</span>
    <span class="nt">&lt;format&gt;</span>PNG<span class="nt">&lt;/format&gt;</span>
    <span class="nt">&lt;metatile&gt;</span>5 5<span class="nt">&lt;/metatile&gt;</span>
    <span class="nt">&lt;metabuffer&gt;</span>10<span class="nt">&lt;/metabuffer&gt;</span>
    <span class="nt">&lt;dimensions&gt;</span>
        <span class="nt">&lt;dimension</span> <span class="na">type=</span><span class="s">&quot;values&quot;</span> <span class="na">name=</span><span class="s">&quot;DIM1&quot;</span> <span class="na">default=</span><span class="s">&quot;foobar&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;value&gt;</span>foobar<span class="nt">&lt;/value&gt;</span>
            <span class="nt">&lt;value&gt;</span>foobarbaz<span class="nt">&lt;/value&gt;</span>
            <span class="nt">&lt;value&gt;</span>foo<span class="nt">&lt;/value&gt;</span>
            <span class="nt">&lt;value&gt;</span>bar<span class="nt">&lt;/value&gt;</span>
        <span class="nt">&lt;/dimension&gt;</span>
    <span class="nt">&lt;/dimensions&gt;</span>
<span class="nt">&lt;/tileset&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="regex-dimensions">
<h3>Regex Dimensions<a class="headerlink" href="#regex-dimensions" title="Stały odnośnik do tego nagłówka">¶</a></h3>
<p>An alternative to the hard-coded list of values is to use regular expressions.</p>
<p>The following example creates a MAPFILE dimension, for using the same MapCache tileset with different MapServer
Mapfiles. The name of the Mapfiles need not be known to MapCache, and can therefore be created even after MapCache has been started.</p>
<p>When a user passes a <code class="docutils literal notranslate"><span class="pre">MAPFILE=/path/to/mapfile</span></code>, the string <code class="docutils literal notranslate"><span class="pre">/path/to/mapfile</span></code> is validated against
the supplied (PCRE) regular expression. The one in this example allows a name composed of alphanumeric characters
separated by slashes (/) and finishing with „.map” ( [a-zA-Z0-9./]*.map$ ) , but will fail if there
are two consecutive dots (..) in the path, to prevent file-system traversal.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;dimension</span> <span class="na">type=</span><span class="s">&quot;regex&quot;</span> <span class="na">name=</span><span class="s">&quot;MAPFILE&quot;</span> <span class="na">default=</span><span class="s">&quot;/path/to/mapfile.map&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;regex&gt;</span>^(?!.*\.\.)[a-zA-Z0-9\./]*\.map$<span class="nt">&lt;/regex&gt;</span>
<span class="nt">&lt;/dimension&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="second-level-dimensions">
<h2>Second Level Dimensions<a class="headerlink" href="#second-level-dimensions" title="Stały odnośnik do tego nagłówka">¶</a></h2>
<p>Second level dimensions store values in a dynamic back-end, a SQLite file, a
PostgreSQL database or an ElasticSearch index. This allows for adding new
dimension values without modifying MapCache configuration file, which otherwise
would need to restart the server.</p>
<div class="section" id="sqlite-dimensions">
<h3>SQLite Dimensions<a class="headerlink" href="#sqlite-dimensions" title="Stały odnośnik do tego nagłówka">¶</a></h3>
<p>In a SQLite dimension, dimension values are stored in a SQLite file. Moreover,
each value references a list of internal, or sub-dimension values which are
used to query cache.</p>
<p>For example, let’s define a „sensor” dimension whose allowed values represent
various Earth observation spacecrafts. A WMS request with that dimension may
contain, e.g.: <code class="docutils literal notranslate"><span class="pre">...&amp;dim_sensor=spot&amp;...</span></code> In this example, each sensor
references several data along an internal „product” sub-dimension. An example
of the „sensor” dimension back-end contents is represented in the following
table:</p>
<table border="1" class="docutils">
<colgroup>
<col width="43%" />
<col width="57%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Sensor dimension</th>
<th class="head">Product sub-dimension</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>spot</td>
<td>spot-img1</td>
</tr>
<tr class="row-odd"><td>spot</td>
<td>spot-img2</td>
</tr>
<tr class="row-even"><td>phr</td>
<td>phr-img1</td>
</tr>
<tr class="row-odd"><td>phr</td>
<td>phr-img2</td>
</tr>
<tr class="row-even"><td>phr</td>
<td>phr-img3</td>
</tr>
</tbody>
</table>
<p>The WMS request occurs at the „sensor” dimension level. The cache query is
performed at the „product” sub-dimension level. In case of a cache miss, the
„product” sub-dimension values are used to query the data source.</p>
<p>Querying the back-end may then result in returning multiple sub-dimension
values, each of which referencing distinct tiles. Assembling these tiles is
described in <a class="reference internal" href="#tile-assembly-policies">Tile Assembly Policies</a> section below.</p>
<p>A SQLite dimension is configured by specifying three elements:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">&lt;dbfile&gt;</span></code>: Location of the SQLite file implementing the dimension</li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;list_query&gt;</span></code>: SQL query returning all sub-dimension values for the
dimension, e.g. <strong>spot-img1</strong>, <strong>spot-img2</strong>, <strong>phr-img1</strong>, <strong>phr-img2</strong>
and  <strong>phr-img3</strong> in the „sensor” dimension example.</li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;validate_query&gt;</span></code>: SQL query returning the list of sub-dimension values
for a given dimension value, e.g. <strong>spot-img1</strong> and <strong>spot-img2</strong> for the
<strong>spot</strong> dimension value in the „sensor” dimension example.</li>
</ul>
</div></blockquote>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="c">&lt;!-- &quot;sqlite&quot; dimension</span>

<span class="c">     This example defines a &quot;sensor&quot; dimension whose possible values are</span>
<span class="c">     stored in the /data/sensor.sqlite SQLite file. The default value is</span>
<span class="c">     &quot;phr&quot;.</span>

<span class="c">     A WMS request with that dimension may contain, e.g.</span>
<span class="c">     &quot;... &amp;dim_sensor=spot&amp; ...&quot;</span>
<span class="c">--&gt;</span>
<span class="nt">&lt;dimension</span> <span class="na">type=</span><span class="s">&quot;sqlite&quot;</span> <span class="na">name=</span><span class="s">&quot;sensor&quot;</span> <span class="na">default=</span><span class="s">&quot;phr&quot;</span><span class="nt">&gt;</span>

   <span class="c">&lt;!-- Access Point --&gt;</span>
   <span class="nt">&lt;dbfile&gt;</span>/data/sensor.sqlite<span class="nt">&lt;/dbfile&gt;</span>

   <span class="c">&lt;!-- All-values Query --&gt;</span>
   <span class="nt">&lt;list_query&gt;</span>
      SELECT distinct(product) FROM dim
   <span class="nt">&lt;/list_query&gt;</span>

   <span class="c">&lt;!-- Selected-values Query --&gt;</span>
   <span class="nt">&lt;validate_query&gt;</span>
      SELECT product FROM dim
       WHERE sensor=:dim
   <span class="nt">&lt;/validate_query&gt;</span>

<span class="nt">&lt;/dimension&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="postgresql-dimensions">
<h3>PostgreSQL Dimensions<a class="headerlink" href="#postgresql-dimensions" title="Stały odnośnik do tego nagłówka">¶</a></h3>
<p>PostgreSQL dimensions are very similar to SQLite dimensions. In particular, the
sub-dimension feature described in the section above is also available with
PostgreSQL dimensions. They differ only in the back-end implementation which is
a PostgreSQL database, and in the way they are configured. A PostgreSQL
dimension is configured by specifying three elements:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">&lt;connection&gt;</span></code>: Connection information of the PostgreSQL database
implementing the dimension, as expected by the <a class="reference external" href="https://www.postgresql.org/docs/current/static/libpq-connect.html#id-1.7.3.8.2.12.2.1.2">PQconnectdb()</a>
function of the libpq - C library.</li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;list_query&gt;</span></code>: SQL query returning all sub-dimension values for the
dimension, e.g. <strong>spot-img1</strong>, <strong>spot-img2</strong>, <strong>phr-img1</strong>, <strong>phr-img2</strong>
and  <strong>phr-img3</strong> in the „sensor” dimension example.</li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;validate_query&gt;</span></code>: SQL query returning the list of sub-dimension values
for a given dimension value, e.g. <strong>spot-img1</strong> and <strong>spot-img2</strong> for the
<strong>spot</strong> dimension value in the „sensor” dimension example.</li>
</ul>
</div></blockquote>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="c">&lt;!-- &quot;postgresql&quot; dimension</span>

<span class="c">     This example defines a &quot;sensor&quot; dimension whose possible values are</span>
<span class="c">     stored in the postgresql://mapcache:mapcache@localhost:5433/mapcache</span>
<span class="c">     PostgreSQL database. The default value is &quot;phr&quot;.</span>

<span class="c">     A WMS request with that dimension may contain, e.g.</span>
<span class="c">     &quot;... &amp;dim_sensor=spot&amp; ...&quot;</span>
<span class="c">--&gt;</span>
<span class="nt">&lt;dimension</span> <span class="na">type=</span><span class="s">&quot;postgresql&quot;</span> <span class="na">name=</span><span class="s">&quot;sensor&quot;</span> <span class="na">default=</span><span class="s">&quot;phr&quot;</span><span class="nt">&gt;</span>

   <span class="c">&lt;!-- Access Point --&gt;</span>
  <span class="nt">&lt;connection&gt;</span>
    host=localhost user=mapcache password=mapcache dbname=mapcache port=5433
  <span class="nt">&lt;/connection&gt;</span>

   <span class="c">&lt;!-- All-values Query --&gt;</span>
  <span class="nt">&lt;list_query&gt;</span>SELECT distinct(product) FROM dim<span class="nt">&lt;/list_query&gt;</span>

   <span class="c">&lt;!-- Selected-values Query --&gt;</span>
  <span class="nt">&lt;validate_query&gt;</span>SELECT product FROM dim WHERE sensor=:dim<span class="nt">&lt;/validate_query&gt;</span>

<span class="nt">&lt;/dimension&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="elasticsearch-dimensions">
<h3>ElasticSearch Dimensions<a class="headerlink" href="#elasticsearch-dimensions" title="Stały odnośnik do tego nagłówka">¶</a></h3>
<p>ElasticSearch dimensions are similar to SQLite or PostgreSQL dimensions. In
particular, the sub-dimension feature described in the section above is also
available with ElasticSearch dimensions. ElasticSearch main difference with
SQLite and PostgreSQL is its query language, Query-DSL, based on JSON instead
of SQL. Therefore, <code class="docutils literal notranslate"><span class="pre">&lt;list_query&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;validate_query&gt;</span></code> elements shall
contain queries expressed in that language. Inserting JSON data in XML
configuration may need to encapsulate it in a <code class="docutils literal notranslate"><span class="pre">&lt;![CDATA[</span> <span class="pre">...</span> <span class="pre">]]&gt;</span></code> element.</p>
<p>In addition, the complex structure of ElasticSearch responses, also expressed
in JSON, raises the need for extraction instructions to get sub-dimension
values from query responses.</p>
<p>For example, let’s assume that this ElasticSearch query:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>   <span class="nt">&quot;size&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nt">&quot;aggs&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="nt">&quot;distinct_product&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="nt">&quot;terms&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="nt">&quot;field&quot;</span><span class="p">:</span> <span class="s2">&quot;product/keyword&quot;</span> <span class="p">}</span> <span class="p">}</span> <span class="p">},</span>
    <span class="nt">&quot;query&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="nt">&quot;term&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="nt">&quot;sensor&quot;</span><span class="p">:</span> <span class="s2">&quot;phr&quot;</span> <span class="p">}</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>returns this response:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>   <span class="nt">&quot;took&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nt">&quot;timed_out&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nt">&quot;_shards&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="nt">&quot;total&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="nt">&quot;successful&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="nt">&quot;skipped&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nt">&quot;failed&quot;</span><span class="p">:</span> <span class="mi">0</span> <span class="p">},</span>
    <span class="nt">&quot;hits&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="nt">&quot;total&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="nt">&quot;max_score&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nt">&quot;hits&quot;</span><span class="p">:</span> <span class="p">[]</span> <span class="p">},</span>
    <span class="nt">&quot;aggregations&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;distinct_product&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;doc_count_error_upper_bound&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="nt">&quot;sum_other_doc_count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="nt">&quot;buckets&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span> <span class="nt">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;phr_img1&quot;</span><span class="p">,</span> <span class="nt">&quot;doc_count&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="p">},</span>
                <span class="p">{</span> <span class="nt">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;phr_img2&quot;</span><span class="p">,</span> <span class="nt">&quot;doc_count&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="p">},</span>
                <span class="p">{</span> <span class="nt">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;phr_img3&quot;</span><span class="p">,</span> <span class="nt">&quot;doc_count&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The expected sub-dimension values are then:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">[</span> <span class="s2">&quot;phr_img1&quot;</span><span class="p">,</span> <span class="s2">&quot;phr_img2&quot;</span><span class="p">,</span> <span class="s2">&quot;phr_img3&quot;</span> <span class="p">]</span>
</pre></div>
</div>
<p>This list is obtained by extracting the <code class="docutils literal notranslate"><span class="pre">aggregations</span></code> item from the outer
dictionary, then <code class="docutils literal notranslate"><span class="pre">distinct_product</span></code> , then <code class="docutils literal notranslate"><span class="pre">buckets</span></code>. Finally the <code class="docutils literal notranslate"><span class="pre">key</span></code>
item is to be extracted from each dictionary of the <code class="docutils literal notranslate"><span class="pre">bucket</span></code> list. The
extraction instructions take the form of a path-like list of keywords to be
used to extract sub-dimension values from JSON response provided by
ElasticSearch:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">[</span> <span class="s2">&quot;aggregations&quot;</span><span class="p">,</span> <span class="s2">&quot;distinct_product&quot;</span><span class="p">,</span> <span class="s2">&quot;buckets&quot;</span><span class="p">,</span> <span class="s2">&quot;key&quot;</span> <span class="p">]</span>
</pre></div>
</div>
<p>This is specified in the MapCache configuration file by way of new XML
elements, namely  <code class="docutils literal notranslate"><span class="pre">&lt;list_response&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;validate_response&gt;</span></code>, containing
extraction instructions respectively for <code class="docutils literal notranslate"><span class="pre">&lt;list_query&gt;</span></code> and
<code class="docutils literal notranslate"><span class="pre">&lt;validate_query&gt;</span></code> queries.</p>
<p>An ElasticSearch dimensions is defined by specifying five elements:</p>
<blockquote>
<div><ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">&lt;http&gt;</span></code>: Connection information of the ElasticSearch index implementing
the dimension. This element contains two sub-elements:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">&lt;url&gt;</span></code>: Search URL of the ElasticSearch index</li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;headers&gt;</span></code>: HTTP headers needed to access the ElasticSearch index.
It must contain the tag:
<code class="docutils literal notranslate"><span class="pre">&lt;Content-Type&gt;application/json&lt;/Content-Type&gt;</span></code>.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">&lt;list_query&gt;</span></code>: <a class="reference external" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl.html">Query DSL</a> query for getting all sub-dimension values
for the dimension. This query is expressed in JSON format and may need to
be escaped in a <code class="docutils literal notranslate"><span class="pre">&lt;![CDATA[</span> <span class="pre">...</span> <span class="pre">]]&gt;</span></code> tag.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">&lt;validate_query&gt;</span></code>: <a class="reference external" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl.html">Query DSL</a> query for getting the list of
sub-dimension values for a given dimension value. This query is expressed
in JSON format and may need to be escaped in a <code class="docutils literal notranslate"><span class="pre">&lt;![CDATA[</span> <span class="pre">...</span> <span class="pre">]]&gt;</span></code> tag.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">&lt;list_response&gt;</span></code>: List of successive keywords needed to extract actual
sub-dimension values from the raw ElasticSearch response to the
<code class="docutils literal notranslate"><span class="pre">&lt;list_query&gt;</span></code> query.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">&lt;validate_response&gt;</span></code>: List of successive keywords needed to extract
actual sub-dimension values from the raw ElasticSearch response to the
<code class="docutils literal notranslate"><span class="pre">&lt;validate_query&gt;</span></code> query.</p>
</li>
</ul>
</div></blockquote>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="c">&lt;!-- &quot;elasticsearch&quot; dimension</span>

<span class="c">     This example defines a &quot;sensor&quot; dimension whose possible values are</span>
<span class="c">     stored in the http://localhost:9200/sensor ElasticSearch index. The</span>
<span class="c">     default value is &quot;phr&quot;.</span>

<span class="c">     A WMS request with that dimension may contain, e.g.</span>
<span class="c">     &quot;... &amp;dim_sensor=spot&amp; ...&quot;</span>
<span class="c">--&gt;</span>
<span class="nt">&lt;dimension</span> <span class="na">type=</span><span class="s">&quot;elasticsearch&quot;</span> <span class="na">name=</span><span class="s">&quot;sensor&quot;</span> <span class="na">default=</span><span class="s">&quot;phr&quot;</span><span class="nt">&gt;</span>

  <span class="c">&lt;!-- Access Point --&gt;</span>
  <span class="nt">&lt;http&gt;</span>
    <span class="nt">&lt;url&gt;</span>http://localhost:9200/sensor/_search<span class="nt">&lt;/url&gt;</span>
    <span class="nt">&lt;headers&gt;</span>
      <span class="nt">&lt;Content-Type&gt;</span>application/json<span class="nt">&lt;/Content-Type&gt;</span>
    <span class="nt">&lt;/headers&gt;</span>
  <span class="nt">&lt;/http&gt;</span>

  <span class="c">&lt;!-- Selected-values Query --&gt;</span>
  <span class="nt">&lt;validate_query&gt;</span><span class="cp">&lt;![CDATA[</span>
<span class="cp">    { &quot;size&quot;: 0,</span>
<span class="cp">      &quot;aggs&quot;: {</span>
<span class="cp">        &quot;products&quot;: { &quot;terms&quot;: { &quot;field&quot;: &quot;product.keyword&quot; } }</span>
<span class="cp">      },</span>
<span class="cp">      &quot;query&quot;: { &quot;term&quot;: { &quot;sensor&quot;: &quot;:dim&quot; } }</span>
<span class="cp">    }</span>
<span class="cp">  ]]&gt;</span><span class="nt">&lt;/validate_query&gt;</span>

  <span class="c">&lt;!-- Selected-values Response Extration Instructions --&gt;</span>
  <span class="nt">&lt;validate_response&gt;</span><span class="cp">&lt;![CDATA[</span>
<span class="cp">    [ &quot;aggregations&quot;, &quot;products&quot;, &quot;buckets&quot;, &quot;key&quot; ]</span>
<span class="cp">  ]]&gt;</span><span class="nt">&lt;/validate_response&gt;</span>

  <span class="c">&lt;!-- All-values Query --&gt;</span>
  <span class="nt">&lt;list_query&gt;</span><span class="cp">&lt;![CDATA[</span>
<span class="cp">    { &quot;size&quot;: 0,</span>
<span class="cp">      &quot;aggs&quot;: {</span>
<span class="cp">        &quot;products&quot;: { &quot;terms&quot;: { &quot;field&quot;: &quot;product.keyword&quot; } }</span>
<span class="cp">      }</span>
<span class="cp">    }</span>
<span class="cp">  ]]&gt;</span><span class="nt">&lt;/list_query&gt;</span>

  <span class="c">&lt;!-- All-values Response Extration Instructions --&gt;</span>
  <span class="nt">&lt;list_response&gt;</span><span class="cp">&lt;![CDATA[</span>
<span class="cp">    [ &quot;aggregations&quot;, &quot;products&quot;, &quot;buckets&quot;, &quot;key&quot; ]</span>
<span class="cp">  ]]&gt;</span><span class="nt">&lt;/list_response&gt;</span>
<span class="nt">&lt;/dimension&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="time-dimensions">
<h3>Time Dimensions<a class="headerlink" href="#time-dimensions" title="Stały odnośnik do tego nagłówka">¶</a></h3>
<p>MapCache supports WMTS and WMS requests that include a TIME parameter, for both
timestamps and time intervals.  See <a class="reference internal" href="../development/rfc/ms-rfc-96.html#rfc96"><span class="std std-ref">MS RFC 96: Time Dimension Support in
MapCache Tilesets</span></a> initial proposal for further details.</p>
<p>Up to Mapcache 1.6.1, defining a Time dimension involves a SQLite back-end. Two
elements must be provided:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">&lt;dbfile&gt;</span></code>: Location of the SQLite file implementing the time dimension</li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;query&gt;</span></code>: SQL query returning the list of available timestamp values
within a given time interval. In that query, start time and end time are
represented by the respective placeholders <code class="docutils literal notranslate"><span class="pre">:start_timestamp</span></code> and
<code class="docutils literal notranslate"><span class="pre">:end_time_stamp</span></code>. Returned values shall be in <code class="docutils literal notranslate"><span class="pre">yyyy-mm-ddThh:mm:ssZ</span></code>
time format, as specified in <a class="reference external" href="https://tools.ietf.org/html/rfc3339">RFC 3339</a>, but restricted to UTC.</li>
</ul>
</div></blockquote>
<p>From MapCache 1.8 on, dynamic back-ends for Time dimensions can be PostgreSQL
databases or ElasticSearch indices in addition to SQLite files. Configuring a
Time dimension with a specific back-end is made by setting a <code class="docutils literal notranslate"><span class="pre">time=&quot;true&quot;</span></code>
attribute within a SQLite, PostgreSQL or ElasticSearch dimension configuration.</p>
<p>Still, MapCache keeps an (almost) backward compatible configuration of Time
dimension with an implicit SQLite back-end. Example in the following section
highlights differences.</p>
<p>Time values in the dynamic back-end are expressed in Unix time, i.e. the number
of seconds that have elapsed since January 1, 1970 (midnight UTC).</p>
<p>Querying the back-end with an interval may result in returning multiple
timestamp values, each of which referencing distinct tiles. Assembling these
tiles is described in <a class="reference internal" href="#tile-assembly-policies">Tile Assembly Policies</a> section below.</p>
<div class="section" id="configuring-a-time-dimension-using-a-default-sqlite-back-end">
<h4>Configuring a Time Dimension using a default SQLite back-end<a class="headerlink" href="#configuring-a-time-dimension-using-a-default-sqlite-back-end" title="Stały odnośnik do tego nagłówka">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><div class="first last highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="c">&lt;!-- &quot;time&quot; dimension</span>

<span class="c">     This example defines a &quot;time&quot; dimension whose possible values</span>
<span class="c">     are stored in the /path/to/mapcache-time.sqlite SQLite file. The</span>
<span class="c">     default value is &quot;2010&quot;.</span>

<span class="c">     A WMS request with that dimension may contain, e.g.  &quot;...</span>
<span class="c">     &amp;time=1999-08-11T11:03:07Z/2001-09-21T08:17:56Z&amp; ...&quot;</span>
<span class="c">--&gt;</span>
<span class="nt">&lt;dimension</span> <span class="na">type=</span><span class="s">&quot;time&quot;</span> <span class="na">name=</span><span class="s">&quot;time&quot;</span> <span class="na">default=</span><span class="s">&quot;2010&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;dbfile&gt;</span>/path/to/mapcache-time.sqlite<span class="nt">&lt;/dbfile&gt;</span>
<span class="hll">    <span class="nt">&lt;query&gt;</span>
</span>         SELECT strftime(&quot;%Y-%m-%dT%H:%M:%SZ&quot;,ts) FROM time
          WHERE ts <span class="ni">&amp;gt;</span>= datetime(:start_timestamp,&quot;unixepoch&quot;)
            AND ts <span class="ni">&amp;lt;</span>= datetime(:end_timestamp,&quot;unixepoch&quot;)
       ORDER BY ts DESC
<span class="hll">    <span class="nt">&lt;/query&gt;</span>
</span>
<span class="nt">&lt;/dimension&gt;</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="c">&lt;!-- &quot;time&quot; dimension</span>

<span class="c">     This example defines a &quot;time&quot; dimension whose possible values</span>
<span class="c">     are stored in the /path/to/mapcache-time.sqlite SQLite file. The</span>
<span class="c">     default value is &quot;2010&quot;.</span>

<span class="c">     A WMS request with that dimension may contain, e.g.  &quot;...</span>
<span class="c">     &amp;time=1999-08-11T11:03:07Z/2001-09-21T08:17:56Z&amp; ...&quot;</span>
<span class="c">--&gt;</span>
<span class="nt">&lt;dimension</span> <span class="na">type=</span><span class="s">&quot;time&quot;</span> <span class="na">name=</span><span class="s">&quot;time&quot;</span> <span class="na">default=</span><span class="s">&quot;2010&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;dbfile&gt;</span>/path/to/mapcache-time.sqlite<span class="nt">&lt;/dbfile&gt;</span>
<span class="hll">    <span class="nt">&lt;validate_query&gt;</span>
</span>         SELECT strftime(&quot;%Y-%m-%dT%H:%M:%SZ&quot;,ts) FROM time
          WHERE ts <span class="ni">&amp;gt;</span>= datetime(:start_timestamp,&quot;unixepoch&quot;)
            AND ts <span class="ni">&amp;lt;</span>= datetime(:end_timestamp,&quot;unixepoch&quot;)
       ORDER BY ts DESC
<span class="hll">    <span class="nt">&lt;/validate_query&gt;</span>
</span><span class="hll">    <span class="nt">&lt;list_query&gt;</span>SELECT ts FROM time<span class="nt">&lt;/list_query&gt;</span>
</span><span class="nt">&lt;/dimension&gt;</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td>Up to MapCache 1.6.1</td>
<td>From MapCache 1.8 on</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="configuring-a-time-dimension-using-an-explicit-back-end">
<h4>Configuring a Time dimension using an explicit back-end<a class="headerlink" href="#configuring-a-time-dimension-using-an-explicit-back-end" title="Stały odnośnik do tego nagłówka">¶</a></h4>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span> <span class="c">&lt;!-- &quot;time&quot; dimension, &quot;new-style&quot; definition using a SQLite back-end</span>

<span class="c">      This example defines a &quot;time&quot; dimension whose possible values are</span>
<span class="c">      stored in the /data/times.sqlite SQLite file. The default value is</span>
<span class="c">      &quot;d1&quot;.</span>

<span class="c">      A WMS request with that dimension may contain, e.g.</span>
<span class="c">      &quot;... &amp;time=1999-08-11T11:03:07Z/2001-09-21T08:17:56Z&amp; ...&quot;</span>
<span class="c"> --&gt;</span>
<span class="hll"> <span class="nt">&lt;dimension</span> <span class="na">type=</span><span class="s">&quot;sqlite&quot;</span> <span class="na">name=</span><span class="s">&quot;time&quot;</span> <span class="na">default=</span><span class="s">&quot;d1&quot;</span> <span class="na">time=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
</span>   <span class="nt">&lt;dbfile&gt;</span>/data/times.sqlite<span class="nt">&lt;/dbfile&gt;</span>
   <span class="nt">&lt;list_query&gt;</span>SELECT ts FROM timedim<span class="nt">&lt;/list_query&gt;</span>
   <span class="nt">&lt;validate_query&gt;</span>
        SELECT strftime(&quot;%Y-%m-%dT%H:%M:%SZ&quot;,ts) FROM timedim
         WHERE ts <span class="ni">&amp;gt;</span>= datetime(:start_timestamp,&quot;unixepoch&quot;)
           AND ts <span class="ni">&amp;lt;</span>= datetime(:end_timestamp,&quot;unixepoch&quot;)
      ORDER BY ts DESC
   <span class="nt">&lt;/validate_query&gt;</span>
 <span class="nt">&lt;/dimension&gt;</span>
</pre></div>
</div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span> <span class="c">&lt;!-- &quot;time&quot; dimension, &quot;new-style&quot; definition using a PostgreSQL back-end</span>

<span class="c">      This example defines a &quot;time&quot; dimension whose possible values are</span>
<span class="c">      stored in the postgresql://mapcache:mapcache@localhost:5433/time</span>
<span class="c">      PostgreSQL database. The default value is &quot;d1&quot;.</span>

<span class="c">      A WMS request with that dimension may contain, e.g.</span>
<span class="c">      &quot;... &amp;time=1999-08-11T11:03:07Z/2001-09-21T08:17:56Z&amp; ...&quot;</span>
<span class="c"> --&gt;</span>
<span class="hll"> <span class="nt">&lt;dimension</span> <span class="na">type=</span><span class="s">&quot;postgresql&quot;</span> <span class="na">name=</span><span class="s">&quot;time&quot;</span> <span class="na">default=</span><span class="s">&quot;d1&quot;</span> <span class="na">time=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
</span>   <span class="nt">&lt;connection&gt;</span>
     host=localhost user=mapcache password=mapcache dbname=times port=5433
   <span class="nt">&lt;/connection&gt;</span>
   <span class="nt">&lt;list_query&gt;</span>SELECT ts FROM timedim<span class="nt">&lt;/list_query&gt;</span>
   <span class="nt">&lt;validate_query&gt;</span>
        SELECT to_char(ts,&#39;YYYY-MM-DD&quot;T&quot;HH24:MI:SS&quot;Z&quot;&#39;) FROM timedim
         WHERE ts <span class="ni">&amp;gt;</span>= to_timestamp(:start_timestamp)
           AND ts <span class="ni">&amp;lt;</span>= to_timestamp(:end_timestamp)
      ORDER BY ts DESC
   <span class="nt">&lt;/validate_query&gt;</span>
 <span class="nt">&lt;/dimension&gt;</span>
</pre></div>
</div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span> <span class="c">&lt;!-- &quot;time&quot; dimension, &quot;new-style&quot; definition using an ElasticSearch back-end</span>

<span class="c">      This example defines a &quot;time&quot; dimension whose possible values are</span>
<span class="c">      stored in the http://localhost:9200/times ElasticSearch index. The</span>
<span class="c">      default value is &quot;d1&quot;.</span>

<span class="c">      A WMS request with that dimension may contain, e.g.</span>
<span class="c">      &quot;... &amp;time=1999-08-11T11:03:07Z/2001-09-21T08:17:56Z&amp; ...&quot;</span>
<span class="c"> --&gt;</span>
<span class="hll"> <span class="nt">&lt;dimension</span> <span class="na">type=</span><span class="s">&quot;elasticsearch&quot;</span> <span class="na">name=</span><span class="s">&quot;time&quot;</span> <span class="na">default=</span><span class="s">&quot;d1&quot;</span> <span class="na">time=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
</span>   <span class="nt">&lt;http&gt;</span>
     <span class="nt">&lt;url&gt;</span>http://localhost:9200/times/_search<span class="nt">&lt;/url&gt;</span>
     <span class="nt">&lt;headers&gt;</span>
       <span class="nt">&lt;Content-Type&gt;</span>application/json<span class="nt">&lt;/Content-Type&gt;</span>
     <span class="nt">&lt;/headers&gt;</span>
   <span class="nt">&lt;/http&gt;</span>

   <span class="nt">&lt;list_query&gt;</span><span class="cp">&lt;![CDATA[</span>
<span class="cp">     { &quot;query&quot;: { &quot;match_all&quot;: { } } }</span>
<span class="cp">   ]]&gt;</span><span class="nt">&lt;/list_query&gt;</span>
   <span class="nt">&lt;list_response&gt;</span><span class="cp">&lt;![CDATA[</span>
<span class="cp">     [ &quot;hits&quot;, &quot;hits&quot;, &quot;_source&quot;, &quot;ts&quot; ]</span>
<span class="cp">   ]]&gt;</span><span class="nt">&lt;/list_response&gt;</span>

   <span class="nt">&lt;validate_query&gt;</span><span class="cp">&lt;![CDATA[</span>
<span class="cp">     { &quot;query&quot;: {</span>
<span class="cp">         &quot;range&quot;: {</span>
<span class="cp">           &quot;ts&quot;: { &quot;gte&quot;: :start_timestamp, &quot;lte&quot;: :end_timestamp }</span>
<span class="cp">         }</span>
<span class="cp">       },</span>
<span class="cp">       &quot;sort&quot;: { &quot;ts&quot;: { &quot;order&quot;: &quot;desc&quot; } },</span>
<span class="cp">       &quot;script_fields&quot;: {</span>
<span class="cp">         &quot;iso_ts&quot;: {</span>
<span class="cp">           &quot;lang&quot;: &quot;painless&quot;,</span>
<span class="cp">           &quot;source&quot;: &quot;SimpleDateFormat f=new SimpleDateFormat(params.fmt); f.setTimeZone(params.tz); return (f.format(doc.ts.value.getMillis()))&quot;,</span>
<span class="cp">           &quot;params&quot;: {</span>
<span class="cp">             &quot;fmt&quot;: &quot;yyyy-MM-dd&#39;T&#39;HH:mm:ss&#39;Z&#39;&quot;,</span>
<span class="cp">             &quot;tz: &quot;UTC&quot;</span>
<span class="cp">           }</span>
<span class="cp">         }</span>
<span class="cp">       }</span>
<span class="cp">     }</span>
<span class="cp">   ]]&gt;</span><span class="nt">&lt;/validate_query&gt;</span>
   <span class="nt">&lt;validate_response&gt;</span><span class="cp">&lt;![CDATA[</span>
<span class="cp">     [ &quot;hits&quot;, &quot;hits&quot;, &quot;fields&quot;, &quot;iso_ts&quot;, 0 ]</span>
<span class="cp">   ]]&gt;</span><span class="nt">&lt;/validate_response&gt;</span>

 <span class="nt">&lt;/dimension&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="tile-assembly-policies">
<h3>Tile Assembly Policies<a class="headerlink" href="#tile-assembly-policies" title="Stały odnośnik do tego nagłówka">¶</a></h3>
<p>When several time or sub-dimension values are returned from a dimension
back-end query, the resulting tile is an assembly of all simple tiles matching
each value. The way simple tiles are assembled is set with the
<code class="docutils literal notranslate"><span class="pre">&lt;assembly_type&gt;</span></code> tag of the <code class="docutils literal notranslate"><span class="pre">&lt;dimensions&gt;</span></code> element. Currently only two
values are implemented in MapCache:</p>
<blockquote>
<div><ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">none</span></code>: No assembly is performed, the resulting tile is the first
retrieved simple tile. This is the default value.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">stack</span></code>: Every pixel of the resulting tile is filled with the first
opaque pixel found in all simple tiles in their retrieval order, e.g.:</p>
<table border="1" class="docutils" id="id1">
<caption><span class="caption-text">Assembly type: <code class="docutils literal notranslate"><span class="pre">stack</span></code></span><a class="headerlink" href="#id1" title="Stały odnośnik do tej tabeli">¶</a></caption>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="first last reference internal image-reference" href="../_images/mapcache-assembly-stack-1.png"><img alt="../_images/mapcache-assembly-stack-1.png" src="../_images/mapcache-assembly-stack-1.png" style="width: 148.5px; height: 125.0px;" /></a>
</td>
<td><a class="first last reference internal image-reference" href="../_images/mapcache-assembly-stack-2.png"><img alt="../_images/mapcache-assembly-stack-2.png" src="../_images/mapcache-assembly-stack-2.png" style="width: 148.5px; height: 125.0px;" /></a>
</td>
<td><a class="first last reference internal image-reference" href="../_images/mapcache-assembly-stack-3.png"><img alt="../_images/mapcache-assembly-stack-3.png" src="../_images/mapcache-assembly-stack-3.png" style="width: 149.0px; height: 125.0px;" /></a>
</td>
</tr>
<tr class="row-even"><td>Product #1</td>
<td>Product #2</td>
<td><code class="docutils literal notranslate"><span class="pre">stack</span></code> assembly of Products #1 &amp; #2</td>
</tr>
</tbody>
</table>
</li>
</ul>
</div></blockquote>
<p>The resulting tile may or may not be cached depending on the value of the
<code class="docutils literal notranslate"><span class="pre">&lt;store_assemblies&gt;</span></code> tag of the <code class="docutils literal notranslate"><span class="pre">&lt;dimensions&gt;</span></code> element. The two possible
values are <code class="docutils literal notranslate"><span class="pre">true</span></code> and <code class="docutils literal notranslate"><span class="pre">false</span></code>. Default is <code class="docutils literal notranslate"><span class="pre">true</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">&lt;subdimensions_read_only&gt;</span></code> tag of the <code class="docutils literal notranslate"><span class="pre">&lt;dimensions&gt;</span></code> element indicates
whether data source shall be queried in case of cache miss. The two possible
values are <code class="docutils literal notranslate"><span class="pre">true</span></code> and <code class="docutils literal notranslate"><span class="pre">false</span></code>. Default is <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;dimensions&gt;</span>
    <span class="nt">&lt;assembly_type&gt;</span>stack<span class="nt">&lt;/assembly_type&gt;</span>
    <span class="nt">&lt;store_assemblies&gt;</span>true<span class="nt">&lt;/store_assemblies&gt;</span>
    <span class="nt">&lt;subdimensions_read_only&gt;</span>false<span class="nt">&lt;/subdimensions_read_only&gt;</span>
    <span class="nt">&lt;dimension</span> <span class="nt">&gt;</span>...<span class="nt">&lt;/dimension&gt;</span>
<span class="nt">&lt;/dimensions&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="storing-dimensions">
<h2>Storing Dimensions<a class="headerlink" href="#storing-dimensions" title="Stały odnośnik do tego nagłówka">¶</a></h2>
<p>When using a disk based cache tiles will be stored in a folder structure similar to
<code class="docutils literal notranslate"><span class="pre">base/gridname/DIM1/value/xx/xx/xx/xx/xx/xx.png</span></code> (where DIM1 is the dimension value).</p>
<p>The order of the <code class="docutils literal notranslate"><span class="pre">&lt;dimension&gt;</span></code> tags inside the <code class="docutils literal notranslate"><span class="pre">&lt;dimensions&gt;</span></code> tag  is important as it is used
to create the directory structure for the disk cache. If you change the order of these
values, any tiles that have been previously cached are invalidated (they will be unavailable to MapCache but not deleted).</p>
<p>Templates can be used to change the folder structure for example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;tmpl&quot;</span> <span class="na">type=</span><span class="s">&quot;disk&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;template&gt;</span>/tmp/template-test/{tileset}#{grid}#{dim}/{z}/{x}/{y}.{ext}<span class="nt">&lt;/template&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
<p>Templates can also be used to change Sqlite database names e.g.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="c">&lt;!-- the following will create databases named TilesetName-#DimensionValue.db --&gt;</span>
<span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;sqlite&quot;</span> <span class="na">type=</span><span class="s">&quot;sqlite3&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;dbfile&gt;</span>{tileset}-{dim}.db<span class="nt">&lt;/dbfile&gt;</span>
   <span class="nt">&lt;detect_blank</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="accessing-tile-caches-with-dimensions">
<h2>Accessing Tile Caches with Dimensions<a class="headerlink" href="#accessing-tile-caches-with-dimensions" title="Stały odnośnik do tego nagłówka">¶</a></h2>
<p>To retrieve a tile with a specific dimension, add the dimension name and value to the request query string e.g. <code class="docutils literal notranslate"><span class="pre">&amp;DIM1=value</span></code></p>
<p>Only WMS and WMTS clients support passing dimensions to MapCache. Other tile services such as gmaps (GoogleMaps), tms, and KML
do not support dimensions. WMTS however does allow access using a x,y,z addressing scheme, so by using URL rewriting on the web server
tile-based clients (for example an OpenLayers <code class="docutils literal notranslate"><span class="pre">ol.source.XYZ</span></code> layer) can load a dimension-based tileset.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># a URL such as the following</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">servername</span><span class="o">/</span><span class="n">tiles</span><span class="o">/</span><span class="mi">13</span><span class="o">/</span><span class="mi">3914</span><span class="o">/</span><span class="mf">2687.</span><span class="n">png</span>
<span class="c1"># can be rewritten into a WMTS request - note WMTS uses {z}/{y}/{x} rather than {z}/{x}/{y}</span>
<span class="c1"># so these values need to be swapped</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">servername</span><span class="o">/</span><span class="n">mapcache</span><span class="o">/</span><span class="n">wmts</span><span class="o">/</span><span class="mf">1.0</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">layername</span><span class="o">/</span><span class="n">default</span><span class="o">/</span><span class="n">dimension</span><span class="o">/</span><span class="n">GoogleMapsCompatible</span><span class="o">/</span><span class="mi">13</span><span class="o">/</span><span class="mi">2687</span><span class="o">/</span><span class="mf">3914.</span><span class="n">png</span>
</pre></div>
</div>
</div>
<div class="section" id="seeding-tile-caches-with-dimensions">
<h2>Seeding Tile Caches with Dimensions<a class="headerlink" href="#seeding-tile-caches-with-dimensions" title="Stały odnośnik do tego nagłówka">¶</a></h2>
<p>The <a class="reference internal" href="seed.html#mapcache-seed"><span class="std std-ref">MapCache seeding tool</span></a> allows specific dimensions to be seeded with the following syntax:</p>
<div class="highlight-bat notranslate"><div class="highlight"><pre><span></span>mapcache_seed -c mapcache_config.xml -t tileset1 -e -1187000,6695000,-605000,7450000 -z 7,10 --dimension DIMENSION_NAME=DIMENSION_VALUE
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Szybkie wyszukiwanie</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Szukaj" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><h3>Navigation</h3>
<p>
<a href="../about.html" title="About">About</a><br>
<a href="../products.html" title="Products">Products</a><br>
<a href="../community/index.html" title="Community">Community</a><br>
<a href="../development/index.html" title="Development">Development</a><br>
<a href="../download.html" title="Downloads">Downloads</a><br>
<a href="../documentation.html" title="Documentation">Documentation</a><br>
<a href="../faq.html" title="FAQ">FAQ</a><br>
<a href="../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</h3>
  <ul>
<li><a class="reference internal" href="#">Tileset Dimensions</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#enabling-dimension-support-in-mapcache">Enabling Dimension Support in MapCache</a><ul>
<li><a class="reference internal" href="#dimension-attributes">Dimension Attributes</a></li>
<li><a class="reference internal" href="#dimension-types">Dimension Types</a></li>
</ul>
</li>
<li><a class="reference internal" href="#first-level-dimensions">First Level Dimensions</a><ul>
<li><a class="reference internal" href="#values-dimensions">Values Dimensions</a></li>
<li><a class="reference internal" href="#regex-dimensions">Regex Dimensions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#second-level-dimensions">Second Level Dimensions</a><ul>
<li><a class="reference internal" href="#sqlite-dimensions">SQLite Dimensions</a></li>
<li><a class="reference internal" href="#postgresql-dimensions">PostgreSQL Dimensions</a></li>
<li><a class="reference internal" href="#elasticsearch-dimensions">ElasticSearch Dimensions</a></li>
<li><a class="reference internal" href="#time-dimensions">Time Dimensions</a><ul>
<li><a class="reference internal" href="#configuring-a-time-dimension-using-a-default-sqlite-back-end">Configuring a Time Dimension using a default SQLite back-end</a></li>
<li><a class="reference internal" href="#configuring-a-time-dimension-using-an-explicit-back-end">Configuring a Time dimension using an explicit back-end</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tile-assembly-policies">Tile Assembly Policies</a></li>
</ul>
</li>
<li><a class="reference internal" href="#storing-dimensions">Storing Dimensions</a></li>
<li><a class="reference internal" href="#accessing-tile-caches-with-dimensions">Accessing Tile Caches with Dimensions</a></li>
<li><a class="reference internal" href="#seeding-tile-caches-with-dimensions">Seeding Tile Caches with Dimensions</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Nawigacja</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Indeks ogólny"
             >indeks</a></li>
        <li class="right" >
          <a href="http.html" title="HTTP Requests"
             >dalej</a> |</li>
        <li class="right" >
          <a href="formats.html" title="Image Formats"
             >wstecz</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../documentation.html" >MapServer 7.2.2 Documentation</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >MapCache 1.6.1</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; <a href="../copyright.html">Copyright</a> 2019, Open Source Geospatial Foundation.
      Ostatnia modyfikacja 2019-03-27.
      Utworzone przy pomocy <a href="http://sphinx-doc.org/">Sphinx</a>'a 1.7.6.
    </div>
  </body>
</html>