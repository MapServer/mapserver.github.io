<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Dynamic Charting &#8212; MapServer 8.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx.css?v=6c7b17ac" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=dd298242" />
    <link rel="stylesheet" type="text/css" href="../_static/ribbon.css?v=ea091bf4" />
    
    <script src="../_static/documentation_options.js?v=521b6f53"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="icon" href="../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="next" title="Flash Output" href="flash.html" />
    <link rel="prev" title="AntiAliasing with MapServer" href="antialias.html" /> 
  </head><body>


<!-- for main branch only, do not backport this -->

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../index.html" title="Home"><img src="../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../index.html" title="Home">Home</a> |
      <a href="../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter" target="_blank">Twitter</a> |
      <a href="../download.html" title="Download Source or Binaries">Download </a> |
      <a class="badge" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=KRJ2X44N3HA6U&source=url" target="_blank">
        <img src="https://img.shields.io/badge/donate-%E2%9D%A4%C2%A0-ff69b4.svg?style=flat" alt="Donate to MapServer">
      </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../ar/output/dynamic_charting.html"><img src="../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../de/output/dynamic_charting.html"><img src="../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../el/output/dynamic_charting.html"><img src="../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../es/output/dynamic_charting.html"><img src="../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../fr/output/dynamic_charting.html"><img src="../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../id/output/dynamic_charting.html"><img src="../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../it/output/dynamic_charting.html"><img src="../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../ja/output/dynamic_charting.html"><img src="../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../nl_NL/output/dynamic_charting.html"><img src="../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../pl/output/dynamic_charting.html"><img src="../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../ru/output/dynamic_charting.html"><img src="../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../sq/output/dynamic_charting.html"><img src="../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../tr/output/dynamic_charting.html"><img src="../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="flash.html" title="Flash Output"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="antialias.html" title="AntiAliasing with MapServer"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../documentation.html" >MapServer 8.0.1 Documentation</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Output Generation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Dynamic Charting</a></li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="index-0">
<span id="dynamic-charting"></span><span id="id1"></span><h1><a class="toc-backref" href="#table-of-contents" role="doc-backlink">Dynamic Charting</a><a class="headerlink" href="#index-0" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Author<span class="colon">:</span></dt>
<dd class="field-odd"><p>Thomas Bonfort</p>
</dd>
<dt class="field-even">Contact<span class="colon">:</span></dt>
<dd class="field-even"><p>thomas.bonfort at gmail.com</p>
</dd>
<dt class="field-odd">Author<span class="colon">:</span></dt>
<dd class="field-odd"><p>Jeff McKenna</p>
</dd>
<dt class="field-even">Contact<span class="colon">:</span></dt>
<dd class="field-even"><p>jmckenna at gatewaygeomatics.com</p>
</dd>
<dt class="field-odd">Last Updated<span class="colon">:</span></dt>
<dd class="field-odd"><p>2021-04-15</p>
</dd>
</dl>
<nav class="contents" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#index-0" id="id2">Dynamic Charting</a></p>
<ul>
<li><p><a class="reference internal" href="#setup" id="id3">Setup</a></p>
<ul>
<li><p><a class="reference internal" href="#supported-renderers" id="id4">Supported Renderers</a></p></li>
<li><p><a class="reference internal" href="#output-from-agg-and-gd-renderers" id="id5">Output from AGG and GD Renderers</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#adding-a-chart-layer-to-a-mapfile" id="id6">Adding a Chart Layer to a Mapfile</a></p>
<ul>
<li><p><a class="reference internal" href="#layer-type" id="id7">Layer Type</a></p></li>
<li><p><a class="reference internal" href="#specifying-the-size-of-each-chart" id="id8">Specifying the Size of each Chart</a></p></li>
<li><p><a class="reference internal" href="#specifying-the-values-to-be-plotted" id="id9">Specifying the Values to be Plotted</a></p></li>
<li><p><a class="reference internal" href="#specifying-style" id="id10">Specifying Style</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#pie-charts" id="id11">Pie Charts</a></p>
<ul>
<li><p><a class="reference internal" href="#pie-chart-expressions" id="id12">Pie Chart Expressions</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#bar-graphs" id="id13">Bar Graphs</a></p>
<ul>
<li><p><a class="reference internal" href="#stacked-bar-graphs" id="id14">Stacked bar Graphs</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
<p>Starting with version 5.0, MapServer includes the ability to automatically draw
pie or bar graphs whose values are taken and adjusted from attributes of a
datasource.</p>
<img alt="../_images/pie-chart-na.png" class="no-scaled-link" src="../_images/pie-chart-na.png" style="width: 400px; height: 300px;" />
<p>This document assumes that you are already familiar with MapServer application
development and especially setting up <a class="reference internal" href="../mapfile/index.html#mapfile"><span class="std std-ref">mapfiles</span></a>. You
can also check out the <a class="reference internal" href="../input/vector/index.html#vector"><span class="std std-ref">Vector Data Access Guide</span></a>, which has lots of
examples of how to access specific data sources.</p>
<section id="setup">
<h2><a class="toc-backref" href="#table-of-contents" role="doc-backlink">Setup</a><a class="headerlink" href="#setup" title="Link to this heading">¶</a></h2>
<section id="supported-renderers">
<h3><a class="toc-backref" href="#table-of-contents" role="doc-backlink">Supported Renderers</a><a class="headerlink" href="#supported-renderers" title="Link to this heading">¶</a></h3>
<p>Dynamic charts are supported through the <a class="reference internal" href="agg.html#agg"><span class="std std-ref">AGG</span></a> renderer (for PNG output)
and Cairo renderer (for PDF &amp; SVG output) for MapServer 7 and more recent versions,
as the GD renderer was removed in the MapServer 7.0 release; MapServer versions
5 and 6 support the GD and <a class="reference internal" href="agg.html#agg"><span class="std std-ref">AGG</span></a> renderers for dynamic charting.</p>
<p>Attempting to add a chart layer with an unsupported renderer will
result in undefined behavior. Rendering quality with the GD renderer (if you are
using MapServer 5 or 6) is less than optimal, especially with small graphs, due
to the lack of subpixel rendering functions.</p>
</section>
<section id="output-from-agg-and-gd-renderers">
<h3><a class="toc-backref" href="#table-of-contents" role="doc-backlink">Output from AGG and GD Renderers</a><a class="headerlink" href="#output-from-agg-and-gd-renderers" title="Link to this heading">¶</a></h3>
<p>MapServer AGG Rendering</p>
<img alt="../_images/renderer-agg.png" src="../_images/renderer-agg.png" />
<p>MapServer GD Rendering</p>
<img alt="../_images/gd-renderer.png" src="../_images/gd-renderer.png" />
</section>
</section>
<section id="adding-a-chart-layer-to-a-mapfile">
<h2><a class="toc-backref" href="#table-of-contents" role="doc-backlink">Adding a Chart Layer to a Mapfile</a><a class="headerlink" href="#adding-a-chart-layer-to-a-mapfile" title="Link to this heading">¶</a></h2>
<section id="layer-type">
<h3><a class="toc-backref" href="#table-of-contents" role="doc-backlink">Layer Type</a><a class="headerlink" href="#layer-type" title="Link to this heading">¶</a></h3>
<p>A new type of layer has been added to the mapfile syntax. To specify a chart
layer, use</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">LAYER</span>
<span class="p">...</span>
    <span class="k">TYPE</span> <span class="nb">CHART</span>
    <span class="p">...</span>
<span class="k">END</span>
</pre></div>
</div>
<p>No other specific keywords have been added in order to keep the number of
different keywords to a minimum in the mapfile syntax, therefore all the
chart specific configuration is determined by PROCESSING directives.</p>
</section>
<section id="specifying-the-size-of-each-chart">
<h3><a class="toc-backref" href="#table-of-contents" role="doc-backlink">Specifying the Size of each Chart</a><a class="headerlink" href="#specifying-the-size-of-each-chart" title="Link to this heading">¶</a></h3>
<p id="index-1">The size of each chart is specified by the CHART_SIZE directive. If two values
are given for this parameter, this will specify the width and height of each
chart (this only applies for bar graphs). By default, the charts are 20x20
pixels.</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">LAYER</span>
    <span class="k">TYPE</span> <span class="nb">CHART</span>
    <span class="k">PROCESSING</span> <span class="s">&quot;CHART_SIZE=21&quot;</span> <span class="c"># specify size of the chart for pie or bar graphs</span>
    <span class="c">#PROCESSING &quot;CHART_SIZE=20 10&quot; # specify width and height for bar graphs</span>
    <span class="p">...</span>
<span class="k">END</span>
</pre></div>
</div>
<p id="index-2">The diameter of a pie chart can be bound to an
attribute,using the CHART_SIZE_RANGE PROCESSING attribute:</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">PROCESSING</span> <span class="s">&quot;CHART_SIZE_RANGE = itemname minsize maxsize minval maxval exponent&quot;</span>
</pre></div>
</div>
<p>or just</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">PROCESSING</span> <span class="s">&quot;CHART_SIZE_RANGE = itemname&quot;</span>
</pre></div>
</div>
<p>where:</p>
<blockquote>
<div><ul>
<li><p>itemname is the name of the attribute that drives the chart size (e.g.
total_sales)</p></li>
<li><p>minsize and maxsize are the minimum and maximum chart size values in pixels
(e.g. “10 100”)</p></li>
<li><p>minval and maxval are the minimum values of the attribute that correspond to
chart sizes of minsize and maxsize (e.g. 10000 1000000).</p></li>
<li><p>exponent (optional) applies an exponential factor to the diameter, calculated
with:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">diameter</span><span class="o">=</span><span class="n">mindiameter</span><span class="w"> </span><span class="o">+</span>
<span class="w">   </span><span class="n">pow</span><span class="p">((</span><span class="n">attribute_value</span><span class="o">-</span><span class="n">minvalue</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">maxvalue</span><span class="o">-</span><span class="n">minvalue</span><span class="p">),</span><span class="mf">1.0</span><span class="o">/</span><span class="n">exponent</span><span class="p">)</span><span class="o">*</span>
<span class="w">   </span><span class="p">(</span><span class="n">maxdiameter</span><span class="o">-</span><span class="n">mindiameter</span><span class="p">);</span>
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
<p>If the attribute value is smaller than ‘minval’ then the chart size will be
minsize pixels, and if the attribute value is larger than maxval, the chart
size will be maxsize pixels.</p>
</section>
<section id="specifying-the-values-to-be-plotted">
<h3><a class="toc-backref" href="#table-of-contents" role="doc-backlink">Specifying the Values to be Plotted</a><a class="headerlink" href="#specifying-the-values-to-be-plotted" title="Link to this heading">¶</a></h3>
<p>Each value to be plotted (i.e. a slice in a pie chart, or a bar in a par graph)
is specified in a CLASS of the chart layer. The value to be plotted is taken
from the SIZE keyword from the first STYLE block of the class. This is
semantically a bit awkward, but keeps the number of different keywords to a
minimum in the mapfile syntax. The value given to the SIZE keyword could of
course be given a static value, but dynamic charting really only makes sense
with attribute binding.</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">LAYER</span>
<span class="p">...</span>
    <span class="k">CLASS</span>
        <span class="c"># include a NAME keyword if you want this class to be included</span>
        <span class="c"># in the legend</span>
        <span class="k">NAME</span> <span class="s">&quot;value 1&quot;</span>
        <span class="k">STYLE</span>
            <span class="c"># specify which value from the data source will be used as the</span>
            <span class="c"># value for the graph</span>
            <span class="k">SIZE</span> <span class="nx">[attribute]</span>
            <span class="p">...</span>
        <span class="k">END</span>
    <span class="k">END</span>
    <span class="k">CLASS</span>
        <span class="p">...</span>
    <span class="k">END</span>
<span class="p">...</span>
<span class="k">END</span>
</pre></div>
</div>
<p>At least 2 CLASS blocks must be specified before charting can occur (but
you already knew this if you want your charts to convey at least <em>some</em>
information).</p>
</section>
<section id="specifying-style">
<span id="index-3"></span><h3><a class="toc-backref" href="#table-of-contents" role="doc-backlink">Specifying Style</a><a class="headerlink" href="#specifying-style" title="Link to this heading">¶</a></h3>
<p>The styling of each value in the charts is specified by the usual MapServer
syntax. Only one style per class is supported, any other STYLE block will
be silently ignored. Only a subset of the styling keywords are supported:</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">STYLE</span>
    <span class="k">SIZE</span> <span class="nx">[attribute]</span>
    <span class="c"># specify the fill color</span>
    <span class="k">COLOR</span> <span class="err">r</span> <span class="err">g</span> <span class="err">b</span>

    <span class="c"># if present will draw an outline around the corresponding bar or slice</span>
    <span class="k">OUTLINECOLOR</span> <span class="err">r</span> <span class="err">g</span> <span class="err">b</span>

    <span class="c">#specify the width of the outline if OUTLINECOLOR is present (defaults to 1)</span>
    <span class="k">WIDTH</span> <span class="err">w</span>

    <span class="c"># only for pie charts. &#39;a&#39; is the number of pixels the corresponding</span>
    <span class="c"># slice will be offset relative to the center of the pie. This is useful</span>
    <span class="c"># for emphasizing a specific value in each chart. &#39;b&#39; is required by the</span>
    <span class="c"># mapfile parser but is ignored.</span>
    <span class="k">OFFSET</span> <span class="err">a</span> <span class="err">b</span>
<span class="k">END</span>
</pre></div>
</div>
</section>
</section>
<section id="pie-charts">
<span id="index-4"></span><h2><a class="toc-backref" href="#table-of-contents" role="doc-backlink">Pie Charts</a><a class="headerlink" href="#pie-charts" title="Link to this heading">¶</a></h2>
<p>This is the default type of chart that is rendered. This can also be
specifically set with a PROCESSING keyword in the layer attributes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROCESSING</span> <span class="s2">&quot;CHART_TYPE=PIE&quot;</span>
</pre></div>
</div>
<p>For each shape in the layer’s datasource, the STYLE SIZE is used to set
the relative size (value) of each pie slice, with the  angles of the slices
that are automatically computed so as to form a full pie. For example:</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">LAYER</span>
<span class="linenos"> 2</span>    <span class="k">NAME</span> <span class="s">&quot;Ages&quot;</span>
<span class="linenos"> 3</span>    <span class="k">TYPE</span> <span class="nb">CHART</span>
<span class="linenos"> 4</span>    <span class="k">CONNECTIONTYPE</span> <span class="nb">postgis</span>
<span class="linenos"> 5</span>    <span class="k">CONNECTION</span> <span class="s">&quot;blabla&quot;</span>
<span class="linenos"> 6</span>    <span class="k">DATA</span> <span class="s">&quot;the_geom from demo&quot;</span>
<span class="linenos"> 7</span>    <span class="k">PROCESSING</span> <span class="s">&quot;CHART_TYPE=pie&quot;</span>
<span class="linenos"> 8</span>    <span class="k">PROCESSING</span> <span class="s">&quot;CHART_SIZE=30&quot;</span>
<span class="linenos"> 9</span>    <span class="k">STATUS</span> <span class="nb">ON</span>
<span class="linenos">10</span>    <span class="k">CLASS</span>
<span class="linenos">11</span>        <span class="k">NAME</span> <span class="s">&quot;Population Age 0-19&quot;</span>
<span class="linenos">12</span>        <span class="k">STYLE</span>
<span class="linenos">13</span>            <span class="k">SIZE</span> <span class="nx">[v1006]</span>
<span class="linenos">14</span>            <span class="k">COLOR</span> <span class="mi">255</span> <span class="mi">244</span> <span class="mi">237</span>
<span class="linenos">15</span>        <span class="k">END</span>
<span class="linenos">16</span>    <span class="k">END</span>
<span class="linenos">17</span>    <span class="k">CLASS</span>
<span class="linenos">18</span>        <span class="k">NAME</span> <span class="s">&quot;Population Age 20-39&quot;</span>
<span class="linenos">19</span>        <span class="k">STYLE</span>
<span class="linenos">20</span>            <span class="k">SIZE</span> <span class="nx">[v1007]</span>
<span class="linenos">21</span>            <span class="k">COLOR</span> <span class="mi">255</span> <span class="mi">217</span> <span class="mi">191</span>
<span class="linenos">22</span>        <span class="k">END</span>
<span class="linenos">23</span>    <span class="k">END</span>
<span class="linenos">24</span>    <span class="k">CLASS</span>
<span class="linenos">25</span>        <span class="k">NAME</span> <span class="s">&quot;Population Age 40-59&quot;</span>
<span class="linenos">26</span>        <span class="k">STYLE</span>
<span class="linenos">27</span>            <span class="k">SIZE</span> <span class="nx">[v1008]</span>
<span class="linenos">28</span>            <span class="k">COLOR</span> <span class="mi">255</span> <span class="mi">186</span> <span class="mi">140</span>
<span class="linenos">29</span>        <span class="k">END</span>
<span class="linenos">30</span>    <span class="k">END</span>
<span class="linenos">31</span><span class="k">END</span>
</pre></div>
</div>
<p>In the example above, if for a given shape we have v1006=1000, v1007=600 and
v1008=400 then the actual pie slices for each class will be respectively
50%, 30% and 20% of the total pie size.</p>
<section id="pie-chart-expressions">
<h3><a class="toc-backref" href="#table-of-contents" role="doc-backlink">Pie Chart Expressions</a><a class="headerlink" href="#pie-chart-expressions" title="Link to this heading">¶</a></h3>
<p>Expressions can be used within a CLASS to generate a pie chart for a layer.
This is best explained through an example.  Let’s say we have 3 polygons,
with the following crop type attributes:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>ID</p></th>
<th class="head"><p>NAME</p></th>
<th class="head"><p>TYPE</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>polygon1</p></td>
<td><p>corn,rice</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>polygon2</p></td>
<td><p>wheat</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>polygon3</p></td>
<td><p>rice,corn,wheat</p></td>
</tr>
</tbody>
</table>
<p>We can use an expression to give a specific color for each crop type, such as:</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">LAYER</span>
  <span class="k">NAME</span> <span class="s">&quot;pie-charts&quot;</span>
  <span class="k">TYPE</span> <span class="nb">CHART</span>
  <span class="k">STATUS</span> <span class="nb">ON</span>
  <span class="k">DATA</span> <span class="s">&quot;croptype.shp&quot;</span>
  <span class="k">PROCESSING</span> <span class="s">&quot;ITEMS=TYPE&quot;</span>
  <span class="k">PROCESSING</span> <span class="s">&quot;CHART_TYPE=pie&quot;</span>
  <span class="k">PROCESSING</span> <span class="s">&quot;CHART_SIZE=70&quot;</span>
  <span class="k">CLASSITEM</span> <span class="s">&quot;TYPE&quot;</span>
  <span class="k">CLASS</span>
    <span class="k">NAME</span> <span class="s">&quot;corn&quot;</span>
    <span class="k">EXPRESSION</span> <span class="o">/</span><span class="p">(</span><span class="o">^|</span><span class="p">,)</span><span class="err">corn</span><span class="p">(</span><span class="o">$|</span><span class="p">,)</span><span class="o">/</span>
    <span class="k">STYLE</span>
      <span class="k">SIZE</span> <span class="mi">1</span>
      <span class="k">COLOR</span> <span class="mi">255</span> <span class="mi">0</span> <span class="mi">0</span>
    <span class="k">END</span>
  <span class="k">END</span>
  <span class="k">CLASS</span>
    <span class="k">NAME</span> <span class="s">&quot;wheat&quot;</span>
    <span class="k">EXPRESSION</span> <span class="o">/</span><span class="p">(</span><span class="o">^|</span><span class="p">,)</span><span class="err">wheat</span><span class="p">(</span><span class="o">$|</span><span class="p">,)</span><span class="o">/</span>
    <span class="k">STYLE</span>
      <span class="k">SIZE</span> <span class="mi">1</span>
      <span class="k">COLOR</span> <span class="mi">0</span> <span class="mi">255</span> <span class="mi">0</span>
    <span class="k">END</span>
  <span class="k">END</span>
  <span class="k">CLASS</span>
    <span class="k">NAME</span> <span class="s">&quot;rice&quot;</span>
    <span class="k">EXPRESSION</span> <span class="o">/</span><span class="p">(</span><span class="o">^|</span><span class="p">,)</span><span class="err">rice</span><span class="p">(</span><span class="o">$|</span><span class="p">,)</span><span class="o">/</span>
    <span class="k">STYLE</span>
      <span class="k">SIZE</span> <span class="mi">1</span>
      <span class="k">COLOR</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">255</span>
    <span class="k">END</span>
  <span class="k">END</span>
<span class="k">END</span> <span class="c"># layer</span>
</pre></div>
</div>
<img alt="../_images/pie-chart-expressions.png" src="../_images/pie-chart-expressions.png" />
<p>More examples of working mapfiles with expressions can be found within the
<a class="reference external" href="https://github.com/MapServer/MapServer/blob/main/msautotest/renderers/chartlayer_pie_expressions.map">msautotest suite</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The size of the pie chart is actually set by: PROCESSING “CHART_SIZE=70”, not
through the STYLE within the CLASS.</p>
</div>
</section>
</section>
<section id="bar-graphs">
<span id="index-5"></span><h2><a class="toc-backref" href="#table-of-contents" role="doc-backlink">Bar Graphs</a><a class="headerlink" href="#bar-graphs" title="Link to this heading">¶</a></h2>
<p>Bar graph drawing is set with a PROCESSING keyword in the layer attributes:</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">PROCESSING</span> <span class="s">&quot;CHART_TYPE=BAR&quot;</span>
</pre></div>
</div>
<p>For each shape in the layer’s datasource, the STYLE SIZE is used to set the
relative size (value) of each bar in the graph. By default, the vertical axis
of each bar graph is scaled for the values of the corresponding shape, and
will always include the origin (=0). For example</p>
<blockquote>
<div><ul class="simple">
<li><p>a shape whose STYLE SIZEs contains values {5,8,10,3} will be plotted
on a graph whose vertical axis spans 0 to 10.</p></li>
<li><p>a shape whose STYLE SIZEs contains values {-5,-8,-10,-3} will be plotted
on a graph whose vertical axis spans -10 to 0.</p></li>
<li><p>a shape whose STYLE SIZEs contains values {-5,-8,10,3} will be plotted
on a graph whose vertical axis spans -8 to 10.</p></li>
</ul>
</div></blockquote>
<p id="index-7"><span id="index-6"></span>Additional PROCESSING directives are used to optionally specify the bounds
of vertical axes so that the graphs for all the shapes can be plotted with
the same scale:</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">PROCESSING</span> <span class="s">&quot;CHART_BAR_MINVAL=val&quot;</span>
<span class="k">PROCESSING</span> <span class="s">&quot;CHART_BAR_MAXVAL=val&quot;</span>
</pre></div>
</div>
<p>Values in the datasource that are above CHART_BAR_MAXVAL or below
CHART_BAR_MINVAL will be clipped respectively to these values. If only one of
these directives is included, the other will be automatically adjusted for
each shape to include at least the origin, i.e. the graphs for all the
shapes will be in the same scale <em>only if</em> all the values are of the
same sign (positive or negative).</p>
<section id="stacked-bar-graphs">
<span id="index-8"></span><h3><a class="toc-backref" href="#table-of-contents" role="doc-backlink">Stacked bar Graphs</a><a class="headerlink" href="#stacked-bar-graphs" title="Link to this heading">¶</a></h3>
<p>Stacked bar graphs can be drawn using:</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">PROCESSING</span> <span class="s">&quot;CHART_TYPE=VBAR&quot;</span>
</pre></div>
</div>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p>
<a href="../about.html" title="About">About</a><br>
<a href="../products.html" title="Products">Products</a><br>
<a href="../community/index.html" title="Community">Community</a><br>
<a href="../development/index.html" title="Development">Development</a><br>
<a href="../download.html" title="Downloads">Downloads</a><br>
<a href="../documentation.html" title="Documentation">Documentation</a><br>
<a href="../faq.html" title="FAQ">FAQ</a><br>
<a href="../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</h3>
  <ul>
<li><a class="reference internal" href="#">Dynamic Charting</a><ul>
<li><a class="reference internal" href="#setup">Setup</a><ul>
<li><a class="reference internal" href="#supported-renderers">Supported Renderers</a></li>
<li><a class="reference internal" href="#output-from-agg-and-gd-renderers">Output from AGG and GD Renderers</a></li>
</ul>
</li>
<li><a class="reference internal" href="#adding-a-chart-layer-to-a-mapfile">Adding a Chart Layer to a Mapfile</a><ul>
<li><a class="reference internal" href="#layer-type">Layer Type</a></li>
<li><a class="reference internal" href="#specifying-the-size-of-each-chart">Specifying the Size of each Chart</a></li>
<li><a class="reference internal" href="#specifying-the-values-to-be-plotted">Specifying the Values to be Plotted</a></li>
<li><a class="reference internal" href="#specifying-style">Specifying Style</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pie-charts">Pie Charts</a><ul>
<li><a class="reference internal" href="#pie-chart-expressions">Pie Chart Expressions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#bar-graphs">Bar Graphs</a><ul>
<li><a class="reference internal" href="#stacked-bar-graphs">Stacked bar Graphs</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="flash.html" title="Flash Output"
             >next</a> |</li>
        <li class="right" >
          <a href="antialias.html" title="AntiAliasing with MapServer"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../documentation.html" >MapServer 8.0.1 Documentation</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Output Generation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Dynamic Charting</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; <a href="../copyright.html">Copyright</a> 2023, Open Source Geospatial Foundation.
      Last updated on 2023-12-22.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.5.
    </div>
  </body>
</html>