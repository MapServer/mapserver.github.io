<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>MapScript Image Generation &#8212; MapServer 8.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx.css?v=6c7b17ac" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=dd298242" />
    <link rel="stylesheet" type="text/css" href="../_static/ribbon.css?v=ea091bf4" />
    
    <script src="../_static/documentation_options.js?v=521b6f53"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="icon" href="../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="next" title="Mapfile Manipulation" href="mapfile.html" />
    <link rel="prev" title="Python MapScript Appendix" href="python.html" /> 
  </head><body>


<!-- for main branch only, do not backport this -->

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../index.html" title="Home"><img src="../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../index.html" title="Home">Home</a> |
      <a href="../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter" target="_blank">Twitter</a> |
      <a href="../download.html" title="Download Source or Binaries">Download </a> |
      <a class="badge" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=KRJ2X44N3HA6U&source=url" target="_blank">
        <img src="https://img.shields.io/badge/donate-%E2%9D%A4%C2%A0-ff69b4.svg?style=flat" alt="Donate to MapServer">
      </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../ar/mapscript/imagery.html"><img src="../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../de/mapscript/imagery.html"><img src="../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../el/mapscript/imagery.html"><img src="../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../es/mapscript/imagery.html"><img src="../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../fr/mapscript/imagery.html"><img src="../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../id/mapscript/imagery.html"><img src="../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../it/mapscript/imagery.html"><img src="../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../ja/mapscript/imagery.html"><img src="../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../nl_NL/mapscript/imagery.html"><img src="../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../pl/mapscript/imagery.html"><img src="../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../ru/mapscript/imagery.html"><img src="../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../sq/mapscript/imagery.html"><img src="../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../tr/mapscript/imagery.html"><img src="../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="mapfile.html" title="Mapfile Manipulation"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="python.html" title="Python MapScript Appendix"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../documentation.html" >MapServer 8.0.1 Documentation</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">MapScript</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MapScript Image Generation</a></li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="mapscript-image-generation">
<span id="ms-imagery"></span><span id="index-0"></span><h1><a class="toc-backref" href="#table-of-contents" role="doc-backlink">MapScript Image Generation</a><a class="headerlink" href="#mapscript-image-generation" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Author<span class="colon">:</span></dt>
<dd class="field-odd"><p>Sean Gillies</p>
</dd>
<dt class="field-even">Author<span class="colon">:</span></dt>
<dd class="field-even"><p>Seth Girvin</p>
</dd>
<dt class="field-odd">Contact<span class="colon">:</span></dt>
<dd class="field-odd"><p>sethg at geographika.co.uk</p>
</dd>
<dt class="field-even">Last Updated<span class="colon">:</span></dt>
<dd class="field-even"><p>2021-05-22</p>
</dd>
</dl>
<nav class="contents" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#mapscript-image-generation" id="id1">MapScript Image Generation</a></p>
<ul>
<li><p><a class="reference internal" href="#introduction" id="id2">Introduction</a></p></li>
<li><p><a class="reference internal" href="#imagery-overview" id="id3">Imagery Overview</a></p></li>
<li><p><a class="reference internal" href="#the-imageobj-class" id="id4">The imageObj Class</a></p></li>
<li><p><a class="reference internal" href="#image-output" id="id5">Image Output</a></p></li>
<li><p><a class="reference internal" href="#images-and-symbols" id="id6">Images and Symbols</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="introduction">
<h2><a class="toc-backref" href="#table-of-contents" role="doc-backlink">Introduction</a><a class="headerlink" href="#introduction" title="Link to this heading">¶</a></h2>
<p>The MapScript HowTo docs are intended to complement the API reference with
examples of usage for specific subjects.  All examples in this document refer
to the Mapfile and testing layers distributed with MapServer and found in source control
under <code class="docutils literal notranslate"><span class="pre">Mapserver/tests</span></code>.</p>
<p>The examples below are written in Python. All MapScript languages use the
same API, but will need to be rewritten using the relevant language’s syntax.</p>
</section>
<section id="imagery-overview">
<h2><a class="toc-backref" href="#table-of-contents" role="doc-backlink">Imagery Overview</a><a class="headerlink" href="#imagery-overview" title="Link to this heading">¶</a></h2>
<p>The most common use of MapServer and MapScript is to create map imagery
using the built-in format drivers such as <code class="docutils literal notranslate"><span class="pre">AGG/PNG</span></code>, <code class="docutils literal notranslate"><span class="pre">AGG/JPEG</span></code>, and <code class="docutils literal notranslate"><span class="pre">CAIRO/PNG</span></code>.
This imagery might be saved to a file on disk or be streamed directly to
another device.</p>
</section>
<section id="the-imageobj-class">
<h2><a class="toc-backref" href="#table-of-contents" role="doc-backlink">The imageObj Class</a><a class="headerlink" href="#the-imageobj-class" title="Link to this heading">¶</a></h2>
<p>Imagery is represented in MapScript by the <a class="reference internal" href="mapscript-api/stub/mapscript.imageObj.html#mapscript.imageObj" title="mapscript.imageObj"><code class="xref py py-class docutils literal notranslate"><span class="pre">imageObj</span></code></a> class.</p>
<section id="creating-imageobj-from-a-mapobj">
<h3>Creating imageObj from a mapObj<a class="headerlink" href="#creating-imageobj-from-a-mapobj" title="Link to this heading">¶</a></h3>
<p>The <a class="reference internal" href="mapscript-api/stub/mapscript.mapObj.html#mapscript.mapObj" title="mapscript.mapObj"><code class="xref py py-class docutils literal notranslate"><span class="pre">mapObj</span></code></a> class has two methods that return instances of <a class="reference internal" href="mapscript-api/stub/mapscript.imageObj.html#mapscript.imageObj" title="mapscript.imageObj"><code class="xref py py-class docutils literal notranslate"><span class="pre">imageObj</span></code></a>: <a class="reference internal" href="mapscript-api/stub/mapscript.mapObj.html#mapscript.mapObj.draw" title="mapscript.mapObj.draw"><code class="xref py py-func docutils literal notranslate"><span class="pre">mapObj.draw()</span></code></a>,
and <a class="reference internal" href="mapscript-api/stub/mapscript.mapObj.html#mapscript.mapObj.prepareImage" title="mapscript.mapObj.prepareImage"><code class="xref py py-func docutils literal notranslate"><span class="pre">mapObj.prepareImage()</span></code></a>. The first returns a full-fledged map image just as one
would obtain from the mapserv CGI program:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">test_map</span> <span class="o">=</span> <span class="n">mapscript</span><span class="o">.</span><span class="n">mapObj</span><span class="p">(</span><span class="s1">&#39;tests/test.map&#39;</span><span class="p">)</span>
<span class="n">map_image</span> <span class="o">=</span> <span class="n">test_map</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
<p>A properly sized and formatted blank image, without any layers, symbols, or
labels, will be generated by <a class="reference internal" href="mapscript-api/stub/mapscript.mapObj.html#mapscript.mapObj.prepareImage" title="mapscript.mapObj.prepareImage"><code class="xref py py-func docutils literal notranslate"><span class="pre">mapObj.prepareImage()</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">blank_image</span> <span class="o">=</span> <span class="n">test_map</span><span class="o">.</span><span class="n">prepareImage</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="creating-a-new-imageobj">
<h3>Creating a new imageObj<a class="headerlink" href="#creating-a-new-imageobj" title="Link to this heading">¶</a></h3>
<p>The imageObj class constructor creates new instances without need of a map:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">format</span> <span class="o">=</span> <span class="n">mapscript</span><span class="o">.</span><span class="n">outputFormatObj</span><span class="p">(</span><span class="s1">&#39;AGG/JPEG&#39;</span><span class="p">)</span>
<span class="n">image</span> <span class="o">=</span> <span class="n">mapscript</span><span class="o">.</span><span class="n">imageObj</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="nb">format</span><span class="p">)</span>   <span class="c1"># 300 wide, 200 high JPEG</span>
</pre></div>
</div>
<p>and can even initialize from a file on disk:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># First three args are overridden by attributes of the disk image file</span>
<span class="n">disk_image</span> <span class="o">=</span> <span class="n">mapscript</span><span class="o">.</span><span class="n">imageObj</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;tests/test.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="image-output">
<h2><a class="toc-backref" href="#table-of-contents" role="doc-backlink">Image Output</a><a class="headerlink" href="#image-output" title="Link to this heading">¶</a></h2>
<section id="creating-files-on-disk">
<h3>Creating files on disk<a class="headerlink" href="#creating-files-on-disk" title="Link to this heading">¶</a></h3>
<p>Imagery is saved to disk by using the ‘save’ method.  By accessing the
‘extension’ attribute of an image’s format, the proper file extension
can be used without making any assumptions</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;test.&#39;</span> <span class="o">+</span> <span class="n">map_image</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">extension</span>
<span class="n">map_image</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
<p>If the image is using a GDAL/GTiff-based format, a GeoTIFF file can be created
on disk by adding a mapObj as a second optional argument to ‘save’</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">map_image</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">test_map</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="direct-output">
<h3>Direct Output<a class="headerlink" href="#direct-output" title="Link to this heading">¶</a></h3>
<p>An image can be dumped to an open filehandle using the <code class="xref py py-func docutils literal notranslate"><span class="pre">mapObj.write()</span></code> method. By
default, the filehandle is ‘stdout’:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Send an image to a web browser</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Content-type: &quot;</span> <span class="o">+</span> <span class="n">map_image</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">mimetype</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">map_image</span><span class="o">.</span><span class="n">write</span><span class="p">()</span>
</pre></div>
</div>
<p>This method is not fully functional for all SWIG MapScript languages. See the <a class="reference internal" href="mapscript-api/index.html#swig"><span class="std std-ref">SWIG API</span></a>
reference for more details.</p>
</section>
</section>
<section id="images-and-symbols">
<h2><a class="toc-backref" href="#table-of-contents" role="doc-backlink">Images and Symbols</a><a class="headerlink" href="#images-and-symbols" title="Link to this heading">¶</a></h2>
<p>The <a class="reference internal" href="mapscript-api/stub/mapscript.symbolObj.html#mapscript.symbolObj.getImage" title="mapscript.symbolObj.getImage"><code class="xref py py-func docutils literal notranslate"><span class="pre">symbolObj.getImage()</span></code></a> method will return an instance of <a class="reference internal" href="mapscript-api/stub/mapscript.imageObj.html#mapscript.imageObj" title="mapscript.imageObj"><code class="xref py py-class docutils literal notranslate"><span class="pre">imageObj</span></code></a>: for
pixmap symbols:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">symbol</span> <span class="o">=</span> <span class="n">test_map</span><span class="o">.</span><span class="n">symbolset</span><span class="o">.</span><span class="n">getSymbolByName</span><span class="p">(</span><span class="s1">&#39;home-png&#39;</span><span class="p">)</span>
<span class="n">input_format</span> <span class="o">=</span> <span class="n">mapscript</span><span class="o">.</span><span class="n">outputFormatObj</span><span class="p">(</span><span class="s1">&#39;AGG/PNG&#39;</span><span class="p">)</span>
<span class="n">image</span> <span class="o">=</span> <span class="n">symbol</span><span class="o">.</span><span class="n">getImage</span><span class="p">(</span><span class="n">input_format</span><span class="p">)</span>
</pre></div>
</div>
<p>There is a symmetric <a class="reference internal" href="mapscript-api/stub/mapscript.symbolObj.html#mapscript.symbolObj.setImage" title="mapscript.symbolObj.setImage"><code class="xref py py-func docutils literal notranslate"><span class="pre">symbolObj.setImage()</span></code></a> method which loads imagery into a symbol,
allowing pixmap symbols to be created dynamically:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">new_symbol</span> <span class="o">=</span> <span class="n">mapscript</span><span class="o">.</span><span class="n">symbolObj</span><span class="p">(</span><span class="s1">&#39;from_image&#39;</span><span class="p">)</span>
<span class="n">new_symbol</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">mapscript</span><span class="o">.</span><span class="n">MS_SYMBOL_PIXMAP</span>
<span class="n">new_symbol</span><span class="o">.</span><span class="n">setImage</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<span class="n">index</span> <span class="o">=</span> <span class="n">test_map</span><span class="o">.</span><span class="n">symbolset</span><span class="o">.</span><span class="n">appendSymbol</span><span class="p">(</span><span class="n">new_symbol</span><span class="p">)</span>
<span class="n">test_map</span><span class="o">.</span><span class="n">symbolset</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;tests/output_symbols.txt&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p>
<a href="../about.html" title="About">About</a><br>
<a href="../products.html" title="Products">Products</a><br>
<a href="../community/index.html" title="Community">Community</a><br>
<a href="../development/index.html" title="Development">Development</a><br>
<a href="../download.html" title="Downloads">Downloads</a><br>
<a href="../documentation.html" title="Documentation">Documentation</a><br>
<a href="../faq.html" title="FAQ">FAQ</a><br>
<a href="../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</h3>
  <ul>
<li><a class="reference internal" href="#">MapScript Image Generation</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#imagery-overview">Imagery Overview</a></li>
<li><a class="reference internal" href="#the-imageobj-class">The imageObj Class</a><ul>
<li><a class="reference internal" href="#creating-imageobj-from-a-mapobj">Creating imageObj from a mapObj</a></li>
<li><a class="reference internal" href="#creating-a-new-imageobj">Creating a new imageObj</a></li>
</ul>
</li>
<li><a class="reference internal" href="#image-output">Image Output</a><ul>
<li><a class="reference internal" href="#creating-files-on-disk">Creating files on disk</a></li>
<li><a class="reference internal" href="#direct-output">Direct Output</a></li>
</ul>
</li>
<li><a class="reference internal" href="#images-and-symbols">Images and Symbols</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="mapfile.html" title="Mapfile Manipulation"
             >next</a> |</li>
        <li class="right" >
          <a href="python.html" title="Python MapScript Appendix"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../documentation.html" >MapServer 8.0.1 Documentation</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >MapScript</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MapScript Image Generation</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; <a href="../copyright.html">Copyright</a> 2023, Open Source Geospatial Foundation.
      Last updated on 2023-12-22.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.5.
    </div>
  </body>
</html>