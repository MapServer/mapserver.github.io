
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Python MapScript Image Generation &#8212; MapServer 7.4.1 documentation</title>
    <link rel="stylesheet" href="../_static/sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <link rel="shortcut icon" href="../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="next" title="Mapfile Manipulation" href="mapfile.html" />
    <link rel="prev" title="Python MapScript Appendix" href="python.html" /> 
  </head><body>

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../index.html" title="Home"><img src="../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../index.html" title="Home">Home</a> |
      <a href="../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a> |
      <a href="../download.html" title="Download Source or Binaries">Download </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../ar/mapscript/imagery.html"><img src="../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../de/mapscript/imagery.html"><img src="../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../el/mapscript/imagery.html"><img src="../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../es/mapscript/imagery.html"><img src="../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../fr/mapscript/imagery.html"><img src="../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../id/mapscript/imagery.html"><img src="../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../it/mapscript/imagery.html"><img src="../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../ja/mapscript/imagery.html"><img src="../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../nl_NL/mapscript/imagery.html"><img src="../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../pl/mapscript/imagery.html"><img src="../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../ru/mapscript/imagery.html"><img src="../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../sq/mapscript/imagery.html"><img src="../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../tr/mapscript/imagery.html"><img src="../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="mapfile.html" title="Mapfile Manipulation"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="python.html" title="Python MapScript Appendix"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../documentation.html" >MapServer 7.4.1 Documentation</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">MapScript</a> &#187;</li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="python-mapscript-image-generation">
<h1><a class="toc-backref" href="#table-of-contents">Python MapScript Image Generation</a><a class="headerlink" href="#python-mapscript-image-generation" title="Permalink to this headline">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Author</dt>
<dd class="field-odd"><p>Sean Gillies</p>
</dd>
<dt class="field-even">Last Updated</dt>
<dd class="field-even"><p>2008/07/15</p>
</dd>
</dl>
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#python-mapscript-image-generation" id="id1">Python MapScript Image Generation</a></p>
<ul>
<li><p><a class="reference internal" href="#introduction" id="id2">Introduction</a></p></li>
<li><p><a class="reference internal" href="#imagery-overview" id="id3">Imagery Overview</a></p></li>
<li><p><a class="reference internal" href="#the-imageobj-class" id="id4">The imageObj Class</a></p></li>
<li><p><a class="reference internal" href="#image-output" id="id5">Image Output</a></p></li>
<li><p><a class="reference internal" href="#images-and-symbols" id="id6">Images and Symbols</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#table-of-contents">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>The MapScript HOWTO docs are intended to complement the API reference with
examples of usage for specific subjects.  All examples in this document refer
to the mapfile and testing layers distributed with MapServer 4.2+ and found
under mapserver/tests.</p>
<div class="section" id="pseudocode">
<h3>Pseudocode<a class="headerlink" href="#pseudocode" title="Permalink to this headline">¶</a></h3>
<p>All examples will use a pseudocode that is consistent with the language
independent API reference.  Each line is a statement. For object attributes
and methods we use the dot, ‘.’, operator.  Creation and deletion of objects
will be indicated by ‘new’ and ‘del’ keywords.  Other than that, the
pseudocode looks a lot like Python.</p>
</div>
</div>
<div class="section" id="imagery-overview">
<h2><a class="toc-backref" href="#table-of-contents">Imagery Overview</a><a class="headerlink" href="#imagery-overview" title="Permalink to this headline">¶</a></h2>
<p>The most common use of MapServer and MapScript is to create map imagery
using the built-in GD format drivers: GD/GIF, GD/PNG, GD/PNG24, and GD/JPEG.
This imagery might be saved to a file on disk or be streamed directly to
another device.</p>
</div>
<div class="section" id="the-imageobj-class">
<h2><a class="toc-backref" href="#table-of-contents">The imageObj Class</a><a class="headerlink" href="#the-imageobj-class" title="Permalink to this headline">¶</a></h2>
<p>Imagery is represented in MapScript by the imageObj class.  Please see the
API Reference (MapScript.txt) for class attribute and method details.</p>
<div class="section" id="creating-imageobj-from-a-mapobj">
<h3>Creating imageObj from a mapObj<a class="headerlink" href="#creating-imageobj-from-a-mapobj" title="Permalink to this headline">¶</a></h3>
<p>The mapObj class has two methods that return instances of imageObj: ‘draw’,
and ‘prepareImage’.  The first returns a full-fledged map image just as one
would obtain from the mapserv CGI program</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">test_map</span> <span class="o">=</span> <span class="n">MapScript</span><span class="o">.</span><span class="n">mapObj</span><span class="p">(</span><span class="s1">&#39;tests/test.map&#39;</span><span class="p">)</span>
<span class="n">map_image</span> <span class="o">=</span> <span class="n">test_map</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
<p>A properly sized and formatted blank image, without any layers, symbols, or
labels, will be generated by ‘prepareImage’</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">blank_image</span> <span class="o">=</span> <span class="n">test_map</span><span class="o">.</span><span class="n">prepareImage</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-a-new-imageobj">
<h3>Creating a new imageObj<a class="headerlink" href="#creating-a-new-imageobj" title="Permalink to this headline">¶</a></h3>
<p>The imageObj class constructor creates new instances without need of a map</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">format</span> <span class="o">=</span> <span class="n">MapScript</span><span class="o">.</span><span class="n">outputFormatObj</span><span class="p">(</span><span class="s1">&#39;GD/JPEG&#39;</span><span class="p">)</span>
<span class="n">image</span> <span class="o">=</span> <span class="n">MapScript</span><span class="o">.</span><span class="n">imageObj</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="n">format</span><span class="p">)</span>   <span class="c1"># 300 wide, 200 high JPEG</span>
</pre></div>
</div>
<p>and can even initialize from a file on disk</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># First three args are overridden by attributes of the disk image file</span>
<span class="n">disk_image</span> <span class="o">=</span> <span class="n">MapScript</span><span class="o">.</span><span class="n">imageObj</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">NULL</span><span class="p">,</span> <span class="s1">&#39;tests/test.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="image-output">
<h2><a class="toc-backref" href="#table-of-contents">Image Output</a><a class="headerlink" href="#image-output" title="Permalink to this headline">¶</a></h2>
<div class="section" id="creating-files-on-disk">
<h3>Creating files on disk<a class="headerlink" href="#creating-files-on-disk" title="Permalink to this headline">¶</a></h3>
<p>Imagery is saved to disk by using the ‘save’ method.  By accessing the
‘extension’ attribute of an image’s format, the proper file extension
can be used without making any assumptions</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;test.&#39;</span> <span class="o">+</span> <span class="n">map_image</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">extension</span>
<span class="n">map_image</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
<p>If the image is using a GDAL/GTiff-based format, a GeoTIFF file can be created
on disk by adding a mapObj as a second optional argument to ‘save’</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">map_image</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">test_map</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="direct-output">
<h3>Direct Output<a class="headerlink" href="#direct-output" title="Permalink to this headline">¶</a></h3>
<p>An image can be dumped to an open filehandle using the ‘write’ method.  By
default, the filehandle is ‘stdout’</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Send an image to a web browser</span>
<span class="k">print</span> <span class="s2">&quot;Content-type: &quot;</span> <span class="o">+</span> <span class="n">map_image</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">mimetype</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span>
<span class="n">map_image</span><span class="o">.</span><span class="n">write</span><span class="p">()</span>
</pre></div>
</div>
<p>This method is not fully functional for all SWIG MapScript languages.  See the
API Reference (MapScript.txt) for details.  The ‘write’ method is new in 4.4.</p>
</div>
</div>
<div class="section" id="images-and-symbols">
<h2><a class="toc-backref" href="#table-of-contents">Images and Symbols</a><a class="headerlink" href="#images-and-symbols" title="Permalink to this headline">¶</a></h2>
<p>The symbolObj::getImage() method will return an instance of imageObj for
pixmap symbols</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">symbol</span> <span class="o">=</span> <span class="n">test_map</span><span class="o">.</span><span class="n">symbolset</span><span class="o">.</span><span class="n">getSymbolByName</span><span class="p">(</span><span class="s1">&#39;home-png&#39;</span><span class="p">)</span>
<span class="n">image</span> <span class="o">=</span> <span class="n">symbol</span><span class="o">.</span><span class="n">getImage</span><span class="p">()</span>
</pre></div>
</div>
<p>There is a symmetric ‘setImage’ method which loads imagery into a symbol,
allowing pixmap symbols to be created dynamically</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">new_symbol</span> <span class="o">=</span> <span class="n">MapScript</span><span class="o">.</span><span class="n">symbolObj</span><span class="p">(</span><span class="s1">&#39;from_image&#39;</span><span class="p">)</span>
<span class="n">new_symbol</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">MapScript</span><span class="o">.</span><span class="n">MS_SYMBOL_PIXMAP</span>
<span class="n">new_symbol</span><span class="o">.</span><span class="n">setImage</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<span class="n">index</span> <span class="o">=</span> <span class="n">test_map</span><span class="o">.</span><span class="n">symbolset</span><span class="o">.</span><span class="n">appendSymbol</span><span class="p">(</span><span class="n">new_symbol</span><span class="p">)</span>
</pre></div>
</div>
<p>The get/setImage methods are new in MapServer 4.4.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><h3>Navigation</h3>
<p>
<a href="../about.html" title="About">About</a><br>
<a href="../products.html" title="Products">Products</a><br>
<a href="../community/index.html" title="Community">Community</a><br>
<a href="../development/index.html" title="Development">Development</a><br>
<a href="../download.html" title="Downloads">Downloads</a><br>
<a href="../documentation.html" title="Documentation">Documentation</a><br>
<a href="../faq.html" title="FAQ">FAQ</a><br>
<a href="../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</h3>
  <ul>
<li><a class="reference internal" href="#">Python MapScript Image Generation</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a><ul>
<li><a class="reference internal" href="#pseudocode">Pseudocode</a></li>
</ul>
</li>
<li><a class="reference internal" href="#imagery-overview">Imagery Overview</a></li>
<li><a class="reference internal" href="#the-imageobj-class">The imageObj Class</a><ul>
<li><a class="reference internal" href="#creating-imageobj-from-a-mapobj">Creating imageObj from a mapObj</a></li>
<li><a class="reference internal" href="#creating-a-new-imageobj">Creating a new imageObj</a></li>
</ul>
</li>
<li><a class="reference internal" href="#image-output">Image Output</a><ul>
<li><a class="reference internal" href="#creating-files-on-disk">Creating files on disk</a></li>
<li><a class="reference internal" href="#direct-output">Direct Output</a></li>
</ul>
</li>
<li><a class="reference internal" href="#images-and-symbols">Images and Symbols</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="mapfile.html" title="Mapfile Manipulation"
             >next</a> |</li>
        <li class="right" >
          <a href="python.html" title="Python MapScript Appendix"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../documentation.html" >MapServer 7.4.1 Documentation</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >MapScript</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; <a href="../copyright.html">Copyright</a> 2019, Open Source Geospatial Foundation.
      Last updated on 2019-09-12.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.1.2.
    </div>
  </body>
</html>