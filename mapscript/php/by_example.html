<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>By Example &mdash; MapServer 7.0.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '7.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="top" title="MapServer 7.0.0 documentation" href="../../index.html" />
    <link rel="up" title="PHP MapScript" href="index.html" />
    <link rel="next" title="Python MapScript Appendix" href="../python.html" />
    <link rel="prev" title="PHP MapScript Migration Guide" href="migration_guide.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../../index.html" title="Home"><img src="../../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../../index.html" title="Home">Home</a> |
      <a href="../../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../../faq.html" title="FAQ">FAQ</a> |
      <a href="../../download.html" title="Download">Download </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../../ar/mapscript/php/by_example.html"><img src="../../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../../de/mapscript/php/by_example.html"><img src="../../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../../el/mapscript/php/by_example.html"><img src="../../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../../es/mapscript/php/by_example.html"><img src="../../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../../fr/mapscript/php/by_example.html"><img src="../../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../../id/mapscript/php/by_example.html"><img src="../../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../../it/mapscript/php/by_example.html"><img src="../../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../../ja/mapscript/php/by_example.html"><img src="../../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../../nl_NL/mapscript/php/by_example.html"><img src="../../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../../pl/mapscript/php/by_example.html"><img src="../../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../../ru/mapscript/php/by_example.html"><img src="../../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../../sq/mapscript/php/by_example.html"><img src="../../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../../tr/mapscript/php/by_example.html"><img src="../../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        
        
          <a href="../../uk/mapscript/php/by_example.html"><img src="../../_static/flagicons/uk.png" alt="uk" title="uk" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../python.html" title="Python MapScript Appendix"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="migration_guide.html" title="PHP MapScript Migration Guide"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../documentation.html" >MapServer 7.0.0 Documentation</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="../index.html" >MapScript</a> &raquo;</li>
          <li class="nav-item nav-item-3"><a href="index.html" accesskey="U">PHP MapScript</a> &raquo;</li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="by-example">
<span id="php-example"></span><h1><a class="toc-backref" href="#contents">By Example</a><a class="headerlink" href="#by-example" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Author:</th><td class="field-body">Vinko Vrsalovic</td>
</tr>
<tr class="field-even field"><th class="field-name">Contact:</th><td class="field-body">el at vinko.cl</td>
</tr>
<tr class="field-odd field"><th class="field-name">Revision:</th><td class="field-body">$Revision$</td>
</tr>
<tr class="field-even field"><th class="field-name">Date:</th><td class="field-body">$Date$</td>
</tr>
<tr class="field-odd field"><th class="field-name">Last Updated:</th><td class="field-body">2005/12/12</td>
</tr>
</tbody>
</table>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#by-example" id="id1">By Example</a><ul>
<li><a class="reference internal" href="#introduction" id="id2">Introduction</a></li>
<li><a class="reference internal" href="#mapscript-overview" id="id3">MapScript overview</a></li>
<li><a class="reference internal" href="#our-first-application" id="id4">Our first application</a></li>
<li><a class="reference internal" href="#conclusions" id="id5">Conclusions</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#contents">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>The purpose of this document is to be a step by step explanation of
the <a class="reference internal" href="phpmapscript.html#phpmapscriptapi"><span>PHP MapScript API</span></a> with practical examples for each of them.  It
is assumed a basic knowledge of <a class="reference internal" href="../../mapfile/map.html#map"><span>MAP</span></a> and MapServer, and
familiarity with the <a class="reference external" href="http://www.php.net">PHP (scripting)</a> and <a class="reference external" href="http://www.w3.org/MarkUp/">HTML (markup)</a> languages
.  This document was originally created for MapServer v4.0, but the
examples still apply to more recent versions.</p>
<p><strong>Let&#8217;s Begin...</strong></p>
<p>Hello, kind reader. I am Tut, thank you for downloading me. I am
sorry, but I am just a technical manual so I cannot answer any
questions. The maintainer, a handsome, very nice and lazy guy
according to what I saw from the other side of the screen, maybe will
be able to answer your question(s). I am currently here to tell you
about MapScript in its PHP incarnation. At my current age, I will be
more useful to beginners than advanced users, even though I hope that
some day I will be sufficiently old to be useful to advanced MapScript
programmers.</p>
<p>Let&#8217;s hope I live long enough... sigh.</p>
<p>But enough with my personal problems, let myself begin. My duty is to
familiarize you with MapScript, and in particular with PHP
MapScript. When I end, you are expected to understand what MapScript
is, and to be able to write applications to display and navigate that
is, zooming and panning over shapefiles via a web browser.</p>
<p>What follows are the questions you must answer affirmatively before
accompanying me through the rest of this journey (I apologize for my
maintainer&#8217;s lack of literary taste).</p>
<div class="section" id="do-you-have-running-somewhere">
<h3>Do you have running somewhere...<a class="headerlink" href="#do-you-have-running-somewhere" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>a web server capable of running PHP as a CGI (Apache will do)?</li>
<li>the PHP language configured as a CGI, version 4.1.2 or higher? I
recommend 4.3 onwards.</li>
<li>PHP MapScript, version 4.0 or later? <a class="reference internal" href="../../installation/php.html#php-install"><span>PHP MapScript Installation</span></a></li>
</ul>
</div>
<div class="section" id="can-you">
<h3>Can you...<a class="headerlink" href="#can-you" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>code PHP or are willing to <a class="reference external" href="http://php.net/tut.php">learn how to</a>?</li>
<li>write and understand <a class="reference external" href="http://www.w3.org/MarkUp/">HTML</a> documents? (Note that Javascript is a
plus)</li>
<li>tell somebody what on earth is a <a class="reference external" href="http://shapelib.maptools.org/">shapefile</a> [or a <a class="reference external" href="http://postgis.refractions.net/">PostGIS</a>
table]?</li>
</ul>
</div>
<div class="section" id="outline-of-this-document">
<h3>Outline of this Document<a class="headerlink" href="#outline-of-this-document" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>A general overview of MapScript, in a language independent way</li>
<li>A trivial example</li>
<li>A simple example</li>
<li>Conclusion</li>
</ul>
<p>You can also go to each part directly through my table of contents
located at the top, if you wish to skip some sections.</p>
</div>
</div>
<div class="section" id="mapscript-overview">
<h2><a class="toc-backref" href="#contents">MapScript overview</a><a class="headerlink" href="#mapscript-overview" title="Permalink to this headline">¶</a></h2>
<p>Ok, now I&#8217;m at last arriving at a point I will enjoy. This overview
intends to clear some common misconceptions beginners encounter when
first facing MapScript and to give a general overview about
MapScript&#8217;s internals. For now, just look at the following diagram (I
apologize again for the maintainer&#8217;s lack of graphic design taste).</p>
<img alt="../../_images/phpmapscript-byexample-map.png" src="../../_images/phpmapscript-byexample-map.png" />
<p>It all starts as everything on the Web. A browser requests a certain
URL through HTTP. The request arrives at the web server, which, in
turn, delivers a file or executes a program and then delivers its
output back to the browser. Yes, I know you knew that, but I have been
told to be as complete as possible, and I will try to.</p>
<p>In MapScript&#8217;s case, the server executes a certain script, which
contains standard language functionality, that is, the same
functionality you would have in that language without MapScript, plus
access to almost all of the MapServer C API, the level of completeness
of MapServer API support varies a bit with the language you choose,
but I think it is my duty to tell you almost every available flavor of
MapScript is usable. This API, exposed now in your scripting language
through the MapScript module, allows you to do many GIS-like
operations on spatial data, including read-write access to shapefiles,
reprojection of data, and many others.  For more information on the
API, click over the link above. For other flavors, you can check their
own documentation, you will see there is not much difference.</p>
<p>The CGI version of MapServer is not required to run MapScript
applications, just as you don&#8217;t need a particular MapScript module to
run the CGI. The CGI version has many features out-of-the-box,
MapScript is just an API, so with MapScript you must start from
scratch or with some of the examples available. Think of the CGI as of
a MapScript application written directly in C, with direct access to
the MapServer C API. Sometimes the out-of-the-box functionality has
some limits which can be surpassed by MapScript, but not embedded
within the CGI. In other words, the CGI is not scriptable, but you can
program all the CGI and more with MapScript. This may seem a strange
thing to clarify, but is a common misconception, just check the <a class="reference external" href="http://lists.osgeo.org/pipermail/mapserver-users/">list
archives</a> if you are not inclined to believe me.</p>
<p>As with MapServer itself, MapScript can be configured using only map
files, but, unlike the CGI, also includes the possibility of
dynamically create maps or modify existing ones and to (and here is
the key to the flexibility that MapScript has) mix this information
with other sources of non GIS data, such as user input, non spatial
and spatial databases, text files, etc. and that you can use every
single module your language provides. The power of this approach is
tremendous, and the most restrictive limit is your imagination. As
always, flexibility comes with a price, performance.  It&#8217;s generally
slower to use a scripting language instead of C, but nowadays this
shouldn&#8217;t be a big worry. And you can still program directly in C
(there are not much documents about how to do it, though you might
want to check the <a class="reference external" href="http://lists.osgeo.org/mailman/listinfo/mapserver-dev/">mapserver-dev list</a>) if you would like to.</p>
<p>The input and output formats MapScript can handle are exactly the same
as the ones configured when you build MapServer/MapScript. But one of
the most important things to remember is that, basically, you feed
geographic data and relevant user input (for instance clicks over the
map image) to MapScript and as a result get one or more file(s),
typically standard image files such as a PNG or JPEG. So you can apply
anything you&#8217;ve seen in any server side scripted web application,
DHTML, Java applets, CSS, HTML templates, sessions, you name it.</p>
</div>
<div class="section" id="our-first-application">
<h2><a class="toc-backref" href="#contents">Our first application</a><a class="headerlink" href="#our-first-application" title="Permalink to this headline">¶</a></h2>
<p>In this first example, I will tell you how to display a shapefile on a
web page using a map file.</p>
<div class="section" id="the-map-file">
<h3>The Map File<a class="headerlink" href="#the-map-file" title="Permalink to this headline">¶</a></h3>
<p>Here&#8217;s the map file:</p>
<div class="highlight-mapfile"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="highlight"><pre><span></span>    <span class="k">NAME</span> <span class="s">&quot;Europe in purple&quot;</span>
    <span class="k">SIZE</span> <span class="mi">400</span> <span class="mi">400</span>
    <span class="k">STATUS</span> <span class="nb">ON</span>
    <span class="k">SYMBOLSET</span> <span class="s">&quot;/var/www/html/maps/symbols/symbols.sym&quot;</span>
    <span class="k">EXTENT</span> <span class="p">-</span><span class="mi">5696501</span> <span class="mi">1923039</span> <span class="mi">5696501</span> <span class="mi">11022882</span>
    <span class="k">UNITS</span> <span class="nb">METERS</span>
    <span class="k">SHAPEPATH</span> <span class="s">&quot;/var/www/html/maps/data&quot;</span>

    <span class="k">WEB</span>
        <span class="k">IMAGEPATH</span> <span class="s">&quot;/var/www/html/maps/tmp/&quot;</span>
        <span class="k">IMAGEURL</span> <span class="s">&quot;/tmp/&quot;</span>
    <span class="k">END</span>

    <span class="k">LAYER</span>
        <span class="k">NAME</span> <span class="s">&quot;Europe&quot;</span>
        <span class="k">TYPE</span> <span class="nb">POLYGON</span>
        <span class="k">STATUS</span> <span class="nb">ON</span>
        <span class="k">DATA</span> <span class="s">&quot;europe&quot;</span>
        <span class="k">CLASS</span>
            <span class="k">STYLE</span>
                <span class="k">COLOR</span> <span class="mi">110</span> <span class="mi">50</span> <span class="mi">100</span>
                <span class="k">OUTLINECOLOR</span> <span class="mi">200</span> <span class="mi">200</span> <span class="mi">200</span>
                <span class="k">SYMBOL</span> <span class="mi">0</span>
            <span class="k">END</span>
        <span class="k">END</span>
    <span class="k">END</span>

    <span class="k">END</span>
</pre></div>
</td></tr></table></div>
<p>Here I have shown a map with a single layer, where the europe.shp,
europe.shx and europe.dbf files must be located in the subdirectory
called data. The symbols are located in the symbols subdirectory. All
this locations are relative from the place the map file is, but better
safe than sorry, I guess. The web section is used to define where will
the images be saved and in what URL will they be available.</p>
</div>
<div class="section" id="displaying-the-map-with-mapscript">
<h3>Displaying the map with MapScript<a class="headerlink" href="#displaying-the-map-with-mapscript" title="Permalink to this headline">¶</a></h3>
<p>To display a map the following MapScript objects and methods will be
used:</p>
<ul class="simple">
<li>MapObj object</li>
<li>imageObj object</li>
</ul>
<p>MapObj methods:</p>
<ul class="simple">
<li>The constructor method: MapObj ms_newMapObj(string map_file_name[,string new_map_path])</li>
<li>The draw method: imageObj draw()</li>
</ul>
<p>imageObj methods:</p>
<ul class="simple">
<li>The saveWebImage method: string saveWebImage()</li>
</ul>
<p>The code looks like this:</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="x">    </span><span class="cp">&lt;?php</span>

    <span class="nb">dl</span><span class="p">(</span><span class="s1">&#39;php_mapscript.so&#39;</span><span class="p">);</span>

    <span class="nv">$map_path</span><span class="o">=</span><span class="s2">&quot;/var/www/html/ms/map_files/&quot;</span><span class="p">;</span>

    <span class="nv">$map</span> <span class="o">=</span> <span class="nx">ms_newMapObj</span><span class="p">(</span><span class="nv">$map_path</span><span class="o">.</span><span class="s2">&quot;europe.map&quot;</span><span class="p">);</span>
    <span class="nv">$image</span><span class="o">=</span><span class="nv">$map</span><span class="o">-&gt;</span><span class="na">draw</span><span class="p">();</span>
    <span class="nv">$image_url</span><span class="o">=</span><span class="nv">$image</span><span class="o">-&gt;</span><span class="na">saveWebImage</span><span class="p">();</span>

    <span class="cp">?&gt;</span><span class="x"></span>

<span class="x">     &lt;HTML&gt;</span>
<span class="x">      &lt;HEAD&gt;</span>
<span class="x">          &lt;TITLE&gt;Example 1: Displaying a map&lt;/TITLE&gt;</span>
<span class="x">      &lt;/HEAD&gt;</span>
<span class="x">      &lt;BODY&gt;</span>
<span class="x">          &lt;IMG SRC=</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$image_url</span><span class="p">;</span> <span class="cp">?&gt;</span><span class="x"> &gt;</span>
<span class="x">      &lt;/BODY&gt;</span>
<span class="x">     &lt;/HTML&gt;</span>
</pre></div>
</td></tr></table></div>
<p>The code I will present through the rest of this document will follow
the following rule:</p>
<ul class="simple">
<li>Every non empty line is numbered</li>
</ul>
<p>This code will render an image corresponding to the shapefile europe and display
it on a HTML page.</p>
</div>
<div class="section" id="code-explanation">
<h3>Code Explanation<a class="headerlink" href="#code-explanation" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>In line 2 it is loaded the MapScript extension (you may not need it if your
php.ini file is configured to automatically load it).</li>
<li>Line 3 declares a variable that holds the absolute path for the mapfile.</li>
<li>Line 4 creates an instance of the MapObj object using the constructor. As you
can see, the constructor receives the location of the map file as its only
required parameter, and the map file received the europe.map name.</li>
<li>Afterwards the draw method of the map object is called to render the image
defined by the map file (line 5). The result (an imageObj) is saved in the
$image variable.</li>
<li>Line 6 calls the saveWebImage method to generate the image file, it returns a
string which represents the URL as defined in the mapfile (in this case,
/tmp/filename.png).</li>
<li>The rest of the lines are pure HTML, except line 13, that defines the source
URL of the image will be the value stored in $image_url.</li>
</ul>
<p>You should test the application on your system, to check that it really works
and to solve the problems that may arise on your particular configuration before
moving on to the more complex examples.</p>
</div>
<div class="section" id="output">
<h3>Output<a class="headerlink" href="#output" title="Permalink to this headline">¶</a></h3>
<p>The output (using the europe shapefile) should look like this:</p>
<img alt="../../_images/phpmapscript-byexample-map.png" src="../../_images/phpmapscript-byexample-map.png" />
</div>
<div class="section" id="zooming-and-panning">
<h3>Zooming and Panning<a class="headerlink" href="#zooming-and-panning" title="Permalink to this headline">¶</a></h3>
<p>Now I will tell you how to add zoom and pan capabilities to the code.</p>
<p>Here goes the list of new methods and objects called.</p>
<p>New Objects:</p>
<ul class="simple">
<li>pointObj</li>
<li>rectObj</li>
</ul>
<p>New Methods and Members called:</p>
<ul class="simple">
<li>The zoompoint method of the map object: void zoompoint(int nZoomFactor,
pointObj oPixelPos, int nImageWidth, int nImageHeight, rectObj oGeorefExt).</li>
<li>The setextent method of the map object: $map-&gt;setextent(double minx,
double miny, double maxx, double maxy);.</li>
<li>The extent, width and height members of the map object.</li>
<li>The constructors of RectObj and PointObj: $point = ms_newPointObj();
$rect = ms_newRectObj();</li>
<li>The setXY method of the point object: $point-&gt;setXY(double x_coord,
double y_coord);</li>
<li>The setextent method of the rectangle object: $rect-&gt;setextent(double minx,
double miny, double maxx, double maxy);</li>
</ul>
<p>The .map file remains the same as the one presented in the previous example.</p>
</div>
<div class="section" id="php-mapscript-code">
<h3>PHP/MapScript Code<a class="headerlink" href="#php-mapscript-code" title="Permalink to this headline">¶</a></h3>
<p>Here I present the new code.</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="x">    </span><span class="cp">&lt;?php</span>

    <span class="nb">dl</span><span class="p">(</span><span class="s1">&#39;php_mapscript.so&#39;</span><span class="p">);</span>

    <span class="c1">// Default values and configuration</span>

    <span class="nv">$val_zsize</span><span class="o">=</span><span class="mi">3</span><span class="p">;</span>
    <span class="nv">$check_pan</span><span class="o">=</span><span class="s2">&quot;CHECKED&quot;</span><span class="p">;</span>
    <span class="nv">$map_path</span><span class="o">=</span><span class="s2">&quot;/var/www/html/ms/map_files/&quot;</span><span class="p">;</span>
    <span class="nv">$map_file</span><span class="o">=</span><span class="s2">&quot;europe.map&quot;</span><span class="p">;</span>

    <span class="nv">$map</span> <span class="o">=</span> <span class="nx">ms_newMapObj</span><span class="p">(</span><span class="nv">$map_path</span><span class="o">.</span><span class="nv">$map_file</span><span class="p">);</span>


    <span class="k">if</span> <span class="p">(</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">&quot;mapa_x&quot;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">&quot;mapa_y&quot;</span><span class="p">])</span>
          <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">&quot;full&quot;</span><span class="p">])</span> <span class="p">)</span> <span class="p">{</span>

          <span class="nv">$extent_to_set</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">&quot;extent&quot;</span><span class="p">]);</span>

          <span class="nv">$map</span><span class="o">-&gt;</span><span class="na">setextent</span><span class="p">(</span><span class="nv">$extent_to_set</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nv">$extent_to_set</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                          <span class="nv">$extent_to_set</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="nv">$extent_to_set</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>

          <span class="nv">$my_point</span> <span class="o">=</span> <span class="nx">ms_newpointObj</span><span class="p">();</span>
          <span class="nv">$my_point</span><span class="o">-&gt;</span><span class="na">setXY</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">&quot;mapa_x&quot;</span><span class="p">],</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">&quot;mapa_y&quot;</span><span class="p">]);</span>

          <span class="nv">$my_extent</span> <span class="o">=</span> <span class="nx">ms_newrectObj</span><span class="p">();</span>

          <span class="nv">$my_extent</span><span class="o">-&gt;</span><span class="na">setextent</span><span class="p">(</span><span class="nv">$extent_to_set</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nv">$extent_to_set</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                  <span class="nv">$extent_to_set</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="nv">$extent_to_set</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>

          <span class="nv">$zoom_factor</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s2">&quot;zoom&quot;</span><span class="p">]</span><span class="o">*</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">&quot;zsize&quot;</span><span class="p">];</span>
          <span class="k">if</span> <span class="p">(</span><span class="nv">$zoom_factor</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                  <span class="nv">$zoom_factor</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                  <span class="nv">$check_pan</span> <span class="o">=</span> <span class="s2">&quot;CHECKED&quot;</span><span class="p">;</span>
                  <span class="nv">$check_zout</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
                  <span class="nv">$check_zin</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
          <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$zoom_factor</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                  <span class="nv">$check_pan</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
                  <span class="nv">$check_zout</span> <span class="o">=</span> <span class="s2">&quot;CHECKED&quot;</span><span class="p">;</span>
                  <span class="nv">$check_zin</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                  <span class="nv">$check_pan</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
                  <span class="nv">$check_zout</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
                  <span class="nv">$check_zin</span> <span class="o">=</span> <span class="s2">&quot;CHECKED&quot;</span><span class="p">;</span>
          <span class="p">}</span>

          <span class="nv">$val_zsize</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nv">$zoom_factor</span><span class="p">);</span>

          <span class="nv">$map</span><span class="o">-&gt;</span><span class="na">zoompoint</span><span class="p">(</span><span class="nv">$zoom_factor</span><span class="p">,</span><span class="nv">$my_point</span><span class="p">,</span><span class="nv">$map</span><span class="o">-&gt;</span><span class="na">width</span><span class="p">,</span><span class="nv">$map</span><span class="o">-&gt;</span><span class="na">height</span><span class="p">,</span>
                          <span class="nv">$my_extent</span><span class="p">);</span>

     <span class="p">}</span>


     <span class="nv">$image</span><span class="o">=</span><span class="nv">$map</span><span class="o">-&gt;</span><span class="na">draw</span><span class="p">();</span>
     <span class="nv">$image_url</span><span class="o">=</span><span class="nv">$image</span><span class="o">-&gt;</span><span class="na">saveWebImage</span><span class="p">();</span>

     <span class="nv">$extent_to_html</span> <span class="o">=</span> <span class="nv">$map</span><span class="o">-&gt;</span><span class="na">extent</span><span class="o">-&gt;</span><span class="na">minx</span><span class="o">.</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="nv">$map</span><span class="o">-&gt;</span><span class="na">extent</span><span class="o">-&gt;</span><span class="na">miny</span><span class="o">.</span><span class="s2">&quot; &quot;</span>
                  <span class="o">.</span><span class="nv">$map</span><span class="o">-&gt;</span><span class="na">extent</span><span class="o">-&gt;</span><span class="na">maxx</span><span class="o">.</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="nv">$map</span><span class="o">-&gt;</span><span class="na">extent</span><span class="o">-&gt;</span><span class="na">maxy</span><span class="p">;</span>

     <span class="cp">?&gt;</span><span class="x"></span>
<span class="x">     &lt;HTML&gt;</span>
<span class="x">     &lt;HEAD&gt;</span>
<span class="x">     &lt;TITLE&gt;Map 2&lt;/TITLE&gt;</span>
<span class="x">     &lt;/HEAD&gt;</span>
<span class="x">     &lt;BODY&gt;</span>
<span class="x">     &lt;CENTER&gt;</span>
<span class="x">     &lt;FORM METHOD=POST ACTION=</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$HTTP_SERVER_VARS</span><span class="p">[</span><span class="s1">&#39;PHP_SELF&#39;</span><span class="p">]</span><span class="cp">?&gt;</span><span class="x">&gt;</span>
<span class="x">     &lt;TABLE&gt;</span>
<span class="x">     &lt;TR&gt;</span>
<span class="x">          &lt;TD&gt;</span>
<span class="x">                  &lt;INPUT TYPE=IMAGE NAME=&quot;mapa&quot; SRC=&quot;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$image_url</span><span class="cp">?&gt;</span><span class="x">&quot;&gt;</span>
<span class="x">          &lt;/TD&gt;</span>
<span class="x">     &lt;/TR&gt;</span>
<span class="x">     &lt;TR&gt;</span>
<span class="x">          &lt;TD&gt;</span>
<span class="x">                  Pan</span>
<span class="x">          &lt;/TD&gt;</span>
<span class="x">          &lt;TD&gt;</span>
<span class="x">                  &lt;INPUT TYPE=RADIO NAME=&quot;zoom&quot; VALUE=0 </span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$check_pan</span><span class="cp">?&gt;</span><span class="x">&gt;</span>
<span class="x">          &lt;/TD&gt;</span>
<span class="x">     &lt;/TR&gt;</span>
<span class="x">     &lt;TR&gt;</span>
<span class="x">          &lt;TD&gt;</span>
<span class="x">                  Zoom In</span>
<span class="x">          &lt;/TD&gt;</span>
<span class="x">          &lt;TD&gt;</span>
<span class="x">                  &lt;INPUT TYPE=RADIO NAME=&quot;zoom&quot; VALUE=1 </span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$check_zin</span><span class="cp">?&gt;</span><span class="x">&gt;</span>
<span class="x">          &lt;/TD&gt;</span>
<span class="x">     &lt;/TR&gt;</span>
<span class="x">     &lt;TR&gt;</span>
<span class="x">          &lt;TD&gt;</span>
<span class="x">                  Zoom Out</span>
<span class="x">          &lt;/TD&gt;</span>
<span class="x">          &lt;TD&gt;</span>
<span class="x">                  &lt;INPUT TYPE=RADIO NAME=&quot;zoom&quot; VALUE=-1 </span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$check_zout</span><span class="cp">?&gt;</span><span class="x">&gt;</span>
<span class="x">          &lt;/TD&gt;</span>
<span class="x">     &lt;/TR&gt;</span>
<span class="x">     &lt;TR&gt;</span>
<span class="x">          &lt;TD&gt;</span>
<span class="x">                  Zoom Size</span>
<span class="x">          &lt;/TD&gt;</span>
<span class="x">          &lt;TD&gt;</span>
<span class="x">                  &lt;INPUT TYPE=TEXT NAME=&quot;zsize&quot; VALUE=&quot;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$val_zsize</span><span class="cp">?&gt;</span><span class="x">&quot;</span>
<span class="x">                  SIZE=2&gt;</span>
<span class="x">          &lt;/TD&gt;</span>
<span class="x">     &lt;/TR&gt;</span>
<span class="x">     &lt;TR&gt;</span>
<span class="x">          &lt;TD&gt;</span>
<span class="x">                  Full Extent</span>
<span class="x">          &lt;/TD&gt;</span>
<span class="x">          &lt;TD&gt;</span>
<span class="x">                  &lt;INPUT TYPE=SUBMIT NAME=&quot;full&quot; VALUE=&quot;Go&quot;</span>
<span class="x">                  SIZE=2&gt;</span>
<span class="x">          &lt;/TD&gt;</span>
<span class="x">     &lt;/TABLE&gt;</span>
<span class="x">     &lt;INPUT TYPE=HIDDEN NAME=&quot;extent&quot; VALUE=&quot;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$extent_to_html</span><span class="cp">?&gt;</span><span class="x">&quot;&gt;</span>
<span class="x">     &lt;/FORM&gt;</span>
<span class="x">     &lt;/CENTER&gt;</span>
<span class="x">     &lt;/BODY&gt;</span>
<span class="x">     &lt;/HMTL&gt;</span>
</pre></div>
</td></tr></table></div>
<p>This code will zoom out, zoom in, pan, and restore to full extent the
image displayed in the previous example.</p>
<p>It looks much more complicated than it really is, much of the lines
are the HTML code, and much of the remaining PHP code is just to deal
with the forms and such.</p>
<p>You should try it and look at how it works first.  Try it in your own
server by copying and pasting the code.</p>
<p>Now it&#8217;s time for you to play with it a little and look at the source
in your browser to check how it changes.</p>
<p>Done?, now let&#8217;s start the explanation with the HTML part.</p>
</div>
<div class="section" id="code-explanation-html">
<h3>Code Explanation - HTML<a class="headerlink" href="#code-explanation-html" title="Permalink to this headline">¶</a></h3>
<p>Line 49 declares a form, and line 53 declares the image generated by
MapScript to be part of that form, so when you click on it, the X and
Y coordinates of the click (in pixels) will be sent along with the
other data for the PHP code to process.</p>
<p>If you are familiar with HTML and PHP, the rest of the HTML code
should be straightforward for you to understand with the exception of
line 98, that will be explained in due time.</p>
</div>
<div class="section" id="code-explanation-php">
<h3>Code Explanation - PHP<a class="headerlink" href="#code-explanation-php" title="Permalink to this headline">¶</a></h3>
<p>Now look at the PHP code, it&#8217;s almost the same code used in example 1,
with the addition of lines 9 to 37. What do these lines do?</p>
<p>Line 9 checks the relevant variables from the form have been
setted. &#8216;mapa_x&#8217; and &#8216;mapa_y&#8217; represent the X and Y coordinates of the
click over the image, and &#8216;full&#8217; represents the click on the &#8216;Full
Extent&#8217; button.</p>
<p>The first time the page is displayed the code between the if statement
doesn&#8217;t get executed, but the rest of the code does. Lines 40 and 41
set the &#8216;$extent_to_html&#8217; variable with the values of the extent
defined in the map file separated by spaces; that value will be put in
the HTML variable &#8216;extent&#8217; in line 98.</p>
<p>Now look at line 11 and 12. We are inside the if statement, that means
the form has been submitted at least once. We grab the extent stored
in the previous execution (the &#8216;extent&#8217; HTML variable) of the code and
set the extent of the map to be that last extent. This allows to zoom
or pan with respect of the previous extent, not the extent that is set
in the map file.</p>
<p>From that last paragraph you can deduce that all the default values
are set in the map file, and anything that you change through
MapScript and would like to remain in your code, must be stored
somehow. In this case it is done through hidden variables in a
form. For more advanced applications you could use session variables
or a database.</p>
<p>Now you should be able to see why the &#8216;Full Extent&#8217; button works. If
you check line 10, it says that if you haven&#8217;t pressed the button,
skip the code in the if statement, so the extent is reset to the value
that the map file has. You should also see that it isn&#8217;t necessarily a
full extent (in case the extent in the map file is not full extent).</p>
<p>Lines 14 and 15 declare a new point object and initialize it with the
values the user clicked on. You should not forget that those values
are in pixels, not in georeferenced coordinates.</p>
<p>Lines 16 through 18 create a new rectangle object and set it with the
extent of the previous image, just like it is done on line 12. In fact
this would work too: $my_extent = $map-&gt;extent;.</p>
<p>To do all the zooming and panning, the zoompoint function in called on
line 35, but first the arguments it receives must be prepared. You can
determine the point the user clicked on, and the extent of the image
($my_point and $my_extent, respectively), but now you have to
determine the zoom factor. That&#8217;s what lines 19 to 33 do. If you
wondered why the values of the radio buttons where 0, -1, and 1 for
pan, zoom in and zoom out, now you will know the reason.</p>
<p>A zoom factor of 1 tells zoompoint that the operation is pan, a
negative value indicates zoom out and a positive value indicates zoom
in. So, by means of multiplying the value received for the radio
buttons (HTML variable &#8216;zoom&#8217;) by the size of the zoom the user
entered the zoom factor is calculated. If that value is 0, that means
the user selected the pan operation, so &#8216;$zoom_factor&#8217; is set to 1,
otherwise the result of the multiplication is the zoom factor
zoompoint needs to receive. The other lines are to preserve the button
the user clicked on the next time. Line 34 tries to preserve the value
of the zoom size the user entered (It doesn&#8217;t do that all the time,
when and why that line fails? That&#8217;s for you to find out).</p>
<p>And finally, line 34 calls the zoompoint method with the zoom factor
obtained, the point built from the pixel coordinates (I insist on that
issue because zoompoint is almost the only method that receives the
coordinates in pixels, for the other methods you must convert pixels
to georeferenced coordinates on your own), the height and width of the
image, and the extent.</p>
<p>After calling zoompoint, the extent of the image is changed
accordingly to the operation performed (or, better put, the zoom
factor). So then the image is drawn and the current extent saved
(after the zooming) for use in the next iteration.</p>
</div>
</div>
<div class="section" id="conclusions">
<h2><a class="toc-backref" href="#contents">Conclusions</a><a class="headerlink" href="#conclusions" title="Permalink to this headline">¶</a></h2>
<p>Well, it&#8217;s time for me to go recharge my batteries. So I will use this
last energy to share some final words. The examples I have managed to
present here are very basic but you should now be able to devise ways
to improve them and suit things to your needs. Keep in mind that you
can preprocess, store, read, write data from any source you can
usually read through PHP, plus all the sources MapServer can handle
for GIS data. You can even process some GIS data with PHP only if the
need would arise (SQL sources are a good example of this). You can
also do hybrid approaches where some script prepares data which is
then shown through the CGI interface to MapServer, or create data on
the fly based on input from a GPS, etc, etc. The possibilities are
just too many to enumerate completely. As I already said your
imagination is the limit. The next version of this document will
include examples that include more than one layer, with different
datasources (not just shapefiles) and creation of dynamic layers and
classes. If you have a better idea or would like to see some other
thing here first, please drop a note to my maintainer.</p>
<p>In the meantime, if you need bigger examples you can refer to the
<a class="reference external" href="http://www.mapsherpa.com/gmap/">GMap demo</a> (you can download the source <a class="reference external" href="http://dl.maptools.org/dl/">here</a> or as an <a class="reference external" href="http://www.maptools.org/ms4w/index.phtml?page=downloads.html">MS4W
packaged application</a>), or the <a class="reference external" href="http://www.maptools.org/">MapTools site</a> (MapLab,
Chameleon). Goodbye, and thanks for reading this far.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Navigation</h3>
<p>
<a href="../../about.html" title="About">About</a><br>
<a href="../../products.html" title="Products">Products</a><br>
<a href="../../community/index.html" title="Community">Community</a><br>
<a href="../../development/index.html" title="Development">Development</a><br>
<a href="../../download.html" title="Downloads">Downloads</a><br>
<a href="../../documentation.html" title="Documentation">Documentation</a><br>
<a href="../../faq.html" title="FAQ">FAQ</a>
</p>
  <h3>Current Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">By Example</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a><ul>
<li><a class="reference internal" href="#do-you-have-running-somewhere">Do you have running somewhere...</a></li>
<li><a class="reference internal" href="#can-you">Can you...</a></li>
<li><a class="reference internal" href="#outline-of-this-document">Outline of this Document</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mapscript-overview">MapScript overview</a></li>
<li><a class="reference internal" href="#our-first-application">Our first application</a><ul>
<li><a class="reference internal" href="#the-map-file">The Map File</a></li>
<li><a class="reference internal" href="#displaying-the-map-with-mapscript">Displaying the map with MapScript</a></li>
<li><a class="reference internal" href="#code-explanation">Code Explanation</a></li>
<li><a class="reference internal" href="#output">Output</a></li>
<li><a class="reference internal" href="#zooming-and-panning">Zooming and Panning</a></li>
<li><a class="reference internal" href="#php-mapscript-code">PHP/MapScript Code</a></li>
<li><a class="reference internal" href="#code-explanation-html">Code Explanation - HTML</a></li>
<li><a class="reference internal" href="#code-explanation-php">Code Explanation - PHP</a></li>
</ul>
</li>
<li><a class="reference internal" href="#conclusions">Conclusions</a></li>
</ul>
</li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Open Source Geospatial Foundation.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.4</a>
      
    </div>

    

    
  </body>
</html>