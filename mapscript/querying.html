<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Querying &#8212; MapServer 8.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx.css?v=6c7b17ac" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=dd298242" />
    <link rel="stylesheet" type="text/css" href="../_static/ribbon.css?v=ea091bf4" />
    
    <script src="../_static/documentation_options.js?v=521b6f53"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="icon" href="../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="next" title="MapCache 1.14.0" href="../mapcache/index.html" />
    <link rel="prev" title="Mapfile Manipulation" href="mapfile.html" /> 
  </head><body>


<!-- for main branch only, do not backport this -->

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../index.html" title="Home"><img src="../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../index.html" title="Home">Home</a> |
      <a href="../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter" target="_blank">Twitter</a> |
      <a href="../download.html" title="Download Source or Binaries">Download </a> |
      <a class="badge" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=KRJ2X44N3HA6U&source=url" target="_blank">
        <img src="https://img.shields.io/badge/donate-%E2%9D%A4%C2%A0-ff69b4.svg?style=flat" alt="Donate to MapServer">
      </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../ar/mapscript/querying.html"><img src="../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../de/mapscript/querying.html"><img src="../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../el/mapscript/querying.html"><img src="../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../es/mapscript/querying.html"><img src="../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../fr/mapscript/querying.html"><img src="../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../id/mapscript/querying.html"><img src="../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../it/mapscript/querying.html"><img src="../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../ja/mapscript/querying.html"><img src="../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../nl_NL/mapscript/querying.html"><img src="../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../pl/mapscript/querying.html"><img src="../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../ru/mapscript/querying.html"><img src="../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../sq/mapscript/querying.html"><img src="../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../tr/mapscript/querying.html"><img src="../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../mapcache/index.html" title="MapCache 1.14.0"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="mapfile.html" title="Mapfile Manipulation"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../documentation.html" >MapServer 8.0.1 Documentation</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">MapScript</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Querying</a></li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="querying">
<span id="index-0"></span><span id="id1"></span><h1><a class="toc-backref" href="#contents" role="doc-backlink">Querying</a><a class="headerlink" href="#querying" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Author<span class="colon">:</span></dt>
<dd class="field-odd"><p>Sean Gillies</p>
</dd>
<dt class="field-even">Author<span class="colon">:</span></dt>
<dd class="field-even"><p>Seth Girvin</p>
</dd>
<dt class="field-odd">Contact<span class="colon">:</span></dt>
<dd class="field-odd"><p>sethg at geographika.co.uk</p>
</dd>
<dt class="field-even">Last Updated<span class="colon">:</span></dt>
<dd class="field-even"><p>2021-05-22</p>
</dd>
</dl>
<nav class="contents" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#querying" id="id2">Querying</a></p>
<ul>
<li><p><a class="reference internal" href="#introduction" id="id3">Introduction</a></p></li>
<li><p><a class="reference internal" href="#attribute-queries" id="id4">Attribute Queries</a></p></li>
<li><p><a class="reference internal" href="#spatial-queries" id="id5">Spatial Queries</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="introduction">
<h2><a class="toc-backref" href="#contents" role="doc-backlink">Introduction</a><a class="headerlink" href="#introduction" title="Link to this heading">¶</a></h2>
<p>The MapScript HowTo docs are intended to complement the API reference with
examples of usage for specific subjects.  All examples in this document refer
to the Mapfile and testing layers distributed with MapServer and found in source control
under <code class="docutils literal notranslate"><span class="pre">Mapserver/tests</span></code>.</p>
<p>The examples below are written in Python. All MapScript languages use the
same API, but will need to be rewritten using the relevant language’s syntax.
Querying Overview</p>
<section id="the-query-result-set">
<h3>The Query Result Set<a class="headerlink" href="#the-query-result-set" title="Link to this heading">¶</a></h3>
<p>Map layers can be queried to select features using spatial query methods
or the attribute query method.  Ignoring for the moment whether we are
executing a spatial or attribute query, results are obtained like so:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># for any query to be successful it needs to have a template</span>
<span class="c1"># set - any value here will do</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">layer</span><span class="o">.</span><span class="n">template</span><span class="p">:</span>
    <span class="n">layer_obj</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="s2">&quot;ttt&quot;</span>

<span class="n">layer</span><span class="o">.</span><span class="n">query</span><span class="p">()</span>                                 <span class="c1"># not an actual method!</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">getResults</span><span class="p">()</span>
</pre></div>
</div>
<p>In the case of a failed query or query with zero results, <a class="reference internal" href="mapscript-api/stub/mapscript.layerObj.html#mapscript.layerObj.getResults" title="mapscript.layerObj.getResults"><code class="xref py py-func docutils literal notranslate"><span class="pre">layerObj.getResults()</span></code></a>
returns NULL.</p>
</section>
<section id="result-set-members">
<h3>Result Set Members<a class="headerlink" href="#result-set-members" title="Link to this heading">¶</a></h3>
<p>Individual members of the query results are obtained like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">results</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">numresults</span><span class="p">):</span>       <span class="c1"># iterate over results</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">getResult</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</pre></div>
</div>
<p>This <a class="reference internal" href="mapscript-api/stub/mapscript.resultObj.html#mapscript.resultObj" title="mapscript.resultObj"><code class="xref py py-class docutils literal notranslate"><span class="pre">mapscript.resultObj</span></code></a> is a handle, of sorts, for a feature of the layer,
having <code class="xref py py-attr docutils literal notranslate"><span class="pre">resultObj.shapeindex</span></code> and <code class="xref py py-attr docutils literal notranslate"><span class="pre">resultObj.tileindex</span></code> attributes that can be used as
arguments to <a class="reference internal" href="mapscript-api/stub/mapscript.layerObj.html#mapscript.layerObj.getShape" title="mapscript.layerObj.getShape"><code class="xref py py-func docutils literal notranslate"><span class="pre">layerObj.getShape()</span></code></a>.</p>
</section>
<section id="resulting-features">
<h3>Resulting Features<a class="headerlink" href="#resulting-features" title="Link to this heading">¶</a></h3>
<p>The previous example code can now be extended to the case of obtaining all
queried features:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">layer</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="s2">&quot;FAKE&quot;</span>
<span class="n">layer</span><span class="o">.</span><span class="n">queryByAttributes</span><span class="p">(</span><span class="n">test_map</span><span class="p">,</span> <span class="s2">&quot;FID&quot;</span><span class="p">,</span> <span class="s1">&#39;&quot;1&quot;&#39;</span><span class="p">,</span> <span class="n">mapscript</span><span class="o">.</span><span class="n">MS_MULTIPLE</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">getResults</span><span class="p">()</span>

<span class="k">if</span> <span class="n">results</span><span class="p">:</span>
    <span class="c1"># open layer in preparation of reading shapes</span>
    <span class="n">layer</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">numresults</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">getResult</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">getShape</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="c1"># get the value of the attribute at index 1</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">shape</span><span class="o">.</span><span class="n">getValue</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

    <span class="c1"># close when done</span>
    <span class="n">layer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="attribute-queries">
<h2><a class="toc-backref" href="#contents" role="doc-backlink">Attribute Queries</a><a class="headerlink" href="#attribute-queries" title="Link to this heading">¶</a></h2>
<section id="by-attributes">
<h3>By Attributes<a class="headerlink" href="#by-attributes" title="Link to this heading">¶</a></h3>
<p>Use <a class="reference internal" href="mapscript-api/stub/mapscript.layerObj.html#mapscript.layerObj.queryByAttributes" title="mapscript.layerObj.queryByAttributes"><code class="xref py py-func docutils literal notranslate"><span class="pre">layerObj.queryByAttributes()</span></code></a> for querying by attribute. Note attributes
are strings.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># select by feature Id</span>
<span class="n">layer</span><span class="o">.</span><span class="n">queryByAttributes</span><span class="p">(</span><span class="n">test_map</span><span class="p">,</span> <span class="s2">&quot;FID&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="n">mapscript</span><span class="o">.</span><span class="n">MS_MULTIPLE</span><span class="p">)</span>

<span class="c1"># select by a string attribute, returning a single result</span>
<span class="n">layer</span><span class="o">.</span><span class="n">queryByAttributes</span><span class="p">(</span><span class="n">test_map</span><span class="p">,</span> <span class="s2">&quot;FNAME&quot;</span><span class="p">,</span> <span class="s2">&quot;A Polygon&quot;</span><span class="p">,</span> <span class="n">mapscript</span><span class="o">.</span><span class="n">MS_SINGLE</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="spatial-queries">
<h2><a class="toc-backref" href="#contents" role="doc-backlink">Spatial Queries</a><a class="headerlink" href="#spatial-queries" title="Link to this heading">¶</a></h2>
<section id="by-rectangle">
<h3>By Rectangle<a class="headerlink" href="#by-rectangle" title="Link to this heading">¶</a></h3>
<p>Use <a class="reference internal" href="mapscript-api/stub/mapscript.layerObj.html#mapscript.layerObj.queryByRect" title="mapscript.layerObj.queryByRect"><code class="xref py py-func docutils literal notranslate"><span class="pre">layerObj.queryByRect()</span></code></a> for querying using a bounding-box. <a class="reference internal" href="mapscript-api/index.html#mapscript.MS_MULTIPLE" title="mapscript.MS_MULTIPLE"><code class="xref py py-data docutils literal notranslate"><span class="pre">MS_MULTIPLE</span></code></a> is set
by default.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">qrect</span> <span class="o">=</span> <span class="n">mapscript</span><span class="o">.</span><span class="n">rectObj</span><span class="p">(</span><span class="o">-</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">45.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">55.0</span><span class="p">)</span>
<span class="n">layer</span><span class="o">.</span><span class="n">queryByRect</span><span class="p">(</span><span class="n">test_map</span><span class="p">,</span> <span class="n">qrect</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="by-point">
<h3>By Point<a class="headerlink" href="#by-point" title="Link to this heading">¶</a></h3>
<p>Use <a class="reference internal" href="mapscript-api/stub/mapscript.layerObj.html#mapscript.layerObj.queryByPoint" title="mapscript.layerObj.queryByPoint"><code class="xref py py-func docutils literal notranslate"><span class="pre">layerObj.queryByPoint()</span></code></a> for querying using a point. The point can also be
buffered.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">qpoint</span> <span class="o">=</span> <span class="n">mapscript</span><span class="o">.</span><span class="n">pointObj</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">51.5</span><span class="p">)</span>
<span class="n">layer</span><span class="o">.</span><span class="n">queryByPoint</span><span class="p">(</span><span class="n">test_map</span><span class="p">,</span> <span class="n">qpoint</span><span class="p">,</span> <span class="n">mapscript</span><span class="o">.</span><span class="n">MS_MULTIPLE</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="by-shape">
<h3>By Shape<a class="headerlink" href="#by-shape" title="Link to this heading">¶</a></h3>
<p>Use <a class="reference internal" href="mapscript-api/stub/mapscript.layerObj.html#mapscript.layerObj.queryByShape" title="mapscript.layerObj.queryByShape"><code class="xref py py-func docutils literal notranslate"><span class="pre">layerObj.queryByShape()</span></code></a> for querying using a shape.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">qrect</span> <span class="o">=</span> <span class="n">mapscript</span><span class="o">.</span><span class="n">rectObj</span><span class="p">(</span><span class="o">-</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">45.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">55.0</span><span class="p">)</span>
<span class="n">qshape</span> <span class="o">=</span> <span class="n">qrect</span><span class="o">.</span><span class="n">toPolygon</span><span class="p">()</span>
<span class="bp">self</span><span class="o">.</span><span class="n">layer</span><span class="o">.</span><span class="n">queryByShape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">,</span> <span class="n">qshape</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="by-selection">
<h3>By Selection<a class="headerlink" href="#by-selection" title="Link to this heading">¶</a></h3>
<p>Use <a class="reference internal" href="mapscript-api/stub/mapscript.layerObj.html#mapscript.layerObj.queryByFeatures" title="mapscript.layerObj.queryByFeatures"><code class="xref py py-func docutils literal notranslate"><span class="pre">layerObj.queryByFeatures()</span></code></a> for querying using results from another layer.</p>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p>
<a href="../about.html" title="About">About</a><br>
<a href="../products.html" title="Products">Products</a><br>
<a href="../community/index.html" title="Community">Community</a><br>
<a href="../development/index.html" title="Development">Development</a><br>
<a href="../download.html" title="Downloads">Downloads</a><br>
<a href="../documentation.html" title="Documentation">Documentation</a><br>
<a href="../faq.html" title="FAQ">FAQ</a><br>
<a href="../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</h3>
  <ul>
<li><a class="reference internal" href="#">Querying</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a><ul>
<li><a class="reference internal" href="#the-query-result-set">The Query Result Set</a></li>
<li><a class="reference internal" href="#result-set-members">Result Set Members</a></li>
<li><a class="reference internal" href="#resulting-features">Resulting Features</a></li>
</ul>
</li>
<li><a class="reference internal" href="#attribute-queries">Attribute Queries</a><ul>
<li><a class="reference internal" href="#by-attributes">By Attributes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#spatial-queries">Spatial Queries</a><ul>
<li><a class="reference internal" href="#by-rectangle">By Rectangle</a></li>
<li><a class="reference internal" href="#by-point">By Point</a></li>
<li><a class="reference internal" href="#by-shape">By Shape</a></li>
<li><a class="reference internal" href="#by-selection">By Selection</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../mapcache/index.html" title="MapCache 1.14.0"
             >next</a> |</li>
        <li class="right" >
          <a href="mapfile.html" title="Mapfile Manipulation"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../documentation.html" >MapServer 8.0.1 Documentation</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >MapScript</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Querying</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; <a href="../copyright.html">Copyright</a> 2023, Open Source Geospatial Foundation.
      Last updated on 2023-12-22.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.5.
    </div>
  </body>
</html>