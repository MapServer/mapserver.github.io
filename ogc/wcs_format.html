<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>WCS Use Cases &#8212; MapServer 8.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx.css?v=6c7b17ac" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=dd298242" />
    <link rel="stylesheet" type="text/css" href="../_static/ribbon.css?v=ea091bf4" />
    
    <script src="../_static/documentation_options.js?v=521b6f53"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="icon" href="../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="next" title="SOS Server" href="sos_server.html" />
    <link rel="prev" title="WCS Server" href="wcs_server.html" /> 
  </head><body>


<!-- for main branch only, do not backport this -->

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../index.html" title="Home"><img src="../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../index.html" title="Home">Home</a> |
      <a href="../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter" target="_blank">Twitter</a> |
      <a href="../download.html" title="Download Source or Binaries">Download </a> |
      <a class="badge" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=KRJ2X44N3HA6U&source=url" target="_blank">
        <img src="https://img.shields.io/badge/donate-%E2%9D%A4%C2%A0-ff69b4.svg?style=flat" alt="Donate to MapServer">
      </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../ar/ogc/wcs_format.html"><img src="../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../de/ogc/wcs_format.html"><img src="../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../el/ogc/wcs_format.html"><img src="../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../es/ogc/wcs_format.html"><img src="../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../fr/ogc/wcs_format.html"><img src="../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../id/ogc/wcs_format.html"><img src="../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../it/ogc/wcs_format.html"><img src="../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../ja/ogc/wcs_format.html"><img src="../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../nl_NL/ogc/wcs_format.html"><img src="../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../pl/ogc/wcs_format.html"><img src="../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../ru/ogc/wcs_format.html"><img src="../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../sq/ogc/wcs_format.html"><img src="../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../tr/ogc/wcs_format.html"><img src="../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="sos_server.html" title="SOS Server"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="wcs_server.html" title="WCS Server"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../documentation.html" >MapServer 8.0.1 Documentation</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">OGC Support and Configuration</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">WCS Use Cases</a></li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="wcs-use-cases">
<span id="wcs-format"></span><span id="index-0"></span><h1><a class="toc-backref" href="#contents" role="doc-backlink">WCS Use Cases</a><a class="headerlink" href="#wcs-use-cases" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Author<span class="colon">:</span></dt>
<dd class="field-odd"><p>Norman Barker</p>
</dd>
<dt class="field-even">Contact<span class="colon">:</span></dt>
<dd class="field-even"><p>nbarker at ittvis.com</p>
</dd>
<dt class="field-odd">Author<span class="colon">:</span></dt>
<dd class="field-odd"><p>Gail Millin</p>
</dd>
<dt class="field-even">Contact<span class="colon">:</span></dt>
<dd class="field-even"><p>nbarker at ittvis.com</p>
</dd>
<dt class="field-odd">Last Updated<span class="colon">:</span></dt>
<dd class="field-odd"><p>2019-11-21</p>
</dd>
</dl>
<nav class="contents" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#wcs-use-cases" id="id1">WCS Use Cases</a></p>
<ul>
<li><p><a class="reference internal" href="#landsat" id="id2">Landsat</a></p></li>
<li><p><a class="reference internal" href="#spot" id="id3">SPOT</a></p></li>
<li><p><a class="reference internal" href="#dem" id="id4">DEM</a></p></li>
<li><p><a class="reference internal" href="#netcdf" id="id5">NetCDF</a></p></li>
<li><p><a class="reference internal" href="#grib2-output-format" id="id6">GRIB2 output format</a></p></li>
</ul>
</li>
</ul>
</nav>
<p>This document explains how to use MapServer to deliver Landsat, SPOT, DEM, and
NetCDF temporal/banded data through the MapServer WCS interface. Thanks go to
Steve Lime and Frank Warmerdam for their assistance with these projects</p>
<p>It also shows how to configure MapServer for GRIB2 output format.</p>
<section id="landsat">
<h2><a class="toc-backref" href="#contents" role="doc-backlink">Landsat</a><a class="headerlink" href="#landsat" title="Link to this heading">¶</a></h2>
<p>To serve Landsat imagery through the MapServer Web Coverage Service specify
the <a class="reference internal" href="../mapfile/outputformat.html#outputformat"><span class="std std-ref">OUTPUTFORMAT</span></a> object. For format support install the GDAL library
and from the command prompt and cd to where GDAL is installed and use the
command, gdalinfo –formats. A list of all supported formats will appear and
will specify if the format is read only <strong>&lt;ro&gt;</strong> or read and write <strong>&lt;rw&gt;</strong>
for WCS the format needs to be supported for read and write (except for
<em>GDAL’s</em> own WCS format, however).</p>
<p>For the example below the Landsat 7 15m resolution mosaic is in a Enhanced
Compressed Wavelets format (ECW). By running the gdalinfo.exe program I could
verify that the ECW format has write permissions, therefore the format can be
specified in the MapFile and requested using the GetCoverage request.</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">OUTPUTFORMAT</span>
    <span class="k">NAME</span> <span class="s">&quot;ECW&quot;</span>
    <span class="k">DRIVER</span> <span class="s">&quot;GDAL/ECW&quot;</span>
    <span class="k">MIMETYPE</span> <span class="s">&quot;image/ecw&quot;</span>
    <span class="k">IMAGEMODE</span> <span class="s">&quot;BYTE&quot;</span>
    <span class="k">EXTENSION</span> <span class="s">&quot;ecw&quot;</span>
<span class="k">END</span>
</pre></div>
</div>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">LAYER</span>
    <span class="k">NAME</span> <span class="s">&quot;Landsat7&quot;</span>
    <span class="k">STATUS</span> <span class="nb">OFF</span>
    <span class="k">TYPE</span> <span class="nb">RASTER</span>
    <span class="k">PROCESSING</span> <span class="s">&quot;SCALE=AUTO&quot;</span>
    <span class="k">UNITS</span> <span class="nb">Meters</span>
    <span class="k">TILEINDEX</span> <span class="s">&quot;MapServer/wcs/landsat7/l7mosaic15m.shp&quot;</span>
    <span class="k">TILEITEM</span> <span class="s">&quot;Location&quot;</span>
    <span class="k">METADATA</span>
      <span class="s">&quot;wcs_description&quot;</span> <span class="s">&quot;Landsat 7 15m resolution mosaic&quot;</span>
      <span class="s">&quot;wcs_name&quot;</span> <span class="s">&quot;Landsat7&quot;</span>
      <span class="s">&quot;wcs_label&quot;</span> <span class="s">&quot;Landsat 7 15m resolution mosaic&quot;</span>
      <span class="s">&quot;ows_srs&quot;</span> <span class="s">&quot;EPSG:27700&quot;</span>
      <span class="s">&quot;ows_extent&quot;</span> <span class="s">&quot;0 0 700005 1050000&quot;</span>
      <span class="s">&quot;wcs_resolution&quot;</span> <span class="s">&quot;75 75&quot;</span>
      <span class="s">&quot;wcs_bandcount&quot;</span> <span class="s">&quot;3&quot;</span>
      <span class="s">&quot;wcs_formats&quot;</span> <span class="s">&quot;ECW&quot;</span>
      <span class="s">&quot;wcs_enable_request&quot;</span> <span class="s">&quot;*&quot;</span>
    <span class="k">END</span>
 <span class="k">END</span>
</pre></div>
</div>
<p>A GetCoverage request can then be requested (using the parameters set in the
MapFile) by creating a URL with the elements: - Your Server, MapServer
Program, Location of MapFile, Type of Service (WCS), Request (GetCoverage),
Coverage (Landsat7), BBOX (0,0,700005,1050000), CRS (EPSG:27700), ResX (75)
ResY (75), Format (ECW).</p>
</section>
<section id="spot">
<h2><a class="toc-backref" href="#contents" role="doc-backlink">SPOT</a><a class="headerlink" href="#spot" title="Link to this heading">¶</a></h2>
<p>SPOT imagery can be delivered through MapServer Web Coverage Service similarly
to the Landsat example above. The main difference is that as SPOT is a
greyscale image the wcs_bandcount = 1 rather than a Landsat image which
consists of 3 bands. For this example the well known GeoTiff format will be
used to demonstrate what to specify in a MapFile for SPOT data.</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">OUTPUTFORMAT</span>
    <span class="k">NAME</span> <span class="s">&quot;GEOTIFF&quot;</span>
    <span class="k">DRIVER</span> <span class="s">&quot;GDAL/GTiff&quot;</span>
    <span class="k">MIMETYPE</span> <span class="s">&quot;image/tiff&quot;</span>
    <span class="k">IMAGEMODE</span> <span class="s">&quot;BYTE&quot;</span>
    <span class="k">EXTENSION</span> <span class="s">&quot;tif&quot;</span>
<span class="k">END</span>
<span class="k">LAYER</span>
    <span class="k">NAME</span> <span class="s">&quot;SPOT&quot;</span>
    <span class="k">STATUS</span> <span class="nb">OFF</span>
    <span class="k">TYPE</span> <span class="nb">RASTER</span>
    <span class="k">PROCESSING</span> <span class="s">&quot;SCALE=AUTO&quot;</span>
    <span class="k">UNITS</span> <span class="nb">Meters</span>
    <span class="k">TILEINDEX</span> <span class="s">&quot;MapServer/wcs/orthospot/spot.shp&quot;</span>
    <span class="k">TILEITEM</span> <span class="s">&quot;Location&quot;</span>
    <span class="k">METADATA</span>
      <span class="s">&quot;wcs_description&quot;</span> <span class="s">&quot;Orthospot mosaic&quot;</span>
      <span class="s">&quot;wcs_name&quot;</span> <span class="s">&quot;SPOT&quot;</span>
      <span class="s">&quot;wcs_label&quot;</span> <span class="s">&quot;Orthospot mosaic&quot;</span>
      <span class="s">&quot;ows_srs&quot;</span> <span class="s">&quot;EPSG:27700&quot;</span>
      <span class="s">&quot;ows_extent&quot;</span> <span class="s">&quot;375960 64480 497410 200590&quot;</span>
      <span class="s">&quot;wcs_resolution&quot;</span> <span class="s">&quot;100 100&quot;</span>
      <span class="s">&quot;wcs_bandcount&quot;</span> <span class="s">&quot;1&quot;</span>
      <span class="s">&quot;wcs_formats&quot;</span> <span class="s">&quot;GEOTIFF&quot;</span>
      <span class="s">&quot;wcs_nativeformat&quot;</span> <span class="s">&quot;8-bit GeoTIF&quot;</span>
      <span class="s">&quot;wcs_enable_request&quot;</span> <span class="s">&quot;*&quot;</span>
    <span class="k">END</span>
<span class="k">END</span>
</pre></div>
</div>
<p>The key parameters to specify in the WCS MapFile for any data layer and format
are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">Layer</span> <span class="n">Name</span> <span class="o">=</span> <span class="n">Create</span> <span class="n">a</span> <span class="n">short</span> <span class="n">name</span> <span class="k">for</span> <span class="n">the</span> <span class="n">data</span>
<span class="o">-</span> <span class="n">Layer</span> <span class="n">Type</span> <span class="o">=</span> <span class="n">Raster</span>
</pre></div>
</div>
<p>The following examples further demonstrate how WCS can be implemented and also
how to create WCS containing layers with a temporal dimension (see NetCDF
example).</p>
</section>
<section id="dem">
<h2><a class="toc-backref" href="#contents" role="doc-backlink">DEM</a><a class="headerlink" href="#dem" title="Link to this heading">¶</a></h2>
<p>It is possible to deliver 16 bit DEM data through the MapServer Web Coverage
Service.</p>
<p>Firstly it is necessary to specify the output format in the map file</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">OUTPUTFORMAT</span>
  <span class="k">NAME</span> <span class="s">&quot;GEOTIFFINT16&quot;</span>
  <span class="k">DRIVER</span> <span class="s">&quot;GDAL/GTiff&quot;</span>
  <span class="k">MIMETYPE</span> <span class="s">&quot;image/tiff&quot;</span>
  <span class="k">IMAGEMODE</span> <span class="s">&quot;INT16&quot;</span>
  <span class="k">EXTENSION</span> <span class="s">&quot;tif&quot;</span>
<span class="k">END</span>
</pre></div>
</div>
<p>and the corresponding layer</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">LAYER</span>
  <span class="k">NAME</span> <span class="s">&quot;srtm&quot;</span>
  <span class="k">STATUS</span> <span class="nb">OFF</span>
  <span class="k">TYPE</span> <span class="nb">RASTER</span>
  <span class="k">DATA</span> <span class="s">&quot;srtm.tif&quot;</span>
  <span class="k">PROJECTION</span>
    <span class="s">&quot;init=epsg:4326&quot;</span>
  <span class="k">END</span>
  <span class="k">METADATA</span>
    <span class="s">&quot;wcs_label&quot;</span> <span class="s">&quot;SRTM WCS TIF Server&quot;</span>
    <span class="s">&quot;ows_extent&quot;</span> <span class="s">&quot;-180 -90 180 90&quot;</span>
    <span class="s">&quot;wcs_resolution&quot;</span> <span class="s">&quot;0.00083 -0.00083&quot;</span>
    <span class="s">&quot;ows_srs&quot;</span> <span class="s">&quot;EPSG:4326&quot;</span>
    <span class="s">&quot;wcs_formats&quot;</span> <span class="s">&quot;GEOTIFFINT16&quot;</span>
    <span class="s">&quot;wcs_nativeformat&quot;</span> <span class="s">&quot;geotiff&quot;</span>
    <span class="s">&quot;wcs_enable_request&quot;</span> <span class="s">&quot;*&quot;</span>
  <span class="k">END</span>
<span class="k">END</span>
</pre></div>
</div>
<p>Performance gains can be made by using the gdaladdo utility described at
<a class="reference external" href="https://gdal.org/programs/gdaladdo.html">https://gdal.org/programs/gdaladdo.html</a></p>
</section>
<section id="netcdf">
<h2><a class="toc-backref" href="#contents" role="doc-backlink">NetCDF</a><a class="headerlink" href="#netcdf" title="Link to this heading">¶</a></h2>
<p>Firstly GDAL doesn’t support all versions of netCDF (there are a lot, it is a
generic format), so for stability it may be necessary to convert the files
into GeoTiff format first. This can be achieved using the netCDF libraries
here <a class="reference external" href="https://www.unidata.ucar.edu/software/netcdf/">https://www.unidata.ucar.edu/software/netcdf/</a>. Denis
Nadeau and Frank Warmerdam have added netCDF CF as a read only format within
GDAL, so it now possible to read the CF convention netCDF files directly from
disk.</p>
<p>We placed the Z-levels in the bands of the GDAL data file (either GeoTiff or
netCDF), and created a shape index for the time levels. GDAL data is a 2-D
format (x,y) and bands. netCDF is an N-D file format, supporting time, x,y,z,
and experiment parameters. By using a set of GDAL netCDF / geoTiff files it is
possible to represent this, and to store the z-level (height) as bands within
the data file. Although a hack, it is possible for a custom client to receive
important metadata from the describeCoverage operation of a WCS about the
which z-level a band of a geotiff represents by encoding this in the returned
axes description tag.</p>
<p>To create the shape file for the temporal dimension we had to do some hacking
with Java code, but we also got it to work with Steve Lime’ s perl script in
the MODIS MapServer demo download (which doesn’t seem to be available now).</p>
<p>The perl script used in Modis demo by Steve Lime is as follows, and I have
placed inline comments below. The script assumes that gdaltindex has already
been run in this directory to create a tile index shape and dbf file. It
assumes that the filenames of your data files have the date in the filename,
for example myfileYYYYMMDDHH.tif</p>
<div class="highlight-perl notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="w">  </span><span class="c1">#!/usr/bin/perl</span>
<span class="linenos"> 2</span><span class="w">  </span><span class="k">use</span><span class="w"> </span><span class="nn">XBase</span><span class="p">;</span>
<span class="linenos"> 3</span><span class="w">  </span><span class="nb">opendir</span><span class="p">(</span><span class="n">DIR</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;.&#39;</span><span class="p">);</span><span class="w"> </span><span class="c1"># open the current directory</span>
<span class="linenos"> 4</span><span class="w">  </span><span class="k">foreach</span><span class="w"> </span><span class="nv">$file</span><span class="w"> </span><span class="p">(</span><span class="nb">readdir</span><span class="p">(</span><span class="n">DIR</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 5</span><span class="w">    </span><span class="k">next</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="o">!</span><span class="p">(</span><span class="nv">$file</span><span class="w"> </span><span class="o">=~</span><span class="sr"> /\.dbf$/</span><span class="p">);</span><span class="w"> </span><span class="c1"># read the dbf file in this directory created by gdaltindex</span>
<span class="linenos"> 6</span><span class="w">    </span><span class="k">print</span><span class="w"> </span><span class="s">&quot;Working on $file...\n&quot;</span><span class="p">;</span>
<span class="linenos"> 7</span><span class="w">    </span><span class="nv">$tfile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;temporary.dbf&#39;</span><span class="p">;</span>
<span class="linenos"> 8</span><span class="w">    </span><span class="nb">system</span><span class="p">(</span><span class="s">&quot;mv $file $tfile&quot;</span><span class="p">);</span>
<span class="linenos"> 9</span><span class="w">    </span><span class="nv">$oldtable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XBase</span><span class="w"> </span><span class="nv">$tfile</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="nb">die</span><span class="w"> </span><span class="nn">XBase</span><span class="o">-&gt;</span><span class="n">errstr</span><span class="p">;</span>
<span class="linenos">10</span><span class="w">    </span><span class="k">print</span><span class="w"> </span><span class="nb">join</span><span class="p">(</span><span class="s">&quot;\t&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">$oldtable</span><span class="o">-&gt;</span><span class="n">field_names</span><span class="p">)</span><span class="w"> </span><span class="o">.</span><span class="s">&quot;\n&quot;</span><span class="p">;</span>
<span class="linenos">11</span><span class="w">    </span><span class="k">print</span><span class="w"> </span><span class="nb">join</span><span class="p">(</span><span class="s">&quot;\t&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">$oldtable</span><span class="o">-&gt;</span><span class="n">field_types</span><span class="p">)</span><span class="w"> </span><span class="o">.</span><span class="s">&quot;\n&quot;</span><span class="p">;</span>
<span class="linenos">12</span><span class="w">    </span><span class="k">print</span><span class="w"> </span><span class="nb">join</span><span class="p">(</span><span class="s">&quot;\t&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">$oldtable</span><span class="o">-&gt;</span><span class="n">field_lengths</span><span class="p">)</span><span class="w"> </span><span class="o">.</span><span class="s">&quot;\n&quot;</span><span class="p">;</span>
<span class="linenos">13</span><span class="w">    </span><span class="k">print</span><span class="w"> </span><span class="nb">join</span><span class="p">(</span><span class="s">&quot;\t&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">$oldtable</span><span class="o">-&gt;</span><span class="n">field_decimals</span><span class="p">)</span><span class="w"> </span><span class="o">.</span><span class="s">&quot;\n&quot;</span><span class="p">;</span>
<span class="linenos">14</span><span class="w">    </span><span class="nv">$newtable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nn">XBase</span><span class="o">-&gt;</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nv">$file</span><span class="p">,</span>
<span class="linenos">15</span><span class="w">                  </span><span class="s">&quot;field_names&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">[</span><span class="nv">$oldtable</span><span class="o">-&gt;</span><span class="n">field_names</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;IMGDATE&quot;</span><span class="p">],</span><span class="w">  </span><span class="c1"># this is the FILTERITEM in the corresponding tile index layer within your mapfile</span>
<span class="linenos">16</span><span class="w">                  </span><span class="s">&quot;field_types&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">[</span><span class="nv">$oldtable</span><span class="o">-&gt;</span><span class="n">field_types</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;C&quot;</span><span class="p">],</span><span class="w">  </span><span class="c1"># character column type</span>
<span class="linenos">17</span><span class="w">                  </span><span class="s">&quot;field_lengths&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">[</span><span class="nv">$oldtable</span><span class="o">-&gt;</span><span class="n">field_lengths</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="p">],</span><span class="w"> </span><span class="c1"># length of the date string</span>
<span class="linenos">18</span><span class="w">                  </span><span class="s">&quot;field_decimals&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">[</span><span class="nv">$oldtable</span><span class="o">-&gt;</span><span class="n">field_decimals</span><span class="p">,</span><span class="w"> </span><span class="nb">undef</span><span class="p">])</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="nb">die</span><span class="w"> </span><span class="s">&quot;Error creating new table.&quot;</span><span class="p">;</span>
<span class="linenos">19</span><span class="w">    </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">$oldtable</span><span class="o">-&gt;</span><span class="n">last_record</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">20</span><span class="w">    </span><span class="p">(</span><span class="nv">$deleted</span><span class="p">,</span><span class="w"> </span><span class="nv">@data</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$oldtable</span><span class="o">-&gt;</span><span class="n">get_record</span><span class="p">(</span><span class="nv">$_</span><span class="p">);</span>
<span class="linenos">21</span><span class="w">    </span><span class="k">print</span><span class="w"> </span><span class="s">&quot;  ...record $data[0]\n&quot;</span><span class="p">;</span>
<span class="linenos">22</span><span class="w">        </span><span class="c1"># extract the date</span>
<span class="linenos">23</span><span class="w">        </span><span class="nv">$year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">substr</span><span class="w"> </span><span class="nv">$data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w">  </span><span class="c1"># year  is at position 8 in the filename string</span>
<span class="linenos">24</span><span class="w">        </span><span class="nv">$month</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">substr</span><span class="w"> </span><span class="nv">$data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w">  </span><span class="c1"># month is at position 12 in the filename string</span>
<span class="linenos">25</span><span class="w">        </span><span class="nv">$day</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">substr</span><span class="w"> </span><span class="nv">$data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="mi">14</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="c1"># day is at position 14 in the filename string</span>
<span class="linenos">26</span><span class="w">        </span><span class="nv">$hour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">substr</span><span class="w"> </span><span class="nv">$data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w">  </span><span class="c1"># hour is at position 16 in the filename string</span>
<span class="linenos">27</span><span class="w">        </span><span class="nv">$date</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="s">&quot;$year-$month-$day&quot;</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="s">&quot;T&quot;</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="s">&quot;$hour\n&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1"># format is YYYY-MM-DDTHH, or any ISO format</span>
<span class="linenos">28</span><span class="w">     </span><span class="k">print</span><span class="w"> </span><span class="s">&quot;$date&quot;</span><span class="p">;</span>
<span class="linenos">29</span><span class="w">        </span><span class="nb">push</span><span class="w"> </span><span class="nv">@data</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;$date&quot;</span><span class="p">;</span>
<span class="linenos">30</span><span class="w">    </span><span class="nv">$newtable</span><span class="o">-&gt;</span><span class="n">set_record</span><span class="p">(</span><span class="nv">$_</span><span class="p">,</span><span class="w"> </span><span class="nv">@data</span><span class="p">);</span>
<span class="linenos">31</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">32</span><span class="w">    </span><span class="nv">$newtable</span><span class="o">-&gt;</span><span class="nb">close</span><span class="p">();</span>
<span class="linenos">33</span><span class="w">    </span><span class="nv">$oldtable</span><span class="o">-&gt;</span><span class="nb">close</span><span class="p">();</span>
<span class="linenos">34</span><span class="w">    </span><span class="nb">unlink</span><span class="p">(</span><span class="nv">$tfile</span><span class="p">);</span>
<span class="linenos">35</span><span class="w">  </span><span class="p">}</span>
</pre></div>
</div>
<p>If have used the perl script then skip to the layer definitions below, if you
wish to code your own the description is here.</p>
<p>The DBF file has to have the column ‘location’ that indicates the location of
the data file (either absolute path or relative to the map file location, and
the second column that can be called whatever you want but indexes time. In
our case we called it ‘time’ :-)</p>
<p>The corresponding shapefile then has to contain Polygons with the bounding
boxes of the tif file for each time. So OGRInfo timeIndex.shp looks something
like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">OGRFeature</span><span class="p">(</span><span class="n">timeIndex</span><span class="p">):</span><span class="mi">116</span>
  <span class="n">location</span><span class="p">(</span><span class="n">String</span><span class="p">)</span> <span class="o">=</span> <span class="n">mytime</span><span class="o">.</span><span class="n">tif</span>
  <span class="n">time</span><span class="p">(</span><span class="n">String</span><span class="p">)</span> <span class="o">=</span> <span class="mi">2001</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">31</span><span class="n">T18</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>
  <span class="n">POLYGON</span> <span class="p">((</span><span class="n">xxx</span><span class="p">,</span><span class="n">xxxx</span><span class="p">,</span><span class="o">.......</span><span class="p">))</span>
</pre></div>
</div>
<p>Define your output format as</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">OUTPUTFORMAT</span>
  <span class="k">NAME</span> <span class="s">&quot;GEOTIFF_FLOAT&quot;</span>
  <span class="k">DRIVER</span> <span class="s">&#39;GDAL/GTiff&#39;</span>
  <span class="k">MIMETYPE</span> <span class="s">&#39;image/tiff&#39;</span>
  <span class="k">IMAGEMODE</span> <span class="nb">FLOAT32</span>
  <span class="k">EXTENSION</span> <span class="s">&#39;tif&#39;</span>
<span class="k">END</span>
</pre></div>
</div>
<p>Then you need to define your tile index within the map file</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">LAYER</span>
  <span class="k">NAME</span> <span class="s">&#39;time_idx&#39;</span>
  <span class="k">TYPE</span> <span class="k">TILEINDEX</span>
  <span class="k">DATA</span> <span class="s">&#39;timeIndex&#39;</span>
  <span class="k">FILTERITEM</span> <span class="s">&#39;time&#39;</span>
  <span class="k">FILTER</span> <span class="s">&#39;%time%&#39;</span>
<span class="k">END</span>
</pre></div>
</div>
<p>and the actual layer</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">LAYER</span>
  <span class="k">NAME</span> <span class="s">&#39;TempData&#39;</span>
  <span class="k">STATUS</span> <span class="nb">OFF</span>
  <span class="k">TYPE</span> <span class="nb">RASTER</span>
  <span class="k">TILEINDEX</span> <span class="s">&#39;time_idx&#39;</span>
  <span class="k">PROJECTION</span>
    <span class="s">&quot;init=epsg:4326&quot;</span>
  <span class="k">END</span>
  <span class="k">METADATA</span>
    <span class="s">&quot;wcs_label&quot;</span> <span class="s">&#39;Temperature data&#39;</span>
    <span class="s">&quot;ows_extent&quot;</span> <span class="s">&#39;-180 -90 180 90&#39;</span>
    <span class="s">&quot;wcs_resolution&quot;</span> <span class="s">&#39;1.125 -1.125&#39;</span>
    <span class="s">&quot;ows_srs&quot;</span> <span class="s">&#39;EPSG:4326&#39;</span>
    <span class="s">&quot;wcs_formats&quot;</span> <span class="s">&#39;GEOTIFF_FLOAT&#39;</span>
    <span class="s">&quot;wcs_nativeformat&quot;</span> <span class="s">&#39;netCDF&#39;</span>
    <span class="s">&quot;wcs_bandcount&quot;</span> <span class="s">&#39;27&#39;</span>
    <span class="s">&quot;wcs_rangeset_axes&quot;</span> <span class="s">&#39;bands&#39;</span>
    <span class="s">&quot;wcs_rangeset_label&quot;</span> <span class="s">&#39;Pressure (hPa units) Levels&#39;</span>
    <span class="s">&quot;wcs_rangeset_name&quot;</span> <span class="s">&#39;bands&#39;</span>
    <span class="s">&quot;wcs_rangeset_description&quot;</span> <span class="s">&#39;Z levels &#39;</span>
    <span class="s">&quot;wcs_timeposition&quot;</span> <span class="s">&#39;2001-01-01T06:00:00,2001-01-01T12:00:00,2001-01-01T18:00:00,2001-01-02T00:00:00&#39;</span>
    <span class="s">&quot;wcs_timeitem&quot;</span> <span class="s">&#39;time&#39;</span>
    <span class="s">&quot;wcs_enable_request&quot;</span> <span class="s">&quot;*&quot;</span>
  <span class="k">END</span>
<span class="k">END</span>
</pre></div>
</div>
<p>The TempData coverage layer will now let you subset with the &amp;bands=…
&amp;time=… subset parameters!</p>
<p>To do a coordinate reprojection specify in the request &amp;Response_CRS=ESPG:xxxx</p>
<p>When you start doing temporal subsetting with WCS and MapServer you can see
the need for an automatic way of generating map files such as using an XSL
stylesheet!</p>
<p>For a tile-index layer you need to provide the following extra metadata in
order to use it for WCS:</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="s">&quot;OWS_EXTENT&quot;</span> <span class="s">&quot;10050 299950 280050 619650&quot;</span>
<span class="s">&quot;WCS_RESOLUTION&quot;</span> <span class="s">&quot;100 100&quot;</span>
<span class="s">&quot;WCS_SIZE&quot;</span> <span class="s">&quot;2700 3197&quot;</span>
<span class="s">&quot;WCS_BANDCOUNT&quot;</span> <span class="s">&quot;3&quot;</span>
</pre></div>
</div>
<p>If your image has a colortable and only one band, it will come out greyscale
unless you set the IMAGEMODE to PC256 instead of BYTE.</p>
</section>
<section id="grib2-output-format">
<h2><a class="toc-backref" href="#contents" role="doc-backlink">GRIB2 output format</a><a class="headerlink" href="#grib2-output-format" title="Link to this heading">¶</a></h2>
<p>This requires MapServer 7.2.0 for format-specific and layer-specific
creation options mechanism, as well as GDAL 2.3.0 for GRIB2 output support.</p>
<p>Define your output format as</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">OUTPUTFORMAT</span>
    <span class="k">NAME</span> <span class="err">GRIB</span>
    <span class="k">DRIVER</span> <span class="s">&quot;GDAL/GRIB&quot;</span>
    <span class="k">MIMETYPE</span> <span class="s">&quot;application/x-grib2&quot;</span>
    <span class="k">IMAGEMODE</span> <span class="nb">Float32</span>
    <span class="k">EXTENSION</span> <span class="s">&quot;grib2&quot;</span>
    <span class="k">FORMATOPTION</span> <span class="s">&quot;DATA_ENCODING=SIMPLE_PACKING&quot;</span>
<span class="k">END</span>
</pre></div>
</div>
<p>(consult <a class="reference external" href="http://gdal.org/frmt_grib.html">GDAL GRIB driver documentation</a> for more options that can be
provided in FORMATOPTION)</p>
<p>and the actual layer</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">LAYER</span>
    <span class="k">NAME</span> <span class="err">temperatures</span>
    <span class="k">TYPE</span> <span class="nb">raster</span>
    <span class="k">STATUS</span> <span class="nb">ON</span>
    <span class="k">DUMP</span> <span class="nb">TRUE</span>
    <span class="k">DATA</span> <span class="s">&quot;temperatures.tif&quot;</span>

    <span class="k">PROJECTION</span>
        <span class="s">&quot;init=epsg:4326&quot;</span>
    <span class="k">END</span>

    <span class="k">METADATA</span>
        <span class="s">&quot;ows_extent&quot;</span> <span class="s">&quot;-180 -90 180 90&quot;</span>
        <span class="s">&quot;wcs_label&quot;</span> <span class="s">&quot;Test label&quot;</span>
        <span class="s">&quot;ows_srs&quot;</span>   <span class="s">&quot;EPSG:4326&quot;</span>
        <span class="s">&quot;wcs_resolution&quot;</span> <span class="s">&quot;2.4 2.4&quot;</span>
        <span class="s">&quot;wcs_bandcount&quot;</span> <span class="s">&quot;1&quot;</span>
        <span class="s">&quot;wcs_imagemode&quot;</span> <span class="s">&quot;Float32&quot;</span>
        <span class="s">&quot;wcs_formats&quot;</span> <span class="s">&quot;GEOTIFF_FLOAT32 GRIB&quot;</span>
        <span class="s">&quot;wcs_description&quot;</span> <span class="s">&quot;Test description&quot;</span>
        <span class="s">&quot;wcs_metadatalink_href&quot;</span> <span class="s">&quot;http://www.gdal.org/metadata_test_link.html&quot;</span>
        <span class="s">&quot;wcs_keywordlist&quot;</span> <span class="s">&quot;test,mapserver&quot;</span>
        <span class="s">&quot;wcs_abstract&quot;</span> <span class="s">&quot;abstract&quot;</span>

        <span class="c"># GDAL creation options for the GRIB output format</span>
        <span class="c"># In the case where the input DATAset would be a GRIB2 product,</span>
        <span class="c"># those wcs_outputformat_GRIB_creationoption_* keywords are not</span>
        <span class="c"># needed, as being directly taken from the input dataset</span>
        <span class="s">&quot;wcs_outputformat_GRIB_creationoption_DISCIPLINE&quot;</span> <span class="s">&quot;0(Meteorological)&quot;</span>
        <span class="s">&quot;wcs_outputformat_GRIB_creationoption_IDS&quot;</span> <span class="s">&quot;Normally this will never be used given the BAND_1_IDS override&quot;</span>
        <span class="s">&quot;wcs_outputformat_GRIB_creationoption_BAND_1_IDS&quot;</span> <span class="s">&quot;CENTER=54(Montreal) SUBCENTER=0 MASTER_TABLE=4 LOCAL_TABLE=0 SIGNF_REF_TIME=1(Start_of_Forecast) REF_TIME=2017-01-05T00:00:00Z PROD_STATUS=0(Operational) TYPE=2(Analysis_and_forecast)&quot;</span>
        <span class="s">&quot;wcs_outputformat_GRIB_creationoption_PDS_PDTN&quot;</span> <span class="s">&quot;0&quot;</span>
        <span class="s">&quot;wcs_outputformat_GRIB_creationoption_PDS_TEMPLATE_ASSEMBLED_VALUES&quot;</span> <span class="s">&quot;0 0 2 47 47 0 0 1 0 103 0 2 255 -127 -2147483647&quot;</span>

        <span class="c"># WCS 2.0 metadata items</span>
        <span class="s">&quot;wcs_native_format&quot;</span> <span class="s">&quot;application/x-grib2&quot;</span>
        <span class="s">&quot;wcs_band_names&quot;</span> <span class="s">&quot;Temperature_2m&quot;</span>
        <span class="s">&quot;Temperature_2m_band_interpretation&quot;</span> <span class="s">&quot;interp&quot;</span>
        <span class="s">&quot;Temperature_2m_band_uom&quot;</span> <span class="s">&quot;Celcius&quot;</span>
        <span class="s">&quot;Temperature_2m_band_definition&quot;</span>       <span class="s">&quot;Temperature at 2m above ground&quot;</span>
        <span class="s">&quot;Temperature_2m_band_description&quot;</span>      <span class="s">&quot;Temperature at 2m above ground&quot;</span>
        <span class="s">&quot;Temperature_2m_interval&quot;</span> <span class="s">&quot;-100 100&quot;</span>
        <span class="s">&quot;Temperature_2m_significant_figures&quot;</span> <span class="s">&quot;1&quot;</span>

        <span class="c"># WCS 1.x metadata items</span>
        <span class="s">&quot;wcs_nativeformat&quot;</span> <span class="s">&quot;GRIB&quot;</span>
        <span class="s">&quot;wcs_rangeset_axes&quot;</span> <span class="s">&quot;bands&quot;</span>
        <span class="s">&quot;wcs_rangeset_name&quot;</span> <span class="s">&quot;Temperatures&quot;</span>
        <span class="s">&quot;wcs_rangeset_label&quot;</span> <span class="s">&quot;Bands&quot;</span>
        <span class="s">&quot;wcs_rangeset_description&quot;</span> <span class="s">&quot;Temperatures&quot;</span>
    <span class="k">END</span>
<span class="k">END</span>
</pre></div>
</div>
<p>(consult <a class="reference external" href="http://gdal.org/frmt_grib.html">GDAL GRIB driver documentation</a> for more options that can be
provided in ‘wcs_outputformat_GRIB_creationoption_{OPTIONNAME}’)</p>
<p>Credit: Support for per-layer creation options has been funded by Meteorological
Service of Canada.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p>
<a href="../about.html" title="About">About</a><br>
<a href="../products.html" title="Products">Products</a><br>
<a href="../community/index.html" title="Community">Community</a><br>
<a href="../development/index.html" title="Development">Development</a><br>
<a href="../download.html" title="Downloads">Downloads</a><br>
<a href="../documentation.html" title="Documentation">Documentation</a><br>
<a href="../faq.html" title="FAQ">FAQ</a><br>
<a href="../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</h3>
  <ul>
<li><a class="reference internal" href="#">WCS Use Cases</a><ul>
<li><a class="reference internal" href="#landsat">Landsat</a></li>
<li><a class="reference internal" href="#spot">SPOT</a></li>
<li><a class="reference internal" href="#dem">DEM</a></li>
<li><a class="reference internal" href="#netcdf">NetCDF</a></li>
<li><a class="reference internal" href="#grib2-output-format">GRIB2 output format</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="sos_server.html" title="SOS Server"
             >next</a> |</li>
        <li class="right" >
          <a href="wcs_server.html" title="WCS Server"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../documentation.html" >MapServer 8.0.1 Documentation</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >OGC Support and Configuration</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">WCS Use Cases</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; <a href="../copyright.html">Copyright</a> 2023, Open Source Geospatial Foundation.
      Last updated on 2023-12-22.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.5.
    </div>
  </body>
</html>