<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>MapScript Wrappers for WxS Services &#8212; MapServer 8.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx.css?v=6c7b17ac" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=dd298242" />
    <link rel="stylesheet" type="text/css" href="../_static/ribbon.css?v=ea091bf4" />
    
    <script src="../_static/documentation_options.js?v=521b6f53"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="icon" href="../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="next" title="Basemaps" href="../basemaps/index.html" />
    <link rel="prev" title="SOS Server" href="sos_server.html" /> 
  </head><body>


<!-- for main branch only, do not backport this -->

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../index.html" title="Home"><img src="../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../index.html" title="Home">Home</a> |
      <a href="../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter" target="_blank">Twitter</a> |
      <a href="../download.html" title="Download Source or Binaries">Download </a> |
      <a class="badge" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=KRJ2X44N3HA6U&source=url" target="_blank">
        <img src="https://img.shields.io/badge/donate-%E2%9D%A4%C2%A0-ff69b4.svg?style=flat" alt="Donate to MapServer">
      </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../ar/ogc/mapscript.html"><img src="../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../de/ogc/mapscript.html"><img src="../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../el/ogc/mapscript.html"><img src="../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../es/ogc/mapscript.html"><img src="../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../fr/ogc/mapscript.html"><img src="../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../id/ogc/mapscript.html"><img src="../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../it/ogc/mapscript.html"><img src="../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../ja/ogc/mapscript.html"><img src="../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../nl_NL/ogc/mapscript.html"><img src="../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../pl/ogc/mapscript.html"><img src="../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../ru/ogc/mapscript.html"><img src="../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../sq/ogc/mapscript.html"><img src="../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../tr/ogc/mapscript.html"><img src="../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../basemaps/index.html" title="Basemaps"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="sos_server.html" title="SOS Server"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../documentation.html" >MapServer 8.0.1 Documentation</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">OGC Support and Configuration</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MapScript Wrappers for WxS Services</a></li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="mapscript-wrappers-for-wxs-services">
<span id="mapscript-ows"></span><span id="index-0"></span><h1><a class="toc-backref" href="#contents" role="doc-backlink">MapScript Wrappers for WxS Services</a><a class="headerlink" href="#mapscript-wrappers-for-wxs-services" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Author<span class="colon">:</span></dt>
<dd class="field-odd"><p>Frank Warmerdam</p>
</dd>
<dt class="field-even">Contact<span class="colon">:</span></dt>
<dd class="field-even"><p>warmerdam at pobox.com</p>
</dd>
</dl>
<nav class="contents" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#mapscript-wrappers-for-wxs-services" id="id1">MapScript Wrappers for WxS Services</a></p>
<ul>
<li><p><a class="reference internal" href="#introduction" id="id2">Introduction</a></p></li>
<li><p><a class="reference internal" href="#python-examples" id="id3">Python Examples</a></p></li>
<li><p><a class="reference internal" href="#perl-example" id="id4">Perl Example</a></p></li>
<li><p><a class="reference internal" href="#java-example" id="id5">Java Example</a></p></li>
<li><p><a class="reference internal" href="#php-example" id="id6">PHP Example</a></p></li>
<li><p><a class="reference internal" href="#use-in-non-cgi-environments-mod-php-etc" id="id7">Use in Non-CGI Environments (mod_php, etc)</a></p></li>
<li><p><a class="reference internal" href="#post-processing-capabilities" id="id8">Post Processing Capabilities</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="introduction">
<h2><a class="toc-backref" href="#contents" role="doc-backlink">Introduction</a><a class="headerlink" href="#introduction" title="Link to this heading">¶</a></h2>
<p>With the implementation of MapServer <a class="reference internal" href="../development/rfc/ms-rfc-16.html#rfc16"><span class="std std-ref">MS RFC 16: MapScript WxS Services</span></a> in MapServer 4.9, MapScript
now has the ability to invoke MapServer’s ability to execute OGC Web Service
requests such as WMS, WCS, and WFS as well as capturing the results of
processing the requests.</p>
<p>This makes it possible to dynamically configure a map object based on
information in the original request, and to capture the output of processing
requests for further post-processing.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><a class="reference internal" href="../cgi/controls.html#cgi-controls"><span class="std std-ref">MapServer CGI Controls</span></a> and <a class="reference internal" href="../cgi/runsub.html#runsub"><span class="std std-ref">Run-time Substitution</span></a> are <strong>not</strong> applied when using
mapscript WxS wrappers. It is up to the mapscript code you are writing to
apply any mapfile modifications.</p>
</div>
</section>
<section id="python-examples">
<h2><a class="toc-backref" href="#contents" role="doc-backlink">Python Examples</a><a class="headerlink" href="#python-examples" title="Link to this heading">¶</a></h2>
<p>The following trivial example, in Python, demonstrates a script that
internally provides the map name, but otherwise uses normal MapServer
processing.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mapscript</span>

<span class="n">req</span> <span class="o">=</span> <span class="n">mapscript</span><span class="o">.</span><span class="n">OWSRequest</span><span class="p">()</span>
<span class="n">req</span><span class="o">.</span><span class="n">loadParams</span><span class="p">()</span>

<span class="nb">map</span> <span class="o">=</span> <span class="n">mapscript</span><span class="o">.</span><span class="n">mapObj</span><span class="p">(</span> <span class="s1">&#39;/u/www/maps/ukpoly/ukpoly.map&#39;</span> <span class="p">)</span>
<span class="nb">map</span><span class="o">.</span><span class="n">OWSDispatch</span><span class="p">(</span> <span class="n">req</span> <span class="p">)</span>
</pre></div>
</div>
<p>The OWSRequest object is used to manage a parsed list of OWS processing
options.  In the above example they are loaded from the environment using
the loadParams() call which fetches and parses them from QUERY_STRING in the
same way the <a class="reference internal" href="../cgi/mapserv.html#mapserv"><span class="std std-ref">mapserv</span></a> executable would.</p>
<p>Then we load a map, and invoke OWSDispatch with the given arguments on that
map.  By default the results of the dispatched request are written to stdout
which returns them back to the client.</p>
<p>The following example ignores all passed in arguments, and manually constructs
a request argument by argument.  It is likely more useful for testing purposes
than for deploying WxS services, but demonstrates direct manipulation of the
request object.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mapscript</span>

<span class="n">req</span> <span class="o">=</span> <span class="n">mapscript</span><span class="o">.</span><span class="n">OWSRequest</span><span class="p">()</span>
<span class="n">req</span><span class="o">.</span><span class="n">setParameter</span><span class="p">(</span> <span class="s1">&#39;SERVICE&#39;</span><span class="p">,</span> <span class="s1">&#39;WMS&#39;</span> <span class="p">)</span>
<span class="n">req</span><span class="o">.</span><span class="n">setParameter</span><span class="p">(</span> <span class="s1">&#39;VERSION&#39;</span><span class="p">,</span> <span class="s1">&#39;1.1.0&#39;</span> <span class="p">)</span>
<span class="n">req</span><span class="o">.</span><span class="n">setParameter</span><span class="p">(</span> <span class="s1">&#39;REQUEST&#39;</span><span class="p">,</span> <span class="s1">&#39;GetCapabilities&#39;</span> <span class="p">)</span>

<span class="nb">map</span> <span class="o">=</span> <span class="n">mapscript</span><span class="o">.</span><span class="n">mapObj</span><span class="p">(</span> <span class="s1">&#39;/u/www/maps/ukpoly/ukpoly.map&#39;</span> <span class="p">)</span>
<span class="nb">map</span><span class="o">.</span><span class="n">OWSDispatch</span><span class="p">(</span> <span class="n">req</span> <span class="p">)</span>
</pre></div>
</div>
<p>The previous example have all let results be returned directly to the client.
But in some cases we want to be able to capture, and perhaps modify the results
of our requests in some custom way.  In the following example we force the
hated OGC required mime type for errors to simple text/xml (warning -
non-standard!)</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mapscript</span>

<span class="n">req</span> <span class="o">=</span> <span class="n">mapscript</span><span class="o">.</span><span class="n">OWSRequest</span><span class="p">()</span>
<span class="n">req</span><span class="o">.</span><span class="n">loadParams</span><span class="p">()</span>

<span class="nb">map</span> <span class="o">=</span> <span class="n">mapscript</span><span class="o">.</span><span class="n">mapObj</span><span class="p">(</span> <span class="s1">&#39;/u/www/maps/ukpoly/ukpoly.map&#39;</span> <span class="p">)</span>

<span class="n">mapscript</span><span class="o">.</span><span class="n">msIO_installStdoutToBuffer</span><span class="p">()</span>
<span class="nb">map</span><span class="o">.</span><span class="n">OWSDispatch</span><span class="p">(</span> <span class="n">req</span> <span class="p">)</span>

<span class="n">content_type</span> <span class="o">=</span> <span class="n">mapscript</span><span class="o">.</span><span class="n">msIO_stripStdoutBufferContentType</span><span class="p">()</span>
<span class="n">content</span> <span class="o">=</span> <span class="n">mapscript</span><span class="o">.</span><span class="n">msIO_getStdoutBufferBytes</span><span class="p">()</span>

<span class="k">if</span> <span class="n">content_type</span> <span class="o">==</span> <span class="s1">&#39;vnd.ogc.se_xml&#39;</span><span class="p">:</span>
  <span class="n">content_type</span> <span class="o">=</span> <span class="s1">&#39;text/xml&#39;</span>

<span class="nb">print</span> <span class="s1">&#39;Content-type: &#39;</span> <span class="o">+</span> <span class="n">content_type</span>
<span class="nb">print</span>
<span class="nb">print</span> <span class="n">content</span>
</pre></div>
</div>
<p>This example demonstrates capture capturing output of OWSRequest to
a buffer, capturing the “Content-type:” header value, and capturing the
actual content as binary data.  The msIO_getStdoutBufferBytes() function
returns the stdout buffer as a byte array.  If the result was known to
be text, the msIO_getStdoutBufferString() function could have been used to
fetch it as a string instead, for easier text manipulation.</p>
</section>
<section id="perl-example">
<h2><a class="toc-backref" href="#contents" role="doc-backlink">Perl Example</a><a class="headerlink" href="#perl-example" title="Link to this heading">¶</a></h2>
<p>Most of the same capabilities are accessible in all SWIG based mapscript
languages.  In perl, we could script creation of a request like this:</p>
<div class="highlight-perl notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/perl</span>

<span class="k">use</span><span class="w"> </span><span class="nn">mapscript</span><span class="p">;</span>

<span class="nv">$req</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nn">mapscript::</span><span class="n">OWSRequest</span><span class="p">();</span>
<span class="nv">$req</span><span class="o">-&gt;</span><span class="n">setParameter</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;SERVICE&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;WMS&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="nv">$req</span><span class="o">-&gt;</span><span class="n">setParameter</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;VERSION&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;1.1.0&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="nv">$req</span><span class="o">-&gt;</span><span class="n">setParameter</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;REQUEST&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;GetCapabilities&quot;</span><span class="w"> </span><span class="p">);</span>

<span class="nv">$map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nn">mapscript::</span><span class="n">mapObj</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;/u/www/maps/ukpoly/ukpoly.map&quot;</span><span class="w"> </span><span class="p">);</span>

<span class="nn">mapscript::</span><span class="n">msIO_installStdoutToBuffer</span><span class="p">();</span>

<span class="nv">$dispatch_out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$map</span><span class="o">-&gt;</span><span class="n">OWSDispatch</span><span class="p">(</span><span class="w"> </span><span class="nv">$req</span><span class="w"> </span><span class="p">);</span>

<span class="nb">printf</span><span class="w"> </span><span class="s">&quot;%s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nn">mapscript::</span><span class="n">msIO_getStdoutBufferString</span><span class="p">();</span>
</pre></div>
</div>
<p>One issue in Perl is that there is currently no wrapping for binary buffers
so you cannot call msIO_getStdoutBufferBytes(), and so cannot manipulate
binary results.</p>
<section id="more-perl-example-code">
<h3>More Perl example code<a class="headerlink" href="#more-perl-example-code" title="Link to this heading">¶</a></h3>
<div class="highlight-perl notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/perl</span>
<span class="c1">############################################################################</span>
<span class="c1">#</span>
<span class="c1"># Name:     wxs.pl</span>
<span class="c1"># Project:  MapServer</span>
<span class="c1"># Purpose:  MapScript WxS example</span>
<span class="c1">#</span>
<span class="c1"># Author:   Tom Kralidis</span>
<span class="c1">#</span>
<span class="c1">##############################################################################</span>
<span class="c1">#</span>
<span class="c1"># Copyright (c) 2007, Tom Kralidis</span>
<span class="c1">#</span>
<span class="c1"># Permission is hereby granted, free of charge, to any person obtaining a</span>
<span class="c1"># copy of this software and associated documentation files (the &quot;Software&quot;),</span>
<span class="c1"># to deal in the Software without restriction, including without limitation</span>
<span class="c1"># the rights to use, copy, modify, merge, publish, distribute, sublicense,</span>
<span class="c1"># and/or sell copies of the Software, and to permit persons to whom the</span>
<span class="c1"># Software is furnished to do so, subject to the following conditions:</span>
<span class="c1">#</span>
<span class="c1"># The above copyright notice and this permission notice shall be included in</span>
<span class="c1"># all copies of this Software or works derived from this Software.</span>
<span class="c1">#</span>
<span class="c1"># THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS</span>
<span class="c1"># OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="c1"># FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL</span>
<span class="c1"># THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="c1"># LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING</span>
<span class="c1"># FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER</span>
<span class="c1"># DEALINGS IN THE SOFTWARE.</span>
<span class="c1">############################################################################/</span>

<span class="k">use</span><span class="w"> </span><span class="nn">CGI::Carp</span><span class="w"> </span><span class="sx">qw(fatalsToBrowser)</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="nn">mapscript</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="nn">strict</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="nn">warnings</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="nn">XML::LibXSLT</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="nn">XML::LibXML</span><span class="p">;</span>

<span class="k">my</span><span class="w"> </span><span class="nv">$dispatch</span><span class="p">;</span>

<span class="c1"># uber-trivial XSLT document, as a file</span>
<span class="k">my</span><span class="w"> </span><span class="nv">$xsltfile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;/tmp/foo.xslt&quot;</span><span class="p">;</span>

<span class="c1"># here&#39;s the actual document inline for</span>
<span class="c1"># testing save and alter $xsltFile above</span>

<span class="cm">=comment</span>
<span class="cm">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cm">&lt;xsl:stylesheet version=&quot;1.0&quot;</span>
<span class="cm"> xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot;</span>
<span class="cm"> xmlns:wfs=&quot;http://www.opengis.net/wfs&quot;&gt;</span>
<span class="cm"> &lt;xsl:output method=&quot;xml&quot; indent=&quot;yes&quot;/&gt;</span>
<span class="cm"> &lt;xsl:template match=&quot;/&quot;&gt;</span>
<span class="cm">  &lt;WFSLayers&gt;</span>
<span class="cm">   &lt;xsl:for-each select=&quot;//wfs:FeatureType&quot;&gt;</span>
<span class="cm">    &lt;wfs_layer&gt;</span>
<span class="cm">     &lt;name&gt;&lt;xsl:value-of select=&quot;wfs:Name&quot;/&gt;&lt;/name&gt;</span>
<span class="cm">     &lt;title&gt;&lt;xsl:value-of select=&quot;wfs:Title&quot;/&gt;&lt;/title&gt;</span>
<span class="cm">    &lt;/wfs_layer&gt;</span>
<span class="cm">   &lt;/xsl:for-each&gt;</span>
<span class="cm">  &lt;/WFSLayers&gt;</span>
<span class="cm"> &lt;/xsl:template&gt;</span>
<span class="cm">&lt;/xsl:stylesheet&gt;</span>
<span class="cm">=cut</span>

<span class="k">my</span><span class="w"> </span><span class="nv">$mapfile</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;/tmp/config.map&quot;</span><span class="p">;</span>
<span class="c1"># init OWSRequest object</span>
<span class="k">my</span><span class="w"> </span><span class="nv">$req</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nn">mapscript::</span><span class="n">OWSRequest</span><span class="p">();</span>

<span class="c1"># pick up CGI parameters passed</span>
<span class="nv">$req</span><span class="o">-&gt;</span><span class="n">loadParams</span><span class="p">();</span>

<span class="c1"># init mapfile</span>
<span class="k">my</span><span class="w"> </span><span class="nv">$map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nn">mapscript::</span><span class="n">mapObj</span><span class="p">(</span><span class="nv">$mapfile</span><span class="p">);</span>

<span class="c1"># if this is a WFS GetCapabilities request, then intercept</span>
<span class="c1"># what is normally returned, process with an XSLT document</span>
<span class="c1"># and then return that to the client</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$req</span><span class="o">-&gt;</span><span class="n">getValueByName</span><span class="p">(</span><span class="s">&#39;REQUEST&#39;</span><span class="p">)</span><span class="w"> </span><span class="ow">eq</span><span class="w"> </span><span class="s">&quot;GetCapabilities&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nv">$req</span><span class="o">-&gt;</span><span class="n">getValueByName</span><span class="p">(</span><span class="s">&#39;SERVICE&#39;</span><span class="p">)</span><span class="w"> </span><span class="ow">eq</span><span class="w"> </span><span class="s">&quot;WFS&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="c1"># push STDOUT to a buffer and run the incoming request</span>
<span class="w">  </span><span class="k">my</span><span class="w"> </span><span class="nv">$io</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nn">mapscript::</span><span class="n">msIO_installStdoutToBuffer</span><span class="p">();</span>
<span class="w">  </span><span class="nv">$dispatch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$map</span><span class="o">-&gt;</span><span class="n">OWSDispatch</span><span class="p">(</span><span class="nv">$req</span><span class="p">);</span>

<span class="w">  </span><span class="c1"># at this point, the client&#39;s request is sent</span>

<span class="w">  </span><span class="c1"># pull out the HTTP headers</span>
<span class="w">  </span><span class="k">my</span><span class="w"> </span><span class="nv">$ct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nn">mapscript::</span><span class="n">msIO_stripStdoutBufferContentType</span><span class="p">();</span>

<span class="w">  </span><span class="c1"># and then pick up the actual content of the response</span>
<span class="w">  </span><span class="k">my</span><span class="w"> </span><span class="nv">$content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nn">mapscript::</span><span class="n">msIO_getStdoutBufferString</span><span class="p">();</span>

<span class="w">  </span><span class="k">my</span><span class="w"> </span><span class="nv">$xml</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nn">XML::LibXML</span><span class="o">-&gt;</span><span class="k">new</span><span class="p">();</span>
<span class="w">  </span><span class="k">my</span><span class="w"> </span><span class="nv">$xslt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nn">XML::LibXSLT</span><span class="o">-&gt;</span><span class="k">new</span><span class="p">();</span>

<span class="w">  </span><span class="c1"># load XML content</span>
<span class="w">  </span><span class="k">my</span><span class="w"> </span><span class="nv">$source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$xml</span><span class="o">-&gt;</span><span class="n">parse_string</span><span class="p">(</span><span class="nv">$content</span><span class="p">);</span>

<span class="w">  </span><span class="c1"># load XSLT document</span>
<span class="w">  </span><span class="k">my</span><span class="w"> </span><span class="nv">$style_doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$xml</span><span class="o">-&gt;</span><span class="n">parse_file</span><span class="p">(</span><span class="nv">$xsltfile</span><span class="p">);</span>
<span class="w">  </span><span class="k">my</span><span class="w"> </span><span class="nv">$stylesheet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$xslt</span><span class="o">-&gt;</span><span class="n">parse_stylesheet</span><span class="p">(</span><span class="nv">$style_doc</span><span class="p">);</span>

<span class="w">  </span><span class="c1"># invoke the XSLT transformation</span>
<span class="w">  </span><span class="k">my</span><span class="w"> </span><span class="nv">$results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$stylesheet</span><span class="o">-&gt;</span><span class="n">transform</span><span class="p">(</span><span class="nv">$source</span><span class="p">);</span>
<span class="w">  </span><span class="c1"># print out the result (header + content)</span>
<span class="w">  </span><span class="k">print</span><span class="w"> </span><span class="s">&quot;Content-type: $ct\n\n&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="k">print</span><span class="w"> </span><span class="nv">$stylesheet</span><span class="o">-&gt;</span><span class="n">output_string</span><span class="p">(</span><span class="nv">$results</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1"># else process as normal</span>
<span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nv">$dispatch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$map</span><span class="o">-&gt;</span><span class="n">OWSDispatch</span><span class="p">(</span><span class="nv">$req</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="java-example">
<h2><a class="toc-backref" href="#contents" role="doc-backlink">Java Example</a><a class="headerlink" href="#java-example" title="Link to this heading">¶</a></h2>
<p>One benefit of redirection of output to a buffer is that it is thread-safe.
Several threads in the same process can be actively processing requests and
writing their results to distinct output buffers.  This Java example, used
to test multi-threaded access demonstrates that.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">edu.umn.gis.mapscript.mapObj</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">edu.umn.gis.mapscript.OWSRequest</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">edu.umn.gis.mapscript.mapscript</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">WxSTest_thread</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Thread</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w">       </span><span class="n">mapName</span><span class="p">;</span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">byte</span><span class="o">[]</span><span class="w">       </span><span class="n">resultBytes</span><span class="p">;</span>

<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">mapObj</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">mapObj</span><span class="p">(</span><span class="n">mapName</span><span class="p">);</span>

<span class="w">      </span><span class="n">map</span><span class="p">.</span><span class="na">setMetaData</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;ows_onlineresource&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;http://dummy.org/&quot;</span><span class="w"> </span><span class="p">);</span>

<span class="w">      </span><span class="n">OWSRequest</span><span class="w"> </span><span class="n">req</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OWSRequest</span><span class="p">();</span>

<span class="w">      </span><span class="n">req</span><span class="p">.</span><span class="na">setParameter</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;SERVICE&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;WMS&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">      </span><span class="n">req</span><span class="p">.</span><span class="na">setParameter</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;VERSION&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;1.1.0&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">      </span><span class="n">req</span><span class="p">.</span><span class="na">setParameter</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;REQUEST&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;GetCapabilities&quot;</span><span class="w"> </span><span class="p">);</span>

<span class="w">      </span><span class="n">mapscript</span><span class="p">.</span><span class="na">msIO_installStdoutToBuffer</span><span class="p">();</span>

<span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">owsResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">map</span><span class="p">.</span><span class="na">OWSDispatch</span><span class="p">(</span><span class="w"> </span><span class="n">req</span><span class="w"> </span><span class="p">);</span>

<span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">owsResult</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span>
<span class="w">          </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;OWSDispatch Result (expect 0): &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">owsResult</span><span class="w"> </span><span class="p">);</span>

<span class="w">      </span><span class="n">resultBytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mapscript</span><span class="p">.</span><span class="na">msIO_getStdoutBufferBytes</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">WxSTest</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w">  </span><span class="p">{</span>
<span class="w">      </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="n">WxSTest_thread</span><span class="w"> </span><span class="n">tt</span><span class="o">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WxSTest_thread</span><span class="o">[</span><span class="mi">100</span><span class="o">]</span><span class="p">;</span>
<span class="w">          </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="w">          </span><span class="kt">int</span><span class="w"> </span><span class="n">expectedLength</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">success</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">failure</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>

<span class="w">          </span><span class="k">for</span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">tt</span><span class="p">.</span><span class="na">length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="w"> </span><span class="p">)</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">              </span><span class="n">tt</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WxSTest_thread</span><span class="p">();</span>
<span class="w">              </span><span class="n">tt</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">.</span><span class="na">mapName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span>
<span class="w">          </span><span class="p">}</span>

<span class="w">          </span><span class="k">for</span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">tt</span><span class="p">.</span><span class="na">length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="n">tt</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">.</span><span class="na">start</span><span class="p">();</span>

<span class="w">          </span><span class="k">for</span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">tt</span><span class="p">.</span><span class="na">length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="w"> </span><span class="p">)</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">              </span><span class="n">tt</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">.</span><span class="na">join</span><span class="p">();</span>
<span class="w">              </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="p">{</span>
<span class="w">                  </span><span class="n">expectedLength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tt</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">.</span><span class="na">resultBytes</span><span class="p">.</span><span class="na">length</span><span class="p">;</span>
<span class="w">                  </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Document Length: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">expectedLength</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;, expecting somewhere around 10000 or more.&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">              </span><span class="p">}</span>
<span class="w">              </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">expectedLength</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">tt</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">.</span><span class="na">resultBytes</span><span class="p">.</span><span class="na">length</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="p">{</span>
<span class="w">                  </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Document Length:&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">tt</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">.</span><span class="na">resultBytes</span><span class="p">.</span><span class="na">length</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; Expected:&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">expectedLength</span><span class="w"> </span><span class="p">);</span>
<span class="w">                  </span><span class="n">failure</span><span class="o">++</span><span class="p">;</span>
<span class="w">              </span><span class="p">}</span>
<span class="w">              </span><span class="k">else</span>
<span class="w">                  </span><span class="n">success</span><span class="o">++</span><span class="p">;</span>
<span class="w">          </span><span class="p">}</span>

<span class="w">          </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Successes: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">success</span><span class="w"> </span><span class="p">);</span>
<span class="w">          </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Failures: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">failure</span><span class="w"> </span><span class="p">);</span>

<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="p">(</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="php-example">
<h2><a class="toc-backref" href="#contents" role="doc-backlink">PHP Example</a><a class="headerlink" href="#php-example" title="Link to this heading">¶</a></h2>
<p>Most of the same capabilities are accessible in php mapscript. Here
is an example displaying a <a class="reference internal" href="wms_server.html#wms-capabilities"><span class="std std-ref">wms capabilities</span></a>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">Example1 : get the capabilities</span>
<span class="x">This is for example what a url could look like :</span>
<span class="x">http://.../php/ows.php?service=WMS&amp;version=1.1.1&amp;Request=GetCapabilities</span>


<span class="cp">&lt;?php</span>

<span class="nb">dl</span><span class="p">(</span><span class="s2">&quot;php_mapscript_4.10.0.dll&quot;</span><span class="p">);</span>

<span class="nv">$request</span> <span class="o">=</span> <span class="nx">ms_newowsrequestobj</span><span class="p">();</span>

<span class="nv">$request</span><span class="o">-&gt;</span><span class="na">loadparams</span><span class="p">();</span>

<span class="cm">/*exampple on how to modify the parameters :</span>
<span class="cm"> forcing the version from 1.1.1 to 1.1.0 */</span>
<span class="nv">$request</span><span class="o">-&gt;</span><span class="na">setParameter</span><span class="p">(</span><span class="s2">&quot;VeRsIoN&quot;</span><span class="p">,</span><span class="s2">&quot;1.1.0&quot;</span><span class="p">);</span>

<span class="nx">ms_ioinstallstdouttobuffer</span><span class="p">();</span>

<span class="nv">$oMap</span> <span class="o">=</span> <span class="nx">ms_newMapobj</span><span class="p">(</span><span class="s2">&quot;../../service/wms.map&quot;</span><span class="p">);</span>

<span class="nv">$oMap</span><span class="o">-&gt;</span><span class="na">owsdispatch</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>

<span class="nv">$contenttype</span> <span class="o">=</span> <span class="nx">ms_iostripstdoutbuffercontenttype</span><span class="p">();</span>

<span class="nv">$buffer</span> <span class="o">=</span> <span class="nx">ms_iogetstdoutbufferstring</span><span class="p">();</span>

<span class="nb">header</span><span class="p">(</span><span class="s1">&#39;Content-type: application/xml&#39;</span><span class="p">);</span>
<span class="k">echo</span> <span class="nv">$buffer</span><span class="p">;</span>

<span class="nx">ms_ioresethandlers</span><span class="p">();</span>

<span class="cp">?&gt;</span>


<span class="x">Example2 : get the map</span>
<span class="x">This is for example what a url could look like :</span>

<span class="x">http://.../php/ows.php?SERVICE=WMS&amp;VeRsIoN=1.1.1&amp;Request=GetMap&amp;</span>
<span class="x">LAYERS=WorldGen_Outline</span>


<span class="cp">&lt;?php</span>

<span class="nb">dl</span><span class="p">(</span><span class="s2">&quot;php_mapscript_4.10.0.dll&quot;</span><span class="p">);</span>

<span class="nv">$request</span> <span class="o">=</span> <span class="nx">ms_newowsrequestobj</span><span class="p">();</span>

<span class="nv">$request</span><span class="o">-&gt;</span><span class="na">loadparams</span><span class="p">();</span>

<span class="nx">ms_ioinstallstdouttobuffer</span><span class="p">();</span>

<span class="nv">$oMap</span> <span class="o">=</span> <span class="nx">ms_newMapobj</span><span class="p">(</span><span class="s2">&quot;../../service/wms.map&quot;</span><span class="p">);</span>

<span class="nv">$oMap</span><span class="o">-&gt;</span><span class="na">owsdispatch</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>

<span class="nv">$contenttype</span> <span class="o">=</span> <span class="nx">ms_iostripstdoutbuffercontenttype</span><span class="p">();</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$contenttype</span> <span class="o">==</span> <span class="s1">&#39;image/png&#39;</span><span class="p">)</span>
   <span class="nb">header</span><span class="p">(</span><span class="s1">&#39;Content-type: image/png&#39;</span><span class="p">);</span>

<span class="nx">ms_iogetStdoutBufferBytes</span><span class="p">();</span>

<span class="nx">ms_ioresethandlers</span><span class="p">();</span>

<span class="cp">?&gt;</span>
</pre></div>
</div>
</section>
<section id="use-in-non-cgi-environments-mod-php-etc">
<h2><a class="toc-backref" href="#contents" role="doc-backlink">Use in Non-CGI Environments (mod_php, etc)</a><a class="headerlink" href="#use-in-non-cgi-environments-mod-php-etc" title="Link to this heading">¶</a></h2>
<p>The loadParams() call establish parses the cgi environment varabiables
(QUERY_STRING, and REQUEST_METHOD) into parameters in the OWSRequest object.
In non-cgi environments, such as when php, python and perl are used as
“loaded modules” in Apache, or Java with Tomcat, the loadParams() call
will not work - in fact in 4.10.x it will terminate the web server instance.</p>
<p>It is necessary in these circumstances for the calling script/application
to parse the request url into keyword/value pairs and assign to the
OWSRequest object by other means, as shown in some of the above examples
explicitly setting the request parameters.</p>
</section>
<section id="post-processing-capabilities">
<h2><a class="toc-backref" href="#contents" role="doc-backlink">Post Processing Capabilities</a><a class="headerlink" href="#post-processing-capabilities" title="Link to this heading">¶</a></h2>
<p>In the following python example, we process any incoming WxS request, but if it is
a GetCapabilities request we replace the Service section in the capabilities
with a section read from a file, that is carefully tailored the way we want.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">elementtree.ElementTree</span> <span class="k">as</span> <span class="nn">ET</span>

<span class="kn">import</span> <span class="nn">mapscript</span>

<span class="n">req</span> <span class="o">=</span> <span class="n">mapscript</span><span class="o">.</span><span class="n">OWSRequest</span><span class="p">()</span>
<span class="n">req</span><span class="o">.</span><span class="n">loadParams</span><span class="p">()</span>

<span class="nb">map</span> <span class="o">=</span> <span class="n">mapscript</span><span class="o">.</span><span class="n">mapObj</span><span class="p">(</span> <span class="s1">&#39;/u/www/maps/ukpoly/ukpoly.map&#39;</span> <span class="p">)</span>

<span class="c1">#</span>
<span class="c1"># Handle anything but a GetCapabilities call normally.</span>
<span class="c1">#</span>
<span class="k">if</span> <span class="n">req</span><span class="o">.</span><span class="n">getValueByName</span><span class="p">(</span><span class="s1">&#39;REQUEST&#39;</span><span class="p">)</span> <span class="o">&lt;&gt;</span> <span class="s1">&#39;GetCapabilities&#39;</span><span class="p">:</span>

  <span class="nb">map</span><span class="o">.</span><span class="n">OWSDispatch</span><span class="p">(</span> <span class="n">req</span> <span class="p">)</span>

<span class="c1">#</span>
<span class="c1"># Do special processing for GetCapabilities</span>
<span class="c1">#</span>
<span class="k">else</span><span class="p">:</span>
  <span class="n">mapscript</span><span class="o">.</span><span class="n">msIO_installStdoutToBuffer</span><span class="p">()</span>

  <span class="nb">map</span><span class="o">.</span><span class="n">OWSDispatch</span><span class="p">(</span> <span class="n">req</span> <span class="p">)</span>

  <span class="n">ct</span> <span class="o">=</span> <span class="n">mapscript</span><span class="o">.</span><span class="n">msIO_stripStdoutBufferContentType</span><span class="p">()</span>
  <span class="n">content</span> <span class="o">=</span> <span class="n">mapscript</span><span class="o">.</span><span class="n">msIO_getStdoutBufferString</span><span class="p">()</span>
  <span class="n">mapscript</span><span class="o">.</span><span class="n">msIO_resetHandlers</span><span class="p">()</span>

  <span class="c1"># Parse the capabilities.</span>

  <span class="n">tree</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>

  <span class="c1"># Strip out ordinary Service section, and replace from custom file.</span>

  <span class="n">tree</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;Service&#39;</span><span class="p">))</span>
  <span class="n">tree</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ET</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;./Service.xml&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">getroot</span><span class="p">())</span>

  <span class="c1"># Stream out adjusted capabilities.</span>

  <span class="nb">print</span> <span class="s1">&#39;Content-type: &#39;</span> <span class="o">+</span> <span class="n">ct</span>
  <span class="nb">print</span>
  <span class="nb">print</span> <span class="n">ET</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p>
<a href="../about.html" title="About">About</a><br>
<a href="../products.html" title="Products">Products</a><br>
<a href="../community/index.html" title="Community">Community</a><br>
<a href="../development/index.html" title="Development">Development</a><br>
<a href="../download.html" title="Downloads">Downloads</a><br>
<a href="../documentation.html" title="Documentation">Documentation</a><br>
<a href="../faq.html" title="FAQ">FAQ</a><br>
<a href="../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</h3>
  <ul>
<li><a class="reference internal" href="#">MapScript Wrappers for WxS Services</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#python-examples">Python Examples</a></li>
<li><a class="reference internal" href="#perl-example">Perl Example</a><ul>
<li><a class="reference internal" href="#more-perl-example-code">More Perl example code</a></li>
</ul>
</li>
<li><a class="reference internal" href="#java-example">Java Example</a></li>
<li><a class="reference internal" href="#php-example">PHP Example</a></li>
<li><a class="reference internal" href="#use-in-non-cgi-environments-mod-php-etc">Use in Non-CGI Environments (mod_php, etc)</a></li>
<li><a class="reference internal" href="#post-processing-capabilities">Post Processing Capabilities</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../basemaps/index.html" title="Basemaps"
             >next</a> |</li>
        <li class="right" >
          <a href="sos_server.html" title="SOS Server"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../documentation.html" >MapServer 8.0.1 Documentation</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >OGC Support and Configuration</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MapScript Wrappers for WxS Services</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; <a href="../copyright.html">Copyright</a> 2023, Open Source Geospatial Foundation.
      Last updated on 2023-12-22.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.5.
    </div>
  </body>
</html>