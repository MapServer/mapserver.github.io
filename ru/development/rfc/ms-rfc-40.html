<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="ru">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>MS RFC 40: Support Label Text Transformations &#8212; MapServer 7.0.5 documentation</title>
    
    <link rel="stylesheet" href="../../_static/sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '7.0.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/translations.js"></script>
    <link rel="shortcut icon" href="../../_static/mapserver.ico"/>
    <link rel="author" title="Об этих документах" href="../../about.html" />
    <link rel="index" title="Алфавитный указатель" href="../../genindex.html" />
    <link rel="search" title="Поиск" href="../../search.html" />
    <link rel="copyright" title="Авторские права" href="../../copyright.html" />
    <link rel="top" title="MapServer 7.0.5 documentation" href="../../index.html" />
    <link rel="up" title="Request for Comments" href="index.html" />
    <link rel="next" title="MS RFC 41: Support of WCS 1.1.x Protocol" href="ms-rfc-41.html" />
    <link rel="prev" title="MS RFC 39: Support of WMS/SLD Named Styles" href="ms-rfc-39.html" /> 
  </head>
  <body role="document">

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../../index.html" title="Home"><img src="../../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../../index.html" title="Home">Home</a> |
      <a href="../../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="../../download.html" title="Download Source or Binaries">Download </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        
          
            <a href="../../../development/rfc/ms-rfc-40.html"><img src="../../_static/flagicons/en.png" alt="en" title="en" border="0" /></a>
          
        
        
          
            <a href="../../../ar/development/rfc/ms-rfc-40.html"><img src="../../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
          
        
        
          
            <a href="../../../de/development/rfc/ms-rfc-40.html"><img src="../../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
          
        
        
          
            <a href="../../../el/development/rfc/ms-rfc-40.html"><img src="../../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
          
        
        
          
            <a href="../../../es/development/rfc/ms-rfc-40.html"><img src="../../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
          
        
        
          
            <a href="../../../fr/development/rfc/ms-rfc-40.html"><img src="../../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
          
        
        
          
            <a href="../../../id/development/rfc/ms-rfc-40.html"><img src="../../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
          
        
        
          
            <a href="../../../it/development/rfc/ms-rfc-40.html"><img src="../../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
          
        
        
          
            <a href="../../../ja/development/rfc/ms-rfc-40.html"><img src="../../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
          
        
        
          
            <a href="../../../nl_NL/development/rfc/ms-rfc-40.html"><img src="../../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
          
        
        
          
            <a href="../../../pl/development/rfc/ms-rfc-40.html"><img src="../../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
          
        
        <img src="../../_static/flagicons/ru.png" alt="ru" title="ru" border="0" width="18px" height="13px"/>
        
          
            <a href="../../../sq/development/rfc/ms-rfc-40.html"><img src="../../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
          
        
        
          
            <a href="../../../tr/development/rfc/ms-rfc-40.html"><img src="../../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
          
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Навигация</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Алфавитный указатель"
             accesskey="I">указатель</a></li>
        <li class="right" >
          <a href="ms-rfc-41.html" title="MS RFC 41: Support of WCS 1.1.x Protocol"
             accesskey="N">вперёд</a> |</li>
        <li class="right" >
          <a href="ms-rfc-39.html" title="MS RFC 39: Support of WMS/SLD Named Styles"
             accesskey="P">назад</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Request for Comments</a> &#187;</li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="ms-rfc-40-support-label-text-transformations">
<span id="rfc40"></span><h1>MS RFC 40: Support Label Text Transformations<a class="headerlink" href="#ms-rfc-40-support-label-text-transformations" title="Ссылка на этот заголовок">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Date:</th><td class="field-body">2007/12/03</td>
</tr>
<tr class="field-even field"><th class="field-name">Author:</th><td class="field-body">Thomas Bonfort</td>
</tr>
<tr class="field-odd field"><th class="field-name">Contact:</th><td class="field-body">thomas.bonfort at gmail.com</td>
</tr>
<tr class="field-even field"><th class="field-name">Last Edited:</th><td class="field-body">2007/12/03</td>
</tr>
<tr class="field-odd field"><th class="field-name">Status:</th><td class="field-body">Implemented</td>
</tr>
<tr class="field-even field"><th class="field-name">Version:</th><td class="field-body">MapServer 5.4</td>
</tr>
</tbody>
</table>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Ссылка на этот заголовок">¶</a></h2>
<p>MapServer 5.0 supports &#8220;hard&#8221; text wrapping, where the wrap character is
unconditionally treated as a newline. This RFC proposes the addition of:</p>
<ul class="simple">
<li>conditional wrapping, i.e. newlines are only added when the current
line length has met a user adjustable criteria</li>
<li>line alignment, i.e. text aligned per user request, namely right, center and left</li>
</ul>
<p>These two additions are independent from one another, i.e. can be activated
together or not.</p>
</div>
<div class="section" id="line-wrapping">
<h2>Line Wrapping<a class="headerlink" href="#line-wrapping" title="Ссылка на этот заголовок">¶</a></h2>
<p>A new keyword, MAXLENGTH is added to the label object, and interacts with the
label WRAP parameter as follows:</p>
<ul class="simple">
<li>the wrap character specifies what character can be replaced by a newline
(no change w.r.t. the current meaning). Probably the most useful wrap
character will become &#8216; &#8216; (i.e. the space character)</li>
<li>the MAXLENGTH value specifies the maximum number of characters that can
compose a line before a newline is inserted. A value of 0 specifies the
current &#8220;hard&#8221; wrapping. A positive value triggers wrapping at the WRAP
character for lines longer than MAXLENGTH. A negative value triggers
wrapping that is allowed to break words, i.e. not necessarily at
the WRAP character.</li>
</ul>
<p>The WRAP / MAXLENGTH combinations are summarized here:</p>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="21%" />
<col width="36%" />
<col width="23%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">&nbsp;</th>
<th class="head">maxlen =0</th>
<th class="head">maxlen &gt; 0</th>
<th class="head">maxlen &lt; 0</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>wrap = &#8216;char&#8217;</td>
<td>current way</td>
<td>conditional wrap if &gt; maxlen</td>
<td>hard wrap</td>
</tr>
<tr class="row-odd"><td>no wrap</td>
<td>no processing</td>
<td>skip label if &gt; maxlen</td>
<td>hard wrap</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="line-centering">
<h2>Line Centering<a class="headerlink" href="#line-centering" title="Ссылка на этот заголовок">¶</a></h2>
<p>A new keyword ALIGN is added to the label object. It supports 3 values: left,
center and right,  and controls how text lines should be aligned w.r.t. the
label bounding box. Precise placement of text can only be done at the renderer
level, by exactly defining the starting pixel of the current line. While this
approach could be taken, it would considerably burden the renderer code.</p>
<p>I propose to use a more generic though less precise way of doing, by
padding the text lines with space characters to approximate indentation.
The initial implementation could only rely on the number of characters in
each text line:</p>
<blockquote>
<div><ul class="simple">
<li>loop through text lines to find the line with the most characters l_max</li>
<li>pad all the other lines with (l_max - l_cur)/2 space characters</li>
</ul>
</div></blockquote>
<p>A more advanced implementation will be to use the exact line lengths as
returned by the renderers with the msGetLabelSize function:</p>
<blockquote>
<div><ul class="simple">
<li>compute the size in pixels of the &#8221;  &#8221; string (two spaces,
accounts for kerning): l_2space</li>
<li>loop through text lines to longest line of length pix_l_max</li>
<li>pad all the other lines with
(pix_l_max - pix_l_cur)/2 * 1/(2*l_2space) space characters</li>
</ul>
</div></blockquote>
<p>&#8216;&#8217;&#8216;Limitations&#8217;&#8216;&#8217;: aligning text to the right will produce ugly results using
this method, unless using a monospace font.</p>
</div>
<div class="section" id="modifications-to-the-source-code">
<h2>Modifications to the source code<a class="headerlink" href="#modifications-to-the-source-code" title="Ссылка на этот заголовок">¶</a></h2>
<ul class="simple">
<li>MAXLENGTH and ALIGN will be added to the LABEL object in map.h, in the
mapfile parser/writer (mapfile.c) and in MapScript</li>
<li>msTransformLabelText() in maplabel.c will be updated to support the
modifications proposed. No other modifications should be required as the
text itself is modified to fit the user&#8217;s request (i.e. it is padded with
spaces, and/or newlines are added to it)</li>
</ul>
</div>
<div class="section" id="mapscript-implications">
<h2>MapScript Implications<a class="headerlink" href="#mapscript-implications" title="Ссылка на этот заголовок">¶</a></h2>
<p>The labelObj will have new maxlength property of type integer
and align property (ms_align_*).</p>
</div>
<div class="section" id="files-affected">
<h2>Files affected<a class="headerlink" href="#files-affected" title="Ссылка на этот заголовок">¶</a></h2>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">map</span><span class="o">.</span><span class="n">h</span>
<span class="n">mapfile</span><span class="o">.</span><span class="n">c</span>
<span class="n">maplabel</span><span class="o">.</span><span class="n">c</span>
<span class="n">maplexer</span><span class="o">.</span><span class="n">l</span>
<span class="n">maplexer</span><span class="o">.</span><span class="n">c</span>
</pre></div>
</div>
</div>
<div class="section" id="backwards-compatibility-issues">
<h2>Backwards compatibility issues<a class="headerlink" href="#backwards-compatibility-issues" title="Ссылка на этот заголовок">¶</a></h2>
<p>None.</p>
</div>
<div class="section" id="bug-id">
<h2>Bug ID<a class="headerlink" href="#bug-id" title="Ссылка на этот заголовок">¶</a></h2>
<ul class="simple">
<li>2383: <a class="reference external" href="https://github.com/mapserver/mapserver/issues/2383">https://github.com/mapserver/mapserver/issues/2383</a></li>
</ul>
</div>
<div class="section" id="voting-history">
<h2>Voting history<a class="headerlink" href="#voting-history" title="Ссылка на этот заголовок">¶</a></h2>
<ul class="simple">
<li>+1: SteveL, SteveW</li>
<li>+0: FrankW, TomK</li>
</ul>
</div>
<div class="section" id="questions-comments-from-the-review-period">
<h2>Questions/Comments from the review period<a class="headerlink" href="#questions-comments-from-the-review-period" title="Ссылка на этот заголовок">¶</a></h2>
<ul class="simple">
<li>SteveW: allow preciser computation of line offsets when
padding with spaces: done. The precise size of each line is
calculated in pixels, and the closest number of space characters
required for alignment is computed accordingly</li>
<li>DanielM: allow multiple characters to be used when wrapping lines:
not addressed. Space characters can be <em>replaced</em> by a newline, while the
hyphen character should generally be kept. Any idea how we can specify that
some wrapping characters are to be kept while others are just markers
for potential linebreaks?</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Быстрый поиск</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Искать" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><h3>Navigation</h3>
<p>
<a href="../../about.html" title="About">About</a><br>
<a href="../../products.html" title="Products">Products</a><br>
<a href="../../community/index.html" title="Community">Community</a><br>
<a href="../index.html" title="Development">Development</a><br>
<a href="../../download.html" title="Downloads">Downloads</a><br>
<a href="../../documentation.html" title="Documentation">Documentation</a><br>
<a href="../../faq.html" title="FAQ">FAQ</a><br>
<a href="../../psc.html" title="PSC">PSC</a>
</p>
  <h3>Current Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">MS RFC 40: Support Label Text Transformations</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#line-wrapping">Line Wrapping</a></li>
<li><a class="reference internal" href="#line-centering">Line Centering</a></li>
<li><a class="reference internal" href="#modifications-to-the-source-code">Modifications to the source code</a></li>
<li><a class="reference internal" href="#mapscript-implications">MapScript Implications</a></li>
<li><a class="reference internal" href="#files-affected">Files affected</a></li>
<li><a class="reference internal" href="#backwards-compatibility-issues">Backwards compatibility issues</a></li>
<li><a class="reference internal" href="#bug-id">Bug ID</a></li>
<li><a class="reference internal" href="#voting-history">Voting history</a></li>
<li><a class="reference internal" href="#questions-comments-from-the-review-period">Questions/Comments from the review period</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Навигация</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Алфавитный указатель"
             >указатель</a></li>
        <li class="right" >
          <a href="ms-rfc-41.html" title="MS RFC 41: Support of WCS 1.1.x Protocol"
             >вперёд</a> |</li>
        <li class="right" >
          <a href="ms-rfc-39.html" title="MS RFC 39: Support of WMS/SLD Named Styles"
             >назад</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Request for Comments</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; <a href="../../copyright.html">Copyright</a> 2017, Open Source Geospatial Foundation.
      Обновлено: 2017-05-10.
      Создано с помощью <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.9.
    </div>
  </body>
</html>