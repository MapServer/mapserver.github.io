
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="nl_NL">
  <head>
    <meta charset="utf-8" />
    <title>How to set up MapServer as a client to access a service over https &#8212; MapServer 7.4.2 documentation</title>
    <link rel="stylesheet" href="../_static/sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <link rel="shortcut icon" href="../_static/mapserver.ico"/>
    <link rel="author" title="Over deze documenten" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Zoeken" href="../search.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="next" title="MapScript Wrappers for WxS Services" href="mapscript.html" />
    <link rel="prev" title="SOS Server" href="sos_server.html" /> 
  </head><body>

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../index.html" title="Home"><img src="../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../index.html" title="Home">Home</a> |
      <a href="../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a> |
      <a href="../download.html" title="Download Source or Binaries">Download </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        
          
            <a href="../../ogc/wxs_secure.html"><img src="../_static/flagicons/en.png" alt="en" title="en" border="0" /></a>
          
        
        
          
            <a href="../../ar/ogc/wxs_secure.html"><img src="../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
          
        
        
          
            <a href="../../de/ogc/wxs_secure.html"><img src="../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
          
        
        
          
            <a href="../../el/ogc/wxs_secure.html"><img src="../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
          
        
        
          
            <a href="../../es/ogc/wxs_secure.html"><img src="../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
          
        
        
          
            <a href="../../fr/ogc/wxs_secure.html"><img src="../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
          
        
        
          
            <a href="../../id/ogc/wxs_secure.html"><img src="../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
          
        
        
          
            <a href="../../it/ogc/wxs_secure.html"><img src="../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
          
        
        
          
            <a href="../../ja/ogc/wxs_secure.html"><img src="../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
          
        
        <img src="../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" width="18px" height="13px"/>
        
          
            <a href="../../pl/ogc/wxs_secure.html"><img src="../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
          
        
        
          
            <a href="../../ru/ogc/wxs_secure.html"><img src="../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
          
        
        
          
            <a href="../../sq/ogc/wxs_secure.html"><img src="../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
          
        
        
          
            <a href="../../tr/ogc/wxs_secure.html"><img src="../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
          
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigatie</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Algemene index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="mapscript.html" title="MapScript Wrappers for WxS Services"
             accesskey="N">volgende</a> |</li>
        <li class="right" >
          <a href="sos_server.html" title="SOS Server"
             accesskey="P">vorige</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../documentation.html" >MapServer 7.4.2 Documentation</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">OGC Support and Configuration</a> &#187;</li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="how-to-set-up-mapserver-as-a-client-to-access-a-service-over-https">
<span id="wxs-secure"></span><span id="index-0"></span><h1><a class="toc-backref" href="#table-of-contents">How to set up MapServer as a client to access a service over https</a><a class="headerlink" href="#how-to-set-up-mapserver-as-a-client-to-access-a-service-over-https" title="Permalink naar deze titel">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Revision</dt>
<dd class="field-odd"><p>$Revision: 12521 $</p>
</dd>
<dt class="field-even">Date</dt>
<dd class="field-even"><p>$Date: 2011-09-06 19:48:20 +0200 (Tue, 06 Sep 2011) $</p>
</dd>
</dl>
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#how-to-set-up-mapserver-as-a-client-to-access-a-service-over-https" id="id1">How to set up MapServer as a client to access a service over https</a></p>
<ul>
<li><p><a class="reference internal" href="#introduction" id="id2">Introduction</a></p></li>
<li><p><a class="reference internal" href="#requirements" id="id3">Requirements</a></p></li>
<li><p><a class="reference internal" href="#default-installation-with-apt-get-install-rpm-manual-etc" id="id4">Default Installation (with apt-get install, rpm, manual, etc)</a></p></li>
<li><p><a class="reference internal" href="#non-standard-installation-common-with-ms4w-and-fgs" id="id5">Non-Standard Installation (common with ms4w and fgs)</a></p></li>
<li><p><a class="reference internal" href="#remote-server-with-a-self-signed-ssl-certificate" id="id6">Remote Server with a Self-Signed SSL Certificate</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#table-of-contents">Introduction</a><a class="headerlink" href="#introduction" title="Permalink naar deze titel">¶</a></h2>
<p>The following documentation explains how to set up MapServer as a
client to access a WMS/WFS server through a secure SSL connection
using the HTTPS protocol.  It describes the common problems a user
could encounter and how to solve them.</p>
</div>
<div class="section" id="requirements">
<h2><a class="toc-backref" href="#table-of-contents">Requirements</a><a class="headerlink" href="#requirements" title="Permalink naar deze titel">¶</a></h2>
<p>MapServer 5.4.1 and up, compiled with Curl.  Curl must be built with
SSL support.</p>
</div>
<div class="section" id="default-installation-with-apt-get-install-rpm-manual-etc">
<h2><a class="toc-backref" href="#table-of-contents">Default Installation (with apt-get install, rpm, manual, etc)</a><a class="headerlink" href="#default-installation-with-apt-get-install-rpm-manual-etc" title="Permalink naar deze titel">¶</a></h2>
<p>The Curl CA bundle file should be located in the default directory.</p>
<p>Verify your connection with the Curl command line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">targethostname</span><span class="p">:</span><span class="n">port</span><span class="o">/</span><span class="n">gmap</span><span class="o">-</span><span class="n">demo</span><span class="o">/</span><span class="n">gmap75</span><span class="o">.</span><span class="n">phtml</span>
</pre></div>
</div>
<p>Edit your map file to add the WMS connection URL.  For example:</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">CONNECTION</span> <span class="s">&quot;https://domainname:port/cgi-bin/mapserv?map=/path/to/wms.map&quot;</span>
<span class="k">CONNECTIONTYPE</span> <span class="nb">WMS</span>
</pre></div>
</div>
<p>If the layer is displayed correctly you do not need to read on.</p>
</div>
<div class="section" id="non-standard-installation-common-with-ms4w-and-fgs">
<h2><a class="toc-backref" href="#table-of-contents">Non-Standard Installation (common with ms4w and fgs)</a><a class="headerlink" href="#non-standard-installation-common-with-ms4w-and-fgs" title="Permalink naar deze titel">¶</a></h2>
<p>If you get the following error, it means that your CA bundle is not
found.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="n">port</span><span class="o">/</span><span class="n">gmap</span><span class="o">-</span><span class="n">demo</span><span class="o">/</span><span class="n">gmap75</span><span class="o">.</span><span class="n">phtml</span>
<span class="n">curl</span><span class="p">:</span> <span class="p">(</span><span class="mi">77</span><span class="p">)</span> <span class="n">error</span> <span class="n">setting</span> <span class="n">certificate</span> <span class="n">verify</span> <span class="n">locations</span><span class="p">:</span>
  <span class="n">CAfile</span><span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">nsavard</span><span class="o">/</span><span class="n">fgsfull</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">curl</span><span class="o">/</span><span class="n">cacert</span><span class="o">.</span><span class="n">pem</span>
  <span class="n">CApath</span><span class="p">:</span> <span class="n">none</span>
</pre></div>
</div>
<p>It may be caused by the CURL_CA_BUNDLE environment variable pointing
to the wrong location or the CA bundle file not being present.
Follow the steps below to correct either case.</p>
<p>Set the CURL_CA_BUNDLE environment variable to point to the bundle
file (e.g. export CURL_CA_BUNDLE=/path/to/my-ca-bundle.ext where
my-ca-bundle.ext could be cacert.pem or ca-bundle.crt).</p>
<p>Download the CA bundle file “cacert.pem” found at
<a class="reference external" href="http://curl.haxx.se/docs/caextract.html">http://curl.haxx.se/docs/caextract.html</a> or if you have the Curl source
you could create the CA bundle by executing “make ca-bundle” or “make
ca-firefox” (if you have Firefox and the certutil tool installed).  If
you used the second choice, the bundle file will be named
ca-bundle.crt and will be found in the lib directory under the Curl
root directory.  See <a class="reference external" href="http://curl.haxx.se/docs/caextract.html">http://curl.haxx.se/docs/caextract.html</a> for more
details.  Store this file in the location pointed to by the
URL_CA_BUNDLE environment variable.</p>
<p>Verify your connection using the Curl command line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">targethostname</span><span class="p">:</span><span class="n">port</span><span class="o">/</span><span class="n">gmap</span><span class="o">-</span><span class="n">demo</span><span class="o">/</span><span class="n">gmap75</span><span class="o">.</span><span class="n">phtml</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Notitie</p>
<p>If you use ms4w, osgeo4w or fgs installation, these installers
should take care of this problem for you.</p>
</div>
</div>
<div class="section" id="remote-server-with-a-self-signed-ssl-certificate">
<h2><a class="toc-backref" href="#table-of-contents">Remote Server with a Self-Signed SSL Certificate</a><a class="headerlink" href="#remote-server-with-a-self-signed-ssl-certificate" title="Permalink naar deze titel">¶</a></h2>
<p>If you get the following error, it means that your remote server
probably use a self-signed SSL certificate and the server certificate
is not included in your CA bundle file.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span><span class="p">:</span> <span class="p">(</span><span class="mi">60</span><span class="p">)</span> <span class="n">SSL</span> <span class="n">certificate</span> <span class="n">problem</span><span class="p">,</span> <span class="n">verify</span> <span class="n">that</span> <span class="n">the</span> <span class="n">CA</span> <span class="n">cert</span> <span class="ow">is</span> <span class="n">OK</span><span class="o">.</span> <span class="n">Details</span><span class="p">:</span>
<span class="n">error</span><span class="p">:</span><span class="mi">14090086</span><span class="p">:</span><span class="n">SSL</span> <span class="n">routines</span><span class="p">:</span><span class="n">SSL3_GET_SERVER_CERTIFICATE</span><span class="p">:</span><span class="n">certificate</span> <span class="n">verify</span> <span class="n">failed</span>
<span class="n">More</span> <span class="n">details</span> <span class="n">here</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">curl</span><span class="o">.</span><span class="n">haxx</span><span class="o">.</span><span class="n">se</span><span class="o">/</span><span class="n">docs</span><span class="o">/</span><span class="n">sslcerts</span><span class="o">.</span><span class="n">html</span>

<span class="n">curl</span> <span class="n">performs</span> <span class="n">SSL</span> <span class="n">certificate</span> <span class="n">verification</span> <span class="n">by</span> <span class="n">default</span><span class="p">,</span> <span class="n">using</span> <span class="n">a</span> <span class="s2">&quot;bundle&quot;</span>
<span class="n">of</span> <span class="n">Certificate</span> <span class="n">Authority</span> <span class="p">(</span><span class="n">CA</span><span class="p">)</span> <span class="n">public</span> <span class="n">keys</span> <span class="p">(</span><span class="n">CA</span> <span class="n">certs</span><span class="p">)</span><span class="o">.</span> <span class="n">If</span> <span class="n">the</span> <span class="n">default</span>
<span class="n">bundle</span> <span class="n">file</span> <span class="n">isn</span><span class="s1">&#39;t adequate, you can specify an alternate file</span>
<span class="n">using</span> <span class="n">the</span> <span class="o">--</span><span class="n">cacert</span> <span class="n">option</span><span class="o">.</span>
<span class="n">If</span> <span class="n">this</span> <span class="n">HTTPS</span> <span class="n">server</span> <span class="n">uses</span> <span class="n">a</span> <span class="n">certificate</span> <span class="n">signed</span> <span class="n">by</span> <span class="n">a</span> <span class="n">CA</span> <span class="n">represented</span> <span class="ow">in</span>
<span class="n">the</span> <span class="n">bundle</span><span class="p">,</span> <span class="n">the</span> <span class="n">certificate</span> <span class="n">verification</span> <span class="n">probably</span> <span class="n">failed</span> <span class="n">due</span> <span class="n">to</span> <span class="n">a</span>
<span class="n">problem</span> <span class="k">with</span> <span class="n">the</span> <span class="n">certificate</span> <span class="p">(</span><span class="n">it</span> <span class="n">might</span> <span class="n">be</span> <span class="n">expired</span><span class="p">,</span> <span class="ow">or</span> <span class="n">the</span> <span class="n">name</span> <span class="n">might</span>
<span class="ow">not</span> <span class="n">match</span> <span class="n">the</span> <span class="n">domain</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">URL</span><span class="p">)</span><span class="o">.</span>
<span class="n">If</span> <span class="n">you</span><span class="s1">&#39;d like to turn off curl&#39;</span><span class="n">s</span> <span class="n">verification</span> <span class="n">of</span> <span class="n">the</span> <span class="n">certificate</span><span class="p">,</span> <span class="n">use</span>
<span class="n">the</span> <span class="o">-</span><span class="n">k</span> <span class="p">(</span><span class="ow">or</span> <span class="o">--</span><span class="n">insecure</span><span class="p">)</span> <span class="n">option</span><span class="o">.</span>
</pre></div>
</div>
<p>To get the remote server certificate you have to execute this command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">openssl</span> <span class="n">s_client</span> <span class="o">-</span><span class="n">connect</span> <span class="n">domainname</span><span class="p">:</span><span class="n">port</span>
</pre></div>
</div>
<p>Copy everything from the “—–BEGIN CERTIFICATE—–” tag to
“—–END CERTIFICATE—–” tag.  Paste it at the end of the
my-ca-bundle.ext file.</p>
<p>Verify your connection with the Curl command line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">targethostname</span><span class="p">:</span><span class="n">port</span><span class="o">/</span><span class="n">gmap</span><span class="o">-</span><span class="n">demo</span><span class="o">/</span><span class="n">gmap75</span><span class="o">.</span><span class="n">phtml</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Notitie</p>
<p>If you get the following error, it means that the domain name in
the URL request is not corresponding to the one that was declared
when creating the remote server certificate.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span><span class="p">:</span> <span class="p">(</span><span class="mi">51</span><span class="p">)</span> <span class="n">SSL</span><span class="p">:</span> <span class="n">certificate</span> <span class="n">subject</span> <span class="n">name</span> <span class="s1">&#39;domainname&#39;</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">match</span> <span class="n">target</span> <span class="n">host</span> <span class="n">name</span> <span class="s1">&#39;domainname&#39;</span>
</pre></div>
</div>
</div>
<p>You have to use the exact same domain name as the one appearing in the
“Common Name” prompt used when generating the remote server
certificate. You cannot use the remote server ip for instance. It
means that the following URL is not acceptable.</p>
<div class="highlight-mapfile notranslate"><div class="highlight"><pre><span></span><span class="k">CONNECTION</span> <span class="s">&quot;https://xxx.xxx.xxx.xxx:port/cgi-bin/mapserv?map=/path/to/wms.map&quot;</span>
<span class="k">CONNECTIONTYPE</span> <span class="nb">WMS</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Snel zoeken</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Zoek" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><h3>Navigation</h3>
<p>
<a href="../about.html" title="About">About</a><br>
<a href="../products.html" title="Products">Products</a><br>
<a href="../community/index.html" title="Community">Community</a><br>
<a href="../development/index.html" title="Development">Development</a><br>
<a href="../download.html" title="Downloads">Downloads</a><br>
<a href="../documentation.html" title="Documentation">Documentation</a><br>
<a href="../faq.html" title="FAQ">FAQ</a><br>
<a href="../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</h3>
  <ul>
<li><a class="reference internal" href="#">How to set up MapServer as a client to access a service over https</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#requirements">Requirements</a></li>
<li><a class="reference internal" href="#default-installation-with-apt-get-install-rpm-manual-etc">Default Installation (with apt-get install, rpm, manual, etc)</a></li>
<li><a class="reference internal" href="#non-standard-installation-common-with-ms4w-and-fgs">Non-Standard Installation (common with ms4w and fgs)</a></li>
<li><a class="reference internal" href="#remote-server-with-a-self-signed-ssl-certificate">Remote Server with a Self-Signed SSL Certificate</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigatie</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Algemene index"
             >index</a></li>
        <li class="right" >
          <a href="mapscript.html" title="MapScript Wrappers for WxS Services"
             >volgende</a> |</li>
        <li class="right" >
          <a href="sos_server.html" title="SOS Server"
             >vorige</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../documentation.html" >MapServer 7.4.2 Documentation</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >OGC Support and Configuration</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; <a href="../copyright.html">Copyright</a> 2019, Open Source Geospatial Foundation.
      Laatste aanpassing op 2019-12-05.
      Aangemaakt met <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.2.
    </div>
  </body>
</html>