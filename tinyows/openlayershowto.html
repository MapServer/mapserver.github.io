<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Sample: WFS-T with TinyOWS and OpenLayers &mdash; MapServer 7.0.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '7.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="top" title="MapServer 7.0.0 documentation" href="../index.html" />
    <link rel="up" title="TinyOWS" href="index.html" />
    <link rel="next" title="Server Tuning: How to speed up your TinyOWS server" href="servertuning.html" />
    <link rel="prev" title="Configuring TinyOWS with a standard Mapfile" href="mapfileconfig.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../index.html" title="Home"><img src="../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../index.html" title="Home">Home</a> |
      <a href="../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../faq.html" title="FAQ">FAQ</a> |
      <a href="../download.html" title="Download">Download </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../ar/tinyows/openlayershowto.html"><img src="../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../de/tinyows/openlayershowto.html"><img src="../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../el/tinyows/openlayershowto.html"><img src="../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../es/tinyows/openlayershowto.html"><img src="../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../fr/tinyows/openlayershowto.html"><img src="../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../id/tinyows/openlayershowto.html"><img src="../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../it/tinyows/openlayershowto.html"><img src="../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../ja/tinyows/openlayershowto.html"><img src="../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../nl_NL/tinyows/openlayershowto.html"><img src="../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../pl/tinyows/openlayershowto.html"><img src="../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../ru/tinyows/openlayershowto.html"><img src="../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../sq/tinyows/openlayershowto.html"><img src="../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../tr/tinyows/openlayershowto.html"><img src="../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        
        
          <a href="../uk/tinyows/openlayershowto.html"><img src="../_static/flagicons/uk.png" alt="uk" title="uk" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="servertuning.html" title="Server Tuning: How to speed up your TinyOWS server"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="mapfileconfig.html" title="Configuring TinyOWS with a standard Mapfile"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../documentation.html" >MapServer 7.0.0 Documentation</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">TinyOWS</a> &raquo;</li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="sample-wfs-t-with-tinyows-and-openlayers">
<span id="tinyows-openlayershowtotransactional"></span><h1>Sample: WFS-T with TinyOWS and OpenLayers<a class="headerlink" href="#sample-wfs-t-with-tinyows-and-openlayers" title="Permalink to this headline">Â¶</a></h1>
<ol class="arabic simple" start="0">
<li>Install PostGIS and TinyOWS (<a class="reference internal" href="serverinstallation.html#tinyows-serverinstallation"><span>TinyOWS Installation</span></a>)</li>
<li>Within PostGIS, create a spatial database called &#8216;tinyows&#8217;</li>
</ol>
<div class="highlight-bash"><div class="highlight"><pre><span></span>createdb -U postgres tinyows
psql -U postgres -d tinyows &lt; <span class="sb">`</span>pg_config --sharedir<span class="sb">`</span>/contrib/postgis-2.0/postgis.sql
psql -U postgres -d tinyows &lt; <span class="sb">`</span>pg_config --sharedir<span class="sb">`</span>/contrib/postgis-2.0/spatial_ref_sys.sql
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>Import Frida data (we will use the parks layer) into your PostGIS database</li>
</ol>
<div class="highlight-bash"><div class="highlight"><pre><span></span>wget ftp://ftp.intevation.de/freegis/frida/frida-1.0.1-shp.tar.gz
tar xvzf frida-1.0.1-shp.tar.gz
<span class="nb">cd</span> frida-1.0.1-shp
shp2pgsql -g geom -s <span class="m">31467</span> -W LATIN1 -I gruenflaechen.shp frida <span class="p">|</span> psql -U postgres -d tinyows
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li>Configure TinyOWS by editing /usr/local/tinyows/config.xml</li>
</ol>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;tinyows</span> <span class="na">online_resource=</span><span class="s">&quot;http://127.0.0.1/cgi-bin/tinyows&quot;</span>
         <span class="na">schema_dir=</span><span class="s">&quot;/usr/local/share/tinyows/schema/&quot;</span><span class="nt">&gt;</span>

<span class="nt">&lt;pg</span> <span class="na">host=</span><span class="s">&quot;127.0.0.1&quot;</span> <span class="na">user=</span><span class="s">&quot;postgres&quot;</span> <span class="na">password=</span><span class="s">&quot;postgres&quot;</span> <span class="na">dbname=</span><span class="s">&quot;tinyows&quot;</span> <span class="na">port=</span><span class="s">&quot;5432&quot;</span><span class="nt">/&gt;</span>

<span class="nt">&lt;metadata</span> <span class="na">name=</span><span class="s">&quot;TinyOWS Server&quot;</span>
          <span class="na">title=</span><span class="s">&quot;TinyOWS Server - WFS-T Frida Service&quot;</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;contact</span> <span class="na">name=</span><span class="s">&quot;TinyOWS Server&quot;</span>
         <span class="na">site=</span><span class="s">&quot;http://www.tinyows.org/&quot;</span>
         <span class="na">email=</span><span class="s">&quot;tinyows-users@lists.maptools.org&quot;</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;layer</span> <span class="na">retrievable=</span><span class="s">&quot;1&quot;</span>
       <span class="na">writable=</span><span class="s">&quot;1&quot;</span>
       <span class="na">ns_prefix=</span><span class="s">&quot;tows&quot;</span>
       <span class="na">ns_uri=</span><span class="s">&quot;http://www.tinyows.org/&quot;</span>
       <span class="na">name=</span><span class="s">&quot;frida&quot;</span>
       <span class="na">title=</span><span class="s">&quot;Frida Parks&quot;</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;/tinyows&gt;</span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li>Test your installations of TinyOWS and PostGIS</li>
</ol>
<div class="highlight-bash"><div class="highlight"><pre><span></span>./YOUR_CGI-BIN_PATH/tinyows --check
TinyOWS version:   1.1.0
FCGI support:      Yes
Config File Path:  /etc/tinyows.xml <span class="o">(</span>TinyOWS XML<span class="o">)</span>
PostGIS Version:   2.0.1
PostGIS dsn:       <span class="nv">host</span><span class="o">=</span>127.0.0.1 <span class="nv">user</span><span class="o">=</span>postgres <span class="nv">password</span><span class="o">=</span>postgres <span class="nv">dbname</span><span class="o">=</span>tinyows <span class="nv">port</span><span class="o">=</span>5432
Output Encoding:   UTF-8
Database Encoding: UTF8
Schema dir:        /usr/local/share/tinyows/schema/
Display bbox:      Yes
Estimated extent:  No
Check schema:      Yes
Check valid geoms: Yes
Available layers:
 - public.frida <span class="o">(</span>31467<span class="o">)</span> -&gt; tows:frida <span class="o">[</span>RW<span class="o">]</span>
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li>Install OpenLayers</li>
</ol>
<div class="highlight-bash"><div class="highlight"><pre><span></span>wget http://openlayers.org/download/OpenLayers-2.12.tar.gz
tar xvzf OpenLayers-2.12.tar.gz
sudo mv OpenLayers-2.12  /YOUR/SERVER/HTDOCS/
</pre></div>
</div>
<ol class="arabic simple" start="6">
<li>Install the OpenLayers proxy (you need the Python interpreter to make it work)</li>
</ol>
<div class="highlight-bash"><div class="highlight"><pre><span></span>sudo cp OpenLayers-2.12/examples/proxy.cgi  /YOUR/SERVER/CGI-BIN/
</pre></div>
</div>
<ol class="arabic simple" start="7">
<li>Add your server IP to proxy allowedHosts in (/YOUR/SERVER/CGI-BIN/proxy.cgi)</li>
</ol>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">allowedHosts</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;127.0.0.1&#39;</span>, <span class="s1">&#39;www.openlayers.org&#39;</span>, <span class="s1">&#39;openlayers.org&#39;</span>, ... <span class="o">]</span>
</pre></div>
</div>
<ol class="arabic simple" start="8">
<li>Create a new file at OpenLayers-2.12/examples/tinyows.html</li>
</ol>
<div class="highlight-html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;../theme/default/style.css&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/css&quot;</span> <span class="p">/&gt;</span>
  <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;style.css&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/css&quot;</span> <span class="p">/&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;../lib/OpenLayers.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
      <span class="nn">#map</span> <span class="p">{</span>
          <span class="nb">width</span><span class="o">:</span> <span class="m">800px</span><span class="p">;</span>
          <span class="nb">height</span><span class="o">:</span> <span class="m">500px</span><span class="p">;</span>
          <span class="nb">float</span><span class="o">:</span> <span class="nb">left</span><span class="p">;</span>
          <span class="nb">border</span><span class="o">:</span> <span class="m">1px</span> <span class="nb">solid</span> <span class="m">#ccc</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nn">#message</span> <span class="p">{</span>
          <span class="nb">position</span><span class="o">:</span> <span class="nb">relative</span><span class="p">;</span>
          <span class="nb">left</span><span class="o">:</span> <span class="m">5px</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nn">#docs</span> <span class="p">{</span>
          <span class="nb">float</span><span class="o">:</span> <span class="nb">left</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nc">.customEditingToolbar</span> <span class="p">{</span>
          <span class="nb">float</span><span class="o">:</span> <span class="nb">right</span><span class="p">;</span>
          <span class="nb">right</span><span class="o">:</span> <span class="m">0px</span><span class="p">;</span>
          <span class="nb">height</span><span class="o">:</span> <span class="m">30px</span><span class="p">;</span>
          <span class="nb">width</span><span class="o">:</span> <span class="m">200px</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nc">.customEditingToolbar</span> <span class="nt">div</span> <span class="p">{</span>
          <span class="nb">float</span><span class="o">:</span> <span class="nb">right</span><span class="p">;</span>
          <span class="nb">margin</span><span class="o">:</span> <span class="m">5px</span><span class="p">;</span>
          <span class="nb">width</span><span class="o">:</span> <span class="m">24px</span><span class="p">;</span>
          <span class="nb">height</span><span class="o">:</span> <span class="m">24px</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nc">.olControlNavigationItemActive</span> <span class="p">{</span>
          <span class="nb">background-image</span><span class="o">:</span> <span class="sx">url(&quot;../theme/default/img/editing_tool_bar.png&quot;)</span><span class="p">;</span>
          <span class="nb">background-repeat</span><span class="o">:</span> <span class="nb">no-repeat</span><span class="p">;</span>
          <span class="nb">background-position</span><span class="o">:</span> <span class="m">-103px</span> <span class="m">-23px</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nc">.olControlNavigationItemInactive</span> <span class="p">{</span>
          <span class="nb">background-image</span><span class="o">:</span> <span class="sx">url(&quot;../theme/default/img/editing_tool_bar.png&quot;)</span><span class="p">;</span>
          <span class="nb">background-repeat</span><span class="o">:</span> <span class="nb">no-repeat</span><span class="p">;</span>
          <span class="nb">background-position</span><span class="o">:</span> <span class="m">-103px</span> <span class="m">-0px</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nc">.olControlDrawFeaturePolygonItemInactive</span> <span class="p">{</span>
          <span class="nb">background-image</span><span class="o">:</span> <span class="sx">url(&quot;../theme/default/img/editing_tool_bar.png&quot;)</span><span class="p">;</span>
          <span class="nb">background-repeat</span><span class="o">:</span> <span class="nb">no-repeat</span><span class="p">;</span>
          <span class="nb">background-position</span><span class="o">:</span> <span class="m">-26px</span> <span class="m">0px</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nc">.olControlDrawFeaturePolygonItemActive</span> <span class="p">{</span>
          <span class="nb">background-image</span><span class="o">:</span> <span class="sx">url(&quot;../theme/default/img/editing_tool_bar.png&quot;)</span><span class="p">;</span>
          <span class="nb">background-repeat</span><span class="o">:</span> <span class="nb">no-repeat</span><span class="p">;</span>
          <span class="nb">background-position</span><span class="o">:</span> <span class="m">-26px</span> <span class="m">-23px</span> <span class="p">;</span>
      <span class="p">}</span>
      <span class="nc">.olControlModifyFeatureItemActive</span> <span class="p">{</span>
          <span class="nb">background-image</span><span class="o">:</span> <span class="sx">url(../theme/default/img/move_feature_on.png)</span><span class="p">;</span>
          <span class="nb">background-repeat</span><span class="o">:</span> <span class="nb">no-repeat</span><span class="p">;</span>
          <span class="nb">background-position</span><span class="o">:</span> <span class="m">0px</span> <span class="m">1px</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nc">.olControlModifyFeatureItemInactive</span> <span class="p">{</span>
          <span class="nb">background-image</span><span class="o">:</span> <span class="sx">url(../theme/default/img/move_feature_off.png)</span><span class="p">;</span>
          <span class="nb">background-repeat</span><span class="o">:</span> <span class="nb">no-repeat</span><span class="p">;</span>
          <span class="nb">background-position</span><span class="o">:</span> <span class="m">0px</span> <span class="m">1px</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nc">.olControlDeleteFeatureItemActive</span> <span class="p">{</span>
          <span class="nb">background-image</span><span class="o">:</span> <span class="sx">url(../theme/default/img/remove_point_on.png)</span><span class="p">;</span>
          <span class="nb">background-repeat</span><span class="o">:</span> <span class="nb">no-repeat</span><span class="p">;</span>
          <span class="nb">background-position</span><span class="o">:</span> <span class="m">0px</span> <span class="m">1px</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nc">.olControlDeleteFeatureItemInactive</span> <span class="p">{</span>
          <span class="nb">background-image</span><span class="o">:</span> <span class="sx">url(../theme/default/img/remove_point_off.png)</span><span class="p">;</span>
          <span class="nb">background-repeat</span><span class="o">:</span> <span class="nb">no-repeat</span><span class="p">;</span>
          <span class="nb">background-position</span><span class="o">:</span> <span class="m">0px</span> <span class="m">1px</span><span class="p">;</span>
      <span class="p">}</span>
  <span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;tinyows.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span> <span class="na">onload</span><span class="o">=</span><span class="s">&quot;init()&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;title&quot;</span><span class="p">&gt;</span>WFS Transaction Example, (TinyOWS ans OpenLayers)<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;tags&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">p</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;shortdesc&quot;</span><span class="p">&gt;</span>
          Shows the use of the WFS Transactions (WFS-T).
          Parks of Osnabruck (Frida).
      <span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
          Base layers is OpenStreetMap from Omniscale WMS Server.
      <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;map&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;message&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;docs&quot;</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
              The WFS protocol allows for creation of new features and
              reading, updating, or deleting of existing features.
          <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
              Use the tools to create, modify, and delete (in order from left
              to right) features. Use the save tool (picture of a disk) to
              save your changes. Use the navigation tool (hand) to stop
              editing and use the mouse for map navigation.
          <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
              See the <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;tinyows.js&quot;</span> <span class="na">target</span><span class="o">=</span><span class="s">&quot;_blank&quot;</span><span class="p">&gt;</span>
              wfs-protocol-transactions.js source<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> to see how this is done.
          <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
<ol class="arabic simple" start="9">
<li>Create a new file at OpenLayers-2.12/examples/tinyows.js (and replace all 127.0.0.1 addresses by your IP server if necessary)</li>
</ol>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">map</span><span class="p">,</span> <span class="nx">wfs</span><span class="p">;</span>
<span class="nx">OpenLayers</span><span class="p">.</span><span class="nx">ProxyHost</span> <span class="o">=</span> <span class="s2">&quot;/cgi-bin/proxy.cgi?url=&quot;</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">DeleteFeature</span> <span class="o">=</span> <span class="nx">OpenLayers</span><span class="p">.</span><span class="nx">Class</span><span class="p">(</span><span class="nx">OpenLayers</span><span class="p">.</span><span class="nx">Control</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">layer</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">OpenLayers</span><span class="p">.</span><span class="nx">Control</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">initialize</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="p">[</span><span class="nx">options</span><span class="p">]);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">layer</span> <span class="o">=</span> <span class="nx">layer</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">handler</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">OpenLayers</span><span class="p">.</span><span class="nx">Handler</span><span class="p">.</span><span class="nx">Feature</span><span class="p">(</span>
          <span class="k">this</span><span class="p">,</span> <span class="nx">layer</span><span class="p">,</span> <span class="p">{</span><span class="nx">click</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">clickFeature</span><span class="p">}</span>
      <span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">clickFeature</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">feature</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// if feature doesn&#39;t have a fid, destroy it</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">feature</span><span class="p">.</span><span class="nx">fid</span> <span class="o">==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">layer</span><span class="p">.</span><span class="nx">destroyFeatures</span><span class="p">([</span><span class="nx">feature</span><span class="p">]);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">feature</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="nx">OpenLayers</span><span class="p">.</span><span class="nx">State</span><span class="p">.</span><span class="nx">DELETE</span><span class="p">;</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">layer</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">triggerEvent</span><span class="p">(</span><span class="s2">&quot;afterfeaturemodified&quot;</span><span class="p">,</span>
                                         <span class="p">{</span><span class="nx">feature</span><span class="o">:</span> <span class="nx">feature</span><span class="p">});</span>
          <span class="nx">feature</span><span class="p">.</span><span class="nx">renderIntent</span> <span class="o">=</span> <span class="s2">&quot;select&quot;</span><span class="p">;</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">layer</span><span class="p">.</span><span class="nx">drawFeature</span><span class="p">(</span><span class="nx">feature</span><span class="p">);</span>
      <span class="p">}</span>
  <span class="p">},</span>
  <span class="nx">setMap</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">map</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">handler</span><span class="p">.</span><span class="nx">setMap</span><span class="p">(</span><span class="nx">map</span><span class="p">);</span>
      <span class="nx">OpenLayers</span><span class="p">.</span><span class="nx">Control</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setMap</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">CLASS_NAME</span><span class="o">:</span> <span class="s2">&quot;OpenLayers.Control.DeleteFeature&quot;</span>
<span class="p">});</span>
<span class="kd">function</span> <span class="nx">showMsg</span><span class="p">(</span><span class="nx">szMessage</span><span class="p">)</span> <span class="p">{</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">).</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">szMessage</span><span class="p">;</span>
  <span class="nx">setTimeout</span><span class="p">(</span>
      <span class="s2">&quot;document.getElementById(&#39;message&#39;).innerHTML = &#39;&#39;&quot;</span><span class="p">,</span><span class="mi">2000</span><span class="p">);</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">showSuccessMsg</span><span class="p">(){</span>
  <span class="nx">showMsg</span><span class="p">(</span><span class="s2">&quot;Transaction successfully completed&quot;</span><span class="p">);</span>
<span class="p">};</span>
<span class="kd">function</span> <span class="nx">showFailureMsg</span><span class="p">(){</span>
  <span class="nx">showMsg</span><span class="p">(</span><span class="s2">&quot;An error occurred while operating the transaction&quot;</span><span class="p">);</span>
<span class="p">};</span>
<span class="kd">function</span> <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">OpenLayers</span><span class="p">.</span><span class="nx">Map</span><span class="p">(</span><span class="s1">&#39;map&#39;</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">projection</span><span class="o">:</span> <span class="k">new</span> <span class="nx">OpenLayers</span><span class="p">.</span><span class="nx">Projection</span><span class="p">(</span><span class="s2">&quot;EPSG:31467&quot;</span><span class="p">),</span>
      <span class="nx">units</span><span class="o">:</span> <span class="s2">&quot;m&quot;</span><span class="p">,</span>
      <span class="nx">maxResolution</span><span class="o">:</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
      <span class="nx">maxExtent</span><span class="o">:</span> <span class="k">new</span> <span class="nx">OpenLayers</span><span class="p">.</span><span class="nx">Bounds</span><span class="p">(</span><span class="mi">3427000</span><span class="p">,</span><span class="mi">5788000</span><span class="p">,</span><span class="mi">3444000</span><span class="p">,</span><span class="mi">5800000</span><span class="p">),</span>
      <span class="nx">controls</span><span class="o">:</span> <span class="p">[</span>
          <span class="k">new</span> <span class="nx">OpenLayers</span><span class="p">.</span><span class="nx">Control</span><span class="p">.</span><span class="nx">PanZoom</span><span class="p">()</span>
      <span class="p">]</span>
  <span class="p">});</span>
  <span class="kd">var</span> <span class="nx">osm</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">OpenLayers</span><span class="p">.</span><span class="nx">Layer</span><span class="p">.</span><span class="nx">WMS</span><span class="p">(</span>
      <span class="s2">&quot;OSM by Omniscale WMS&quot;</span><span class="p">,</span>
      <span class="s2">&quot;http://osm.omniscale.net/proxy/service&quot;</span><span class="p">,</span>
      <span class="p">{</span><span class="nx">layers</span><span class="o">:</span> <span class="s1">&#39;osm&#39;</span><span class="p">,</span> <span class="nx">format</span><span class="o">:</span> <span class="s1">&#39;image/jpeg&#39;</span><span class="p">},</span>
      <span class="p">{</span><span class="nx">projection</span><span class="o">:</span><span class="s2">&quot;EPSG:31467&quot;</span><span class="p">,</span>  <span class="nx">units</span><span class="o">:</span> <span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="nx">maxResolution</span><span class="o">:</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="nx">maxExtent</span><span class="o">:</span> <span class="k">new</span> <span class="nx">OpenLayers</span><span class="p">.</span><span class="nx">Bounds</span><span class="p">(</span><span class="mi">3427000</span><span class="p">,</span><span class="mi">5788000</span><span class="p">,</span><span class="mi">3444000</span><span class="p">,</span><span class="mi">5800000</span><span class="p">)}</span>
  <span class="p">);</span>
  <span class="kd">var</span> <span class="nx">saveStrategy</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">OpenLayers</span><span class="p">.</span><span class="nx">Strategy</span><span class="p">.</span><span class="nx">Save</span><span class="p">();</span>
  <span class="nx">saveStrategy</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;success&quot;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">showSuccessMsg</span><span class="p">);</span>
  <span class="nx">saveStrategy</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;fail&quot;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">showFailureMsg</span><span class="p">);</span>
  <span class="nx">wfs</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">OpenLayers</span><span class="p">.</span><span class="nx">Layer</span><span class="p">.</span><span class="nx">Vector</span><span class="p">(</span><span class="s2">&quot;Editable Features&quot;</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">strategies</span><span class="o">:</span> <span class="p">[</span><span class="k">new</span> <span class="nx">OpenLayers</span><span class="p">.</span><span class="nx">Strategy</span><span class="p">.</span><span class="nx">BBOX</span><span class="p">(),</span> <span class="nx">saveStrategy</span><span class="p">],</span>
      <span class="nx">projection</span><span class="o">:</span> <span class="k">new</span> <span class="nx">OpenLayers</span><span class="p">.</span><span class="nx">Projection</span><span class="p">(</span><span class="s2">&quot;EPSG:31467&quot;</span><span class="p">),</span>
      <span class="nx">protocol</span><span class="o">:</span> <span class="k">new</span> <span class="nx">OpenLayers</span><span class="p">.</span><span class="nx">Protocol</span><span class="p">.</span><span class="nx">WFS</span><span class="p">({</span>
          <span class="nx">version</span><span class="o">:</span> <span class="s2">&quot;1.1.0&quot;</span><span class="p">,</span>
          <span class="nx">srsName</span><span class="o">:</span> <span class="s2">&quot;EPSG:31467&quot;</span><span class="p">,</span>
          <span class="nx">url</span><span class="o">:</span> <span class="s2">&quot;http://127.0.0.1/cgi-bin/tinyows&quot;</span><span class="p">,</span>
          <span class="nx">featureNS</span> <span class="o">:</span>  <span class="s2">&quot;http://www.tinyows.org/&quot;</span><span class="p">,</span>
          <span class="nx">featureType</span><span class="o">:</span> <span class="s2">&quot;frida&quot;</span><span class="p">,</span>
          <span class="nx">geometryName</span><span class="o">:</span> <span class="s2">&quot;geom&quot;</span><span class="p">,</span>
          <span class="nx">schema</span><span class="o">:</span> <span class="s2">&quot;http://127.0.0.1/cgi-bin/tinyows?service=wfs&amp;request=DescribeFeatureType&amp;version=1.1.0&amp;typename=tows:frida&quot;</span>
      <span class="p">})</span>
  <span class="p">});</span>
  <span class="nx">map</span><span class="p">.</span><span class="nx">addLayers</span><span class="p">([</span><span class="nx">osm</span><span class="p">,</span> <span class="nx">wfs</span><span class="p">]);</span>
  <span class="kd">var</span> <span class="nx">panel</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">OpenLayers</span><span class="p">.</span><span class="nx">Control</span><span class="p">.</span><span class="nx">Panel</span><span class="p">(</span>
      <span class="p">{</span><span class="s1">&#39;displayClass&#39;</span><span class="o">:</span> <span class="s1">&#39;customEditingToolbar&#39;</span><span class="p">}</span>
  <span class="p">);</span>
  <span class="kd">var</span> <span class="nx">navigate</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">OpenLayers</span><span class="p">.</span><span class="nx">Control</span><span class="p">.</span><span class="nx">Navigation</span><span class="p">({</span>
      <span class="nx">title</span><span class="o">:</span> <span class="s2">&quot;Pan Map&quot;</span>
  <span class="p">});</span>
  <span class="kd">var</span> <span class="nx">draw</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">OpenLayers</span><span class="p">.</span><span class="nx">Control</span><span class="p">.</span><span class="nx">DrawFeature</span><span class="p">(</span>
      <span class="nx">wfs</span><span class="p">,</span> <span class="nx">OpenLayers</span><span class="p">.</span><span class="nx">Handler</span><span class="p">.</span><span class="nx">Polygon</span><span class="p">,</span>
      <span class="p">{</span>
          <span class="nx">title</span><span class="o">:</span> <span class="s2">&quot;Draw Feature&quot;</span><span class="p">,</span>
          <span class="nx">displayClass</span><span class="o">:</span> <span class="s2">&quot;olControlDrawFeaturePolygon&quot;</span><span class="p">,</span>
          <span class="nx">multi</span><span class="o">:</span> <span class="kc">true</span>
      <span class="p">}</span>
  <span class="p">);</span>
  <span class="kd">var</span> <span class="nx">edit</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">OpenLayers</span><span class="p">.</span><span class="nx">Control</span><span class="p">.</span><span class="nx">ModifyFeature</span><span class="p">(</span><span class="nx">wfs</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">title</span><span class="o">:</span> <span class="s2">&quot;Modify Feature&quot;</span><span class="p">,</span>
      <span class="nx">displayClass</span><span class="o">:</span> <span class="s2">&quot;olControlModifyFeature&quot;</span>
  <span class="p">});</span>
  <span class="kd">var</span> <span class="nx">del</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DeleteFeature</span><span class="p">(</span><span class="nx">wfs</span><span class="p">,</span> <span class="p">{</span><span class="nx">title</span><span class="o">:</span> <span class="s2">&quot;Delete Feature&quot;</span><span class="p">});</span>
  <span class="kd">var</span> <span class="nx">save</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">OpenLayers</span><span class="p">.</span><span class="nx">Control</span><span class="p">.</span><span class="nx">Button</span><span class="p">({</span>
      <span class="nx">title</span><span class="o">:</span> <span class="s2">&quot;Save Changes&quot;</span><span class="p">,</span>
      <span class="nx">trigger</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="k">if</span><span class="p">(</span><span class="nx">edit</span><span class="p">.</span><span class="nx">feature</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">edit</span><span class="p">.</span><span class="nx">selectControl</span><span class="p">.</span><span class="nx">unselectAll</span><span class="p">();</span>
          <span class="p">}</span>
          <span class="nx">saveStrategy</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span>
      <span class="p">},</span>
      <span class="nx">displayClass</span><span class="o">:</span> <span class="s2">&quot;olControlSaveFeatures&quot;</span>
  <span class="p">});</span>
  <span class="nx">panel</span><span class="p">.</span><span class="nx">addControls</span><span class="p">([</span><span class="nx">navigate</span><span class="p">,</span> <span class="nx">save</span><span class="p">,</span> <span class="nx">del</span><span class="p">,</span> <span class="nx">edit</span><span class="p">,</span> <span class="nx">draw</span><span class="p">]);</span>
  <span class="nx">panel</span><span class="p">.</span><span class="nx">defaultControl</span> <span class="o">=</span> <span class="nx">navigate</span><span class="p">;</span>
  <span class="nx">map</span><span class="p">.</span><span class="nx">addControl</span><span class="p">(</span><span class="nx">panel</span><span class="p">);</span>
  <span class="nx">map</span><span class="p">.</span><span class="nx">zoomToMaxExtent</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Navigation</h3>
<p>
<a href="../about.html" title="About">About</a><br>
<a href="../products.html" title="Products">Products</a><br>
<a href="../community/index.html" title="Community">Community</a><br>
<a href="../development/index.html" title="Development">Development</a><br>
<a href="../download.html" title="Downloads">Downloads</a><br>
<a href="../documentation.html" title="Documentation">Documentation</a><br>
<a href="../faq.html" title="FAQ">FAQ</a>
</p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Open Source Geospatial Foundation.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.4</a>
      
    </div>

    

    
  </body>
</html>